<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samsung AI Experience Group Dashboard</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a1a;
            color: #e1e1e1;
            overflow-x: hidden;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #2a2a2a;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3a3a3a;
        }

        .dashboard-container {
            display: flex;
            height: 100vh;
            align-items: stretch;
        }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            width: 250px;
            background-color: #2a2a2a;
            color: #b1b1b1;
            border-right: 1px solid #3a3a3a;
            display: flex;
            flex-direction: column;
        }



        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #b1b1b1;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        .menu-item:hover {
            background-color: #3a3a3a;
            color: #fff;
        }

        .menu-item.active {
            background-color: #4a4a4a;
            color: #fff;
        }

        .refresh-button {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #b1b1b1;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        .refresh-button:hover {
            background-color: #3a3a3a;
            color: #fff;
        }

        .refresh-progress {
            position: absolute;
            bottom: -10px;
            left: 20px;
            right: 20px;
            height: 6px;
            background-color: #2a2a2a;
            border-radius: 3px;
            overflow: hidden;
            display: none;
        }

        .refresh-progress-bar {
            height: 100%;
            background-color: #4a9eff;
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .refresh-button {
            position: relative;
        }

        .menu-icon {
            width: 16px;
            height: 16px;
            margin-right: 12px;
            opacity: 0.7;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content {
            flex: 1;
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #1a1a1a; /* ë°°ê²½ìƒ‰ ê²€ì •ìœ¼ë¡œ ë³€ê²½ */
            padding: 20px 30px;
            height: 80px;
            box-sizing: border-box;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* í—¤ë” ì•„ë˜ ì„ ì— ì—¬ë°± ì¶”ê°€ */
        .header::after {
            content: '';
            position: absolute;
            left: 30px;
            right: 30px;
            bottom: 0;
            height: 1px;
            background-color: #3a3a3a;
        }



        .header-left h1 {
            color: #fff;
            font-size: 24px;
            font-weight: 600;
        }

        .content-area {
            padding: 30px;
            min-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        /* ê¸°ë³¸ ìˆ¨ê¹€ ì²˜ë¦¬ */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Overview í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .overview-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-stat-box {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .overview-stat-box:hover {
            background-color: #3a3a3a;
            border-color: #4a4a4a;
        }

        .overview-stat-box.clickable {
            cursor: pointer;
        }

        .overview-stat-box.selected {
            background-color: #3a3a3a;
            border-color: #5a9eff;
            box-shadow: 0 0 10px rgba(90, 158, 255, 0.3);
        }

        .overview-stat-box.selected .stat-number,
        .overview-stat-box.selected .stat-label,
        .overview-stat-box.selected .stat-description {
            color: white;
        }

        .overview-stat-box .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }

        .overview-stat-box .stat-label {
            font-size: 16px;
            font-weight: 600;
            color: #e1e1e1;
            margin-bottom: 4px;
        }

        .overview-stat-box .stat-description {
            font-size: 12px;
            color: #b1b1b1;
        }

        .overview-chart-container {
            background-color: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            background-color: transparent;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-period-display {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 8px 16px;
            margin-right: 8px;
            min-width: 220px;
        }

        .filter-period-display span {
            color: #ff9800;
            font-size: 14px;
            font-weight: 600;
        }

        .chart-btn {
            background-color: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #b1b1b1;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-btn:hover {
            background-color: #4a4a4a;
            color: #fff;
        }

        .chart-btn.active {
            background-color: #4a9eff;
            border-color: #4a9eff;
            color: white;
        }

        .overview-member-details {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            overflow: hidden;
        }

        .member-details-header {
            background-color: #1a1a1a;
            color: #fff;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .member-details-header h3 {
            font-size: 18px;
            font-weight: 600;
        }



        .member-list {
            display: grid;
            gap: 0;
        }

        .member-list-header {
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr 1fr;
            gap: 20px;
            padding: 12px 20px;
            background-color: #2a2a2a;
            color: #b1b1b1;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            border-bottom: 2px solid #3a3a3a;
        }

        .member-item {
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            padding: 12px 20px;
            background-color: #1a1a1a;
            border-bottom: 1px solid #3a3a3a;
            font-size: 14px;
        }

        .member-item:hover {
            background-color: #2a2a2a;
        }

        .member-item:last-child {
            border-bottom: none;
        }

        .member-date {
            color: #b1b1b1;
            font-size: 13px;
        }

        .member-email {
            color: #b1b1b1;
        }

        .clickable-email {
            color: #4a9eff;
            cursor: pointer;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .clickable-email:hover {
            color: #2196f3;
            text-decoration: underline;
        }

        .member-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .member-type.active {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .member-type.inactive {
            background-color: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        .member-kind {
            color: #e1e1e1;
            font-size: 13px;
        }

        .member-request {
            color: #fff;
            font-weight: 500;
        }

        .member-spend {
            color: #4a9eff;
            font-weight: 600;
        }

        /* í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
        .activity-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background-color: #2a2a2a;
            border-top: 1px solid #3a3a3a;
        }

        .activity-pagination button {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #e1e1e1;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .activity-pagination button:hover {
            background: #4a4a4a;
        }

        .activity-pagination button.active {
            background: #4a9eff;
            border-color: #4a9eff;
            color: white;
        }

        .activity-pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .activity-pagination .page-info {
            color: #b1b1b1;
            font-size: 12px;
            margin: 0 10px;
        }

        .activity-page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .activity-page-size-selector select {
            background: #3a3a3a;
            color: #fff;
            border: 1px solid #4a4a4a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
        .user-cumulative-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background-color: #2a2a2a;
            border-top: 1px solid #3a3a3a;
        }
        
        .user-cumulative-pagination button {
            background: #3a3a3a;
            color: #e1e1e1;
            border: 1px solid #4a4a4a;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .user-cumulative-pagination button:hover:not(:disabled) {
            background: #4a4a4a;
            border-color: #5a5a5a;
        }
        
        .user-cumulative-pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .user-cumulative-pagination .page-info {
            color: #b1b1b1;
            font-size: 14px;
            min-width: 120px;
            text-align: center;
        }
        
        .user-cumulative-page-size-selector {
            display: flex;
            align-items: center;
        }

        /* ì°¨íŠ¸ ì„ íƒê¸° ìŠ¤íƒ€ì¼ */
        .chart-selector {
            margin-bottom: 20px;
        }

        .chart-selector select {
            padding: 10px 16px;
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            color: #e1e1e1;
            font-size: 14px;
            cursor: pointer;
            min-width: 250px;
            transition: all 0.3s ease;
        }

        .chart-selector select:hover {
            border-color: #4a9eff;
        }

        .chart-selector select:focus {
            outline: none;
            border-color: #4a9eff;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
        }

        .chart-content {
            display: none;
            background-color: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 0 6px 6px 6px;
            padding: 20px;
        }

        .chart-content.active {
            display: block;
        }

        .user-cumulative-page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-cumulative-page-size-selector select {
            background: #3a3a3a;
            color: #fff;
            border: 1px solid #4a4a4a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        /* Members í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ (All Raw Eventsì™€ ë™ì¼) */
        #members-pagination button {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #e1e1e1;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 2px;
            transition: all 0.2s ease;
        }

        #members-pagination button:hover {
            background: #4a4a4a;
            border-color: #5a5a5a;
        }

        #members-pagination button.active {
            background: #4a9eff;
            border-color: #4a9eff;
            color: white;
            font-weight: 600;
        }

        #members-pagination span {
            color: #7a7a7a;
            padding: 0 5px;
        }

        /* í•„í„° ë° ê²€ìƒ‰ ì˜ì—­ */
        .filter-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 0;
            border-bottom: 1px solid #3a3a3a;
        }

        /* Members ì„¹ì…˜ì—ì„œ êµ¬ë¶„ì„  ì œê±° ë° ê°„ê²© ì¶•ì†Œ */
        #members .filter-controls {
            border-bottom: none;
            margin-bottom: 15px;
            padding: 10px 0;
        }

        .filter-controls         .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-picker input[type="date"] {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 8px 12px;
            color: #fff;
            font-size: 14px;
        }

        /* ë‹¬ë ¥ ì•„ì´ì½˜ ìƒ‰ìƒ ë³€ê²½ */
        .date-picker input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1) brightness(1.5) sepia(1) saturate(5) hue-rotate(45deg);
            cursor: pointer;
        }

        .date-picker input[type="date"]::-moz-calendar-picker-indicator {
            filter: invert(1) brightness(1.5) sepia(1) saturate(5) hue-rotate(45deg);
            cursor: pointer;
        }

        .date-picker span {
            color: #ccc;
            font-weight: 500;
        }

        .filter-controls .chart-btn {
            min-width: 40px;
        }

        /* ë°ì´í„° ë¡œë”© ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .data-loading-btn {
            background: linear-gradient(135deg, #4a9eff, #007bff);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(74, 158, 255, 0.3);
        }

        .data-loading-btn:hover {
            background: linear-gradient(135deg, #007bff, #0056b3);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(74, 158, 255, 0.4);
        }

        .data-loading-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(74, 158, 255, 0.3);
        }

        .data-loading-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .date-filter-btn {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #e1e1e1;
            padding: 6px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-filter-btn:hover {
            background-color: #3a3a3a;
        }

        .analytics-btn {
            background: transparent;
            border: 1px solid #4a4a4a;
            color: #e1e1e1;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            height: 32px;
        }

        .analytics-btn:hover {
            background-color: #2a2a2a;
        }

        /* ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .role-badge {
            background-color: #3a3a3a;
            color: #e1e1e1;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .role-badge.admin {
            background-color: #4a9eff;
            color: white;
        }

        /* Members í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .data-table {
            background-color: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            overflow: hidden;
            width: 100%;
        }

        .table-header {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr 1fr 0.5fr;
            gap: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #b1b1b1;
            text-transform: uppercase;
        }

        .table-row {
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr 1fr 0.5fr;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            background-color: #1a1a1a;
        }

        .table-row:hover {
            background-color: #2a2a2a;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        /* Usage í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .usage-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .usage-card {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
        }

        .usage-card-number {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }

        .usage-card-label {
            color: #b1b1b1;
            font-size: 14px;
        }

        .search-box {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 8px 12px;
            color: #e1e1e1;
            font-size: 14px;
            width: 250px;
        }

        .search-container {
            position: relative;
            display: inline-block;
        }

        .search-clear-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .search-clear-btn:hover {
            background-color: #f44336;
            color: white;
        }

        .search-clear-btn:active {
            background-color: #d32f2f;
            color: white;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 2px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #3a3a3a;
            transition: background-color 0.2s ease;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover {
            background-color: #3a3a3a;
        }

        .autocomplete-item.selected {
            background-color: #4a9eff;
            color: white;
        }

        .autocomplete-item .user-name {
            font-weight: 600;
            color: #e1e1e1;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .autocomplete-item .user-email {
            color: #b1b1b1;
            font-size: 12px;
        }

        .autocomplete-item.selected .user-name,
        .autocomplete-item.selected .user-email {
            color: white;
        }

        .user-cumulative-info {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .user-cumulative-header {
            background-color: #1a1a1a;
            color: #fff;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 1px solid #3a3a3a;
            font-size: 18px;
            font-weight: 600;
        }

        .user-cumulative-table {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr;
            gap: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #b1b1b1;
            text-transform: uppercase;
        }

        /* Overview í™œë™ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .overview-activity-header {
            background-color: #1a1a1a;
            color: #fff;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 1px solid #3a3a3a;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .overview-activity-table {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr 1fr;
            gap: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #b1b1b1;
            text-transform: uppercase;
        }

        /* Export CSV ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .export-csv-btn:hover {
            background-color: #45a049 !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .export-csv-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .user-cumulative-row {
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            background-color: #1a1a1a;
        }

        .user-cumulative-row:hover {
            background-color: #2a2a2a;
        }

        .user-cumulative-row:last-child {
            border-bottom: none;
        }

        .user-email {
            color: #4a9eff;
            font-weight: 600;
        }

        /* Settings í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .settings-section {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .accordion-header {
            background-color: #2a2a2a;
            padding: 20px;
            border-bottom: 1px solid #3a3a3a;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .accordion-header:hover {
            background-color: #3a3a3a;
        }

        .accordion-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }

        .accordion-arrow {
            font-size: 16px;
            color: #b1b1b1;
            transition: transform 0.2s ease;
        }

        .accordion-content {
            display: none;
            padding: 20px;
            background-color: #1a1a1a;
        }

        .accordion-content.active {
            display: block;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #3a3a3a;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            color: #fff;
            margin-bottom: 4px;
        }

        .setting-description {
            color: #7a7a7a;
            font-size: 12px;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background-color: #4a9eff;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .toggle-switch.off {
            background-color: #5a5a5a;
        }

        .toggle-switch::after {
            content: '';
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            right: 2px;
            transition: all 0.2s ease;
        }

        .toggle-switch.off::after {
            right: 22px;
        }

        .setting-select {
            background: #3a3a3a;
            color: #fff;
            border: 1px solid #4a4a4a;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
        }

        .export-btn {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: #3a8edf;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
           
            .menu-text {
                display: none;
            }

            .overview-stats {
                grid-template-columns: 1fr;
            }

            .member-item,
            .member-list-header,
            .table-row,
            .table-header,
            .user-cumulative-row,
            .user-cumulative-table {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }

        /* ì°¨íŠ¸ ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ ê°œì„  */
        #chart-search-input {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        #chart-search-input:focus {
            border-color: #4a9eff !important;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.1) !important;
            outline: none;
        }

        /* ê²€ìƒ‰ clear ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .search-clear-btn:hover {
            background-color: #3a3a3a !important;
            color: #e1e1e1 !important;
        }

        /* ë°ì´í„°ë¦¬ìŠ¤íŠ¸ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        #heatmap-emails-datalist {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* ì‹œê°„ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ë§ */
        input[type="time"]::-webkit-calendar-picker-indicator {
            background-color: transparent;
            color: #fff;
            cursor: pointer;
            filter: invert(1) brightness(1.5);
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }

        input[type="time"]::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }

        input[type="time"]::-webkit-datetime-edit {
            color: #e1e1e1;
            font-weight: 500;
        }

        input[type="time"]::-webkit-datetime-edit-fields-wrapper {
            color: #e1e1e1;
        }

        input[type="time"]::-webkit-datetime-edit-hour-field,
        input[type="time"]::-webkit-datetime-edit-minute-field,
        input[type="time"]::-webkit-datetime-edit-ampm-field {
            color: #e1e1e1;
            background: transparent;
        }

        input[type="time"]::-webkit-datetime-edit-text {
            color: #e1e1e1;
        }

        /* ì‹œê°„ ë“œë¡­ë‹¤ìš´ ìŠ¤í¬ë¡¤ ìŠ¤íƒ€ì¼ */
        #email-hour-select,
        #email-minute-select,
        #new-schedule-hour,
        #new-schedule-minute {
            scrollbar-width: thin;
            scrollbar-color: #3a3a3a #1a1a1a;
        }

        #email-hour-select::-webkit-scrollbar,
        #email-minute-select::-webkit-scrollbar,
        #new-schedule-hour::-webkit-scrollbar,
        #new-schedule-minute::-webkit-scrollbar {
            width: 8px;
        }

        #email-hour-select::-webkit-scrollbar-track,
        #email-minute-select::-webkit-scrollbar-track,
        #new-schedule-hour::-webkit-scrollbar-track,
        #new-schedule-minute::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 4px;
        }

        #email-hour-select::-webkit-scrollbar-thumb,
        #email-minute-select::-webkit-scrollbar-thumb,
        #new-schedule-hour::-webkit-scrollbar-thumb,
        #new-schedule-minute::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }

        #email-hour-select::-webkit-scrollbar-thumb:hover,
        #email-minute-select::-webkit-scrollbar-thumb:hover,
        #new-schedule-hour::-webkit-scrollbar-thumb:hover,
        #new-schedule-minute::-webkit-scrollbar-thumb:hover {
            background: #4a4a4a;
        }

        /* ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìŠ¤íƒ€ì¼ */
        #email-hour-select option,
        #email-minute-select option,
        #new-schedule-hour option,
        #new-schedule-minute option {
            background-color: #2a2a2a;
            color: #e1e1e1;
            padding: 8px 12px;
        }

        #email-hour-select option:hover,
        #email-minute-select option:hover,
        #new-schedule-hour option:hover,
        #new-schedule-minute option:hover {
            background-color: #3a3a3a;
        }

        #email-hour-select option:checked,
        #email-minute-select option:checked,
        #new-schedule-hour option:checked,
        #new-schedule-minute option:checked {
            background-color: #4a9eff;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div style="height: 20px;"></div>
            <a href="javascript:void(0)" class="refresh-button" onclick="handleRefreshClick()">
                <span class="menu-icon">ğŸ”„</span>
                <span class="menu-text">ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸</span>
                <div class="refresh-progress">
                    <div class="refresh-progress-bar"></div>
                </div>
            </a>
            <div style="height: 1px; background-color: #3a3a3a; margin: 10px 20px;"></div>
            <a href="javascript:void(0)" class="menu-item active" data-section="overview">
                <span class="menu-icon">ğŸ“Š</span>
                <span class="menu-text">Overview</span>
            </a>
            <a href="javascript:void(0)" class="menu-item" data-section="settings">
                <span class="menu-icon">âš™ï¸</span>
                <span class="menu-text">Settings</span>
            </a>
            <a href="javascript:void(0)" class="menu-item" data-section="members">
                <span class="menu-icon">ğŸ‘¥</span>
                <span class="menu-text">Members</span>
            </a>
            <a href="javascript:void(0)" class="menu-item" data-section="usage">
                <span class="menu-icon">ğŸ“ˆ</span>
                <span class="menu-text">Usage</span>
            </a>
        </nav>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <h1 id="page-title">Dashboard Overview</h1>
                </div>
                <div class="header-right">
                    <!-- Clear Cache button and Ready status removed -->
                </div>
            </header>

            <div class="content-area">
                <!-- Overview ì„¹ì…˜ -->
                <div id="overview" class="content-section active">
                    <!-- 2.1.1 í•„í„°ë§ ê¸°ëŠ¥ -->
                    <div class="filter-controls">
                        <div class="chart-controls">
                            <div class="filter-period-display">
                                <span id="filter-period-text">2025-08-03 ~ 2025-08-03</span>
                            </div>
                            <button class="chart-btn" data-days="1">1d</button>
                            <button class="chart-btn" data-days="7">7d</button>
                            <button class="chart-btn active" data-days="30">30d</button>
                            <div class="date-picker">
                                <input type="date" id="start-date" />
                                <span>~</span>
                                <input type="date" id="end-date" />
                                <button class="analytics-btn" onclick="applyDateFilter()">ì ìš©</button>
                            </div>
                        </div>

                    </div>

                    <!-- ì‚¬ìš©ëŸ‰ ê°œìš” ì¹´ë“œ (Usageì—ì„œ ì´ë™) -->
                    <div class="usage-cards">
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ì‹¤ì œ í™œë™í•œ ì‚¬ìš©ì ìˆ˜</div>
                        </div>
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ì—ì´ì „íŠ¸ í¸ì§‘ ë¼ì¸ ìˆ˜</div>
                        </div>
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ìˆ˜ë½ëœ íƒ­ ìˆ˜</div>
                        </div>
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ì±„íŒ… ìˆ˜</div>
                        </div>
                    </div>

                    <!-- ê·¸ë˜í”„ ì˜ì—­ -->
                    <div class="overview-chart-container">
                        <div class="chart-header">
                            <div class="chart-selector">
                                <select id="chartSelect" onchange="handleChartChange(this.value)">
                                    <option value="activity-trend">ğŸ“ˆ ì¼ë³„ í™œë™ ì¶”ì´</option>
                                    <option value="model-distribution">ğŸ“Š ëª¨ë¸ ì‚¬ìš© ë¶„í¬</option>
                                    <option value="cost-trend">ğŸ’° ë¹„ìš© ì¶”ì´</option>
                                    <option value="activity-type">ğŸ“Š í™œë™ ìœ í˜• ë¶„í¬</option>
                                    <option value="user-heatmap">ğŸ”¥ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ</option>
                                    <option value="cost-efficiency">ğŸ“Š ë¹„ìš© íš¨ìœ¨ì„± ë¶„ì„</option>
                                    <option value="model-preference">ğŸ¯ ëª¨ë¸ ì„ í˜¸ë„</option>
                                    <option value="user-performance">ğŸ† ì‚¬ìš©ìë³„ ì„±ê³¼</option>
                                    <option value="activity-type-detailed">ğŸ“ˆ í™œë™ ìœ í˜• ìƒì„¸</option>
                                </select>
                            </div>
                            <!-- ì°¨íŠ¸ë³„ ê²€ìƒ‰ì°½ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
                            <div id="chart-search-container" class="chart-search" style="display: none; margin-top: 10px;">
                                <div class="search-container">
                                    <div style="position: relative; display: flex; align-items: center; max-width: 300px;">
                                        <span style="position: absolute; left: 12px; color: #7a7a7a; font-size: 14px;">ğŸ”</span>
                                        <input type="text" class="search-box" id="chart-search-input" placeholder="Search..." onkeyup="handleChartSearch(this.value)" oninput="toggleSearchClearBtn('chart-search-input')" onclick="showChartAutocomplete('chart-search-input')" onfocus="showChartAutocomplete('chart-search-input')" autocomplete="off" style="padding-left: 35px; border-radius: 8px; border: 1px solid #3a3a3a; background-color: #2a2a2a; color: #e1e1e1; padding-right: 35px;">
                                        <button class="search-clear-btn" id="chart-search-input-clear" onclick="clearChartSearch('chart-search-input')" style="display: none; position: absolute; right: 8px; background: none; border: none; color: #7a7a7a; font-size: 18px; cursor: pointer; padding: 4px; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">Ã—</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="activity-trend-chart" class="chart-content active">
                            <canvas id="overviewChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="model-distribution-chart" class="chart-content">
                            <canvas id="modelDistributionChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="cost-trend-chart" class="chart-content">
                            <canvas id="costTrendChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="activity-type-chart" class="chart-content">
                            <canvas id="activityTypeChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="user-heatmap-chart" class="chart-content">
                            <canvas id="userHeatmapChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="cost-efficiency-chart" class="chart-content">
                            <canvas id="costEfficiencyChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="model-preference-chart" class="chart-content">
                            <canvas id="modelPreferenceChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="user-performance-chart" class="chart-content">
                            <canvas id="userPerformanceChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="activity-type-detailed-chart" class="chart-content">
                            <canvas id="activityTypeDetailedChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                    </div>

                    <!-- 2.1.2 í†µê³„ ì¹´ë“œ -->
                    <div class="overview-stats">
                        <div class="overview-stat-box clickable" data-type="total" onclick="filterOverviewMembersByType('total')">
                            <div class="stat-number">-</div>
                            <div class="stat-label">
                                <span class="role-badge" style="background-color: #4a9eff; color: white;">ì „ì²´ ë©¤ë²„</span>
                            </div>
                            <div class="stat-description">ëª¨ë“  ë©¤ë²„ì˜ í™œë™ ê¸°ë¡</div>
                        </div>
                        <div class="overview-stat-box clickable" data-type="active" onclick="filterOverviewMembersByType('active')">
                            <div class="stat-number">-</div>
                            <div class="stat-label">
                                <span class="role-badge" style="background-color: #4caf50; color: white;">í™œì„± ë©¤ë²„</span>
                            </div>
                            <div class="stat-description">í™œì„± ë©¤ë²„ì˜ í™œë™ ê¸°ë¡</div>
                        </div>
                        <div class="overview-stat-box clickable" data-type="inactive" onclick="filterOverviewMembersByType('inactive')">
                            <div class="stat-number">-</div>
                            <div class="stat-label">
                                <span class="role-badge" style="background-color: #ff9800; color: white;">ë¹„í™œì„± ë©¤ë²„</span>
                            </div>
                            <div class="stat-description">ë¹„í™œì„± ë©¤ë²„ì˜ í™œë™ ê¸°ë¡</div>
                        </div>
                    </div>

                    <!-- ë©¤ë²„ ì„¸ë¶€ ë¦¬ìŠ¤íŠ¸ -->
                    <div class="overview-member-details">
                        <div class="overview-activity-header">ğŸ“‹ í™œë™ ë¦¬ìŠ¤íŠ¸</div>
                        <div class="overview-activity-table">
                            <div>ë§ˆì§€ë§‰ í™œë™</div>
                            <div>ì‚¬ìš©ì</div>
                            <div>ìƒíƒœ</div>
                            <div>í™œë™ ìœ í˜•</div>
                            <div>ìš”ì²­ ìˆ˜</div>
                            <div>ë¹„ìš©</div>
                            <div>ì œí•œ</div>
                        </div>
                        <div id="overview-activity-container">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í…Œì´ë¸” ë‚´ìš© -->
                            <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                                ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                            </div>
                        </div>
                        
                        <!-- Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ (Members ìŠ¤íƒ€ì¼) -->
                        <div id="overview-activity-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                            <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>

                <!-- Members ì„¹ì…˜ -->
                <div id="members" class="content-section">
                    <div class="filter-controls" style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div style="color: #e1e1e1; font-size: 14px; font-weight: 500; margin-left: 20px;">
                                Fast Requests last reset on: <span id="fast-requests-reset-date" style="color: #ffffff; font-weight: 600;">2025ë…„ 7ì›” 22ì¼</span> (ì˜¤ëŠ˜ ë‚ ì§œ: <span id="today-date" style="color: #ff9800; font-weight: 600;">2025-08-03</span>)
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-left: auto;">
                                <div class="search-container">
                                    <div style="position: relative; display: flex; align-items: center;">
                                        <span style="position: absolute; left: 12px; color: #7a7a7a; font-size: 14px;">ğŸ”</span>
                                        <input type="text" class="search-box" id="members-search" placeholder="Search name, email..." onkeyup="filterMembers(this.value)" oninput="toggleSearchClearBtn('members-search'); showAutocomplete('members-search')" onclick="showAutocomplete('members-search')" onfocus="showAutocomplete('members-search')" autocomplete="off" style="padding-left: 35px;">
                                        <button class="search-clear-btn" id="members-search-clear" onclick="clearSearch('members-search')" style="display: none;">Ã—</button>
                                    </div>
                                    <div id="members-autocomplete" class="autocomplete-dropdown" style="display: none;"></div>
                                </div>
                                <button class="export-csv-btn" onclick="exportMembersToCSV()" style="background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease;">
                                    ğŸ“Š Export CSV
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="data-table" id="members-table-container">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í…Œì´ë¸” í—¤ë”ì™€ ë‚´ìš© -->
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ì‹¤ì œ ë©¤ë²„ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ëŠ” ì¤‘...
                        </div>
                    </div>
                    
                    <!-- Members í˜ì´ì§€ë„¤ì´ì…˜ (All Raw Events ìŠ¤íƒ€ì¼) -->
                    <div id="members-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                        <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- Usage ì„¹ì…˜ -->
                <div id="usage" class="content-section">
                    <!-- ë‚ ì§œ í•„í„°ì™€ ê²€ìƒ‰ -->
                    <div class="filter-controls">
                        <div class="chart-controls">
                            <div class="filter-period-display">
                                <span id="usage-filter-period-text">2025-08-03 ~ 2025-08-03</span>
                            </div>
                            <button class="chart-btn" data-days="1">1d</button>
                            <button class="chart-btn" data-days="7">7d</button>
                            <button class="chart-btn active" data-days="30">30d</button>
                            <div class="date-picker">
                                <input type="date" id="usage-start-date" />
                                <span>~</span>
                                <input type="date" id="usage-end-date" />
                                <button class="analytics-btn" onclick="applyUsageDateFilter()">ì ìš©</button>
                            </div>
                        </div>
                        <div>
                            <div class="search-container">
                                <div style="position: relative; display: flex; align-items: center;">
                                    <span style="position: absolute; left: 12px; color: #7a7a7a; font-size: 14px;">ğŸ”</span>
                                    <input type="text" class="search-box" id="usage-search" placeholder="Search name, email..." onkeyup="filterUsageMembers(this.value)" oninput="toggleSearchClearBtn('usage-search'); showAutocomplete('usage-search')" onclick="showAutocomplete('usage-search')" onfocus="showAutocomplete('usage-search')" autocomplete="off" style="padding-left: 35px;">
                                    <button class="search-clear-btn" id="usage-search-clear" onclick="clearSearch('usage-search')" style="display: none;">Ã—</button>
                                </div>
                                <div id="usage-autocomplete" class="autocomplete-dropdown" style="display: none;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ì‚¬ìš©ìë³„ ëˆ„ì  ì •ë³´ -->
                    <div class="user-cumulative-info">
                        <div class="user-cumulative-header">ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´</div>
                        <div class="user-cumulative-table">
                            <div>NAME</div>
                            <div>EMAIL</div>
                            <div>ROLE</div>
                            <div>REQUEST</div>
                            <div>SPEND</div>
                            <div>LAST ACT</div>
                        </div>
                        <div id="user-cumulative-container">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í…Œì´ë¸” ë‚´ìš© -->
                            <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                                ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                            </div>
                        </div>
                        
                        <!-- ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ (All Raw Events ìŠ¤íƒ€ì¼) -->
                        <div id="user-cumulative-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                            <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>

                    <!-- All Raw Events í…Œì´ë¸” -->
                    <div class="user-cumulative-info">
                        <div class="user-cumulative-header">ğŸ“‹ All Raw Events</div>
                        <div class="user-cumulative-table">
                            <div>DATE</div>
                            <div>USER</div>
                            <div>KIND</div>
                            <div>MAX_MODEL</div>
                            <div>MODEL</div>
                            <div>COST</div>
                        </div>
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                        
                        <!-- í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ -->
                        <div class="filtered-events-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                            <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>

                <!-- Settings ì„¹ì…˜ -->
                <div id="settings" class="content-section">
                    <!-- í™œì„± ê¸°ê°„ ì„¤ì • -->
                    <div class="settings-section">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <div class="accordion-title">í™œì„± ê¸°ê°„ ì„¤ì •</div>
                            <div class="accordion-arrow">â–¼</div>
                        </div>
                        <div class="accordion-content">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">í™œì„± ìƒíƒœ ìë™ ì „í™˜</div>
                                    <div class="setting-description">ì§€ì •ëœ ê¸°ê°„ ë™ì•ˆ í™œë™ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ë¹„í™œì„± ìƒíƒœë¡œ ì „í™˜ë©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ë¹„í™œì„± ì „í™˜ ê¸°ê°„</div>
                                    <div class="setting-description">í™œë™ì´ ì—†ì„ ê²½ìš° ë¹„í™œì„±ìœ¼ë¡œ ì „í™˜ë˜ëŠ” ê¸°ê°„</div>
                                </div>
                                <select class="setting-select">
                                    <option>7ì¼</option>
                                    <option>14ì¼</option>
                                    <option selected>30ì¼</option>
                                    <option>60ì¼</option>
                                    <option>90ì¼</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">í™œì„± ìƒíƒœ ì•Œë¦¼</div>
                                    <div class="setting-description">ë¹„í™œì„± ì „í™˜ ì „ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ì•Œë¦¼ ë°œì†¡ ì‹œì </div>
                                    <div class="setting-description">ë¹„í™œì„± ì „í™˜ ëª‡ ì¼ ì „ì— ì•Œë¦¼ì„ ë°œì†¡í• ì§€ ì„¤ì •</div>
                                </div>
                                <select class="setting-select">
                                    <option>1ì¼ ì „</option>
                                    <option selected>3ì¼ ì „</option>
                                    <option>7ì¼ ì „</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Email Report ì„¤ì • -->
                    <div class="settings-section">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <div class="accordion-title">Email Report ì„¤ì •</div>
                            <div class="accordion-arrow">â–¼</div>
                        </div>
                        <div class="accordion-content">
                            <!-- ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ -->
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬</div>
                                    <div class="setting-description">ì˜ˆì•½ëœ ë©”ì¼ì˜ ìë™ ë°œì†¡ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>

                            <!-- ë°œì†¡ ì£¼ê¸° -->
                            <div class="setting-item" id="email-frequency-setting">
                                <div>
                                    <div class="setting-label">ë°œì†¡ ì£¼ê¸°</div>
                                    <div class="setting-description">ë¦¬í¬íŠ¸ë¥¼ ë°œì†¡í•  ì£¼ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                                </div>
                                <select class="setting-select" id="email-frequency-select" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                    <option value="daily">ë§¤ì¼</option>
                                    <option value="weekly" selected>ë§¤ì£¼</option>
                                    <option value="monthly">ë§¤ì›”</option>
                                </select>
                            </div>

                            <!-- ë°œì†¡ ì‹œê°„ ì„¤ì • -->
                            <div class="setting-item" id="email-time-setting">
                                <div>
                                    <div class="setting-label">ë°œì†¡ ì‹œê°„ ì„¤ì •</div>
                                    <div class="setting-description">ë¦¬í¬íŠ¸ë¥¼ ë°œì†¡í•  êµ¬ì²´ì ì¸ ì‹œê°„ì„ ì„¤ì •í•˜ì„¸ìš”</div>
                                </div>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="email-hour-select" style="
                                        background-color: transparent;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 8px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        font-family: inherit;
                                        transition: background-color 0.2s ease;
                                        min-width: 120px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="updateTimeInput()">
                                        <option value="00">ì˜¤ì „ 12ì‹œ</option>
                                        <option value="01">ì˜¤ì „ 1ì‹œ</option>
                                        <option value="02">ì˜¤ì „ 2ì‹œ</option>
                                        <option value="03">ì˜¤ì „ 3ì‹œ</option>
                                        <option value="04">ì˜¤ì „ 4ì‹œ</option>
                                        <option value="05">ì˜¤ì „ 5ì‹œ</option>
                                        <option value="06">ì˜¤ì „ 6ì‹œ</option>
                                        <option value="07">ì˜¤ì „ 7ì‹œ</option>
                                        <option value="08">ì˜¤ì „ 8ì‹œ</option>
                                        <option value="09" selected>ì˜¤ì „ 9ì‹œ</option>
                                        <option value="10">ì˜¤ì „ 10ì‹œ</option>
                                        <option value="11">ì˜¤ì „ 11ì‹œ</option>
                                        <option value="12">ì˜¤í›„ 12ì‹œ</option>
                                        <option value="13">ì˜¤í›„ 1ì‹œ</option>
                                        <option value="14">ì˜¤í›„ 2ì‹œ</option>
                                        <option value="15">ì˜¤í›„ 3ì‹œ</option>
                                        <option value="16">ì˜¤í›„ 4ì‹œ</option>
                                        <option value="17">ì˜¤í›„ 5ì‹œ</option>
                                        <option value="18">ì˜¤í›„ 6ì‹œ</option>
                                        <option value="19">ì˜¤í›„ 7ì‹œ</option>
                                        <option value="20">ì˜¤í›„ 8ì‹œ</option>
                                        <option value="21">ì˜¤í›„ 9ì‹œ</option>
                                        <option value="22">ì˜¤í›„ 10ì‹œ</option>
                                        <option value="23">ì˜¤í›„ 11ì‹œ</option>
                                    </select>
                                    <select id="email-minute-select" style="
                                        background-color: transparent;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 8px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        font-family: inherit;
                                        transition: background-color 0.2s ease;
                                        min-width: 80px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="updateTimeInput()">
                                        <option value="00" selected>00ë¶„</option>
                                        <option value="01">01ë¶„</option>
                                        <option value="02">02ë¶„</option>
                                        <option value="03">03ë¶„</option>
                                        <option value="04">04ë¶„</option>
                                        <option value="05">05ë¶„</option>
                                        <option value="06">06ë¶„</option>
                                        <option value="07">07ë¶„</option>
                                        <option value="08">08ë¶„</option>
                                        <option value="09">09ë¶„</option>
                                        <option value="10">10ë¶„</option>
                                        <option value="11">11ë¶„</option>
                                        <option value="12">12ë¶„</option>
                                        <option value="13">13ë¶„</option>
                                        <option value="14">14ë¶„</option>
                                        <option value="15">15ë¶„</option>
                                        <option value="16">16ë¶„</option>
                                        <option value="17">17ë¶„</option>
                                        <option value="18">18ë¶„</option>
                                        <option value="19">19ë¶„</option>
                                        <option value="20">20ë¶„</option>
                                        <option value="21">21ë¶„</option>
                                        <option value="22">22ë¶„</option>
                                        <option value="23">23ë¶„</option>
                                        <option value="24">24ë¶„</option>
                                        <option value="25">25ë¶„</option>
                                        <option value="26">26ë¶„</option>
                                        <option value="27">27ë¶„</option>
                                        <option value="28">28ë¶„</option>
                                        <option value="29">29ë¶„</option>
                                        <option value="30">30ë¶„</option>
                                        <option value="31">31ë¶„</option>
                                        <option value="32">32ë¶„</option>
                                        <option value="33">33ë¶„</option>
                                        <option value="34">34ë¶„</option>
                                        <option value="35">35ë¶„</option>
                                        <option value="36">36ë¶„</option>
                                        <option value="37">37ë¶„</option>
                                        <option value="38">38ë¶„</option>
                                        <option value="39">39ë¶„</option>
                                        <option value="40">40ë¶„</option>
                                        <option value="41">41ë¶„</option>
                                        <option value="42">42ë¶„</option>
                                        <option value="43">43ë¶„</option>
                                        <option value="44">44ë¶„</option>
                                        <option value="45">45ë¶„</option>
                                        <option value="46">46ë¶„</option>
                                        <option value="47">47ë¶„</option>
                                        <option value="48">48ë¶„</option>
                                        <option value="49">49ë¶„</option>
                                        <option value="50">50ë¶„</option>
                                        <option value="51">51ë¶„</option>
                                        <option value="52">52ë¶„</option>
                                        <option value="53">53ë¶„</option>
                                        <option value="54">54ë¶„</option>
                                        <option value="55">55ë¶„</option>
                                        <option value="56">56ë¶„</option>
                                        <option value="57">57ë¶„</option>
                                        <option value="58">58ë¶„</option>
                                        <option value="59">59ë¶„</option>
                                    </select>
                                    <!-- ìˆ¨ê²¨ì§„ time input (ê¸°ì¡´ ë¡œì§ í˜¸í™˜ì„±ì„ ìœ„í•´) -->
                                    <input type="time" id="email-time-input" value="09:00" style="display: none;">
                                </div>
                            </div>

                            <!-- ë°œì‹ ì¸ ì„¤ì • -->
                            <div class="setting-item" style="flex-direction: column; align-items: flex-start; gap: 10px;">
                                <div>
                                    <div class="setting-label">ë°œì‹ ì¸ ì„¤ì •</div>
                                    <div class="setting-description">ì´ë©”ì¼ì˜ ë°œì‹  í‘œì‹œ ì´ë¦„ê³¼ ë°œì‹  ì´ë©”ì¼ì„ ì„¤ì •í•˜ì„¸ìš” (ì˜µì…˜)</div>
                                </div>
                                <div style="display: flex; gap: 12px; width: 100%; max-width: 800px; flex-wrap: wrap;">
                                    <input type="text" id="email-sender-name" class="search-box" placeholder="í‘œì‹œ ì´ë¦„ (ì˜ˆ: Samsung AI Dashboard)" style="flex:1; min-width: 240px;" />
                                    <input type="email" id="email-sender-address" class="search-box" placeholder="ë°œì‹  ì´ë©”ì¼ (ì˜ˆ: your-name@gmail.com)" style="flex:1; min-width: 240px;" />
                                </div>
                                <div style="color:#7a7a7a; font-size:12px;">
                                    ì°¸ê³ : Gmailì„ ì‚¬ìš©í•  ê²½ìš° ì‹¤ì œ ë°œì‹  ê³„ì •ì€ ì„œë²„ì— ì„¤ì •ëœ Gmail ê³„ì •ìœ¼ë¡œ ì¸ì¦ë©ë‹ˆë‹¤. ë°œì‹  ì´ë©”ì¼ì„ ì„ì˜ë¡œ ë³€ê²½í•˜ë©´ ìˆ˜ì‹ ì ë©”ì¼í•¨ì—ì„œ í‘œì‹œë§Œ ë°”ë€Œê±°ë‚˜ Gmail ì •ì±…ì— ë”°ë¼ ì›ë˜ ê³„ì •ìœ¼ë¡œ í‘œì‹œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </div>
                            </div>

                            <!-- ë°œì†¡ ë©”ì‹œì§€ ì…ë ¥ -->
                            <div class="setting-item" style="flex-direction: column; align-items: flex-start;">
                                <div style="margin-bottom: 15px;">
                                    <div class="setting-label">ë°œì†¡ ë©”ì‹œì§€ ì…ë ¥</div>
                                    <div class="setting-description">ì´ë©”ì¼ ë¦¬í¬íŠ¸ì— í¬í•¨ë  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                                </div>
                                <div style="
                                    position: relative;
                                    background-color: #1a1a1a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    transition: all 0.2s ease;
                                    width: 100%;
                                    max-width: 800px;
                                ">
                                    <textarea 
                                        id="email-report-message" 
                                        placeholder="ì´ë©”ì¼ì— í¬í•¨ë  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                        style="
                                            width: 100%;
                                            height: 120px;
                                            padding: 12px;
                                            border: none;
                                            background: transparent;
                                            color: #ff9800;
                                            font-size: 14px;
                                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                            line-height: 1.5;
                                            outline: none;
                                            resize: vertical;
                                            min-height: 120px;
                                            max-height: 200px;
                                            box-sizing: border-box;
                                        "
                                        onfocus="this.parentElement.style.backgroundColor='#2a2a2a'; this.parentElement.style.borderColor='#4a9eff'"
                                        onblur="this.parentElement.style.backgroundColor='#1a1a1a'; this.parentElement.style.borderColor='#3a3a3a'"
                                        oninput="updateMessageCharCount(); syncMessageInputs('email-report-message')"
                                    ></textarea>
                                </div>
                                <div style="
                                    color: #7a7a7a;
                                    font-size: 12px;
                                    margin-top: 5px;
                                    text-align: right;
                                    width: 100%;
                                    max-width: 800px;
                                ">
                                    <span id="report-message-char-count">0</span>/1000 ê¸€ì
                                </div>
                            </div>

                            <!-- ì²¨ë¶€ íŒŒì¼ -->
                            <div class="setting-item" style="flex-direction: column; align-items: flex-start;">
                                <div style="margin-bottom: 10px;">
                                    <div class="setting-label">ì²¨ë¶€ íŒŒì¼</div>
                                    <div class="setting-description">ë¦¬í¬íŠ¸ì— í¬í•¨í•  ì²¨ë¶€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
                                </div>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                                    <label style="display: flex; align-items: center; gap: 6px;">
                                        <input type="checkbox" id="attachment-all-members" style="width: 16px; height: 16px;" onclick="handleAttachmentTargetToggle('all', this)">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì „ì²´ ë©¤ë²„</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px;">
                                        <input type="checkbox" id="attachment-inactive-members" style="width: 16px; height: 16px;" onclick="handleAttachmentTargetToggle('inactive', this)">
                                        <span style="color: #e1e1e1; font-size: 14px;">ë¹„í™œì„± ë©¤ë²„</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 6px;">
                                        <input type="checkbox" id="attachment-custom" style="width: 16px; height: 16px;" onclick="handleAttachmentTargetToggle('custom', this)">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì§ì ‘ ì…ë ¥</span>
                                    </label>
                                </div>

                                <!-- ì „ì²´ ë©¤ë²„ ì„¹ì…˜ -->
                                <div id="attachment-all-section" style="display: none; margin-top: 10px; width: 100%;">
                                    <div class="setting-label" style="margin-bottom: 8px;">ì „ì²´ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸</div>
                                    <div style="display:flex; justify-content: space-between; align-items:center; gap:12px; margin-bottom:8px;">
                                        <div style="position: relative; display:flex; align-items:center;">
                                            <span style="position:absolute; left:10px; color:#7a7a7a;">ğŸ”</span>
                                            <input type="text" id="attachment-all-search" class="search-box" placeholder="Search name, email..." style="padding-left: 30px; width: 260px;" oninput="filterAttachmentList('all', this.value)">
                                        </div>
                                        <div style="display:flex; gap:8px; align-items:center;">
                                            <select id="attachment-all-sort" class="setting-select" style="background-color: transparent; min-width: 160px;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="sortAttachmentList('all', this.value)">
                                                <option value="name_asc" selected>ì´ë¦„ â†‘</option>
                                                <option value="name_desc">ì´ë¦„ â†“</option>
                                                <option value="email_asc">ì´ë©”ì¼ â†‘</option>
                                                <option value="email_desc">ì´ë©”ì¼ â†“</option>
                                            </select>
                                            <select id="attachment-all-page-size" class="setting-select" style="background-color: transparent; min-width: 100px;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="changeAttachmentPageSize('all', this.value)">
                                                <option value="10">10</option>
                                                <option value="20" selected>20</option>
                                                <option value="50">50</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="attachment-all-list" style="margin-bottom: 8px; background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 6px; padding: 12px; color: #e1e1e1; max-height: 220px; overflow-y: auto;"></div>
                                    <div id="attachment-all-pagination" class="pagination-container" style="display:flex; justify-content: flex-end; gap:8px; align-items:center;"></div>
                                    <label style="display:flex; align-items: center; gap: 6px; margin: 12px 0;">
                                        <input type="checkbox" id="attachment-all-usage" style="width: 16px; height: 16px;" onclick="toggleAttachmentUsageSection('all', this)">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì‚¬ìš©ëŸ‰</span>
                                    </label>
                                </div>

                                <!-- ë¹„í™œì„± ë©¤ë²„ ì„¹ì…˜ -->
                                <div id="attachment-inactive-section" style="display: none; margin-top: 10px; width: 100%;">
                                    <div class="setting-label" id="attachment-inactive-title" style="margin-bottom: 8px;">ë¹„í™œì„± ë©¤ë²„ ë¦¬ìŠ¤íŠ¸</div>
                                    <div style="display:flex; justify-content: space-between; align-items:center; gap:12px; margin-bottom:8px;">
                                        <div style="position: relative; display:flex; align-items:center;">
                                            <span style="position:absolute; left:10px; color:#7a7a7a;">ğŸ”</span>
                                            <input type="text" id="attachment-inactive-search" class="search-box" placeholder="Search name, email..." style="padding-left: 30px; width: 260px;" oninput="filterAttachmentList('inactive', this.value)">
                                        </div>
                                        <div style="display:flex; gap:8px; align-items:center;">
                                            <select id="attachment-inactive-sort" class="setting-select" style="background-color: transparent; min-width: 160px;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="sortAttachmentList('inactive', this.value)">
                                                <option value="name_asc" selected>ì´ë¦„ â†‘</option>
                                                <option value="name_desc">ì´ë¦„ â†“</option>
                                                <option value="email_asc">ì´ë©”ì¼ â†‘</option>
                                                <option value="email_desc">ì´ë©”ì¼ â†“</option>
                                                <option value="last_asc">ë§ˆì§€ë§‰ í™œë™ ì˜¤ë˜ëœìˆœ</option>
                                                <option value="last_desc">ë§ˆì§€ë§‰ í™œë™ ìµœê·¼ìˆœ</option>
                                            </select>
                                            <select id="attachment-inactive-page-size" class="setting-select" style="background-color: transparent; min-width: 100px;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="changeAttachmentPageSize('inactive', this.value)">
                                                <option value="10">10</option>
                                                <option value="20" selected>20</option>
                                                <option value="50">50</option>
                                            </select>
                                            <select id="attachment-inactive-days" class="setting-select" style="background-color: transparent; min-width: 140px;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="setInactiveDaysFilter(this.value)">
                                                <option value="7">ìµœê·¼ 7ì¼ ë¬´í™œë™</option>
                                                <option value="14" selected>ìµœê·¼ 14ì¼ ë¬´í™œë™</option>
                                                <option value="30">ìµœê·¼ 30ì¼ ë¬´í™œë™</option>
                                                <option value="60">ìµœê·¼ 60ì¼ ë¬´í™œë™</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="attachment-inactive-list" style="margin-bottom: 8px; background: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 6px; padding: 12px; color: #e1e1e1; max-height: 220px; overflow-y: auto;"></div>
                                    <div id="attachment-inactive-pagination" class="pagination-container" style="display:flex; justify-content: flex-end; gap:8px; align-items:center;"></div>
                                    <label style="display:flex; align-items: center; gap: 6px; margin: 12px 0;">
                                        <input type="checkbox" id="attachment-inactive-usage" style="width: 16px; height: 16px;" onclick="toggleAttachmentUsageSection('inactive', this)">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì‚¬ìš©ëŸ‰</span>
                                    </label>
                                </div>

                                <!-- ì§ì ‘ ì…ë ¥ ì„¹ì…˜ -->
                                <div id="attachment-custom-section" style="display: none; margin-top: 10px; width: 100%;">
                                    <div style="margin-bottom: 10px;">
                                        <div class="setting-label">ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì£¼ì†Œ</div>
                                        <div class="setting-description">ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”</div>
                                    </div>
                                    <div style="position: relative; background-color: #1a1a1a; border: 1px solid #3a3a3a; border-radius: 4px; transition: all 0.2s ease; width: 100%; max-width: 800px; margin-bottom: 16px;">
                                        <textarea id="attachment-custom-emails" placeholder="emailì„ ì§ì ‘ ì…ë ¥ í•˜ì„¸ìš”.(example1@samsung.com, example2@samsung.com)" style="width: 100%; height: 120px; padding: 12px; border: none; background: transparent; color: #ff9800; font-size: 14px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.5; outline: none; resize: vertical; min-height: 120px; max-height: 200px; box-sizing: border-box;" onfocus="this.parentElement.style.backgroundColor='#2a2a2a'; this.parentElement.style.borderColor='#4a9eff'" onblur="this.parentElement.style.backgroundColor='#1a1a1a'; this.parentElement.style.borderColor='#3a3a3a'"></textarea>
                                    </div>
                                    <label style="display:flex; align-items: center; gap: 6px; margin: 16px 0 12px;">
                                        <input type="checkbox" id="attachment-custom-usage" style="width: 16px; height: 16px;" onclick="toggleAttachmentUsageSection('custom', this)">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì‚¬ìš©ëŸ‰</span>
                                    </label>
                                </div>

                                <!-- ì‚¬ìš©ëŸ‰ ì²¨ë¶€ ì„¤ì • (ê³µí†µ, ì„ íƒëœ ì„¹ì…˜ ì•„ë˜ë¡œ ì´ë™í•˜ì—¬ í‘œì‹œ) -->
                                <div id="usage-attachment-settings" style="display: none; margin-top: 12px; width: 100%;">
                                    
                                    <!-- ê¸°ê°„ ì„¤ì • -->
                                    <div style="display: flex; gap: 16px; align-items: center;">
                                        <div style="min-width: 80px; color: #b1b1b1; font-size: 14px;">ê¸°ê°„</div>
                                        <div class="chart-controls" id="usage-attachment-period-buttons" style="gap: 8px;">
                                            <button type="button" class="chart-btn" onclick="selectUsageAttachmentPeriod('1')">1d</button>
                                            <button type="button" class="chart-btn" onclick="selectUsageAttachmentPeriod('7')">7d</button>
                                            <button type="button" class="chart-btn" onclick="selectUsageAttachmentPeriod('30')">30d</button>
                                            <button type="button" class="chart-btn" onclick="selectUsageAttachmentPeriod('custom')">ì§ì ‘ì…ë ¥</button>
                                        </div>
                                        <div id="usage-attachment-custom-date" class="chart-controls" style="display: none; gap: 8px; align-items: center;">
                                            <div class="filter-period-display">
                                                <span id="usage-attachment-period-text">ê¸°ê°„ì„ ì„ íƒí•˜ì„¸ìš”</span>
                                            </div>
                                            <div class="date-picker">
                                                <input type="date" id="usage-attachment-start-date" />
                                                <span>~</span>
                                                <input type="date" id="usage-attachment-end-date" />
                                                <button type="button" class="analytics-btn" onclick="applyUsageAttachmentDateRange()">ì ìš©</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ìˆ˜ì‹ ì ê·¸ë£¹ -->
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                                    <div class="setting-description">ë¦¬í¬íŠ¸ë¥¼ ë°›ì„ ëŒ€ìƒì„ ì„¤ì •í•©ë‹ˆë‹¤</div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="admin-checkbox" checked style="width: 16px; height: 16px;" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ê´€ë¦¬ì</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="all-members-checkbox" style="width: 16px; height: 16px;" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì „ì²´ ë©¤ë²„</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="inactive-members-checkbox" style="width: 16px; height: 16px;" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ë¹„í™œì„± ë©¤ë²„</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="custom-email-checkbox" style="width: 16px; height: 16px;" onclick="toggleCustomEmailInput(this)" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì§ì ‘ ì…ë ¥</span>
                                    </label>
                                </div>
                                
                            </div>
                            
                            <!-- ì§ì ‘ ì…ë ¥ ì˜ì—­ -->
                            <div id="custom-email-input" style="display: none; margin-top: 10px;">
                                <div style="margin-bottom: 15px;">
                                    <div class="setting-label">ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì£¼ì†Œ</div>
                                    <div class="setting-description">ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”</div>
                                </div>
                                <div style="
                                    position: relative;
                                    background-color: #1a1a1a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    transition: all 0.2s ease;
                                    width: 100%;
                                    max-width: 800px;
                                ">
                                    <textarea
                                        id="custom-emails"
                                        placeholder="emailì„ ì§ì ‘ ì…ë ¥ í•˜ì„¸ìš”.(example1@samsung.com, example2@samsung.com)"
                                        style="
                                            width: 100%;
                                            height: 120px;
                                            padding: 12px;
                                            border: none;
                                            background: transparent;
                                            color: #ff9800;
                                            font-size: 14px;
                                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                            line-height: 1.5;
                                            outline: none;
                                            resize: vertical;
                                            min-height: 120px;
                                            max-height: 200px;
                                            box-sizing: border-box;
                                        "
                                        onfocus="this.parentElement.style.backgroundColor='#2a2a2a'; this.parentElement.style.borderColor='#4a9eff'"
                                        onblur="this.parentElement.style.backgroundColor='#1a1a1a'; this.parentElement.style.borderColor='#3a3a3a'"
                                    ></textarea>
                                </div>
                            </div>
                            
                            <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                            <div class="setting-item" style="margin-top: 20px;">
                                <div>
                                    <div class="setting-label">ì„¤ì • ê´€ë¦¬</div>
                                    <div class="setting-description">í˜„ì¬ ì„¤ì •ì„ í™•ì¸í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤</div>
                                </div>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items:center;">
                                    <button class="analytics-btn" onclick="showEmailSettingsList()">ì„¤ì • ë¦¬ìŠ¤íŠ¸</button>
                                    <button class="analytics-btn" onclick="showEmailScheduleList()">ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸</button>
                                    <button class="analytics-btn" onclick="showEmailRecipients()">ìˆ˜ì‹ ì ë³´ê¸°</button>
                                    <button class="analytics-btn" onclick="saveEmailSettings()">ì„¤ì • ì €ì¥</button>
                                    
                                </div>
                            </div>


                        </div>
                    </div>

                    <!-- Export Documents ì„¤ì • -->
                    <div class="settings-section">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <div class="accordion-title">Export Documents ì„¤ì •</div>
                            <div class="accordion-arrow">â–¼</div>
                        </div>
                        <div class="accordion-content">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ìë™ ë°±ì—…</div>
                                    <div class="setting-description">ë°ì´í„°ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ìë™ ë°±ì—…í•©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch off" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="setting-item" id="backup-frequency-setting" style="display: none;">
                                <div>
                                    <div class="setting-label">ë°±ì—… ì£¼ê¸°</div>
                                    <div class="setting-description">ë°±ì—…ì„ ìˆ˜í–‰í•  ì£¼ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                                </div>
                                <select class="setting-select" id="backup-frequency-select" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                    <option value="daily" selected>ë§¤ì¼</option>
                                    <option value="weekly">ë§¤ì£¼</option>
                                    <option value="monthly">ë§¤ì›”</option>
                                </select>
                            </div>
                            <div class="setting-item" id="backup-time-setting" style="display: none;">
                                <div>
                                    <div class="setting-label">ë°±ì—… ì‹œê°„</div>
                                    <div class="setting-description">ë°±ì—…ì„ ì‹¤í–‰í•  êµ¬ì²´ì ì¸ ì‹œê°„ì„ ì„¤ì •í•˜ì„¸ìš”</div>
                                </div>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="backup-hour-select" style="
                                        background-color: transparent;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 8px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        font-family: inherit;
                                        transition: background-color 0.2s ease;
                                        min-width: 120px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="updateBackupTimeInput()">
                                        <option value="00">ì˜¤ì „ 12ì‹œ</option>
                                        <option value="01">ì˜¤ì „ 1ì‹œ</option>
                                        <option value="02" selected>ì˜¤ì „ 2ì‹œ</option>
                                        <option value="03">ì˜¤ì „ 3ì‹œ</option>
                                        <option value="04">ì˜¤ì „ 4ì‹œ</option>
                                        <option value="05">ì˜¤ì „ 5ì‹œ</option>
                                        <option value="06">ì˜¤ì „ 6ì‹œ</option>
                                        <option value="07">ì˜¤ì „ 7ì‹œ</option>
                                        <option value="08">ì˜¤ì „ 8ì‹œ</option>
                                        <option value="09">ì˜¤ì „ 9ì‹œ</option>
                                        <option value="10">ì˜¤ì „ 10ì‹œ</option>
                                        <option value="11">ì˜¤ì „ 11ì‹œ</option>
                                        <option value="12">ì˜¤í›„ 12ì‹œ</option>
                                        <option value="13">ì˜¤í›„ 1ì‹œ</option>
                                        <option value="14">ì˜¤í›„ 2ì‹œ</option>
                                        <option value="15">ì˜¤í›„ 3ì‹œ</option>
                                        <option value="16">ì˜¤í›„ 4ì‹œ</option>
                                        <option value="17">ì˜¤í›„ 5ì‹œ</option>
                                        <option value="18">ì˜¤í›„ 6ì‹œ</option>
                                        <option value="19">ì˜¤í›„ 7ì‹œ</option>
                                        <option value="20">ì˜¤í›„ 8ì‹œ</option>
                                        <option value="21">ì˜¤í›„ 9ì‹œ</option>
                                        <option value="22">ì˜¤í›„ 10ì‹œ</option>
                                        <option value="23">ì˜¤í›„ 11ì‹œ</option>
                                    </select>
                                    <select id="backup-minute-select" style="
                                        background-color: transparent;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 8px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        font-family: inherit;
                                        transition: background-color 0.2s ease;
                                        min-width: 80px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="updateBackupTimeInput()">
                                        <option value="00" selected>00ë¶„</option>
                                        <option value="05">05ë¶„</option>
                                        <option value="10">10ë¶„</option>
                                        <option value="15">15ë¶„</option>
                                        <option value="20">20ë¶„</option>
                                        <option value="25">25ë¶„</option>
                                        <option value="30">30ë¶„</option>
                                        <option value="35">35ë¶„</option>
                                        <option value="40">40ë¶„</option>
                                        <option value="45">45ë¶„</option>
                                        <option value="50">50ë¶„</option>
                                        <option value="55">55ë¶„</option>
                                    </select>
                                    <input type="time" id="backup-time-input" value="02:00" style="display: none;">
                                </div>
                            </div>
                            <div class="setting-item" id="backup-location-setting" style="display: none;">
                                <div>
                                    <div class="setting-label">ë°±ì—… ìœ„ì¹˜</div>
                                    <div class="setting-description">ë°±ì—… íŒŒì¼ì´ ì €ì¥ë  ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                                </div>
                                <input type="text" id="backup-location-input" class="search-box" placeholder="ì˜ˆ: C:\\Backups\\Dashboard ë˜ëŠ” /backups/dashboard" style="min-width: 300px;" />
                            </div>
                            <!-- Export ì¢…ë¥˜ â†’ Export ë²”ìœ„(ì¡°ê±´) â†’ Export í˜•ì‹ ìˆœì„œ -->
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Export ì¢…ë¥˜</div>
                                    <div class="setting-description">ë‚´ë³´ë‚¼ ë°ì´í„°ì˜ ì¢…ë¥˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤</div>
                                </div>
                                <div style="display:flex; gap: 12px; flex-wrap: wrap; align-items:center;">
                                    <label style="display:flex; align-items:center; gap:6px;">
                                        <input type="checkbox" id="export-type-summary" value="summary" onclick="handleExportTypeCheckboxChange()" style="width:16px; height:16px;">
                                        <span style="color:#e1e1e1; font-size:14px;">ìš”ì•½ ë¦¬í¬íŠ¸</span>
                                    </label>
                                    <label style="display:flex; align-items:center; gap:6px;">
                                        <input type="checkbox" id="export-type-raw" value="raw-events" onclick="handleExportTypeCheckboxChange()" style="width:16px; height:16px;">
                                        <span style="color:#e1e1e1; font-size:14px;">ì‚¬ìš© ì´ë²¤íŠ¸ ì›ë³¸</span>
                                    </label>
                                    <label style="display:flex; align-items:center; gap:6px;">
                                        <input type="checkbox" id="export-type-members" value="members" onclick="handleExportTypeCheckboxChange()" style="width:16px; height:16px;">
                                        <span style="color:#e1e1e1; font-size:14px;">ë©¤ë²„ ëª©ë¡</span>
                                    </label>
                                    <label style="display:flex; align-items:center; gap:6px;">
                                        <input type="checkbox" id="export-type-all" value="all" onclick="handleExportTypeCheckboxChange()" style="width:16px; height:16px;">
                                        <span style="color:#e1e1e1; font-size:14px;">ì „ì²´ (ìš”ì•½ + ì›ë³¸)</span>
                                    </label>
                                </div>
                            </div>
                            <div class="setting-item" id="export-range-setting">
                                <div>
                                    <div class="setting-label">Export ë²”ìœ„</div>
                                    <div class="setting-description">ë‚´ë³´ë‚¼ ë°ì´í„°ì˜ ê¸°ê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤</div>
                                </div>
                                <select class="setting-select">
                                    <option>ìµœê·¼ 7ì¼</option>
                                    <option selected>ìµœê·¼ 30ì¼</option>
                                    <option>ìµœê·¼ 90ì¼</option>
                                    <option>ì „ì²´ ê¸°ê°„</option>
                                    <option>ì‚¬ìš©ì ì§€ì •</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Export í˜•ì‹</div>
                                    <div class="setting-description">ë¬¸ì„œë¥¼ ë‚´ë³´ë‚¼ íŒŒì¼ í˜•ì‹ì„ ì„ íƒí•©ë‹ˆë‹¤</div>
                                </div>
                                <select id="export-format-select" class="setting-select" style="background-color: transparent;" onchange="handleExportFormatChange(this.value)" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                    <option value="csv">CSV</option>
                                    <option value="xlsx" selected>Excel (XLSX)</option>
                                    <option value="pdf">PDF</option>
                                    <option value="json">JSON</option>
                                </select>
                            </div>
                            
                            <!-- í˜•ì‹ë³„ ì„¸ë¶€ ì˜µì…˜ -->
                            <div id="export-format-options" style="margin-top: 6px;">
                                <!-- CSV ì˜µì…˜ -->
                                <div id="csv-options" style="display: none;">
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">CSV êµ¬ë¶„ì</div>
                                            <div class="setting-description">í•„ë“œ ê°„ ê°’ì„ êµ¬ë¶„í•˜ëŠ” ë¬¸ì</div>
                                        </div>
                                        <select class="setting-select" id="csv-delimiter" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="," selected>ì½¤ë§ˆ (,)</option>
                                            <option value="\t">íƒ­ (\t)</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ì¸ì½”ë”©</div>
                                            <div class="setting-description">ì—‘ì…€ í˜¸í™˜ì„ ìœ„í•´ UTF-8 with BOM ê¶Œì¥</div>
                                        </div>
                                        <select class="setting-select" id="csv-encoding" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="utf8">UTF-8</option>
                                            <option value="utf8-bom" selected>UTF-8 with BOM</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">í—¤ë” í¬í•¨</div>
                                            <div class="setting-description">ì²« í–‰ì— í•„ë“œëª…ì„ í¬í•¨</div>
                                        </div>
                                        <select class="setting-select" id="csv-include-header" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="yes" selected>ì˜ˆ</option>
                                            <option value="no">ì•„ë‹ˆì˜¤</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ë‚ ì§œ/ì‹œê°„ í¬ë§·</div>
                                            <div class="setting-description">í‘œì‹œ í˜•ì‹</div>
                                        </div>
                                        <select class="setting-select" id="csv-datetime-format" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                            <option value="YYYY-MM-DD HH:mm" selected>YYYY-MM-DD HH:mm</option>
                                            <option value="ISO8601">ISO 8601</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ì¤„ë°”ê¿ˆ</div>
                                            <div class="setting-description">ìš´ì˜ì²´ì œë³„ ì¤„ë°”ê¿ˆ ë¬¸ì</div>
                                        </div>
                                        <select class="setting-select" id="csv-newline" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="LF">LF (Unix)</option>
                                            <option value="CRLF" selected>CRLF (Windows)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- XLSX ì˜µì…˜ -->
                                <div id="xlsx-options" style="display: none;">
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ì‹œíŠ¸ êµ¬ì„±</div>
                                            <div class="setting-description">ìš”ì•½/ë©¤ë²„/ì›ë³¸ ë°ì´í„° ë¶„ë¦¬ ì €ì¥</div>
                                        </div>
                                        <select class="setting-select" id="xlsx-sheets" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="single">ë‹¨ì¼ ì‹œíŠ¸</option>
                                            <option value="multi" selected>ë‹¤ì¤‘ ì‹œíŠ¸ (ê¶Œì¥)</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">í—¤ë” ê³ ì •</div>
                                            <div class="setting-description">ìŠ¤í¬ë¡¤ ì‹œ í—¤ë” í–‰ ê³ ì •</div>
                                        </div>
                                        <select class="setting-select" id="xlsx-freeze-header" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="yes" selected>ì˜ˆ</option>
                                            <option value="no">ì•„ë‹ˆì˜¤</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ì—´ ë„ˆë¹„ ìë™ ë§ì¶¤</div>
                                            <div class="setting-description">ë‚´ìš©ì— ë§ì¶° ì—´ ë„ˆë¹„ ì¡°ì •</div>
                                        </div>
                                        <select class="setting-select" id="xlsx-autofit" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="yes" selected>ì˜ˆ</option>
                                            <option value="no">ì•„ë‹ˆì˜¤</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- PDF ì˜µì…˜ -->
                                <div id="pdf-options" style="display: none;">
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ìš©ì§€/ë°©í–¥</div>
                                            <div class="setting-description">PDF í˜ì´ì§€ í¬ê¸° ë° ë°©í–¥</div>
                                        </div>
                                        <select class="setting-select" id="pdf-page" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="A4-portrait" selected>A4 - ì„¸ë¡œ</option>
                                            <option value="A4-landscape">A4 - ê°€ë¡œ</option>
                                            <option value="Letter-portrait">Letter - ì„¸ë¡œ</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ë¨¸ë¦¬ë§/ë°”ë‹¥ê¸€</div>
                                            <div class="setting-description">ì œëª©/í˜ì´ì§€ ë²ˆí˜¸/ë‚ ì§œ í‘œì‹œ</div>
                                        </div>
                                        <select class="setting-select" id="pdf-header-footer" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="yes" selected>ì˜ˆ</option>
                                            <option value="no">ì•„ë‹ˆì˜¤</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- JSON ì˜µì…˜ -->
                                <div id="json-options" style="display: none;">
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">êµ¬ì¡°</div>
                                            <div class="setting-description">ì¶œë ¥ JSON í˜•ì‹</div>
                                        </div>
                                        <select class="setting-select" id="json-structure" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="array">ë°°ì—´ (Array)</option>
                                            <option value="ndjson" selected>NDJSON (ì¤„ ë‹¨ìœ„)</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div>
                                            <div class="setting-label">ë“¤ì—¬ì“°ê¸°</div>
                                            <div class="setting-description">ê°€ë…ì„±ì„ ìœ„í•œ Pretty ì¶œë ¥</div>
                                        </div>
                                        <select class="setting-select" id="json-indent" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                            <option value="minify">ë¯¸ë‹ˆíŒŒì´</option>
                                            <option value="2" selected>2ì¹¸</option>
                                            <option value="4">4ì¹¸</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- ê³µí†µ ì˜µì…˜ -->
                            <div id="export-common-options" style="margin-top: 6px;">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">ì••ì¶•(Zip)</div>
                                        <div class="setting-description">ëŒ€ìš©ëŸ‰ íŒŒì¼ ì „ì†¡ì„ ìœ„í•´ ê¶Œì¥</div>
                                    </div>
                                    <select class="setting-select" id="export-zip" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                        <option value="yes">ì˜ˆ</option>
                                        <option value="no" selected>ì•„ë‹ˆì˜¤</option>
                                    </select>
                                </div>
                            </div>
                            <div class="setting-item" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #3a3a3a; justify-content: flex-end;">
                                <div></div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="analytics-btn" onclick="showExportSettingsList()">ì„¤ì • ë¦¬ìŠ¤íŠ¸</button>
                                    <button class="analytics-btn" onclick="handleExportNow()">ì§€ê¸ˆ Export í•˜ê¸°</button>
                                    <button class="analytics-btn" onclick="saveExportSettings()">ì„¤ì • ì €ì¥</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // html2pdf.js CDN (ì›í´ë¦­ PDF ì €ì¥ìš©)
        (function injectHtml2Pdf(){
            const existing = document.querySelector('script[data-lib="html2pdf"]');
            if (existing) return;
            const s = document.createElement('script');
            s.src = 'https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js';
            s.defer = true;
            s.setAttribute('data-lib','html2pdf');
            document.head.appendChild(s);
        })();
        // ë©¤ë²„ í™œë™ ë°ì´í„°
        const memberData = {
            total: [
                { date: "25ë…„ 7ì›” 25ì¼ (ì˜¤ëŠ˜)", email: "greenmold@samsung.com", type: "active", kind: "Chat Request", request: "3", spend: "$0.05" },
                { date: "25ë…„ 7ì›” 25ì¼ (ì˜¤ëŠ˜)", email: "ck9104.lee@samsung.com", type: "active", kind: "Code Generation", request: "2", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 25ì¼ (ì˜¤ëŠ˜)", email: "by07.so@samsung.com", type: "active", kind: "Analysis", request: "5", spend: "$0.08" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "dynamic.choi@samsung.com", type: "inactive", kind: "Chat Request", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "darney.jeon@samsung.com", type: "inactive", kind: "Code Review", request: "2", spend: "$0.02" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "j0117.lee@samsung.com", type: "active", kind: "Documentation", request: "4", spend: "$0.04" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "kaeul.kim@samsung.com", type: "active", kind: "Chat Request", request: "6", spend: "$0.06" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "nw.aioffice@samsung.com", type: "inactive", kind: "Analysis", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "sh.ryan.park@samsung.com", type: "active", kind: "Code Generation", request: "7", spend: "$0.07" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "sejin.seo@samsung.com", type: "active", kind: "Chat Request", request: "3", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "sol22.lee@samsung.com", type: "inactive", kind: "Documentation", request: "2", spend: "$0.02" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "shee.lim@samsung.com", type: "inactive", kind: "Analysis", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "joseph2.jeon@samsung.com", type: "active", kind: "Code Review", request: "5", spend: "$0.05" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "taewoo.bang@samsung.com", type: "inactive", kind: "Chat Request", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "baewj@samsung.com", type: "inactive", kind: "Code Generation", request: "3", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 22ì¼ (3ì¼ì „)", email: "yj7.park@samsung.com", type: "active", kind: "Analysis", request: "4", spend: "$0.04" },
                { date: "25ë…„ 7ì›” 22ì¼ (3ì¼ì „)", email: "nemo.kim@samsung.com", type: "active", kind: "Chat Request", request: "6", spend: "$0.06" },
                { date: "25ë…„ 7ì›” 22ì¼ (3ì¼ì „)", email: "ms0402.kim@samsung.com", type: "active", kind: "Documentation", request: "3", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 21ì¼ (4ì¼ì „)", email: "shx.kim@samsung.com", type: "active", kind: "Code Review", request: "5", spend: "$0.05" },
                { date: "25ë…„ 7ì›” 21ì¼ (4ì¼ì „)", email: "greenmold@samsung.com", type: "active", kind: "Analysis", request: "8", spend: "$0.08" }
            ]
        };

        // í™œì„±/ë¹„í™œì„± ë©¤ë²„ í™œë™ ë¶„ë¥˜
        memberData.active = memberData.total.filter(activity => activity.type === "active");
        memberData.inactive = memberData.total.filter(activity => activity.type === "inactive");

        // ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderMemberList(type) {
            const memberList = document.getElementById('member-list');
            const memberListTitle = document.getElementById('member-list-title');
            if (!memberList || !memberListTitle) {
                console.warn('renderMemberList: ëŒ€ìƒ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ ì´ˆê¸° ë Œë”ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤. (member-list / member-list-title)');
                return;
            }
           
            let activities = [];
            let title = "";
            let icon = "";
           
            switch(type) {
                case 'active':
                    activities = memberData.active;
                    title = "í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸";
                    icon = "ğŸŸ¢";
                    break;
                case 'inactive':
                    activities = memberData.inactive;
                    title = "ë¹„í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸";
                    icon = "ğŸŸ ";
                    break;
                default:
                    activities = memberData.total;
                    title = "ì „ì²´ í™œë™ ë¦¬ìŠ¤íŠ¸";
                    icon = "ğŸ“Š";
            }
           
            memberListTitle.textContent = `${icon} ${title}`;
           
            memberList.innerHTML = `
                <div class="member-list-header">
                    <div>DATE</div>
                    <div>EMAIL</div>
                    <div>TYPE</div>
                    <div>KIND</div>
                    <div>REQUEST</div>
                    <div>SPEND</div>
                </div>
                ${activities.map(activity => `
                    <div class="member-item">
                        <div class="member-date">${activity.date}</div>
                        <div class="member-email">${activity.email}</div>
                        <div class="member-type ${activity.type}">${activity.type === 'active' ? 'í™œì„±' : 'ë¹„í™œì„±'}</div>
                        <div class="member-kind">${activity.kind}</div>
                        <div class="member-request">${activity.request}</div>
                        <div class="member-spend">${activity.spend}</div>
                    </div>
                `).join('')}
            `;
        }

        // í†µê³„ ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
        function initOverviewStats() {
            const statBoxes = document.querySelectorAll('.overview-stat-box');
           
            statBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    // ëª¨ë“  ë°•ìŠ¤ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
                    statBoxes.forEach(b => b.classList.remove('selected'));
                   
                    // í´ë¦­ëœ ë°•ìŠ¤ì— selected í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('selected');
                   
                    // í•´ë‹¹ íƒ€ì…ì˜ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
                    const type = this.getAttribute('data-type');
                    renderMemberList(type);
                });
            });
           
            // ì´ˆê¸° ë¡œë“œ ì‹œ ì „ì²´ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
            renderMemberList('total');
        }

        // í˜„ì¬ í•„í„° ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getCurrentFilterState() {
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
            
            return {
                dateRange: dateRange,
                filterType: currentFilterType,
                members: currentMembers,
                rawEventsData: currentRawEventsData
            };
        }
        
        // í•„í„° ìƒíƒœê°€ ë™ì¼í•œì§€ ë¹„êµí•˜ëŠ” í•¨ìˆ˜
        function isFilterStateEqual(filter1, filter2) {
            if (!filter1 || !filter2) return false;
            
            return filter1.dateRange.startDate.getTime() === filter2.dateRange.startDate.getTime() &&
                   filter1.dateRange.endDate.getTime() === filter2.dateRange.endDate.getTime() &&
                   filter1.filterType === filter2.filterType &&
                   filter1.members.length === filter2.members.length &&
                   filter1.rawEventsData.length === filter2.rawEventsData.length;
        }
        
        // ìºì‹œëœ ì°¨íŠ¸ë¥¼ ìº”ë²„ìŠ¤ì— ë³µì›í•˜ëŠ” í•¨ìˆ˜
        function restoreCachedChart(chartType) {
            const cachedChart = chartCache[chartType];
            if (!cachedChart.data) return false;
            
            const canvas = getCanvasForChartType(chartType);
            if (!canvas) return false;
            
            const ctx = canvas.getContext('2d');
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            // ìºì‹œëœ ì´ë¯¸ì§€ ë°ì´í„° ë³µì›
            ctx.putImageData(cachedChart.data, 0, 0);
            
            console.log(`ğŸ“Š ìºì‹œëœ ì°¨íŠ¸ ë³µì› ì™„ë£Œ: ${chartType}`);
            return true;
        }
        
        // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¥¸ ìº”ë²„ìŠ¤ ìš”ì†Œ ë°˜í™˜
        function getCanvasForChartType(chartType) {
            const canvasIds = {
                'activity-trend': 'overviewChart',
                'model-distribution': 'modelDistributionChart',
                'cost-trend': 'costTrendChart',
                'activity-type': 'activityTypeChart',
                'user-heatmap': 'userHeatmapChart',
                'cost-efficiency': 'costEfficiencyChart',
                'model-preference': 'modelPreferenceChart',
                'user-performance': 'userPerformanceChart',
                'activity-type-detailed': 'activityTypeDetailedChart'
            };
            
            return document.getElementById(canvasIds[chartType]);
        }
        
        // ì°¨íŠ¸ ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function cacheChartData(chartType) {
            const canvas = getCanvasForChartType(chartType);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            chartCache[chartType].data = imageData;
            console.log(`ğŸ“Š ì°¨íŠ¸ ë°ì´í„° ìºì‹œ ì €ì¥: ${chartType}`);
        }
        
        // ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        async function checkAndLoadDataForChart(chartType) {
            console.log(`ğŸ” ${chartType} ì°¨íŠ¸ ë°ì´í„° ìƒíƒœ í™•ì¸ ì¤‘...`);
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œ ìš°ì„  í™•ì¸
            const currentFilter = getCurrentFilterState();
            if (chartDataStore.isDataValid(currentFilter)) {
                console.log(`âœ… í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ${chartType} ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
                return true;
            }
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ì „ì—­ ë³€ìˆ˜ í™•ì¸
            const members = currentMembersData || [];
            const rawEvents = currentRawEventsData || [];
            
            console.log(`ğŸ“Š ì „ì—­ ë³€ìˆ˜ ë°ì´í„° ìƒíƒœ - ë©¤ë²„: ${members.length}ëª…, ì´ë²¤íŠ¸: ${rawEvents.length}ê°œ`);
            
            // ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸ëŠ” ì´ë²¤íŠ¸ ë°ì´í„°ë§Œ ìˆìœ¼ë©´ ë¨
            if (chartType === 'model-distribution') {
                if (rawEvents.length === 0) {
                    console.log('âŒ ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„° ë¡œë”©ì„ ì‹œë„í•©ë‹ˆë‹¤.');
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ Overview ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¡œë“œ
                    return false;
                }
                console.log('âœ… ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸: ì´ë²¤íŠ¸ ë°ì´í„° í™•ì¸ ì™„ë£Œ');
                return true;
            }
            
            if (members.length === 0) {
                console.log('âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
            
            if (rawEvents.length === 0) {
                console.log('âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
            
            // íŠ¹ì • ì°¨íŠ¸ë³„ ì¶”ê°€ ë°ì´í„° í™•ì¸
            if (chartType === 'cost-trend' || chartType === 'cost-efficiency') {
                // ë¹„ìš© ê´€ë ¨ ì°¨íŠ¸ëŠ” cost ë°ì´í„°ê°€ í•„ìš”
                const hasCostData = rawEvents.some(event => 
                    event.requestsCosts !== undefined && event.requestsCosts !== null
                );
                if (!hasCostData) {
                    console.log('âŒ ë¹„ìš© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return false;
                }
            }
            
            console.log(`âœ… ${chartType} ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ëª¨ë‘ ìˆìŠµë‹ˆë‹¤.`);
            return true;
        }
        
        // ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        async function refreshDataForChart(chartType) {
            console.log(`ğŸ”„ ${chartType} ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘...`);
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                showLoadingStatus(true);
                
                // ê¸°ë³¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                await Promise.all([
                    updateMembersWithRealData(),
                    updateOverviewWithRealData()
                ]);
                
                console.log(`âœ… ${chartType} ì°¨íŠ¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ`);
                return true;
            } catch (error) {
                console.error(`âŒ ${chartType} ì°¨íŠ¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:`, error);
                showErrorMessage(`ì°¨íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                return false;
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                showLoadingStatus(false);
            }
        }
        
        // ì°¨íŠ¸ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function handleChartChange(chartType) {
            console.log(`ğŸ”„ ì°¨íŠ¸ ë³€ê²½ ìš”ì²­: ${chartType}`);
            
            // ëª¨ë“  ì°¨íŠ¸ì—ì„œ ê²€ìƒ‰ì°½ ìˆ¨ê¹€
            const searchContainer = document.getElementById('chart-search-container');
            if (searchContainer) {
                searchContainer.style.display = 'none';
                // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
                const searchInput = document.getElementById('chart-search-input');
                if (searchInput) {
                    searchInput.value = '';
                    clearChartSearch('chart-search-input');
                }
            }
            
            // íŠ¹ë³„ ì²˜ë¦¬ê°€ í•„ìš”í•œ ì°¨íŠ¸ë“¤ (activity-trend ì œì™¸)
            if (chartType !== 'activity-trend') {
                // ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µê³¼ ëª¨ë¸ ì„ í˜¸ë„ì— ê²€ìƒ‰ì°½ í‘œì‹œ
                if (chartType === 'user-heatmap' || chartType === 'model-preference') {
                    const searchContainer = document.getElementById('chart-search-container');
                    if (searchContainer) {
                        searchContainer.style.display = 'block';
                        const searchInput = document.getElementById('chart-search-input');
                        if (searchInput) {
                            if (chartType === 'user-heatmap') {
                                searchInput.placeholder = 'ì‚¬ìš©ì ID ê²€ìƒ‰...';
                                // íˆíŠ¸ë§µìš© ì´ë©”ì¼ ë“œë¡­ë‹¤ìš´ ìƒì„±
                                populateHeatmapEmailDropdown();
                            } else if (chartType === 'model-preference') {
                                searchInput.placeholder = 'ì‚¬ìš©ì ID ê²€ìƒ‰...';
                                // ëª¨ë¸ ì„ í˜¸ë„ìš© ì´ë©”ì¼ ë“œë¡­ë‹¤ìš´ ìƒì„±
                                populateModelPreferenceDropdown();
                            }
                        }
                    }
                } else {
                    const searchContainer = document.getElementById('chart-search-container');
                    if (searchContainer) {
                        searchContainer.style.display = 'none';
                        const searchInput = document.getElementById('chart-search-input');
                        if (searchInput) {
                            searchInput.value = '';
                            clearChartSearch('chart-search-input');
                        }
                    }
                }
                console.log(`ğŸ¯ íŠ¹ë³„ ì²˜ë¦¬ ì°¨íŠ¸: ${chartType}`);
                
                // ë¨¼ì € ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                document.querySelectorAll('.chart-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                const chartId = `${chartType}-chart`;
                const selectedChart = document.getElementById(chartId);
                if (selectedChart) {
                    selectedChart.classList.add('active');
                    console.log(`âœ… ${chartType} ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í™œì„±í™” ì™„ë£Œ`);
                } else {
                    console.error(`âŒ ${chartId} ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
                    return;
                }
                
                // ë°ì´í„° í™•ì¸ ë° ë¡œë”©
                const hasMembersData = currentMembersData && currentMembersData.length > 0;
                const hasEventsData = currentRawEventsData && currentRawEventsData.length > 0;
                
                console.log(`ğŸ“Š ë°ì´í„° ìƒíƒœ í™•ì¸: ë©¤ë²„ë°ì´í„°=${hasMembersData}, ì´ë²¤íŠ¸ë°ì´í„°=${hasEventsData}`);
                
                // ë°ì´í„° ìš”êµ¬ì‚¬í•­ë³„ í™•ì¸
                let needsData = false;
                if (chartType === 'model-distribution') {
                    needsData = !hasEventsData;
                } else if (chartType === 'user-performance') {
                    needsData = !hasMembersData || !hasEventsData;
                } else if (chartType === 'cost-trend' || chartType === 'cost-efficiency') {
                    needsData = !hasEventsData; // ë¹„ìš© ê´€ë ¨ ì°¨íŠ¸ëŠ” ì´ë²¤íŠ¸ ë°ì´í„°ë§Œ í•„ìš”
                } else {
                    needsData = !hasMembersData || !hasEventsData; // ê¸°íƒ€ ì°¨íŠ¸ëŠ” ë‘˜ ë‹¤ í•„ìš”
                }
                
                if (needsData) {
                    console.log(`ğŸ”„ ${chartType} ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ë¡œë”© ì‹œì‘...`);
                    
                    // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ - ì°¨íŠ¸ë³„ ìº”ë²„ìŠ¤ ID ë§¤í•‘
                    const canvasIdMap = {
                        'user-performance': 'userPerformanceChart',
                        'model-distribution': 'modelDistributionChart',
                        'cost-trend': 'costTrendChart',
                        'activity-type': 'activityTypeChart',
                        'user-heatmap': 'userHeatmapChart',
                        'cost-efficiency': 'costEfficiencyChart',
                        'model-preference': 'modelPreferenceChart',
                        'activity-type-detailed': 'activityTypeDetailedChart'
                    };
                    const canvasId = canvasIdMap[chartType] || 'overviewChart';
                    const canvas = document.getElementById(canvasId);
                    if (canvas) {
                        const rect = canvas.getBoundingClientRect();
                        canvas.width = rect.width;
                        canvas.height = 300;
                        const ctx = canvas.getContext('2d');
                        ctx.fillStyle = '#1a1a1a';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#7a7a7a';
                        ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', canvas.width / 2, canvas.height / 2);
                    }
                    
                    updateOverviewWithCurrentFilter(30).then(() => {
                        console.log('âœ… ë°ì´í„° ë¡œë”© ì™„ë£Œ, ì°¨íŠ¸ ìƒì„± ì‹œì‘');
                        // ì°¨íŠ¸ë³„ ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ
                        if (chartType === 'user-performance') {
                            createUserPerformanceChart();
                        } else if (chartType === 'model-distribution') {
                            createModelDistributionChart();
                        } else if (chartType === 'cost-trend') {
                            createCostTrendChart();
                        } else if (chartType === 'activity-type') {
                            createActivityTypeChart();
                        } else if (chartType === 'user-heatmap') {
                            createUserHeatmapChart();
                        } else if (chartType === 'cost-efficiency') {
                            createCostEfficiencyChart();
                        } else if (chartType === 'model-preference') {
                            createModelPreferenceChart();
                        } else if (chartType === 'activity-type-detailed') {
                            createActivityTypeDetailedChart();
                        }
                    }).catch(error => {
                        console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                        const canvas = document.getElementById(canvasId);
                        if (canvas) {
                            const ctx = canvas.getContext('2d');
                            ctx.fillStyle = '#1a1a1a';
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                            ctx.fillStyle = '#f44336';
                            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                            ctx.textAlign = 'center';
                            ctx.fillText('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨', canvas.width / 2, canvas.height / 2);
                        }
                    });
                    return;
                } else {
                    // ë°ì´í„°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ë°”ë¡œ ì°¨íŠ¸ ìƒì„±
                    console.log('âœ… ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•¨, ë°”ë¡œ ì°¨íŠ¸ ìƒì„±');
                    if (chartType === 'user-performance') {
                        createUserPerformanceChart();
                    } else if (chartType === 'model-distribution') {
                        createModelDistributionChart();
                    } else if (chartType === 'cost-trend') {
                        createCostTrendChart();
                    } else if (chartType === 'activity-type') {
                        createActivityTypeChart();
                    } else if (chartType === 'user-heatmap') {
                        createUserHeatmapChart();
                    } else if (chartType === 'cost-efficiency') {
                        createCostEfficiencyChart();
                    } else if (chartType === 'model-preference') {
                        createModelPreferenceChart();
                    } else if (chartType === 'activity-type-detailed') {
                        createActivityTypeDetailedChart();
                    }
                    return;
                }
            }
            
            // ë‹¤ë¥¸ ì°¨íŠ¸ë“¤ì€ switchChart í•¨ìˆ˜ ì‚¬ìš©
            console.log(`ğŸ”„ ë‹¤ë¥¸ ì°¨íŠ¸ ì²˜ë¦¬: ${chartType}`);
            switchChart(chartType).catch(error => {
                console.error('ì°¨íŠ¸ ì „í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                showErrorMessage('ì°¨íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }
        
        // ì°¨íŠ¸ ì „í™˜ í•¨ìˆ˜ (ë°ì´í„° ë¡œë”© í¬í•¨)
        async function switchChart(chartType) {
            console.log(`ğŸ“Š switchChart í˜¸ì¶œ: ${chartType}`);
            
            // ëª¨ë“  ì°¨íŠ¸ ë‚´ìš© ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.chart-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ ì°¨íŠ¸ ë‚´ìš© í‘œì‹œ
            const selectedChart = document.getElementById(`${chartType}-chart`);
            if (selectedChart) {
                selectedChart.classList.add('active');
                console.log(`âœ… ${chartType} ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í™œì„±í™” ì™„ë£Œ`);
            } else {
                console.error(`âŒ ${chartType}-chart ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
                return;
            }
            
            // í˜„ì¬ í•„í„° ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            const currentFilter = getCurrentFilterState();
            
            // ìºì‹œëœ ì°¨íŠ¸ê°€ ìˆê³  í•„í„°ê°€ ë™ì¼í•œì§€ í™•ì¸
            const cachedChart = chartCache[chartType];
            const shouldUseCache = cachedChart.rendered && cachedChart.data && isFilterStateEqual(cachedChart.filter, currentFilter);
            
            if (shouldUseCache) {
                console.log(`ğŸ“Š ìºì‹œëœ ì°¨íŠ¸ ì‚¬ìš©: ${chartType}`);
                if (restoreCachedChart(chartType)) {
                    return;
                }
            }
            
            // ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸ (í†µí•© ë°ì´í„° ì €ì¥ì†Œ ìš°ì„  ì‚¬ìš©)
            const hasRequiredData = await checkAndLoadDataForChart(chartType);
            if (!hasRequiredData) {
                console.log(`âš ï¸ ${chartType} ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. Overview ì´ˆê¸° ë¡œë”©ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.`);
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì°¨íŠ¸ì— ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  ë¦¬í„´
                const canvas = getCanvasForChartType(chartType);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    const rect = canvas.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = 300;
                    
                    ctx.fillStyle = '#1a1a1a';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    ctx.fillStyle = '#7a7a7a';
                    ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', canvas.width / 2, canvas.height / 2);
                }
                return;
            }
            
            // ìƒˆë¡œìš´ ì°¨íŠ¸ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
            console.log(`ğŸ“Š ì°¨íŠ¸ ìƒˆë¡œ ìƒì„±/ì—…ë°ì´íŠ¸: ${chartType}`);
            
            // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì°¨íŠ¸ ë Œë”ë§
            console.log(`ğŸ“Š ì°¨íŠ¸ íƒ€ì… "${chartType}" ë Œë”ë§ ì‹œì‘...`);
            
            if (chartType === 'activity-trend') {
                console.log('ğŸ“ˆ ì¼ë³„ í™œë™ ì¶”ì´ ì°¨íŠ¸ ìƒì„±');
                createOverviewChart();
            } else if (chartType === 'model-distribution') {
                console.log('ğŸ“Š ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ì°¨íŠ¸ ìƒì„±');
                createModelDistributionChart();
            } else if (chartType === 'cost-trend') {
                console.log('ğŸ’° ë¹„ìš© ì¶”ì´ ì°¨íŠ¸ ìƒì„±');
                createCostTrendChart();
            } else if (chartType === 'activity-type') {
                console.log('ğŸ“Š í™œë™ ìœ í˜• ë¶„í¬ ì°¨íŠ¸ ìƒì„±');
                createActivityTypeChart();
            } else if (chartType === 'user-heatmap') {
                console.log('ğŸ”¥ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„±');
                createUserHeatmapChart();
            } else if (chartType === 'cost-efficiency') {
                console.log('ğŸ“Š ë¹„ìš© íš¨ìœ¨ì„± ë¶„ì„ ì°¨íŠ¸ ìƒì„±');
                createCostEfficiencyChart();
            } else if (chartType === 'model-preference') {
                console.log('ğŸ¯ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„±');
                createModelPreferenceChart();
            } else if (chartType === 'user-performance') {
                console.log('ğŸ† ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±');
                
                // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° í™•ì¸ ë° ë¡œë”©
                const hasMembersData = currentMembersData && currentMembersData.length > 0;
                const hasEventsData = currentRawEventsData && currentRawEventsData.length > 0;
                
                console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ë°ì´í„° ìƒíƒœ: ë©¤ë²„ ${hasMembersData ? currentMembersData.length : 0}ëª…, ì´ë²¤íŠ¸ ${hasEventsData ? currentRawEventsData.length : 0}ê°œ`);
                
                if (!hasMembersData || !hasEventsData) {
                    console.log('âš ï¸ ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë©”ì‹œì§€ í‘œì‹œ
                    const canvas = document.getElementById('userPerformanceChart');
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        const width = canvas.width;
                        const height = canvas.height;
                        
                        ctx.fillStyle = '#1a1a1a';
                        ctx.fillRect(0, 0, width, height);
                        
                        ctx.fillStyle = '#7a7a7a';
                        ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                    }
                    return;
                }
                
                createUserPerformanceChart();
            } else if (chartType === 'activity-type-detailed') {
                console.log('ğŸ“ˆ í™œë™ ìœ í˜• ìƒì„¸ ì°¨íŠ¸ ìƒì„±');
                createActivityTypeDetailedChart();
            } else {
                console.log('âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì°¨íŠ¸ íƒ€ì…:', chartType);
            }
            
            // ì°¨íŠ¸ ë Œë”ë§ ì™„ë£Œ í›„ ìºì‹œì— ì €ì¥
            setTimeout(() => {
                cacheChartData(chartType);
                chartCache[chartType].filter = currentFilter;
                chartCache[chartType].rendered = true;
            }, 100);
            
            console.log(`ğŸ“Š ì°¨íŠ¸ ì „í™˜ ì™„ë£Œ: ${chartType}`);
        }

        // ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ë§‰ëŒ€ ì°¨íŠ¸ ìƒì„±
        function createModelDistributionChart() {
            console.log('ğŸ” createModelDistributionChart ì‹œì‘...');
            console.log('ğŸ” ì „ì—­ ë³€ìˆ˜ ìƒíƒœ í™•ì¸:');
            console.log('- currentRawEventsData:', currentRawEventsData);
            console.log('- currentRawEventsData ê¸¸ì´:', currentRawEventsData ? currentRawEventsData.length : 'undefined');
            console.log('- chartDataStore.rawEvents ê¸¸ì´:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 'undefined');
            
            const canvas = document.getElementById('modelDistributionChart');
            if (!canvas) {
                console.error('âŒ modelDistributionChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            console.log('ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •:', canvas.width, 'x', canvas.height);
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            console.log('âœ… ë°°ê²½ ì„¤ì • ì™„ë£Œ');
            
            // ëª¨ë¸ ì‚¬ìš© ë°ì´í„° ìƒì„±
            console.log('ğŸ“Š ëª¨ë¸ ë°ì´í„° ìƒì„± ì‹œì‘...');
            const modelData = generateModelDistributionData();
            console.log('ğŸ“Š ìƒì„±ëœ ëª¨ë¸ ë°ì´í„°:', modelData);
            
            if (modelData.length === 0) {
                console.log('âš ï¸ ëª¨ë¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            console.log('ğŸ“Š ë§‰ëŒ€ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì‹œì‘...');
            drawModelDistributionBarChart(ctx, width, height, modelData);
            console.log('âœ… ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ë°ì´í„° ìƒì„±
        function generateModelDistributionData() {
            console.log('ğŸ” generateModelDistributionData ì‹œì‘...');
            
            const modelUsage = new Map();
            
            // ì „ì—­ ë³€ìˆ˜ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (chartDataStore ìš°ì„ , ì—†ìœ¼ë©´ ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            console.log('- ì‚¬ìš©í•  rawEvents.length:', rawEvents ? rawEvents.length : 0);
            
            if (rawEvents && rawEvents.length > 0) {
                console.log('ğŸ¯ ì´ë²¤íŠ¸ ë°ì´í„° ìƒ˜í”Œ (ì²˜ìŒ 3ê°œ):');
                rawEvents.slice(0, 3).forEach((event, index) => {
                    console.log(`ì´ë²¤íŠ¸ ${index}:`, {
                        model: event.model,
                        timestamp: event.timestamp,
                        userEmail: event.userEmail || event.email,
                        kind: event.kind,
                        ì „ì²´: event
                    });
                });
                
                // ëª¨ë¸ë³„ ì‚¬ìš© íšŸìˆ˜ ì§‘ê³„
                rawEvents.forEach((event, index) => {
                    const model = event.model || 'unknown';
                    modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
                    
                    // ì²˜ìŒ 5ê°œ ì´ë²¤íŠ¸ì˜ ëª¨ë¸ ì •ë³´ ë¡œê·¸
                    if (index < 5) {
                        console.log(`- ì´ë²¤íŠ¸ ${index}: model="${model}", ì „ì²´ ì´ë²¤íŠ¸:`, event);
                    }
                });
                
                console.log('ğŸ“Š ëª¨ë¸ë³„ ì‚¬ìš© íšŸìˆ˜ ì§‘ê³„ ê²°ê³¼:');
                modelUsage.forEach((count, model) => {
                    console.log(`- ${model}: ${count}íšŒ`);
                });
                console.log('ğŸ“Š modelUsage Map í¬ê¸°:', modelUsage.size);
            } else {
                console.log('âš ï¸ generateModelDistributionData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                console.log('âš ï¸ rawEvents ê°’:', rawEvents);
                return [];
            }
            
            // ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ìƒ‰ìƒ ì¶”ê°€
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4'];
            const data = [];
            let colorIndex = 0;
            
            modelUsage.forEach((count, model) => {
                data.push({
                    label: model,
                    value: count,
                    color: colors[colorIndex % colors.length]
                });
                colorIndex++;
            });
            
            console.log(`ğŸ“Š ëª¨ë¸ ë¶„í¬ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ê°œ ëª¨ë¸ (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            console.log('ğŸ“Š ìµœì¢… ë°ì´í„°:', data);
            return data;
        }

        // íŒŒì´ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawPieChart(ctx, width, height, data) {
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            let total = data.reduce((sum, item) => sum + item.value, 0);
            let currentAngle = 0;
            
            data.forEach(item => {
                const sliceAngle = (item.value / total) * 2 * Math.PI;
                
                // íŒŒì´ ìŠ¬ë¼ì´ìŠ¤ ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = item.color;
                ctx.fill();
                
                // í…Œë‘ë¦¬ ê·¸ë¦¬ê¸°
                ctx.strokeStyle = '#1a1a1a';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ë ˆì´ë¸” ê·¸ë¦¬ê¸°
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + (radius * 0.7) * Math.cos(labelAngle);
                const labelY = centerY + (radius * 0.7) * Math.sin(labelAngle);
                
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(`${item.label} (${item.value})`, labelX, labelY);
                
                currentAngle += sliceAngle;
            });
            
            // ë²”ë¡€ ê·¸ë¦¬ê¸°
            drawPieChartLegend(ctx, width, height, data);
        }

        // ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ë§‰ëŒ€ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawModelDistributionBarChart(ctx, width, height, data) {
            console.log('ğŸ” drawModelDistributionBarChart ì‹œì‘...');
            console.log('ğŸ“Š ì…ë ¥ ë°ì´í„°:', data);
            console.log('ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸°:', width, 'x', height);
            
            if (data.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - (padding * 2);
            const chartHeight = height - (padding * 2);
            const barWidth = chartWidth / data.length * 0.8;
            const barSpacing = chartWidth / data.length * 0.2;
            
            // ìµœëŒ€ê°’ ê³„ì‚°
            const maxValue = Math.max(...data.map(d => d.value));
            
            // Yì¶• ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Xì¶• ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Yì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxValue / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4'];
            
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barSpacing / 2;
                const barHeight = (item.value / maxValue) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.value.toString(), x + barWidth / 2, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ëª¨ë¸ëª…)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.label, x + barWidth / 2, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('AI ëª¨ë¸ë³„ ì‚¬ìš© ë¶„í¬', width / 2, 25);
        }
        
        // íŒŒì´ ì°¨íŠ¸ ë²”ë¡€ ê·¸ë¦¬ê¸°
        function drawPieChartLegend(ctx, width, height, data) {
            const legendX = 20;
            const legendY = height - 100;
            const itemHeight = 20;
            
            data.forEach((item, index) => {
                const y = legendY + index * itemHeight;
                
                // ìƒ‰ìƒ ë°•ìŠ¤
                ctx.fillStyle = item.color;
                ctx.fillRect(legendX, y, 15, 15);
                
                // í…ìŠ¤íŠ¸
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText(`${item.label}: ${item.value}íšŒ`, legendX + 20, y + 10);
            });
        }

        // ë¹„ìš© ì¶”ì´ ë¼ì¸ ì°¨íŠ¸ ìƒì„±
        function createCostTrendChart() {
            console.log('ğŸ’° createCostTrendChart ì‹œì‘...');
            console.log('ğŸ’° ì „ì—­ ë³€ìˆ˜ ìƒíƒœ í™•ì¸:');
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 'undefined');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 'undefined');
            
            const canvas = document.getElementById('costTrendChart');
            if (!canvas) {
                console.error('âŒ costTrendChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ë¹„ìš© ë°ì´í„° ìƒì„±
            const costData = generateCostTrendData();
            console.log('ğŸ’° ìƒì„±ëœ ë¹„ìš© ë°ì´í„°:', costData);
            
            if (costData.length === 0) {
                console.log('âš ï¸ ë¹„ìš© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë¹„ìš© ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë¼ì¸ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawLineChart(ctx, width, height, costData);
            console.log('âœ… ë¹„ìš© ì¶”ì´ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // ë¹„ìš© ì¶”ì´ ë°ì´í„° ìƒì„±
        function generateCostTrendData() {
            console.log('ğŸ’° generateCostTrendData ì‹œì‘...');
            const dailyCosts = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ’° ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            console.log('- ì‚¬ìš©í•  rawEvents.length:', rawEvents ? rawEvents.length : 0);
            
            if (rawEvents && rawEvents.length > 0) {
                rawEvents.forEach(event => {
                    const eventDate = new Date(parseInt(event.timestamp));
                    const dateKey = eventDate.toISOString().split('T')[0];
                    const cost = (event.requestsCosts || 0) / 100; // cents to dollars
                    
                    if (dailyCosts.has(dateKey)) {
                        dailyCosts.set(dateKey, dailyCosts.get(dateKey) + cost);
                    } else {
                        dailyCosts.set(dateKey, cost);
                    }
                });
            } else {
                console.log('âš ï¸ generateCostTrendData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
            const sortedDates = Array.from(dailyCosts.keys()).sort();
            const data = sortedDates.map(date => ({
                date: date,
                cost: dailyCosts.get(date)
            }));
            
            console.log(`ğŸ“Š ë¹„ìš© ì¶”ì´ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ì¼ê°„ì˜ ë°ì´í„° (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return data;
        }

        // ë¼ì¸ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawLineChart(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 40;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            // Yì¶• ìµœëŒ€ê°’ ê³„ì‚°
            const maxCost = Math.max(...data.map(d => d.cost));
            const minCost = Math.min(...data.map(d => d.cost));
            const costRange = maxCost - minCost;
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // ì„¸ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= data.length - 1; i++) {
                const x = padding + (chartWidth / (data.length - 1)) * i;
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
            }
            
            // ë¼ì¸ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((point, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = height - padding - ((point.cost - minCost) / costRange) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // ë°ì´í„° í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
            data.forEach((point, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = height - padding - ((point.cost - minCost) / costRange) * chartHeight;
                
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // ì¶• ë ˆì´ë¸” ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            
            // Xì¶• ë ˆì´ë¸” (ë‚ ì§œ)
            data.forEach((point, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const date = new Date(point.date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
                ctx.fillText(dateStr, x, height - 10);
            });
            
            // Yì¶• ë ˆì´ë¸” (ë¹„ìš©)
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                const cost = maxCost - (costRange / 5) * i;
                ctx.fillText(`$${cost.toFixed(2)}`, 10, y + 4);
            }
        }

        // í™œë™ ìœ í˜• ë¶„í¬ ë°” ì°¨íŠ¸ ìƒì„±
        function createActivityTypeChart() {
            console.log('ğŸ“Š createActivityTypeChart ì‹œì‘...');
            const canvas = document.getElementById('activityTypeChart');
            if (!canvas) {
                console.error('âŒ activityTypeChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í™œë™ ìœ í˜• ë°ì´í„° ìƒì„±
            const activityData = generateActivityTypeData();
            console.log('ğŸ“Š ìƒì„±ëœ í™œë™ ìœ í˜• ë°ì´í„°:', activityData);
            
            if (activityData.length === 0) {
                console.log('âš ï¸ í™œë™ ìœ í˜• ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('í™œë™ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawBarChart(ctx, width, height, activityData);
            console.log('âœ… í™œë™ ìœ í˜• ë¶„í¬ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // í™œë™ ìœ í˜• ë°ì´í„° ìƒì„±
        function generateActivityTypeData() {
            console.log('ğŸ“Š generateActivityTypeData ì‹œì‘...');
            const activityTypes = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            console.log('- ì‚¬ìš©í•  rawEvents.length:', rawEvents ? rawEvents.length : 0);
            
            if (rawEvents && rawEvents.length > 0) {
                rawEvents.forEach(event => {
                    const type = event.kind || 'unknown';
                    activityTypes.set(type, (activityTypes.get(type) || 0) + 1);
                });
            } else {
                console.log('âš ï¸ generateActivityTypeData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ìƒ‰ìƒ ì¶”ê°€
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0'];
            const data = [];
            let colorIndex = 0;
            
            activityTypes.forEach((count, type) => {
                data.push({
                    label: type,
                    value: count,
                    color: colors[colorIndex % colors.length]
                });
                colorIndex++;
            });
            
            console.log(`ğŸ“Š í™œë™ ìœ í˜• ë°ì´í„° ìƒì„± ì™„ë£‰: ${data.length}ê°œ ìœ í˜• (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return data;
        }

        // ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawBarChart(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.length;
            const maxValue = Math.max(...data.map(d => d.value));
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // ë°” ê·¸ë¦¬ê¸°
            data.forEach((item, index) => {
                const x = padding + barWidth * index + barWidth * 0.1;
                const barHeight = (item.value / maxValue) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë°” ê·¸ë¦¬ê¸°
                ctx.fillStyle = item.color;
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ê°’ í…ìŠ¤íŠ¸
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.value.toString(), x + barWidth * 0.4, y - 10);
                
                // ë ˆì´ë¸”
                ctx.fillStyle = '#7a7a7a';
                ctx.fillText(item.label, x + barWidth * 0.4, height - 10);
            });
            
            // Yì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                const value = maxValue - (maxValue / 5) * i;
                ctx.fillText(value.toString(), padding - 10, y + 4);
            }
        }

        // ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ë§‰ëŒ€ ê·¸ë˜í”„)
        function createUserHeatmapChart() {
            console.log('ğŸ”¥ createUserHeatmapChart ì‹œì‘...');
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) {
                console.error('âŒ userHeatmapChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± (ë§‰ëŒ€ ê·¸ë˜í”„ìš©)
            const heatmapData = generateHeatmapBarData();
            console.log('ğŸ”¥ ìƒì„±ëœ íˆíŠ¸ë§µ ë°ì´í„°:', heatmapData);
            
            if (heatmapData.length === 0) {
                console.log('âš ï¸ íˆíŠ¸ë§µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('í™œë™ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawHeatmapBarChart(ctx, width, height, heatmapData);
            console.log('âœ… ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // íˆíŠ¸ë§µ ë§‰ëŒ€ ê·¸ë˜í”„ìš© ë°ì´í„° ìƒì„±
        function generateHeatmapBarData() {
            console.log('ğŸ”¥ generateHeatmapBarData ì‹œì‘...');
            const userActivityMap = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ”¥ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.members:', chartDataStore.members ? chartDataStore.members.length : 0);
            console.log('- currentMembers:', currentMembers ? currentMembers.length : 0);
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateHeatmapBarData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateHeatmapBarData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ìˆ˜ ê³„ì‚°
            members.forEach((member, userIndex) => {
                const userEmail = member.email;
                const userName = member.name;
                const userId = userEmail.split('@')[0]; // ID ì¶”ì¶œ
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                const totalActivity = userEvents.length;
                
                userActivityMap.set(userIndex, {
                    name: userName,
                    email: userEmail,
                    id: userId,
                    totalActivity: totalActivity
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 20ëª… ì„ íƒ
            const sortedUsers = Array.from(userActivityMap.entries())
                .sort((a, b) => b[1].totalActivity - a[1].totalActivity)
                .slice(0, 20);
            
            const data = sortedUsers.map(([userIndex, userData]) => ({
                userId: userData.id,
                userName: userData.name,
                email: userData.email,
                activity: userData.totalActivity
            }));
            
            console.log(`ğŸ”¥ íˆíŠ¸ë§µ ë§‰ëŒ€ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ëª…ì˜ ì‚¬ìš©ì (ë°ì´í„° ì†ŒìŠ¤: ${members.length}ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            console.log('ğŸ”¥ ìµœì¢… ë°ì´í„°:', data);
            return data;
        }

        // ê¸°ì¡´ íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± (ì°¸ê³ ìš©)
        function generateHeatmapData() {
            const userActivityMap = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = chartDataStore.members.length > 0 ? chartDataStore.members : currentMembers;
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateHeatmapData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateHeatmapData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            members.forEach((member, userIndex) => {
                const userEmail = member.email;
                const userName = member.name;
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail
                );
                
                const dailyActivity = new Map();
                
                userEvents.forEach(event => {
                    const eventDate = new Date(parseInt(event.timestamp));
                    const dateKey = eventDate.toISOString().split('T')[0];
                    
                    if (dailyActivity.has(dateKey)) {
                        dailyActivity.set(dateKey, dailyActivity.get(dateKey) + 1);
                    } else {
                        dailyActivity.set(dateKey, 1);
                    }
                });
                
                userActivityMap.set(userIndex, {
                    name: userName,
                    email: userEmail,
                    dailyActivity: dailyActivity
                });
            });
            
            const data = [];
            const days = 7;
            
            for (let userIndex = 0; userIndex < Math.min(userActivityMap.size, 5); userIndex++) {
                const userData = userActivityMap.get(userIndex);
                if (!userData) continue;
                
                for (let dayIndex = 0; dayIndex < days; dayIndex++) {
                    const targetDate = new Date();
                    targetDate.setDate(targetDate.getDate() - (days - 1 - dayIndex));
                    const dateKey = targetDate.toISOString().split('T')[0];
                    
                    const activity = userData.dailyActivity.get(dateKey) || 0;
                    
                    data.push({
                        user: userIndex,
                        day: dayIndex,
                        activity: activity,
                        userName: userData.name
                    });
                }
            }
            
            console.log(`ğŸ“Š íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ê°œ ì…€ (ë°ì´í„° ì†ŒìŠ¤: ${members.length}ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return data;
        }

        // íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°
        function drawHeatmap(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const cellWidth = (width - 100) / 7;
            const cellHeight = (height - 80) / 5;
            const startX = 80;
            const startY = 20;
            const cellSpacing = 8; // ì…€ ê°„ê²© ì¶”ê°€
            
            const maxActivity = Math.max(...data.map(d => d.activity));
            
            data.forEach(item => {
                const x = startX + item.day * cellWidth;
                const y = startY + item.user * cellHeight;
                
                const intensity = item.activity / maxActivity;
                const color = getHeatmapColor(intensity);
                
                ctx.fillStyle = color;
                // ì…€ ê°„ê²©ì„ ê³ ë ¤í•˜ì—¬ í¬ê¸° ì¡°ì •
                ctx.fillRect(x + cellSpacing/2, y + cellSpacing/2, cellWidth - cellSpacing, cellHeight - cellSpacing);
                
                if (item.activity > 0) {
                    ctx.fillStyle = intensity > 0.5 ? '#000' : '#fff';
                    ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(item.activity.toString(), x + cellWidth/2, y + cellHeight/2);
                }
            });
        }

        // íˆíŠ¸ë§µ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
        function drawHeatmapBarChart(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.length;
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0'];
            
            // ìµœëŒ€ í™œë™ ìˆ˜ ì°¾ê¸°
            const maxActivity = Math.max(...data.map(item => item.activity));
            
            // Yì¶• ë ˆì´ë¸” ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxActivity / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barWidth * 0.1;
                const barHeight = (item.activity / maxActivity) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.activity.toString(), x + barWidth * 0.4, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ì‚¬ìš©ì ID)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.userId.substring(0, 15), x + barWidth * 0.4, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ì‚¬ìš©ìë³„ í™œë™ íˆíŠ¸ë§µ (ìƒìœ„ 20ëª…)', width / 2, 25);
        }

        // íˆíŠ¸ë§µ ìƒ‰ìƒ ê³„ì‚°
        function getHeatmapColor(intensity) {
            const r = Math.floor(255 * intensity);
            const g = Math.floor(100 * (1 - intensity));
            const b = Math.floor(255 * (1 - intensity));
            return `rgb(${r}, ${g}, ${b})`;
        }

        // íˆíŠ¸ë§µ ë ˆì´ë¸” ê·¸ë¦¬ê¸°
        function drawHeatmapLabels(ctx, width, height) {
            const users = [];
            if (currentMembers && currentMembers.length > 0) {
                currentMembers.slice(0, 5).forEach(member => {
                    users.push(member.name);
                });
            }
            
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dayName = date.toLocaleDateString('ko-KR', { weekday: 'short' });
                days.push(dayName);
            }
            
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            
            const cellHeight = (height - 80) / 5;
            users.forEach((user, index) => {
                const y = 20 + index * cellHeight + cellHeight/2;
                const displayName = user.length > 8 ? user.substring(0, 8) + '...' : user;
                ctx.fillText(displayName, 40, y);
            });
            
            const cellWidth = (width - 100) / 7;
            days.forEach((day, index) => {
                const x = 80 + index * cellWidth + cellWidth/2;
                ctx.fillText(day, x, 10);
            });
        }

        // ë¹„ìš© íš¨ìœ¨ì„± ë¶„ì„ ì°¨íŠ¸ ìƒì„±
        function createCostEfficiencyChart() {
            const canvas = document.getElementById('costEfficiencyChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const efficiencyData = generateCostEfficiencyData();
            drawScatterPlot(ctx, width, height, efficiencyData);
        }

        // ë¹„ìš© íš¨ìœ¨ì„± ë°ì´í„° ìƒì„±
        function generateCostEfficiencyData() {
            const userEfficiency = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = chartDataStore.members.length > 0 ? chartDataStore.members : currentMembers;
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateCostEfficiencyData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateCostEfficiencyData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            members.forEach(member => {
                const userEmail = member.email;
                const userName = member.name;
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail
                );
                
                const totalRequests = userEvents.length;
                const totalCost = userEvents.reduce((sum, event) => 
                    sum + (event.requestsCosts || 0), 0) / 100;
                
                if (totalRequests > 0) {
                    userEfficiency.set(userName, {
                        requests: totalRequests,
                        cost: totalCost,
                        efficiency: totalCost / totalRequests
                    });
                }
            });
            
            const result = Array.from(userEfficiency.values());
            console.log(`ğŸ“Š ë¹„ìš© íš¨ìœ¨ì„± ë°ì´í„° ìƒì„± ì™„ë£‰: ${result.length}ëª…ì˜ ì‚¬ìš©ì (ë°ì´í„° ì†ŒìŠ¤: ${members.length}ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return result;
        }

        // ìŠ¤ìºí„° í”Œë¡¯ ê·¸ë¦¬ê¸°
        function drawScatterPlot(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            const maxRequests = Math.max(...data.map(d => d.requests));
            const maxCost = Math.max(...data.map(d => d.cost));
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5; i++) {
                const x = padding + (chartWidth / 5) * i;
                const y = padding + (chartHeight / 5) * i;
                
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // ë°ì´í„° í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
            data.forEach(item => {
                const x = padding + (item.requests / maxRequests) * chartWidth;
                const y = height - padding - (item.cost / maxCost) * chartHeight;
                
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#fff';
                ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${item.requests}`, x, y - 10);
            });
            
            // ì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ìš”ì²­ ìˆ˜', width / 2, height - 10);
            
            ctx.save();
            ctx.translate(10, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ë¹„ìš© ($)', 0, 0);
            ctx.restore();
        }

        // ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„±
        function createModelPreferenceChart() {
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const preferenceData = generateModelPreferenceData();
            drawStackedBarChart(ctx, width, height, preferenceData);
        }

        // ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„± (í™œë™ ê¸°ì¤€ ìƒìœ„ 20ëª…, í™œë™ ì—†ëŠ” ì‚¬ìš©ì ì œì™¸)
        function generateModelPreferenceData() {
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = chartDataStore.members.length > 0 ? chartDataStore.members : currentMembers;
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateModelPreferenceData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateModelPreferenceData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ë° ëª¨ë¸ ì‚¬ìš©ëŸ‰ ê³„ì‚°
            const userActivityData = [];
            members.forEach(member => {
                const userEmail = member.email;
                const userName = member.name;
                const userId = userEmail.split('@')[0];
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                // í™œë™ì´ ì—†ëŠ” ì‚¬ìš©ìëŠ” ì œì™¸
                if (userEvents.length === 0) {
                    return;
                }
                
                const modelUsage = new Map();
                userEvents.forEach(event => {
                    const model = event.model || 'unknown';
                    modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
                });
                
                userActivityData.push({
                    userName: userName,
                    userId: userId,
                    email: userEmail,
                    totalActivity: userEvents.length,
                    modelUsage: modelUsage
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 20ëª… ì„ íƒ
            const sortedUsers = userActivityData
                .sort((a, b) => b.totalActivity - a.totalActivity)
                .slice(0, 20);
            
            // Map í˜•íƒœë¡œ ë³€í™˜ (ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´)
            const userModelPreference = new Map();
            sortedUsers.forEach(user => {
                userModelPreference.set(user.userId, user.modelUsage); // userIdë¡œ í‚¤ ë³€ê²½
            });
            
            console.log(`ğŸ“Š ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${userModelPreference.size}ëª…ì˜ í™œì„± ì‚¬ìš©ì (ì „ì²´ ${members.length}ëª… ì¤‘ ìƒìœ„ 20ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return userModelPreference;
        }

        // ìŠ¤íƒ ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawStackedBarChart(ctx, width, height, data) {
            if (data.size === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.size;
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0'];
            
            let userIndex = 0;
            data.forEach((modelUsage, userName) => {
                const x = padding + barWidth * userIndex + barWidth * 0.1;
                const totalUsage = Array.from(modelUsage.values()).reduce((sum, count) => sum + count, 0);
                
                // ì‚¬ìš©ì ID (userNameì´ ì´ë¯¸ userIdë¡œ ì„¤ì •ë¨)
                const userId = userName;
                
                let currentY = height - padding;
                let colorIndex = 0;
                
                modelUsage.forEach((count, model) => {
                    const barHeight = (count / totalUsage) * chartHeight;
                    currentY -= barHeight;
                    
                    ctx.fillStyle = colors[colorIndex % colors.length];
                    ctx.fillRect(x, currentY, barWidth * 0.8, barHeight);
                    
                    if (barHeight > 20) {
                        ctx.fillStyle = '#fff';
                        ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(model, x + barWidth * 0.4, currentY + barHeight / 2);
                    }
                    
                    colorIndex++;
                });
                
                // ì‚¬ìš©ì ID (Xì¶•) - ìµœëŒ€ 15ìë¡œ ì œí•œ
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(userId.substring(0, 15), x + barWidth * 0.4, height - 10);
                
                userIndex++;
            });
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±
        function createUserPerformanceChart() {
            console.log('ğŸ† createUserPerformanceChart ì‹œì‘');
            
            const canvas = document.getElementById('userPerformanceChart');
            if (!canvas) {
                console.error('âŒ userPerformanceChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            console.log(`ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸°: ${width}x${height}`);
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const performanceData = generateUserPerformanceData();
            console.log(`ğŸ“Š ì„±ê³¼ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${performanceData.length}ëª…ì˜ ì‚¬ìš©ì`);
            
            if (performanceData.length === 0) {
                console.log('âš ï¸ ì„±ê³¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            console.log('ğŸ”„ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì‹œì‘...', performanceData);
            drawPerformanceChart(ctx, width, height, performanceData);
            console.log('âœ… ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„)
        function createFilteredUserHeatmapChart(searchTerm) {
            console.log('ğŸ”¥ createFilteredUserHeatmapChart ì‹œì‘:', searchTerm);
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) {
                console.error('âŒ userHeatmapChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê²€ìƒ‰ëœ ì‚¬ìš©ìì˜ ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
            const weeklyData = generateWeeklyActivityData(searchTerm);
            console.log('ğŸ”¥ ìƒì„±ëœ ìš”ì¼ë³„ ë°ì´í„°:', weeklyData);
            
            if (!weeklyData || !weeklyData.data || weeklyData.data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
                return;
            }
            
            // ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawWeeklyBarChart(ctx, width, height, weeklyData.data, weeklyData.userName);
            console.log('âœ… í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
        function generateWeeklyActivityData(searchTerm) {
            console.log('ğŸ”¥ generateWeeklyActivityData ì‹œì‘:', searchTerm);
            
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!members || members.length === 0 || !rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                return [];
            }
            
            // ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì ì°¾ê¸° (ID ê¸°ë°˜)
            const matchedUser = members.find(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase() === searchTerm.toLowerCase();
            });
            
            if (!matchedUser) {
                console.log('âš ï¸ ê²€ìƒ‰ëœ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return null;
            }
            
            // í•´ë‹¹ ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ í•„í„°ë§
            const userEvents = rawEvents.filter(event => 
                event.userEmail === matchedUser.email || event.email === matchedUser.email
            );
            
            // ìš”ì¼ë³„ í™œë™ ìˆ˜ ê³„ì‚°
            const weeklyActivity = new Map();
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            
            userEvents.forEach(event => {
                const eventDate = new Date(parseInt(event.timestamp));
                const dayOfWeek = eventDate.getDay();
                const dayName = dayNames[dayOfWeek];
                
                weeklyActivity.set(dayName, (weeklyActivity.get(dayName) || 0) + 1);
            });
            
            // ëª¨ë“  ìš”ì¼ì— ëŒ€í•´ ë°ì´í„° ìƒì„± (í™œë™ì´ ì—†ëŠ” ìš”ì¼ì€ 0)
            const data = dayNames.map(dayName => ({
                day: dayName,
                activity: weeklyActivity.get(dayName) || 0
            }));
            
            console.log(`ğŸ”¥ ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${matchedUser.name} (${data.length}ì¼)`);
            console.log('ğŸ”¥ ìµœì¢… ë°ì´í„°:', data);
            return {
                data: data,
                userName: matchedUser.name,
                userEmail: matchedUser.email
            };
        }

        // ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
        function drawWeeklyBarChart(ctx, width, height, data, userName) {
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.length;
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4', '#ff5722'];
            
            // ìµœëŒ€ í™œë™ ìˆ˜ ì°¾ê¸°
            const maxActivity = Math.max(...data.map(item => item.activity));
            
            // Yì¶• ë ˆì´ë¸” ê·¸ë¦¬ê¸° (íˆíŠ¸ìˆ˜)
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxActivity / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // Yì¶• ì œëª© (íˆíŠ¸ìˆ˜)
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.save();
            ctx.translate(20, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('íˆíŠ¸ìˆ˜', 0, 0);
            ctx.restore();
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barWidth * 0.1;
                const barHeight = maxActivity > 0 ? (item.activity / maxActivity) * chartHeight : 0;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.activity.toString(), x + barWidth * 0.4, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ìš”ì¼)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.day, x + barWidth * 0.4, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`${userName}ì˜ ìš”ì¼ë³„ íˆíŠ¸ìˆ˜`, width / 2, 25);
        }

        // í•„í„°ë§ëœ ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±
        function createFilteredUserPerformanceChart(searchTerm) {
            const canvas = document.getElementById('userPerformanceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ì „ì²´ ì„±ê³¼ ë°ì´í„°ì—ì„œ ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ìë§Œ í•„í„°ë§
            const allPerformanceData = generateUserPerformanceData();
            const filteredData = allPerformanceData.filter(user => 
                user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                user.email.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredData.length === 0) {
                // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
                return;
            }
            
            // í•„í„°ë§ëœ ë°ì´í„°ë¡œ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawPerformanceChart(ctx, width, height, filteredData);
            
            console.log(`âœ… í•„í„°ë§ëœ ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ: "${searchTerm}" - ${filteredData.length}ëª…ì˜ ì‚¬ìš©ì`);
        }

        // í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ìš”ì¼ë³„ íˆíŠ¸ìˆ˜)
        function createFilteredUserHeatmapChart(searchTerm) {
            console.log('ğŸ”¥ createFilteredUserHeatmapChart ì‹œì‘:', searchTerm);
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) {
                console.error('âŒ userHeatmapChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê²€ìƒ‰ëœ ì‚¬ìš©ìì˜ ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
            const weeklyData = generateWeeklyActivityData(searchTerm);
            console.log('ğŸ”¥ ìƒì„±ëœ ìš”ì¼ë³„ ë°ì´í„°:', weeklyData);
            
            if (!weeklyData || !weeklyData.data || weeklyData.data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
                return;
            }
            
            // ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawWeeklyBarChart(ctx, width, height, weeklyData.data, weeklyData.userName);
            console.log('âœ… í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // í•„í„°ë§ëœ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„±
        function createFilteredModelPreferenceChart(searchTerm) {
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`ëª¨ë¸ ì„ í˜¸ë„ ê²€ìƒ‰ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...`, width / 2, height / 2);
            
            console.log(`âœ… í•„í„°ë§ëœ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ: "${searchTerm}"`);
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„±
        function generateUserPerformanceData() {
            const userPerformance = [];
            
            // í˜„ì¬ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ê¸° (chartDataStore ìš°ì„ , ì—†ìœ¼ë©´ ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembersData || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log(`ğŸ” ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„± ì‹œì‘: ë©¤ë²„ ${members.length}ëª…, ì´ë²¤íŠ¸ ${rawEvents.length}ê°œ`);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateUserPerformanceData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateUserPerformanceData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            members.forEach(member => {
                const userEmail = member.email;
                const userName = member.name;
                
                // ì´ë©”ì¼ í•„ë“œëª… í™•ì¸ (userEmail ë˜ëŠ” email)
                const userEvents = rawEvents.filter(event => {
                    const eventEmail = event.userEmail || event.email;
                    return eventEmail === userEmail;
                });
                
                const totalRequests = userEvents.length;
                const totalCost = userEvents.reduce((sum, event) => 
                    sum + (event.requestsCosts || 0), 0) / 100;
                const uniqueDays = new Set(userEvents.map(event => 
                    new Date(parseInt(event.timestamp)).toDateString())).size;
                
                if (totalRequests > 0) {
                    userPerformance.push({
                        name: userName,
                        email: userEmail,
                        requests: totalRequests,
                        cost: totalCost,
                        activeDays: uniqueDays,
                        efficiency: totalRequests / uniqueDays || 0
                    });
                }
            });
            
            const result = userPerformance.sort((a, b) => b.requests - a.requests).slice(0, 50);
            console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${result.length}ëª…ì˜ ì‚¬ìš©ì (ìƒìœ„ 50ëª…, ì „ì²´: ${userPerformance.length}ëª…)`);
            return result;
        }

        // ì„±ê³¼ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawPerformanceChart(ctx, width, height, data) {
            console.log(`ğŸ¨ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì‹œì‘: ë°ì´í„° ${data.length}ê°œ, ìº”ë²„ìŠ¤ í¬ê¸° ${width}x${height}`);
            
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = Math.max(4, chartWidth / data.length); // ìµœì†Œ 4px ë„ˆë¹„ ë³´ì¥
            const maxRequests = Math.max(...data.map(d => d.requests));
            
            console.log(`ğŸ“Š ì°¨íŠ¸ ì„¤ì •: íŒ¨ë”©=${padding}, ì°¨íŠ¸í¬ê¸°=${chartWidth}x${chartHeight}, ë°”ë„ˆë¹„=${barWidth}, ìµœëŒ€ìš”ì²­=${maxRequests}`);
            
            // ë°°ê²½ ì§€ìš°ê¸°
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê·¸ë¦¬ë“œ
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
                
                // Yì¶• ë¼ë²¨
                const value = Math.round((maxRequests * (5 - i)) / 5);
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(value.toString(), padding - 10, y + 4);
            }
            
            // ë°” ì°¨íŠ¸
            data.forEach((user, index) => {
                const x = padding + barWidth * index + barWidth * 0.1;
                const barHeight = Math.max(1, (user.requests / maxRequests) * chartHeight);
                const y = height - padding - barHeight;
                
                // ë°” ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#4a9eff';
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ìš”ì²­ ìˆ˜ (ë°” ìœ„ì—)
                if (barHeight > 20) {
                    ctx.fillStyle = '#fff';
                    ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(user.requests.toString(), x + barWidth * 0.4, y - 5);
                }
                
                // ì´ë©”ì¼ ID (Xì¶• ì•„ë˜) - @samsung.com ì œì™¸
                if (barWidth > 20) {
                    ctx.fillStyle = '#7a7a7a';
                    ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.save();
                    ctx.translate(x + barWidth * 0.4, height - 15);
                    ctx.rotate(-Math.PI / 4);
                    const emailId = user.email.split('@')[0]; // @samsung.com ì œì™¸í•˜ê³  IDë§Œ ì¶”ì¶œ
                    ctx.fillText(emailId.substring(0, 8), 0, 0); // ìµœëŒ€ 8ê¸€ìê¹Œì§€ í‘œì‹œ
                    ctx.restore();
                }
            });
            
            // ë²”ë¡€ ê·¸ë¦¬ê¸° (ì˜¤ë¥¸ìª½ ìƒë‹¨)
            drawPerformanceLegend(ctx, width, height);
            
            console.log('âœ… ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì™„ë£Œ');
        }

        // ì„±ê³¼ ì°¨íŠ¸ ë²”ë¡€ ê·¸ë¦¬ê¸°
        function drawPerformanceLegend(ctx, width, height) {
            const legendX = width - 200;
            const legendY = 30;
            const itemHeight = 18;
            const itemSpacing = 5;
            
            // ë²”ë¡€ ë°°ê²½
            ctx.fillStyle = 'rgba(26, 26, 26, 0.9)';
            ctx.fillRect(legendX - 10, legendY - 10, 190, 120);
            
            // ë²”ë¡€ í…Œë‘ë¦¬
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            ctx.strokeRect(legendX - 10, legendY - 10, 190, 120);
            
            // ë²”ë¡€ ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = 'bold 12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('ğŸ“Š ê³„ì‚° ì§€í‘œ', legendX, legendY);
            
            // ë²”ë¡€ í•­ëª©ë“¤
            const legendItems = [
                { label: 'ì´ ìš”ì²­ ìˆ˜', description: 'ì‚¬ìš©ìë³„ ì´ë²¤íŠ¸ ê°œìˆ˜' },
                { label: 'ì´ ë¹„ìš©', description: 'requestsCosts í•©ê³„ Ã· 100' },
                { label: 'í™œë™ ì¼ìˆ˜', description: 'ê³ ìœ í•œ í™œë™ ë‚ ì§œ ìˆ˜' },
                { label: 'íš¨ìœ¨ì„±', description: 'ì´ ìš”ì²­ ìˆ˜ Ã· í™œë™ ì¼ìˆ˜' },
                { label: 'ì •ë ¬ ê¸°ì¤€', description: 'ìš”ì²­ ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ' }
            ];
            
            legendItems.forEach((item, index) => {
                const y = legendY + 20 + (itemHeight + itemSpacing) * index;
                
                // ë¼ë²¨
                ctx.fillStyle = '#4a9eff';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText(item.label, legendX, y);
                
                // ì„¤ëª…
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.fillText(item.description, legendX, y + 12);
            });
        }

        // í™œë™ ìœ í˜• ìƒì„¸ ì°¨íŠ¸ ìƒì„±
        function createActivityTypeDetailedChart() {
            const canvas = document.getElementById('activityTypeDetailedChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const detailedData = generateActivityTypeDetailedData();
            drawDetailedBarChart(ctx, width, height, detailedData);
        }

        // í™œë™ ìœ í˜• ìƒì„¸ ë°ì´í„° ìƒì„±
        function generateActivityTypeDetailedData() {
            const activityDetails = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateActivityTypeDetailedData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            rawEvents.forEach(event => {
                const type = event.kind || 'unknown';
                const model = event.model || 'unknown';
                const cost = (event.requestsCosts || 0) / 100;
                
                if (!activityDetails.has(type)) {
                    activityDetails.set(type, {
                        count: 0,
                        totalCost: 0,
                        models: new Map(),
                        users: new Set()
                    });
                }
                
                const details = activityDetails.get(type);
                details.count++;
                details.totalCost += cost;
                details.models.set(model, (details.models.get(model) || 0) + 1);
                details.users.add(event.userEmail);
            });
            
            console.log(`ğŸ“Š í™œë™ ìœ í˜• ìƒì„¸ ë°ì´í„° ìƒì„± ì™„ë£‰: ${activityDetails.size}ê°œ ìœ í˜• (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return activityDetails;
        }

        // ìƒì„¸ ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawDetailedBarChart(ctx, width, height, data) {
            if (data.size === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.size;
            const maxCount = Math.max(...Array.from(data.values()).map(d => d.count));
            
            let index = 0;
            data.forEach((details, type) => {
                const x = padding + barWidth * index + barWidth * 0.1;
                const barHeight = (details.count / maxCount) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë©”ì¸ ë°”
                ctx.fillStyle = '#4a9eff';
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ì •ë³´ í…ìŠ¤íŠ¸
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(details.count.toString(), x + barWidth * 0.4, y - 10);
                
                // í™œë™ ìœ í˜•
                ctx.fillStyle = '#7a7a7a';
                ctx.fillText(type, x + barWidth * 0.4, height - 10);
                
                // ì¶”ê°€ ì •ë³´
                ctx.fillStyle = '#ff9800';
                ctx.fillText(`$${details.totalCost.toFixed(2)}`, x + barWidth * 0.4, height - 25);
                ctx.fillStyle = '#4caf50';
                ctx.fillText(`${details.users.size}ëª…`, x + barWidth * 0.4, height - 40);
                
                index++;
            });
        }

        // ì°¨íŠ¸ ìƒì„± (Overviewìš©)
        function createOverviewChart() {
            const canvas = document.getElementById('overviewChart');
            if (!canvas) return;
           
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
           
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
           
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í˜„ì¬ í•„í„° ìƒíƒœ í™•ì¸
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
            
            // ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
            const dailyData = generateDailyActivityData(dateRange);
            
            if (dailyData.length === 0) {
                // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
           
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
           
            // ì„¸ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= dailyData.length; i++) {
                const x = (width / dailyData.length) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
           
            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = (height / 5) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // ìµœëŒ€ê°’ ê³„ì‚°
            const maxValue = Math.max(...dailyData.map(d => d.value));
            
            // ë°ì´í„° í¬ì¸íŠ¸ ìƒì„±
            const dataPoints = dailyData.map((data, index) => ({
                x: (width / dailyData.length) * index + (width / dailyData.length / 2),
                y: height - (height * (data.value / maxValue)) - 20
            }));
           
            // ì„  ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(dataPoints[0].x, dataPoints[0].y);
           
            for (let i = 1; i < dataPoints.length; i++) {
                ctx.lineTo(dataPoints[i].x, dataPoints[i].y);
            }
            ctx.stroke();
           
            // ë°ì´í„° í¬ì¸íŠ¸ ì› ê·¸ë¦¬ê¸°
            dataPoints.forEach(point => {
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
           
            // ë‚ ì§œ ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
           
            dailyData.forEach((data, index) => {
                const x = (width / dailyData.length) * index + (width / dailyData.length / 2);
                ctx.fillText(data.date, x, height - 10);
            });
        }
        
        // ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„± í•¨ìˆ˜
        function generateDailyActivityData(dateRange) {
            const dailyData = [];
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateDailyActivityData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return dailyData;
            }
            
            // ë‚ ì§œë³„ í™œë™ ìˆ˜ ì§‘ê³„
            const dailyActivity = new Map();
            
            rawEvents.forEach(event => {
                const eventDate = new Date(parseInt(event.timestamp));
                const dateKey = eventDate.toISOString().split('T')[0];
                
                if (eventDate >= dateRange.startDate && eventDate <= dateRange.endDate) {
                    dailyActivity.set(dateKey, (dailyActivity.get(dateKey) || 0) + 1);
                }
            });
            
            // ë‚ ì§œ ë²”ìœ„ ë‚´ ëª¨ë“  ë‚ ì§œì— ëŒ€í•´ ë°ì´í„° ìƒì„±
            const startDate = new Date(dateRange.startDate);
            const endDate = new Date(dateRange.endDate);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateKey = d.toISOString().split('T')[0];
                const dateStr = `${d.getMonth() + 1}/${d.getDate()}`;
                
                dailyData.push({
                    date: dateStr,
                    value: dailyActivity.get(dateKey) || 0
                });
            }
            
            return dailyData;
        }

        // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê´€ë¦¬ ê°ì²´
        const scrollPositions = {
            overview: 0,
            members: 0,
            usage: 0,
            settings: 0
        };
        
        // ì„¹ì…˜ë³„ ìµœì´ˆ ë°©ë¬¸ ì—¬ë¶€ ì¶”ì 
        const sectionVisited = {
            overview: false,
            members: false,
            usage: false,
            settings: false
        };

        // ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
               
                // í˜„ì¬ í™œì„± ì„¹ì…˜ì˜ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
                const currentActiveSection = document.querySelector('.content-section.active');
                if (currentActiveSection) {
                    const currentSectionName = currentActiveSection.id;
                    scrollPositions[currentSectionName] = currentActiveSection.scrollTop;
                }
               
                // ëª¨ë“  ë©”ë‰´ ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.menu-item').forEach(menu => {
                    menu.classList.remove('active');
                });
               
                // í´ë¦­ëœ ë©”ë‰´ì— active í´ë˜ìŠ¤ ì¶”ê°€
                this.classList.add('active');
               
                // ëª¨ë“  ì½˜í…ì¸  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
               
                // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
                const sectionName = this.getAttribute('data-section');
                const targetSection = document.getElementById(sectionName);
                if (targetSection) {
                    targetSection.classList.add('active');
                    
                    // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì„¤ì •
                    setTimeout(() => {
                        if (!sectionVisited[sectionName]) {
                            // ìµœì´ˆ ë°©ë¬¸ ì‹œ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                            targetSection.scrollTop = 0;
                            sectionVisited[sectionName] = true;
                            console.log(`${sectionName} ì„¹ì…˜ ìµœì´ˆ ë°©ë¬¸ - ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤`);
                        } else {
                            // ì´í›„ ë°©ë¬¸ ì‹œ ì´ì „ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¡œ ë³µì›
                            targetSection.scrollTop = scrollPositions[sectionName];
                            console.log(`${sectionName} ì„¹ì…˜ ì¬ë°©ë¬¸ - ì´ì „ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤: ${scrollPositions[sectionName]}px`);
                        }
                    }, 50);
                }
               
                // í—¤ë” ì œëª© ì—…ë°ì´íŠ¸
                const pageTitle = document.getElementById('page-title');
               
                switch(sectionName) {
                    case 'overview':
                        pageTitle.textContent = 'Dashboard Overview';
                        // Overview ë©”ë‰´ í´ë¦­ ì‹œ í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€í•˜ë©´ì„œ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨
                        setTimeout(async () => {
                            console.log('=== Overview ë©”ë‰´ í´ë¦­ ì‹œ ìë™ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘ ===');
                            await refreshAllRealData(); // ìë™ ìƒˆë¡œê³ ì¹¨ (í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€)
                        }, 100);
                        break;
                    case 'members':
                        pageTitle.textContent = 'Dashboard Members';
                        // Members ë©”ë‰´ í´ë¦­ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
                        setTimeout(async () => {
                            console.log('=== Members ë©”ë‰´ í´ë¦­ ì‹œ ìë™ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘ ===');
                            await updateMembersWithRealData();
                        }, 100);
                        break;
                    case 'usage':
                        pageTitle.textContent = 'Usage Analytics';
                        // Usage ë©”ë‰´ í´ë¦­ ì‹œ ì¡°ê±´ë¶€ ë°ì´í„° ë¡œë”©
                        setTimeout(async () => {
                            if (!isUsageDataLoaded) {
                                console.log('=== Usage ë©”ë‰´ ì²« ë²ˆì§¸ í´ë¦­ - ë°ì´í„° ë¡œë”© ì‹œì‘ ===');
                                // ì´ˆê¸° í•„í„° ê¸°ê°„ í‘œì‹œ ì„¤ì • (30ì¼)
                                const initialDateRange = getDateRange(30);
                                updateUsageFilterPeriodDisplay(initialDateRange.startDate, initialDateRange.endDate);
                                await updateUsageWithCurrentFilter(30, true); // ì²« ë²ˆì§¸ ë¡œë”©
                            } else {
                                console.log('=== Usage ë©”ë‰´ ì¬í´ë¦­ - ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ê°±ì‹  ===');
                                updateUsageWithCurrentFilter(30, false); // ë°±ê·¸ë¼ìš´ë“œ ë¡œë”©
                            }
                        }, 100);
                        break;
                    case 'settings':
                        pageTitle.textContent = 'Settings';
                        break;
                    default:
                        pageTitle.textContent = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
                }
            });
        });

        // ì•„ì½”ë””ì–¸ í† ê¸€ í•¨ìˆ˜
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.accordion-arrow');
           
            // ë‹¤ë¥¸ ëª¨ë“  ì•„ì½”ë””ì–¸ ë‹«ê¸°
            document.querySelectorAll('.accordion-content').forEach(otherContent => {
                if (otherContent !== content) {
                    otherContent.classList.remove('active');
                    otherContent.previousElementSibling.querySelector('.accordion-arrow').textContent = 'â–¼';
                }
            });
           
            // í˜„ì¬ ì•„ì½”ë””ì–¸ í† ê¸€
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                arrow.textContent = 'â–¼';
            } else {
                content.classList.add('active');
                arrow.textContent = 'â–²';
            }
        }

        // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ í™œì„±í™” ìƒíƒœ
        let emailSchedulerActive = false;

        // í† ê¸€ ìŠ¤ìœ„ì¹˜ í•¨ìˆ˜
        function toggleSwitch(toggle) {
            toggle.classList.toggle('off');
            
            // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ í† ê¸€ì¸ì§€ í™•ì¸
            const settingItem = toggle.closest('.setting-item');
            if (settingItem) {
                const label = settingItem.querySelector('.setting-label');
                if (label && label.textContent === 'ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬') {
                    const isActive = !toggle.classList.contains('off');
                    handleEmailSchedulerToggle(isActive);
                }
                // ìë™ ë°±ì—… í† ê¸€ì¸ì§€ í™•ì¸
                if (label && label.textContent === 'ìë™ ë°±ì—…') {
                    const isBackupActive = !toggle.classList.contains('off');
                    handleBackupToggle(isBackupActive);
                }
            }
        }

        // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ í™œì„±í™” í† ê¸€ ì²˜ë¦¬
        function handleEmailSchedulerToggle(isActive) {
            emailSchedulerActive = isActive;
            
            if (isActive) {
                console.log('âœ… ì˜ˆì•½ ë©”ì¼ ë°œì†¡ í™œì„±í™”ë¨ - ë°±ê·¸ë¼ìš´ë“œ ì²´í¬ ì‹œì‘');
                startEmailScheduler();
                // ì„¤ì • UI í‘œì‹œ
                const freqEl = document.getElementById('email-frequency-setting');
                const timeEl = document.getElementById('email-time-setting');
                if (freqEl) freqEl.style.display = '';
                if (timeEl) timeEl.style.display = '';
            } else {
                console.log('âŒ ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ë¹„í™œì„±í™”ë¨ - ë°±ê·¸ë¼ìš´ë“œ ì²´í¬ ì¤‘ì§€');
                stopEmailScheduler();
                // ì„¤ì • UI ìˆ¨ê¹€
                const freqEl = document.getElementById('email-frequency-setting');
                const timeEl = document.getElementById('email-time-setting');
                if (freqEl) freqEl.style.display = 'none';
                if (timeEl) timeEl.style.display = 'none';
            }
        }

        // ìë™ ë°±ì—… í† ê¸€ ì²˜ë¦¬
        function handleBackupToggle(isActive) {
            const freqEl = document.getElementById('backup-frequency-setting');
            const timeEl = document.getElementById('backup-time-setting');
            const locEl = document.getElementById('backup-location-setting');

            if (isActive) {
                if (freqEl) freqEl.style.display = '';
                if (timeEl) timeEl.style.display = '';
                if (locEl) locEl.style.display = '';
                // ì´ˆê¸° ì‹œê°„ ë“œë¡­ë‹¤ìš´ ë™ê¸°í™”
                initializeBackupTimeDropdowns();
            } else {
                if (freqEl) freqEl.style.display = 'none';
                if (timeEl) timeEl.style.display = 'none';
                if (locEl) locEl.style.display = 'none';
            }
        }

        // ë°±ì—… ì‹œê°„ ë“œë¡­ë‹¤ìš´ â†’ ìˆ¨ê²¨ì§„ time input ë™ê¸°í™”
        function updateBackupTimeInput() {
            const hourSelect = document.getElementById('backup-hour-select');
            const minuteSelect = document.getElementById('backup-minute-select');
            const timeInput = document.getElementById('backup-time-input');
            if (hourSelect && minuteSelect && timeInput) {
                const hour = String(hourSelect.value).padStart(2, '0');
                const minute = String(minuteSelect.value).padStart(2, '0');
                timeInput.value = `${hour}:${minute}`;
                console.log(`â° ë°±ì—… ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸: ${timeInput.value}`);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°±ì—… ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initializeBackupTimeDropdowns() {
            const timeInput = document.getElementById('backup-time-input');
            const hourSelect = document.getElementById('backup-hour-select');
            const minuteSelect = document.getElementById('backup-minute-select');
            if (timeInput && hourSelect && minuteSelect && timeInput.value.includes(':')) {
                const [hours, minutes] = timeInput.value.split(':');
                hourSelect.value = hours;
                minuteSelect.value = minutes;
                console.log(`â° ë°±ì—… ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”: ${hours}:${minutes}`);
            }
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ë³€ê²½ ì‹œ ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ì¬í™•ì¸
        function checkSchedulerStatus() {
            if (!emailSchedulerActive) {
                return; // í† ê¸€ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì‹œ
            }

            // ì˜ˆì•½ëœ ë©”ì¼ì´ ì—†ê±°ë‚˜ í™œì„± ìƒíƒœì¸ ì˜ˆì•½ì´ ì—†ìœ¼ë©´ ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€
            if (!window.emailScheduleList || window.emailScheduleList.length === 0) {
                console.log('ğŸ“­ ì˜ˆì•½ëœ ë©”ì¼ì´ ì—†ì–´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì¤‘ì§€í•©ë‹ˆë‹¤.');
                stopEmailScheduler();
                return;
            }

            const activeSchedules = window.emailScheduleList.filter(schedule => 
                schedule.status === 'í™œì„±'
            );

            if (activeSchedules.length === 0) {
                console.log('ğŸ“­ í™œì„± ìƒíƒœì¸ ì˜ˆì•½ëœ ë©”ì¼ì´ ì—†ì–´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì¤‘ì§€í•©ë‹ˆë‹¤.');
                stopEmailScheduler();
                return;
            }

            // í™œì„± ì˜ˆì•½ì´ ìˆì§€ë§Œ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ˆë©´ ì‹œì‘
            if (!isSchedulerRunning) {
                console.log(`ğŸ“… í™œì„± ì˜ˆì•½ì´ ë°œê²¬ë˜ì–´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. (í™œì„± ì˜ˆì•½: ${activeSchedules.length}ê°œ)`);
                startEmailScheduler();
            }
        }

        // ì²¨ë¶€ íŒŒì¼ - ì‚¬ìš©ëŸ‰ í† ê¸€ ì²˜ë¦¬
        function handleUsageAttachmentToggle(checkbox) {
            const settings = document.getElementById('usage-attachment-settings');
            if (!settings) return;
            settings.style.display = checkbox && checkbox.checked ? '' : 'none';
        }
        // ì²¨ë¶€ íŒŒì¼ - íƒ€ê²Ÿ í† ê¸€ ì²˜ë¦¬ (ì „ì²´/ë¹„í™œì„±/ì§ì ‘ì…ë ¥)
        function handleAttachmentTargetToggle(target, checkbox) {
            const allSec = document.getElementById('attachment-all-section');
            const inactiveSec = document.getElementById('attachment-inactive-section');
            const customSec = document.getElementById('attachment-custom-section');
            const usageSettings = document.getElementById('usage-attachment-settings');
            if (!allSec || !inactiveSec || !customSec || !usageSettings) return;

            // ì„¹ì…˜ ì—´ê¸°/ë‹«ê¸°
            if (target === 'all') {
                allSec.style.display = checkbox.checked ? '' : 'none';
                if (!checkbox.checked) document.getElementById('attachment-all-usage').checked = false;
            } else if (target === 'inactive') {
                inactiveSec.style.display = checkbox.checked ? '' : 'none';
                if (!checkbox.checked) document.getElementById('attachment-inactive-usage').checked = false;
            } else if (target === 'custom') {
                customSec.style.display = checkbox.checked ? '' : 'none';
                if (!checkbox.checked) document.getElementById('attachment-custom-usage').checked = false;
            }

            // ì‚¬ìš©ëŸ‰ ì„¤ì • íŒ¨ë„ì€ ì „ì—­ 1ê°œë¥¼ ìƒí™©ì— ë”°ë¼ ì´ë™/í‘œì‹œ
            if (checkbox && checkbox.checked) {
                window._lastAttachmentTarget = target;
                setActiveUsageTarget(target);
            } else {
                // ì„ íƒ í•´ì œ ì‹œ ë§ˆì§€ë§‰ ëŒ€ìƒì´ì—ˆìœ¼ë©´ ëŒ€ì²´ íƒ€ê²Ÿ ì„ íƒ: custom > inactive > all
                const allChecked = !!document.getElementById('attachment-all-members')?.checked;
                const inactiveChecked = !!document.getElementById('attachment-inactive-members')?.checked;
                const customChecked = !!document.getElementById('attachment-custom')?.checked;
                let next = null;
                if (customChecked) next = 'custom';
                else if (inactiveChecked) next = 'inactive';
                else if (allChecked) next = 'all';
                setActiveUsageTarget(next);
            }
            refreshUsageAttachmentSettingsPlacement();
            enforceAttachmentSectionOrder();
        }

        // ì‚¬ìš©ëŸ‰ ì²´í¬ë°•ìŠ¤ë³„ë¡œ ì„¤ì • íŒ¨ë„ í‘œì‹œ ìœ„ì¹˜/ìƒíƒœ ê°±ì‹ 
        function toggleAttachmentUsageSection(target, checkbox) {
            const usageSettings = document.getElementById('usage-attachment-settings');
            if (!usageSettings) return;
            // ì²´í¬ë˜ì—ˆì„ ë•Œë§Œ íŒ¨ë„ í‘œì‹œ. í•´ë‹¹ ì„¹ì…˜ì˜ "ì‚¬ìš©ëŸ‰" ë¼ë²¨ ë°”ë¡œ ì•„ë˜ë¡œ ì´ë™
            const map = { all: 'attachment-all-usage', inactive: 'attachment-inactive-usage', custom: 'attachment-custom-usage' };
            const usageInput = document.getElementById(map[target]);
            if (checkbox && checkbox.checked && usageInput) {
                const labelEl = usageInput.closest('label');
                if (labelEl && labelEl.parentNode) {
                    labelEl.parentNode.insertBefore(usageSettings, labelEl.nextSibling);
                }
                usageSettings.style.display = '';
                enforceAttachmentSectionOrder();

                // ì‚¬ìš©ëŸ‰ í™œì„± ì‹œ ê¸°ê°„ ê¸°ë³¸ê°’ì„ 30dë¡œ ì„¤ì • (ë¯¸ì„¤ì •/ê¸°ë³¸ ë¬¸êµ¬ì¸ ê²½ìš°)
                const periodTextEl = document.getElementById('usage-attachment-period-text');
                if (periodTextEl && (!periodTextEl.textContent || periodTextEl.textContent.trim() === '' || periodTextEl.textContent.trim() === 'ê¸°ê°„ì„ ì„ íƒí•˜ì„¸ìš”')) {
                    // ë²„íŠ¼ active ìƒíƒœë„ 30dë¡œ ì„¤ì •
                    selectUsageAttachmentPeriod('30');
                }
                // í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateAttachmentUsageTable();
            } else {
                usageSettings.style.display = 'none';
            }
        }

        // í˜„ì¬ ì²´í¬ ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒ¨ë„ ì¬ë°°ì¹˜
        function refreshUsageAttachmentSettingsPlacement() {
            const usageSettings = document.getElementById('usage-attachment-settings');
            if (!usageSettings) return;
            const allUsage = document.getElementById('attachment-all-usage');
            const inactiveUsage = document.getElementById('attachment-inactive-usage');
            const customUsage = document.getElementById('attachment-custom-usage');
            // ê³ ì • ìˆœì„œ: ì „ì²´ ë©¤ë²„ â†’ ë¹„í™œì„± ë©¤ë²„ â†’ ì§ì ‘ ì…ë ¥
            const order = [allUsage, inactiveUsage, customUsage];
            const checkedInput = order.find(inp => inp && inp.checked);
            if (checkedInput) {
                const labelEl = checkedInput.closest('label');
                if (labelEl && labelEl.parentNode) {
                    labelEl.parentNode.insertBefore(usageSettings, labelEl.nextSibling);
                }
                usageSettings.style.display = '';
                enforceAttachmentSectionOrder();
                // ê¸°ë³¸ ê¸°ê°„ 30d ë³´ì¥ ë° í…Œì´ë¸” ê°±ì‹ 
                const periodTextEl = document.getElementById('usage-attachment-period-text');
                if (periodTextEl && (!periodTextEl.textContent || periodTextEl.textContent.trim() === '' || periodTextEl.textContent.trim() === 'ê¸°ê°„ì„ ì„ íƒí•˜ì„¸ìš”')) {
                    selectUsageAttachmentPeriod('30');
                }
                updateAttachmentUsageTable();
            } else {
                usageSettings.style.display = 'none';
            }
        }

        // ì²¨ë¶€ íŒŒì¼ ì„¹ì…˜(ì „ì²´ â†’ ë¹„í™œì„± â†’ ì§ì ‘ ì…ë ¥) DOM ìˆœì„œë¥¼ í•­ìƒ ê°•ì œ
        function enforceAttachmentSectionOrder() {
            try {
                const allSec = document.getElementById('attachment-all-section');
                const inactiveSec = document.getElementById('attachment-inactive-section');
                const customSec = document.getElementById('attachment-custom-section');
                if (!allSec || !inactiveSec || !customSec) return;
                const parent = allSec.parentNode;
                if (!parent) return;
                // ì›í•˜ëŠ” ìˆœì„œë¡œ ì¬ë°°ì¹˜ (appendChildëŠ” ê¸°ì¡´ ë…¸ë“œë¥¼ ì´ë™ì‹œí‚´)
                parent.appendChild(allSec);
                parent.appendChild(inactiveSec);
                parent.appendChild(customSec);
            } catch (_) {}
        }

        // ì‚¬ìš©ëŸ‰ ì²´í¬ë°•ìŠ¤ëŠ” í•œ ì„¹ì…˜ì—ë§Œ ë…¸ì¶œë˜ë„ë¡ ì œì–´
        function setActiveUsageTarget(target) {
            const map = {
                all: document.getElementById('attachment-all-usage')?.closest('label'),
                inactive: document.getElementById('attachment-inactive-usage')?.closest('label'),
                custom: document.getElementById('attachment-custom-usage')?.closest('label')
            };
            // ëª¨ë‘ ìˆ¨ê¹€
            Object.values(map).forEach(lbl => { if (lbl) lbl.style.display = 'none'; });
            // ëª¨ë‘ ì²´í¬ í•´ì œ (í•œ ê³³ë§Œ ì‚¬ìš©ëŸ‰ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œ)
            const allU = document.getElementById('attachment-all-usage');
            const inU = document.getElementById('attachment-inactive-usage');
            const cuU = document.getElementById('attachment-custom-usage');
            if (allU) allU.checked = false;
            if (inU) inU.checked = false;
            if (cuU) cuU.checked = false;
            
            if (target && map[target]) {
                map[target].style.display = 'flex';
            }
        }

        // ì²¨ë¶€ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ê²€ìƒ‰/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜ + ë¹„í™œì„± Nì¼ ê¸°ì¤€)
        function renderAttachmentMemberLists() {
            try {
                const allList = document.getElementById('attachment-all-list');
                const inactiveList = document.getElementById('attachment-inactive-list');
                if (!allList || !inactiveList) return;

                const baseMembers = (originalMembersData && originalMembersData.length ? originalMembersData : currentMembersData) || [];
                if (!baseMembers || baseMembers.length === 0) {
                    allList.innerHTML = '<div style="color:#7a7a7a;">í‘œì‹œí•  ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    inactiveList.innerHTML = '<div style="color:#7a7a7a;">í‘œì‹œí•  ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                // ì£¼ì˜: allowedEvents/lastEventMapì€ ë Œë” ì‹œë§ˆë‹¤ ìµœì‹  ì „ì—­ ë°ì´í„°ë¡œ ì¬ê³„ì‚°í•´ì•¼ í•¨(ì´ˆê¸° ë¹ˆ ë°ì´í„° ìº¡ì³ ë°©ì§€)

                // ìƒíƒœ ì´ˆê¸°í™”
                window.attachmentAllState = window.attachmentAllState || { page: 1, pageSize: 20, search: '', sort: 'name_asc' };
                window.attachmentInactiveState = window.attachmentInactiveState || { page: 1, pageSize: 20, search: '', sort: 'name_asc', days: 14 };

                function renderList(type) {
                    const state = type === 'all' ? window.attachmentAllState : window.attachmentInactiveState;

                    // ìµœì‹  ì´ë²¤íŠ¸ë¡œ lastEventMap/allowedEvents ì¬ê³„ì‚° (ì „ì—­ letê³¼ window í”„ë¡œí¼í‹° ëª¨ë‘ ëŒ€ì‘)
                    const rawEventsNow = (typeof currentRawEventsData !== 'undefined' && Array.isArray(currentRawEventsData) ? currentRawEventsData : (window.currentRawEventsData || []));
                    const allowedEventsNow = rawEventsNow.filter(ev => ev && ev.userEmail && typeof ev.requestsCosts === 'number' && ev.requestsCosts > 0 && !isNaN(parseInt(ev.timestamp)));
                    const lastEventMapNow = {};
                    for (const ev of allowedEventsNow) {
                        const email = ev.userEmail;
                        const ts = parseInt(ev.timestamp);
                        if (!lastEventMapNow[email] || ts > lastEventMapNow[email]) {
                            lastEventMapNow[email] = ts;
                        }
                    }

                    // ì§„ë‹¨ ë¡œê·¸: ë Œë” íƒ€ì´ë° ë°ì´í„° ìƒíƒœ
                    try {
                        const tsValues = rawEventsNow.map(e => parseInt(e.timestamp)).filter(v => !isNaN(v));
                        const minTs = tsValues.length ? Math.min(...tsValues) : null;
                        const maxTs = tsValues.length ? Math.max(...tsValues) : null;
                        console.group(`[ì²¨ë¶€íŒŒì¼/ë¹„í™œì„±] ë Œë” ì§„ë‹¨ (${type})`);
                        console.log('ë©¤ë²„ ìˆ˜:', baseMembers.length);
                        console.log('Raw ì´ë²¤íŠ¸ ìˆ˜:', rawEventsNow.length, 'ë²”ìœ„:', minTs ? new Date(minTs).toISOString() : '-', '~', maxTs ? new Date(maxTs).toISOString() : '-');
                        console.log('í™œë™ ì¸ì •(>0) ì´ë²¤íŠ¸ ìˆ˜:', allowedEventsNow.length);
                        console.groupEnd();
                    } catch (e) {}

                    let members = baseMembers.map(m => ({
                        ...m,
                        lastActivityTimestamp: lastEventMapNow[m.email] || 0
                    }));

                    // ë¹„í™œì„± ê¸°ì¤€: ìµœê·¼ Nì¼ ë¬´í™œë™ (Overviewì™€ ë™ì¼í•œ í™œë™ ì •ì˜ë¡œ ê³„ì‚°)
                    if (type === 'inactive') {
                        const cutoff = Date.now() - (state.days * 24 * 60 * 60 * 1000);
                        const activeEmails = new Set();
                        let eventsWithinCutoff = 0;
                        for (const ev of allowedEventsNow) {
                            const ts = parseInt(ev.timestamp);
                            if (ts >= cutoff) { activeEmails.add(ev.userEmail); eventsWithinCutoff++; }
                        }
                        members = members.filter(m => !activeEmails.has(m.email));
                        // ì œëª©ì— í˜„ì¬ ë¹„í™œì„± ìˆ˜ í‘œê¸°
                        try {
                            const titleEl = document.getElementById('attachment-inactive-title');
                            if (titleEl) {
                                titleEl.textContent = `ë¹„í™œì„± ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ (${members.length})`;
                            }
                        } catch (e) {
                            // no-op
                        }
                        // ì§„ë‹¨ ë¡œê·¸: í•„í„° ê²°ê³¼
                        try {
                            console.group('[ì²¨ë¶€íŒŒì¼/ë¹„í™œì„±] í•„í„° ê²°ê³¼');
                            console.log('ì„ íƒ Nì¼:', state.days);
                            console.log('ì»·ì˜¤í”„ ì‹œê°:', new Date(cutoff).toISOString());
                            console.log('ì»·ì˜¤í”„ ë‚´ ì´ë²¤íŠ¸ ìˆ˜:', eventsWithinCutoff);
                            console.log('í™œì„± ì´ë©”ì¼ ìˆ˜(Nì¼ ë‚´):', activeEmails.size);
                            console.log('ë¹„í™œì„± ê²°ê³¼ ë©¤ë²„ ìˆ˜:', members.length);
                            console.groupEnd();
                        } catch (e) {}
                    }

                    // ê²€ìƒ‰
                    if (state.search && state.search.trim()) {
                        const q = state.search.trim().toLowerCase();
                        members = members.filter(m => (m.name || '').toLowerCase().includes(q) || (m.email || '').toLowerCase().includes(q));
                    }

                    // ì •ë ¬
                    const [field, dir] = state.sort.split('_');
                    members.sort((a, b) => {
                        if (field === 'last') {
                            const at = a.lastActivityTimestamp || 0;
                            const bt = b.lastActivityTimestamp || 0;
                            return dir === 'asc' ? at - bt : bt - at;
                        }
                        const av = field === 'email' ? (a.email || '') : (a.name || '');
                        const bv = field === 'email' ? (b.email || '') : (b.name || '');
                        return dir === 'asc' ? av.localeCompare(bv) : bv.localeCompare(av);
                    });

                    // í˜ì´ì§€ë„¤ì´ì…˜
                    const total = members.length;
                    const totalPages = Math.max(1, Math.ceil(total / state.pageSize));
                    if (state.page > totalPages) state.page = totalPages;
                    const start = (state.page - 1) * state.pageSize;
                    const pageData = members.slice(start, start + state.pageSize);

                    // ë Œë”ë§
                    const listEl = document.getElementById(type === 'all' ? 'attachment-all-list' : 'attachment-inactive-list');
                    listEl.innerHTML = pageData.map(m => `<div style=\"display:flex; justify-content:space-between; padding:6px 8px; border-bottom:1px solid #2a2a2a;\"><span>${m.name || m.email}</span><span style=\"color:#7a7a7a;\">${m.email || ''}</span></div>`).join('');
                    if (pageData.length === 0) {
                        listEl.innerHTML = '<div style=\"color:#7a7a7a;\">í‘œì‹œí•  ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }

                    const pagEl = document.getElementById(type === 'all' ? 'attachment-all-pagination' : 'attachment-inactive-pagination');
                    if (pagEl) {
                        pagEl.innerHTML = renderAttachmentPagination(type, state.page, totalPages);
                    }
                }

                renderList('all');
                renderList('inactive');
                window._renderAttachmentList = renderList;
            } catch (e) {
                console.error('ì²¨ë¶€ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ì‹¤íŒ¨:', e);
            }
        }

        // (ì‚­ì œë¨) ì²¨ë¶€ íŒŒì¼ - ì‚¬ìš©ëŸ‰ ëŒ€ìƒ ë³€ê²½ ì²˜ë¦¬: ëŒ€ìƒ UI ì œê±°ì— ë”°ë¼ ë¹„í™œì„±í™”

        // ê²€ìƒ‰
        function filterAttachmentList(type, query) {
            const state = type === 'all' ? window.attachmentAllState : window.attachmentInactiveState;
            state.search = query || '';
            state.page = 1;
            window._renderAttachmentList && window._renderAttachmentList(type);
        }

        // ì •ë ¬
        function sortAttachmentList(type, sortValue) {
            const state = type === 'all' ? window.attachmentAllState : window.attachmentInactiveState;
            state.sort = sortValue;
            window._renderAttachmentList && window._renderAttachmentList(type);
        }

        // í˜ì´ì§€ ì‚¬ì´ì¦ˆ ë³€ê²½
        function changeAttachmentPageSize(type, pageSize) {
            const state = type === 'all' ? window.attachmentAllState : window.attachmentInactiveState;
            state.pageSize = parseInt(pageSize, 10) || 20;
            state.page = 1;
            window._renderAttachmentList && window._renderAttachmentList(type);
        }

        // í˜ì´ì§€ ì´ë™
        function changeAttachmentPage(type, page) {
            const state = type === 'all' ? window.attachmentAllState : window.attachmentInactiveState;
            state.page = Math.max(1, page);
            window._renderAttachmentList && window._renderAttachmentList(type);
        }

        // ë¹„í™œì„± ê¸°ì¤€ ê¸°ê°„ ë³€ê²½
        function setInactiveDaysFilter(days) {
            const state = window.attachmentInactiveState || (window.attachmentInactiveState = { page: 1, pageSize: 20, search: '', sort: 'name_asc', days: 14 });
            state.days = parseInt(days, 10) || 14;
            state.page = 1;
            if (window._renderAttachmentList) {
                window._renderAttachmentList('inactive');
            } else {
                // ì´ˆê¸° ë Œë”ëŸ¬ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš° ì¦‰ì‹œ ì´ˆê¸°í™” í›„ ë Œë”ë§ ë³´ì¥
                try {
                    renderAttachmentMemberLists();
                    // ë Œë”ëŸ¬ ë°”ì¸ë”© í›„ ì¦‰ì‹œ ê°±ì‹ 
                    setTimeout(() => {
                        window._renderAttachmentList && window._renderAttachmentList('inactive');
                    }, 0);
                } catch (e) {
                    console.error('ë¹„í™œì„± ê¸°ê°„ ë³€ê²½ ì¦‰ì‹œ ë°˜ì˜ ì‹¤íŒ¨:', e);
                }
            }
        }

        // í˜ì´ì§€ë„¤ì´ì…˜ HTML ë Œë”ë§
        function renderAttachmentPagination(type, current, total) {
            const prev = Math.max(1, current - 1);
            const next = Math.min(total, current + 1);
            return `
                <button class="page-btn" onclick="changeAttachmentPage('${type}', 1)">First</button>
                <button class="page-btn" onclick="changeAttachmentPage('${type}', ${prev})">â€¹</button>
                <span style="color:#b1b1b1; font-size: 12px;">${current} / ${total}</span>
                <button class="page-btn" onclick="changeAttachmentPage('${type}', ${next})">â€º</button>
                <button class="page-btn" onclick="changeAttachmentPage('${type}', ${total})">Last</button>
            `;
        }

        // ì²¨ë¶€ íŒŒì¼ - ì‚¬ìš©ëŸ‰ ê¸°ê°„ ì„ íƒ
        function selectUsageAttachmentPeriod(value) {
            const customInput = document.getElementById('usage-attachment-custom-days-input');
            const customDateBox = document.getElementById('usage-attachment-custom-date');
            const periodButtons = document.getElementById('usage-attachment-period-buttons');
            // ë²„íŠ¼ active ìƒíƒœ ì—…ë°ì´íŠ¸
            const container = periodButtons || (customInput ? customInput.parentElement : null);
            if (container) {
                container.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            }
            
            if (value === 'custom') {
                // usage ì„¹ì…˜ê³¼ ë™ì¼í•˜ê²Œ ê¸°ê°„ í•„í„°ë¥¼ ë…¸ì¶œ
                if (customInput) customInput.style.display = 'none';
                if (customDateBox) customDateBox.style.display = '';
                // ë§ˆì§€ë§‰ ë²„íŠ¼ì„ active ì²˜ë¦¬
                if (container) {
                    const btns = container.querySelectorAll('.chart-btn');
                    if (btns.length) btns[btns.length - 1].classList.add('active');
                }
                // ì»¤ìŠ¤í…€ì€ ì§ì ‘ ì ìš© ë²„íŠ¼ìœ¼ë¡œ í…ìŠ¤íŠ¸ê°€ ì„¤ì •ë¨
                window.__usageAttachmentSelectedDays = undefined;
            } else {
                if (customInput) { customInput.style.display = 'none'; customInput.value = ''; }
                if (customDateBox) customDateBox.style.display = 'none';
                // í•´ë‹¹ ê°’ì˜ ë²„íŠ¼ active ì²˜ë¦¬
                if (container) {
                    const map = { '1': 0, '7': 1, '30': 2 };
                    const idx = map[value];
                    const btns = container.querySelectorAll('.chart-btn');
                    if (idx !== undefined && btns[idx]) btns[idx].classList.add('active');
                }

                // ì„ íƒëœ ì¼ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ëŠ˜ ê¸°ì¤€ ë‚ ì§œ ë²”ìœ„ë¥¼ í…ìŠ¤íŠ¸ì— ì¦‰ì‹œ ë°˜ì˜
                const days = parseInt(value, 10);
                if (!isNaN(days)) {
                    const toDateStr = (d) => {
                        const yyyy = d.getFullYear();
                        const mm = String(d.getMonth() + 1).padStart(2, '0');
                        const dd = String(d.getDate()).padStart(2, '0');
                        return `${yyyy}-${mm}-${dd}`;
                    };
                    const end = new Date();
                    const start = new Date();
                    start.setDate(start.getDate() - days);
                    const textEl = document.getElementById('usage-attachment-period-text');
                    if (textEl) {
                        textEl.textContent = `${toDateStr(start)} ~ ${toDateStr(end)}`;
                    }
                    window.__usageAttachmentSelectedDays = days;
                }
                // ê¸°ê°„ ë³€ê²½ ì‹œ í…Œì´ë¸” ê°±ì‹ 
                updateAttachmentUsageTable();
            }
        }

        // ì²¨ë¶€ ì‚¬ìš©ëŸ‰ í…Œì´ë¸” (NAME, EMAIL, ROLE, REQUEST, SPEND, LAST ACT)
        async function updateAttachmentUsageTable() {
            try {
                const containerId = 'usage-attachment-table-container';
                let container = document.getElementById(containerId);
                if (!container) {
                    // usage settings ì•„ë˜ì— í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ìƒì„±
                    const usageSettings = document.getElementById('usage-attachment-settings');
                    if (!usageSettings) return;
                    container = document.createElement('div');
                    container.id = containerId;
                    container.style.marginTop = '12px';
                    container.style.background = '#1a1a1a';
                    container.style.border = '1px solid #3a3a3a';
                    container.style.borderRadius = '6px';
                    container.style.padding = '12px';
                    usageSettings.parentNode.insertBefore(container, usageSettings.nextSibling);
                }

                // ìºì‹œ ìƒíƒœ í™•ì¸ í›„ ë¡œë”© í‘œì‹œ (ìºì‹œ ì—†ì„ ë•Œë§Œ)
                (function showLoadingIfNoCache(){
                    try {
                        const periodText = (document.getElementById('usage-attachment-period-text')?.textContent || '').trim();
                        const m = periodText.match(/(\d{4}-\d{2}-\d{2})\s*~\s*(\d{4}-\d{2}-\d{2})/);
                        let startDate = null, endDate = null;
                        if (m) { startDate = m[1]; endDate = m[2]; }
                        const membersCached = !!(window.__membersCache && window.__membersCache.data && (Date.now() - (window.__membersCache.fetchedAt || 0) < 10*60*1000));
                        let eventsCached = false;
                        if (startDate && endDate && window.__eventsCache) {
                            const key = `${startDate}_${endDate}`;
                            const cached = window.__eventsCache.get(key);
                            eventsCached = !!(cached && cached.data && (Date.now() - (cached.fetchedAt || 0) < 5*60*1000));
                        }
                        if (!(membersCached && eventsCached)) {
                            container.innerHTML = '<div style="padding: 12px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                        }
                    } catch (_) {}
                })();

                // í˜„ì¬ ì„ íƒëœ ê·¸ë£¹ì˜ ì´ë©”ì¼ ìˆ˜ì§‘
                const allOn = !!document.getElementById('attachment-all-members')?.checked;
                const inactiveOn = !!document.getElementById('attachment-inactive-members')?.checked;
                const customOn = !!document.getElementById('attachment-custom')?.checked;

                if (!allOn && !inactiveOn && !customOn) {
                    container.innerHTML = '<div style="color:#7a7a7a;">ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                // ë©¤ë²„ ë¡œë“œ(ìºì‹œ ì‚¬ìš©)
                const membersData = await getTeamMembers();
                const members = membersData?.teamMembers || [];

                let targetEmails = new Set();
                if (allOn) members.forEach(m => m.email && targetEmails.add(m.email));

                if (inactiveOn) {
                    // ì²¨ë¶€ ì„¹ì…˜ê³¼ ë™ì¼ ê¸°ì¤€: ìµœê·¼ Nì¼ ë¬´í™œë™
                    const inactivityDays = (window.attachmentInactiveState && window.attachmentInactiveState.days)
                        || parseInt(document.getElementById('attachment-inactive-days')?.value)
                        || 14;
                    const rawEventsNow = (typeof currentRawEventsData !== 'undefined' && Array.isArray(currentRawEventsData)
                        ? currentRawEventsData
                        : (window.currentRawEventsData || []));
                    const allowed = rawEventsNow.filter(ev => ev && ev.userEmail && typeof ev.requestsCosts === 'number' && ev.requestsCosts > 0 && !isNaN(parseInt(ev.timestamp)));
                    const cutoff = Date.now() - (inactivityDays * 24 * 60 * 60 * 1000);
                    const activeSet = new Set();
                    for (const ev of allowed) { const ts = parseInt(ev.timestamp); if (ts >= cutoff) activeSet.add(ev.userEmail); }
                    members.filter(m => m.email && !activeSet.has(m.email)).forEach(m => targetEmails.add(m.email));
                }

                if (customOn) {
                    const customList = (document.getElementById('attachment-custom-emails')?.value || '')
                        .split(',').map(s => s.trim()).filter(Boolean);
                    customList.forEach(e => targetEmails.add(e));
                }

                // ì´ë©”ì¼ì´ ì—†ìœ¼ë©´ ì¢…ë£Œ
                const emailList = Array.from(targetEmails);
                if (emailList.length === 0) {
                    container.innerHTML = '<div style="color:#7a7a7a;">í‘œì‹œí•  ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                // ê¸°ê°„ í…ìŠ¤íŠ¸ íŒŒì‹± (ì—†ìœ¼ë©´ 30dë¡œ ê¸°ë³¸ ì„¤ì •ë¨)
                const periodText = (document.getElementById('usage-attachment-period-text')?.textContent || '').trim();
                const m = periodText.match(/(\d{4}-\d{2}-\d{2})\s*~\s*(\d{4}-\d{2}-\d{2})/);
                let startDate = null, endDate = null;
                if (m) { startDate = m[1]; endDate = m[2]; }

                // ì´ë²¤íŠ¸/ì§€ì¶œ ë°ì´í„° ë¡œë“œ (ìºì‹œ ì‚¬ìš©)
                const [eventsData, spendingData] = await Promise.all([
                    (startDate && endDate) ? getFilteredEvents(startDate, endDate) : Promise.resolve({ usageEvents: [] }),
                    getTeamSpendingData()
                ]);

                // ì§‘ê³„: Usage ì„¹ì…˜ ë¡œì§ ì¬ì‚¬ìš©
                const memberSpendMap = {};
                if (spendingData && spendingData.teamMemberSpend) {
                    spendingData.teamMemberSpend.forEach(spendInfo => {
                        memberSpendMap[spendInfo.email] = {
                            premiumRequests: spendInfo.fastPremiumRequests || 0,
                            spend: (spendInfo.spendCents || 0) / 100,
                            hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                        };
                    });
                }

                const userPeriodStats = {};
                if (eventsData && eventsData.usageEvents) {
                    eventsData.usageEvents.forEach(event => {
                        const userEmail = event.userEmail;
                        const timestamp = parseInt(event.timestamp);
                        if (!userPeriodStats[userEmail]) userPeriodStats[userEmail] = { lastTimestamp: timestamp, periodRequests: 0 };
                        if (timestamp > userPeriodStats[userEmail].lastTimestamp) userPeriodStats[userEmail].lastTimestamp = timestamp;
                        userPeriodStats[userEmail].periodRequests += (event.requestsCosts || 0);
                    });
                }

                const emailSet = new Set(emailList);
                const rows = members
                    .filter(m => m.email && emailSet.has(m.email))
                    .map(member => {
                        const spendData = memberSpendMap[member.email] || {};
                        const stats = userPeriodStats[member.email] || {};
                        const lastTs = stats.lastTimestamp || 0;
                        let lastAct = 'No Activity';
                        if (lastTs) {
                            const d = new Date(lastTs);
                            const yyyy = d.getFullYear();
                            const mm = String(d.getMonth()+1).padStart(2,'0');
                            const dd = String(d.getDate()).padStart(2,'0');
                            const hh = String(d.getHours()).padStart(2,'0');
                            const mi = String(d.getMinutes()).padStart(2,'0');
                            lastAct = `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
                        }
                        return {
                            name: member.name || 'Unnamed',
                            email: member.email,
                            role: member.role === 'owner' ? 'Admin' : 'Member',
                            request: stats.periodRequests || 0,
                            spend: spendData.spend || 0,
                            lastAct,
                            lastTs
                        };
                    });

                // ì •ë ¬ ë° í˜ì´ì§€ ìƒíƒœ ì €ì¥
                rows.sort((a, b) => (b.lastTs||0) - (a.lastTs||0) || (b.request||0) - (a.request||0));
                window.__attachmentUsageRows = rows;
                window.__attachmentUsagePage = 1;
                window.__attachmentUsagePageSize = window.__attachmentUsagePageSize || 20;
                renderAttachmentUsageTablePage();
            } catch (e) {
                console.warn('ì²¨ë¶€ ì‚¬ìš©ëŸ‰ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', e);
            }
        }

        function renderAttachmentUsageTablePage() {
            const container = document.getElementById('usage-attachment-table-container');
            if (!container) return;
            const rows = window.__attachmentUsageRows || [];
            const pageSize = window.__attachmentUsagePageSize || 20;
            const page = window.__attachmentUsagePage || 1;
            const total = rows.length;
            const totalPages = Math.max(1, Math.ceil(total / pageSize));
            const start = (page - 1) * pageSize;
            const pageRows = rows.slice(start, start + pageSize);

            const header = `
                <div style="display:grid; grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1fr; gap:12px; padding:8px 0; border-bottom:1px solid #3a3a3a; color:#e1e1e1;">
                    <div>NAME</div><div>EMAIL</div><div>ROLE</div><div>REQUEST</div><div>SPEND</div><div>LAST ACT</div>
                </div>`;
            const body = pageRows.length ? pageRows.map(r => `
                <div style="display:grid; grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1fr; gap:12px; padding:6px 0; border-bottom:1px solid #2a2a2a; color:#b1b1b1;">
                    <div>${r.name}</div>
                    <div>${r.email}</div>
                    <div><span class="role-badge ${r.role==='Admin'?'admin':''}">${r.role}</span></div>
                    <div style="font-weight:600; color:#fff;">${r.request}</div>
                    <div>$${(r.spend||0).toFixed(2)}</div>
                    <div>${r.lastAct}</div>
                </div>`).join('') : '<div style="color:#7a7a7a; padding:8px 0;">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            const pagination = renderAttachmentUsagePagination(totalPages);
            container.innerHTML = header + body + pagination;
        }

        function renderAttachmentUsagePagination(totalPages) {
            const page = window.__attachmentUsagePage || 1;
            let html = '<div style="display:flex; justify-content:flex-end; gap:4px; margin-top:8px;">';
            if (page > 1) html += `<button class="page-btn" onclick="changeAttachmentUsagePage(${page-1})">â€¹</button>`;
            let start = Math.max(1, page - 2);
            let end = Math.min(totalPages, page + 2);
            if (start > 1) {
                html += `<button class="page-btn" onclick="changeAttachmentUsagePage(1)">1</button>`;
                if (start > 2) html += `<span style="color:#7a7a7a; padding:0 4px;">...</span>`;
            }
            for (let i = start; i <= end; i++) {
                const active = i === page;
                html += `<button class="page-btn" onclick="changeAttachmentUsagePage(${i})" style="background:${active?'#4a9eff':'#3a3a3a'}; border:1px solid ${active?'#4a9eff':'#4a4a4a'}; color:${active?'#fff':'#e1e1e1'}">${i}</button>`;
            }
            if (end < totalPages) {
                if (end < totalPages - 1) html += `<span style="color:#7a7a7a; padding:0 4px;">...</span>`;
                html += `<button class="page-btn" onclick="changeAttachmentUsagePage(${totalPages})">${totalPages}</button>`;
            }
            if (page < totalPages) html += `<button class="page-btn" onclick="changeAttachmentUsagePage(${page+1})">â€º</button>`;
            html += '</div>';
            return html;
        }

        function changeAttachmentUsagePage(page) {
            window.__attachmentUsagePage = page;
            renderAttachmentUsageTablePage();
        }

        // ì²¨ë¶€ íŒŒì¼ - ì‚¬ìš©ëŸ‰ ê¸°ê°„ ì§ì ‘ì…ë ¥ ì ìš©
        function applyUsageAttachmentDateRange() {
            const startInput = document.getElementById('usage-attachment-start-date');
            const endInput = document.getElementById('usage-attachment-end-date');
            const text = document.getElementById('usage-attachment-period-text');
            if (!startInput || !endInput || !text) return;
            if (!startInput.value || !endInput.value) {
                showSimpleAlert('âš ï¸ ê¸°ê°„ ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.', 'warning');
                return;
            }
            text.textContent = `${startInput.value} ~ ${endInput.value}`;
            console.log(`ğŸ“… ì‚¬ìš©ëŸ‰ ì²¨ë¶€ ê¸°ê°„ ì„¤ì •: ${text.textContent}`);
        }

        // Export Documents - ì§€ê¸ˆ Export í•˜ê¸°
        function handleExportNow() {
            try {
                const selFormatEl = document.getElementById('export-format-select');
                const format = selFormatEl ? selFormatEl.value : 'xlsx';
                const exportMembersChecked = document.getElementById('export-type-members')?.checked || document.getElementById('export-type-all')?.checked;

                if (exportMembersChecked) {
                    if (!currentMembersData || currentMembersData.length === 0) {
                        showSimpleAlert('âš ï¸ ë‚´ë³´ë‚¼ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                        return;
                    }
                    const dateStr = new Date().toISOString().split('T')[0];
                    let filename = '';
                    if (format === 'csv') {
                        filename = `members_export_${dateStr}.csv`;
                        exportMembersToCSV(filename);
                    } else if (format === 'json') {
                        filename = `members_export_${dateStr}.json`;
                        exportMembersToJSON(filename);
                    } else if (format === 'pdf') {
                        filename = `members_export_${dateStr}.pdf`;
                        exportMembersToPDF(filename);
                    } else {
                        // ê¸°ë³¸: Excel í˜•ì‹(HTML í…Œì´ë¸” ê¸°ë°˜ .xls)ë¡œ ë‚´ë³´ë‚´ê¸°
                        filename = `members_export_${dateStr}.xls`;
                        exportMembersToExcelHTML(filename);
                    }
                    const hint = getDownloadLocationHint(filename);
                    console.log(`ë©¤ë²„ ëª©ë¡ Export ì™„ë£Œ: ${hint}`);
                    return;
                }

                showSimpleAlert('â„¹ï¸ ì„ íƒëœ Export ì¢…ë¥˜ê°€ ì•„ì§ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ë©¤ë²„ ëª©ë¡ë§Œ ìš°ì„  ì§€ì›)', 'info');
            } catch (e) {
                console.error('Export ì‹¤íŒ¨:', e);
                showSimpleAlert('âŒ Export ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // Export Documents - ì„¤ì • ì €ì¥
        function saveExportSettings() {
            try {
                showSimpleAlert('âœ… Export ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                console.error('Export ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', e);
                showSimpleAlert('âŒ Export ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // Export ì¢…ë¥˜ ì„ íƒì— ë”°ë¼ Export ë²”ìœ„ í‘œì‹œ/ìˆ¨ê¹€
        function handleExportTypeChange(value) {
            const rangeItem = document.getElementById('export-range-setting');
            if (!rangeItem) return;
            if (value === 'members') {
                rangeItem.style.display = 'none';
            } else {
                rangeItem.style.display = '';
            }
        }

        // ì²´í¬ë°•ìŠ¤í˜• Export ì¢…ë¥˜ ë³€ê²½ ì²˜ë¦¬
        function handleExportTypeCheckboxChange() {
            const summary = document.getElementById('export-type-summary').checked;
            const raw = document.getElementById('export-type-raw').checked;
            const members = document.getElementById('export-type-members').checked;
            const all = document.getElementById('export-type-all').checked;

            // ìœ íš¨ì„±: "ì „ì²´"ê°€ ì„ íƒë˜ë©´ ë‚˜ë¨¸ì§€ ìë™ ì„ íƒ/ë™ê¸°í™”
            if (all) {
                document.getElementById('export-type-summary').checked = true;
                document.getElementById('export-type-raw').checked = true;
                document.getElementById('export-type-members').checked = true;
            }

            // ë²”ìœ„ í‘œì‹œ ê·œì¹™: ë©¤ë²„ë§Œ ë‹¨ë… ì„ íƒ ì‹œ ë²”ìœ„ ìˆ¨ê¹€, ê·¸ ì™¸ëŠ” í‘œì‹œ
            const rangeItem = document.getElementById('export-range-setting');
            if (rangeItem) {
                const selectedCount = (summary?1:0) + (raw?1:0) + (members?1:0) + (all?1:0);
                const onlyMembers = members && !summary && !raw && !all && selectedCount === 1;
                rangeItem.style.display = onlyMembers ? 'none' : '';
            }
        }

        // Export í˜•ì‹ ì„ íƒì— ë”°ë¼ ì„¸ë¶€ ì˜µì…˜ í‘œì‹œ
        function handleExportFormatChange(value) {
            const csv = document.getElementById('csv-options');
            const xlsx = document.getElementById('xlsx-options');
            const pdf = document.getElementById('pdf-options');
            const json = document.getElementById('json-options');
            if (!csv || !xlsx || !pdf || !json) return;
            csv.style.display = 'none';
            xlsx.style.display = 'none';
            pdf.style.display = 'none';
            json.style.display = 'none';
            if (value === 'csv') csv.style.display = '';
            else if (value === 'xlsx') xlsx.style.display = '';
            else if (value === 'pdf') pdf.style.display = '';
            else if (value === 'json') json.style.display = '';
        }

        // ì„¤ì • ë¦¬ìŠ¤íŠ¸(Email Report)
        function showEmailSettingsList() {
            showSimpleAlert('â„¹ï¸ ì„¤ì • ë¦¬ìŠ¤íŠ¸ í‘œì‹œ (ì¤€ë¹„ ì¤‘)', 'info');
        }

        // ì„¤ì • ë¦¬ìŠ¤íŠ¸(Export Documents)
        function showExportSettingsList() {
            showSimpleAlert('â„¹ï¸ Export ì„¤ì • ë¦¬ìŠ¤íŠ¸ í‘œì‹œ (ì¤€ë¹„ ì¤‘)', 'info');
        }

        // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘ (í† ê¸€ìš©)
        function startEmailScheduler() {
            if (isSchedulerRunning) {
                console.log('ğŸ“… ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }

            // ì˜ˆì•½ëœ ë©”ì¼ì´ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸
            if (!window.emailScheduleList || window.emailScheduleList.length === 0) {
                console.log('ğŸ“­ ì˜ˆì•½ëœ ë©”ì¼ì´ ì—†ì–´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‹œì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            // í™œì„± ìƒíƒœì¸ ì˜ˆì•½ì´ ìˆëŠ”ì§€ í™•ì¸
            const activeSchedules = window.emailScheduleList.filter(schedule => 
                schedule.status === 'í™œì„±'
            );

            if (activeSchedules.length === 0) {
                console.log('ğŸ“­ í™œì„± ìƒíƒœì¸ ì˜ˆì•½ëœ ë©”ì¼ì´ ì—†ì–´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‹œì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            console.log(`âœ… ì˜ˆì•½ ë©”ì¼ ë°œì†¡ í™œì„±í™”ë¨ - ë°±ê·¸ë¼ìš´ë“œ ì²´í¬ ì‹œì‘ (í™œì„± ì˜ˆì•½: ${activeSchedules.length}ê°œ)`);
            isSchedulerRunning = true;

            // ì¦‰ì‹œ í•œ ë²ˆ ê²€ì‚¬
            checkAndSendScheduledEmails();
            
            // 1ë¶„ë§ˆë‹¤ ê²€ì‚¬
            emailSchedulerInterval = setInterval(() => {
                checkAndSendScheduledEmails();
            }, 60000);
        }

        // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€ (í† ê¸€ìš©)
        function stopEmailScheduler() {
            if (emailSchedulerInterval) {
                clearInterval(emailSchedulerInterval);
                emailSchedulerInterval = null;
                isSchedulerRunning = false;
                console.log('âŒ ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ë¹„í™œì„±í™”ë¨ - ë°±ê·¸ë¼ìš´ë“œ ì²´í¬ ì¤‘ì§€');
            }
        }



        // Overview í†µê³„ ì¹´ë“œ í´ë¦­ ì‹œ ë©¤ë²„ íƒ€ì…ë³„ í•„í„°ë§
        function filterOverviewMembersByType(type) {
            console.log(`=== Overview í†µê³„ ì¹´ë“œ í´ë¦­: ${type} ===`);
            
            // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateOverviewSelection(type);
            currentFilterType = type;
            
            // ë©¤ë²„ ë°ì´í„° í•„í„°ë§ ë° í‘œì‹œ
            filterAndDisplayMembers(type);
            
            console.log(`í†µê³„ ì¹´ë“œ ì„ íƒ ì™„ë£Œ: ${type} - í•„í„°ë§ëœ ë°ì´í„° í‘œì‹œ`);
        }

        // ë©¤ë²„ ë°ì´í„°ë¥¼ íƒ€ì…ë³„ë¡œ í•„í„°ë§í•˜ê³  í‘œì‹œ
        function filterAndDisplayMembers(type) {
            console.log(`=== ë©¤ë²„ ë°ì´í„° í•„í„°ë§ ì‹œì‘: ${type} ===`);
            
            if (!originalMembersData || originalMembersData.length === 0) {
                console.log('í•„í„°ë§í•  ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            let filteredMembers = [];
            
            if (type === 'total') {
                // ì „ì²´ ë©¤ë²„ í‘œì‹œ
                filteredMembers = [...originalMembersData];
                console.log(`ì „ì²´ ë©¤ë²„ í‘œì‹œ: ${filteredMembers.length}ëª…`);
            } else if (type === 'active') {
                // í™œì„± ë©¤ë²„ë§Œ í•„í„°ë§ (Premium Requestsê°€ ìˆëŠ” ë©¤ë²„)
                filteredMembers = originalMembersData.filter(member => 
                    member.spendData.premiumRequests > 0
                );
                console.log(`í™œì„± ë©¤ë²„ í•„í„°ë§: ${filteredMembers.length}ëª…`);
            } else if (type === 'inactive') {
                // ë¹„í™œì„± ë©¤ë²„ë§Œ í•„í„°ë§ (Premium Requestsê°€ ì—†ëŠ” ë©¤ë²„)
                filteredMembers = originalMembersData.filter(member => 
                    member.spendData.premiumRequests === 0
                );
                console.log(`ë¹„í™œì„± ë©¤ë²„ í•„í„°ë§: ${filteredMembers.length}ëª…`);
            }
            
            // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            if (filteredMembers.length > 0) {
                currentMembersData = filteredMembers;
                currentMembersPage = 1; // í˜ì´ì§€ ë¦¬ì…‹
                renderMembersTableWithPagination(filteredMembers);
            } else {
                // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ë¹ˆ í…Œì´ë¸” í‘œì‹œ
                const container = document.getElementById('members-table-container');
                if (container) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ${type === 'active' ? 'í™œì„± ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.' : 
                              type === 'inactive' ? 'ë¹„í™œì„± ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.' : 
                              'ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'}
                        </div>
                    `;
                }
            }
            
            // í™œë™ ë¦¬ìŠ¤íŠ¸ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
            updateActivityListByType(type);
            
            console.log(`=== ë©¤ë²„ ë°ì´í„° í•„í„°ë§ ì™„ë£Œ: ${type} ===`);
        }

        // í™œë™ ë¦¬ìŠ¤íŠ¸ë¥¼ íƒ€ì…ë³„ë¡œ í•„í„°ë§í•˜ê³  ì—…ë°ì´íŠ¸
        function updateActivityListByType(type) {
            console.log(`=== í™œë™ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ ì‹œì‘: ${type} ===`);
            
            if (!currentActivities || currentActivities.length === 0) {
                console.log('í•„í„°ë§í•  í™œë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                updateActivityList([]);
                return;
            }
            
            let filteredActivities = [];
            
            if (type === 'total') {
                // ì „ì²´ í™œë™ í‘œì‹œ
                filteredActivities = [...currentActivities];
                console.log(`ì „ì²´ í™œë™ í‘œì‹œ: ${filteredActivities.length}ê°œ`);
            } else if (type === 'active') {
                // í™œì„± í™œë™ë§Œ í•„í„°ë§
                filteredActivities = currentActivities.filter(activity => 
                    activity.type === 'active'
                );
                console.log(`í™œì„± í™œë™ í•„í„°ë§: ${filteredActivities.length}ê°œ`);
            } else if (type === 'inactive') {
                // ë¹„í™œì„± í™œë™ë§Œ í•„í„°ë§
                filteredActivities = currentActivities.filter(activity => 
                    activity.type === 'inactive'
                );
                console.log(`ë¹„í™œì„± í™œë™ í•„í„°ë§: ${filteredActivities.length}ê°œ`);
            }
            
            // í•„í„°ë§ëœ í™œë™ ë°ì´í„°ë¡œ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateActivityList(filteredActivities);
            
            console.log(`=== í™œë™ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ ì™„ë£Œ: ${type} ===`);
        }

        // Overview í†µê³„ ì¹´ë“œ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateOverviewSelection(type) {
            // ëª¨ë“  í†µê³„ ì¹´ë“œì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.overview-stat-box').forEach(box => {
                box.classList.remove('selected');
            });
            
            // í´ë¦­ëœ ì¹´ë“œì— selected í´ë˜ìŠ¤ ì¶”ê°€
            const targetBox = document.querySelector(`.overview-stat-box[data-type="${type}"]`);
            if (targetBox) {
                targetBox.classList.add('selected');
            }
            
            console.log(`í†µê³„ ì¹´ë“œ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸: ${type}`);
        }

        // íƒ€ì…ë³„ ë©¤ë²„ ë°ì´í„°ë¥¼ ì‹¤ì œ APIì—ì„œ ê°€ì ¸ì™€ì„œ í‘œì‹œ
        async function updateMembersByTypeWithRealData(type) {
            console.log(`=== ${type} ë©¤ë²„ ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ì‹œì‘ ===`);
            console.log(`ìš”ì²­ëœ íƒ€ì…: ${type}, í˜„ì¬ í•„í„° íƒ€ì…: ${currentFilterType}`);
           
            // í˜„ì¬ í•„í„° ê¸°ê°„ ê²°ì •
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
           
            console.log(`í•„í„° ê¸°ê°„: ${new Date(dateRange.startDate).toLocaleDateString()} ~ ${new Date(dateRange.endDate).toLocaleDateString()}`);
           
            // ì‹¤ì œ API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const [membersData, eventsData] = await Promise.all([
                getTeamMembers(),
                getFilteredEvents(dateRange.startDate, dateRange.endDate)
            ]);
           
            if (!membersData || !membersData.teamMembers) {
                throw new Error('ë©¤ë²„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
           
            console.log(`API ì‘ë‹µ: ë©¤ë²„ ${membersData.teamMembers.length}ëª…, ì´ë²¤íŠ¸ ${eventsData?.usageEvents?.length || 0}ê°œ`);
           
            if (type === 'inactive') {
                // ë¹„í™œì„± ë©¤ë²„ ì²˜ë¦¬
                await showInactiveMembersWithData(membersData, eventsData);
            } else if (type === 'active') {
                // í™œì„± ë©¤ë²„ ì²˜ë¦¬
                await showActiveMembersWithData(membersData, eventsData, 'active');
            } else if (type === 'total') {
                // ì „ì²´ ë©¤ë²„ ì²˜ë¦¬
                await showActiveMembersWithData(membersData, eventsData, 'total');
            } else {
                console.error(`ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì…: ${type}`);
                currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                updateActivityList([]);
                // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
            }
           
            console.log(`=== ${type} ë©¤ë²„ ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ì™„ë£Œ ===`);
        }

        // í™œì„± ë©¤ë²„ ë˜ëŠ” ì „ì²´ ë©¤ë²„ í‘œì‹œ
        async function showActiveMembersWithData(membersData, eventsData, type) {
            console.log(`=== ${type} ë©¤ë²„ ë°ì´í„° í‘œì‹œ ì‹œì‘ ===`);
           
            if (!eventsData || !eventsData.usageEvents) {
                console.log('í™œë™ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                updateActivityList([]);
                // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
                return;
            }
           
            // ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const spendingData = await getTeamSpendingData();
            const memberSpendMap = {};
            if (spendingData && spendingData.teamMemberSpend) {
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100,
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });
            }
           
            // ì‹¤ì œ í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            const activities = createActivityListWithLastActivity(eventsData.usageEvents, membersData.teamMembers, memberSpendMap);
            console.log(`ìƒì„±ëœ í™œë™ ë¦¬ìŠ¤íŠ¸: ${activities.length}ëª…`);
           
            let filteredActivities;
            if (type === 'active') {
                // í™œì„± ë©¤ë²„: request > 0ì¸ ë©¤ë²„ë§Œ
                filteredActivities = activities.filter(activity => activity.request > 0);
            } else if (type === 'total') {
                // ì „ì²´ ë©¤ë²„: ì‹¤ì œ í™œë™ì´ ìˆëŠ” ëª¨ë“  ë©¤ë²„
                filteredActivities = activities;
            } else {
                // ê¸°ë³¸ê°’: ì „ì²´ ë©¤ë²„
                filteredActivities = activities;
                console.log(`ê¸°ë³¸ ì „ì²´ ë©¤ë²„ í‘œì‹œ: ${filteredActivities.length}ëª…`);
            }
           
            console.log(`${type} ë©¤ë²„ ìµœì¢… ë°ì´í„°: ${filteredActivities.length}ëª…`);
            console.log('í‘œì‹œë  ë©¤ë²„ ëª©ë¡:', filteredActivities.map(a => `${a.email} (${a.request} requests)`));
           
            updateActivityList(filteredActivities);
            // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
           
            console.log(`=== ${type} ë©¤ë²„ ë°ì´í„° í‘œì‹œ ì™„ë£Œ ===`);
        }

        // ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ í•¨ìˆ˜ (ë°ì´í„°ì™€ í•¨ê»˜)
        async function showInactiveMembersWithData(membersData, eventsData) {
            console.log('=== ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ ì‹œì‘ ===');
           
            // ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const spendingData = await getTeamSpendingData();
            const memberSpendMap = {};
            if (spendingData && spendingData.teamMemberSpend) {
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100,
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });
            }
           
            // í™œë™ì´ ìˆëŠ” ì‚¬ìš©ì ëª©ë¡ ìƒì„±
            const activeUserEmails = new Set();
            if (eventsData && eventsData.usageEvents) {
                eventsData.usageEvents.forEach(event => {
                    if (event.userEmail && event.requestsCosts > 0) {
                        activeUserEmails.add(event.userEmail);
                    }
                });
            }
           
            // ë¹„í™œì„± ë©¤ë²„ í•„í„°ë§
            const inactiveMembers = membersData.teamMembers.filter(member =>
                !activeUserEmails.has(member.email)
            );
           
            console.log(`ë¹„í™œì„± ë©¤ë²„: ${inactiveMembers.length}ëª…`);
            console.log('ë¹„í™œì„± ë©¤ë²„ ëª©ë¡:', inactiveMembers.map(m => m.email));
           
            // ë¹„í™œì„± ë©¤ë²„ë¥¼ í™œë™ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë³€í™˜
            const inactiveActivities = inactiveMembers.map(member => {
                const spendData = memberSpendMap[member.email] || {};
                const actualSpend = spendData.spend || 0; // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                const premiumRequests = spendData.premiumRequests || 0;
                const hardLimit = spendData.hardLimitOverride || 0;
                const limitDisplay = hardLimit > 0 ? `$${hardLimit}` : '$0';
               
                return {
                    date: 'No Activity',
                    timestamp: 0,
                    email: member.email,
                    name: member.name || 'Unnamed',
                    type: 'inactive',
                    kind: 'No Activity',
                    request: premiumRequests, // Premium Requests ì‚¬ìš©
                    spend: `$${actualSpend.toFixed(2)}`, // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                    limit: limitDisplay
                };
            });
           
            currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
            updateActivityList(inactiveActivities);
            // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
        }

        // ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ í•¨ìˆ˜ (ê¸°ì¡´ í˜¸í™˜ì„± ìœ ì§€)
        async function showInactiveMembers() {
            try {
                console.log('=== ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ ì‹œì‘ (ê¸°ì¡´ í•¨ìˆ˜) ===');
               
                // í˜„ì¬ í•„í„° ê¸°ê°„ì˜ ì´ë²¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                let dateRange;
                if (currentDateRange) {
                    dateRange = currentDateRange;
                } else {
                    const filterDays = getCurrentFilterDays();
                    dateRange = getDateRange(filterDays);
                }
               
                const [membersData, eventsData] = await Promise.all([
                    getTeamMembers(),
                    getFilteredEvents(dateRange.startDate, dateRange.endDate)
                ]);
               
                if (!membersData || !membersData.teamMembers) {
                    console.error('ë©¤ë²„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
               
                await showInactiveMembersWithData(membersData, eventsData);
               
            } catch (error) {
                console.error('âŒ ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ ì‹¤íŒ¨:', error);
            }
        }

        // í™œë™ ë°ì´í„°ë¥¼ íƒ€ì…ë³„ë¡œ í•„í„°ë§ (ì‹¤ì œ í™œë™ ê¸°ì¤€) - ì‚¬ìš© ì¤‘ë‹¨ë¨
        // ì´ì œ ê° í†µê³„ ì¹´ë“œ í´ë¦­ ì‹œ ì‹¤ì œ API ë°ì´í„°ë¥¼ ìƒˆë¡œ ê°€ì ¸ì™€ì„œ í‘œì‹œí•¨
        function filterActivitiesByType(activities, type) {
            console.log(`âš ï¸ filterActivitiesByType ì‚¬ìš© ì¤‘ë‹¨ë¨. ëŒ€ì‹  updateMembersByTypeWithRealData ì‚¬ìš©`);
            console.log(`í•„í„°ë§ ìš”ì²­: ${type}, ì „ì²´ í™œë™ ìˆ˜: ${activities.length}`);
           
            let filteredActivities;
            switch (type) {
                case 'active':
                    filteredActivities = activities.filter(activity => activity.type === 'active' && activity.request > 0);
                    break;
                case 'inactive':
                    // ë¹„í™œì„± ë©¤ë²„ë„ í‘œì‹œí•˜ë„ë¡ ìˆ˜ì •
                    filteredActivities = activities.filter(activity => activity.type === 'inactive');
                    break;
                case 'total':
                default:
                    filteredActivities = activities;
                    break;
            }
           
            console.log(`í•„í„°ë§ ê²°ê³¼: ${filteredActivities.length}ëª…`);
            return filteredActivities;
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ ì œëª© ì—…ë°ì´íŠ¸ (ë™ì ìœ¼ë¡œ í—¤ë”ì— í¬í•¨ë¨)
        function updateOverviewActivityTitle(type, count, totalCount) {
            // ì œëª©ì€ renderOverviewActivityTableWithPaginationì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
            let title, emoji;
            switch (type) {
                case 'active':
                    title = 'í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸';
                    emoji = 'âœ…';
                    break;
                case 'inactive':
                    title = 'ë¹„í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸';
                    emoji = 'ğŸ’¤';
                    break;
                case 'total':
                default:
                    title = 'ì „ì²´ í™œë™ ë¦¬ìŠ¤íŠ¸';
                    emoji = 'ğŸ“Š';
                    break;
            }
           
            // ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ì œëª©ì— ì‚¬ìš©ë  ê¸°ë³¸ ì •ë³´ ë°˜í™˜
            return { title, emoji };
        }

        // í˜„ì¬ Overview í•„í„° ê¸°ê°„ì„ í…ìŠ¤íŠ¸ë¡œ ë°˜í™˜
        function getCurrentOverviewPeriodText() {
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
            
            const startDate = new Date(dateRange.startDate).toLocaleDateString('ko-KR');
            const endDate = new Date(dateRange.endDate).toLocaleDateString('ko-KR');
            
            // ë‚ ì§œ ëì˜ "." ì œê±°
            const cleanStartDate = startDate.replace(/\.$/, '');
            const cleanEndDate = endDate.replace(/\.$/, '');
            
            return `${cleanStartDate} ~ ${cleanEndDate}`;
        }

        // ì°¨íŠ¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ì¦‰ì‹œ ë°˜ì‘)
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('chart-btn')) {
                // ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°±
                e.target.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    e.target.style.transform = '';
                }, 150);
                
                // í˜„ì¬ ì„¹ì…˜ì˜ ì°¨íŠ¸ ë²„íŠ¼ë“¤ë§Œ ì²˜ë¦¬
                const parentSection = e.target.closest('.content-section');
                if (parentSection) {
                    // ì¦‰ì‹œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                    parentSection.querySelectorAll('.chart-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    e.target.classList.add('active');
                   
                    // Overview ì„¹ì…˜ì˜ í•„í„° ë²„íŠ¼ì¸ ê²½ìš°
                    if (parentSection.id === 'overview') {
                        const days = e.target.getAttribute('data-days') || 1;
                        console.log(`Overview í•„í„° ë²„íŠ¼ í´ë¦­: ${days}ì¼`);
                        
                        // ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™” (í•„í„°ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
                        clearChartCache();
                        
                        // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë°ì´í„° ë¡œë”© ì „)
                        const dateRange = getDateRange(parseInt(days));
                        updateFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
                        
                        // ë¹„ë™ê¸°ë¡œ ë°ì´í„° ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            updateOverviewWithCurrentFilter();
                        }, 10);
                    }
                    // Usage ì„¹ì…˜ì˜ í•„í„° ë²„íŠ¼ì¸ ê²½ìš°
                    else if (parentSection.id === 'usage') {
                        const days = e.target.getAttribute('data-days') || 30;
                        console.log(`Usage í•„í„° ë²„íŠ¼ í´ë¦­: ${days}ì¼`);
                        
                        // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë°ì´í„° ë¡œë”© ì „)
                        const dateRange = getDateRange(parseInt(days));
                        updateUsageFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
                        
                        // ë¹„ë™ê¸°ë¡œ ë°ì´í„° ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            updateUsageWithCurrentFilter(days);
                        }, 10);
                    }
                }
            }
        });

        // ë‚ ì§œ í•„í„° ì ìš© í•¨ìˆ˜
        async function applyDateFilter() {
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
           
            if (!startDateInput.value || !endDateInput.value) {
                alert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
           
            const startDate = new Date(startDateInput.value).getTime();
            const endDate = new Date(endDateInput.value).getTime() + (24 * 60 * 60 * 1000 - 1); // í•˜ë£¨ ëê¹Œì§€
           
            if (startDate > endDate) {
                alert('ì‹œì‘ ë‚ ì§œëŠ” ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
           
            console.log(`Overview ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ì ìš©: ${new Date(startDate).toLocaleDateString()} ~ ${new Date(endDate).toLocaleDateString()}`);
           
            // í˜„ì¬ ë‚ ì§œ ë²”ìœ„ ì €ì¥
            currentDateRange = { startDate, endDate };
           
            // ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™” (í•„í„°ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
            clearChartCache();
           
            // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateFilterPeriodDisplay(startDate, endDate);
           
            // ë²„íŠ¼ active ìƒíƒœ ì œê±°
            document.querySelectorAll('#overview .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
           
            // ë¹„ë™ê¸°ë¡œ Overview ì—…ë°ì´íŠ¸
            setTimeout(async () => {
                await updateOverviewWithCurrentFilter();
            }, 10);
        }

        // Usage ë‚ ì§œ í•„í„° ì ìš© í•¨ìˆ˜
        async function applyUsageDateFilter() {
            const startDateInput = document.getElementById('usage-start-date');
            const endDateInput = document.getElementById('usage-end-date');
           
            if (!startDateInput.value || !endDateInput.value) {
                alert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
           
            const startDate = new Date(startDateInput.value).getTime();
            const endDate = new Date(endDateInput.value).getTime() + (24 * 60 * 60 * 1000 - 1); // í•˜ë£¨ ëê¹Œì§€
           
            if (startDate > endDate) {
                alert('ì‹œì‘ ë‚ ì§œëŠ” ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
           
            console.log(`Usage ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ì ìš©: ${new Date(startDate).toLocaleDateString()} ~ ${new Date(endDate).toLocaleDateString()}`);
           
            // í˜„ì¬ ë‚ ì§œ ë²”ìœ„ ì €ì¥
            currentUsageDateRange = { startDate, endDate };
           
            // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateUsageFilterPeriodDisplay(startDate, endDate);
           
            // ë²„íŠ¼ active ìƒíƒœ ì œê±°
            document.querySelectorAll('#usage .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
           
            // ë¹„ë™ê¸°ë¡œ Usage ì—…ë°ì´íŠ¸
            setTimeout(async () => {
                await updateUsageWithDateRange(startDate, endDate);
            }, 10);
        }

        // í˜„ì¬ í•„í„° ì„¤ì •ìœ¼ë¡œ Overview ì—…ë°ì´íŠ¸
        async function updateOverviewWithCurrentFilter() {
            try {
                console.log('=== í˜„ì¬ í•„í„°ë¡œ Overview ì—…ë°ì´íŠ¸ ì‹œì‘ ===');
               
                // ì°¨íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ê¸°ë³¸ ì°¨íŠ¸ ìƒì„±
                if (!window.overviewChartInitialized) {
                    console.log('ì°¨íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•„ ê¸°ë³¸ ì°¨íŠ¸ ìƒì„±');
                    createOverviewChart();
                    window.overviewChartInitialized = true;
                }
               
                // ë‚ ì§œ ë²”ìœ„ ê²°ì •
                let dateRange;
                if (currentDateRange) {
                    dateRange = currentDateRange;
                    console.log('ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ì‚¬ìš©');
                } else {
                    const filterDays = getCurrentFilterDays();
                    dateRange = getDateRange(filterDays);
                    console.log(`ê¸°ë³¸ í•„í„° ê¸°ê°„ ì‚¬ìš©: ${filterDays}ì¼`);
                }
                
                // í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                updateFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
               
                // íŒ€ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const membersData = await getTeamMembers();
                if (!membersData || !membersData.teamMembers) {
                    console.error('íŒ€ì› ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                currentMembers = membersData.teamMembers;
               
                // í™œë™ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
                const eventsData = await getFilteredEvents(dateRange.startDate, dateRange.endDate);
               
                // ì§€ì¶œ ë°ì´í„°ë¡œ í†µê³„ ê³„ì‚° (ì„ íƒëœ ê¸°ê°„)
                const spendingData = await getTeamSpendingData();
               
                // ì§€ì¶œ ë°ì´í„° ë§¤í•‘
                const memberSpendMap = {};
                if (spendingData && spendingData.teamMemberSpend) {
                    console.log('ğŸ” ì›ë³¸ ì§€ì¶œ ë°ì´í„°:', spendingData.teamMemberSpend);
                    spendingData.teamMemberSpend.forEach(spendInfo => {
                        memberSpendMap[spendInfo.email] = {
                            premiumRequests: spendInfo.fastPremiumRequests || 0,
                            spend: (spendInfo.spendCents || 0) / 100,
                            hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                        };
                        console.log(`ğŸ’° ${spendInfo.email}: requests=${spendInfo.fastPremiumRequests}, spend=$${((spendInfo.spendCents || 0) / 100).toFixed(2)}, limit=$${spendInfo.hardLimitOverrideDollars || 0}`);
                    });
                    console.log('ğŸ“Š ìµœì¢… ì§€ì¶œ ë°ì´í„° ë§µ:', memberSpendMap);
                }
               
                if (eventsData && eventsData.usageEvents) {
                    console.log(`âœ… ${eventsData.usageEvents.length}ê±´ì˜ í™œë™ ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
                    currentActivities = createActivityListWithLastActivity(eventsData.usageEvents, membersData.teamMembers, memberSpendMap);
                    
                    // í˜„ì¬ Raw Events ë°ì´í„° ì—…ë°ì´íŠ¸
                    currentRawEventsData = eventsData.usageEvents;
                    console.log('ğŸ”„ currentRawEventsData ì—…ë°ì´íŠ¸ ì™„ë£Œ:', currentRawEventsData.length, 'ê°œ ì´ë²¤íŠ¸');
                    // ì²¨ë¶€íŒŒì¼ ë¹„í™œì„± ë¦¬ìŠ¤íŠ¸ ì¦‰ì‹œ ê°±ì‹  ì‹œë„
                    try {
                        const inactiveSec = document.getElementById('attachment-inactive-section');
                        const isInactiveVisible = inactiveSec && inactiveSec.style.display !== 'none';
                        console.log('ğŸ“£ [ì²¨ë¶€íŒŒì¼/ë¹„í™œì„±] ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸ ê°ì§€. ì„¹ì…˜ í‘œì‹œ ìƒíƒœ:', isInactiveVisible);
                        if (window._renderAttachmentList) {
                            window._renderAttachmentList('inactive');
                        } else if (typeof renderAttachmentMemberLists === 'function') {
                            renderAttachmentMemberLists();
                        }
                    } catch (e) {
                        console.warn('ì²¨ë¶€íŒŒì¼ ë¹„í™œì„± ë¦¬ìŠ¤íŠ¸ ìë™ ê°±ì‹  ì‹¤íŒ¨:', e);
                    }
                    
                    // í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì—…ë°ì´íŠ¸
                    const currentFilter = getCurrentFilterState();
                    chartDataStore.updateData(
                        membersData.teamMembers,
                        eventsData.usageEvents,
                        spendingData,
                        null, // usageDataëŠ” ë³„ë„ í˜¸ì¶œë¨
                        currentFilter
                    );
                   
                    // ì„ íƒëœ ê¸°ê°„ ë‚´ ì‹¤ì œ í™œì„± ë©¤ë²„ ê³„ì‚°
                    const periodActiveMembers = calculatePeriodActiveMembers(eventsData.usageEvents);
                    const totalMembers = membersData.teamMembers.length;
                    const inactiveMembers = totalMembers - periodActiveMembers;
                   
                    console.log(`í†µê³„ ê³„ì‚° ê²°ê³¼: ì „ì²´ ${totalMembers}ëª…, í™œì„± ${periodActiveMembers}ëª…, ë¹„í™œì„± ${inactiveMembers}ëª…`);
                    console.log(`í™œë™ ë¦¬ìŠ¤íŠ¸ì— ì‹¤ì œ í‘œì‹œë  ë©¤ë²„ ìˆ˜: ${currentActivities.length}ëª…`);
                   
                    // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
                    updateStatsCards(totalMembers, periodActiveMembers, inactiveMembers);
                   
                    // í˜„ì¬ ì„ íƒëœ íƒ€ì…ì— ë”°ë¼ í•„í„°ë§
                    const filteredActivities = filterActivitiesByType(currentActivities, currentFilterType);
                    currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                    updateActivityList(filteredActivities);
                    // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
                    
                    // Overview ì„¹ì…˜ì˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ (í˜„ì¬ í•„í„° ê¸°ê°„ ì‚¬ìš©)
                    console.log('Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì¤‘...');
                    const overviewUsageData = await getUsageData(dateRange.startDate, dateRange.endDate);
                    updateUsageCards(overviewUsageData, eventsData);
                    console.log('âœ… Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì„ íƒëœ í•„í„° ê¸°ê°„ ê¸°ì¤€)
                    console.log('Overview ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘...');
                    if (overviewUsageData && overviewUsageData.data) {
                        const chartData = createChartData(overviewUsageData.data);
                        updateChart(chartData);
                        console.log(`âœ… ${overviewUsageData.data.length}ê±´ì˜ ì°¨íŠ¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.`);
                    }
                    console.log('âœ… Overview ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.log('í™œë™ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    currentActivities = [];
                    const totalMembers = membersData ? membersData.teamMembers.length : 0;
                    updateStatsCards(totalMembers, 0, totalMembers);
                    currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                    updateActivityList([]);
                    
                    // Overview ì„¹ì…˜ì˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ (í˜„ì¬ í•„í„° ê¸°ê°„ ì‚¬ìš©)
                    console.log('Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì¤‘...');
                    const overviewUsageData = await getUsageData(dateRange.startDate, dateRange.endDate);
                    updateUsageCards(overviewUsageData, eventsData);
                    console.log('âœ… Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // í˜„ì¬ í™œì„±í™”ëœ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    console.log('í˜„ì¬ í™œì„±í™”ëœ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘...');
                    const activeChart = document.querySelector('.chart-content.active');
                    if (activeChart) {
                        const chartSelect = document.getElementById('chartSelect');
                        const currentChartType = chartSelect ? chartSelect.value : 'activity-trend';
                        
                        console.log(`í˜„ì¬ í™œì„±í™”ëœ ì°¨íŠ¸: ${currentChartType}`);
                        
                        // ìºì‹œë¥¼ ë¬´ì‹œí•˜ê³  ì°¨íŠ¸ë¥¼ ìƒˆë¡œ ìƒì„±
                        chartCache[currentChartType] = { data: null, filter: null, rendered: false };
                        
                        // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì°¨íŠ¸ ë Œë”ë§
                        if (currentChartType === 'activity-trend') {
                            createOverviewChart();
                        } else if (currentChartType === 'model-distribution') {
                            createModelDistributionChart();
                        } else if (currentChartType === 'cost-trend') {
                            createCostTrendChart();
                        } else if (currentChartType === 'activity-type') {
                            createActivityTypeChart();
                        } else if (currentChartType === 'user-heatmap') {
                            createUserHeatmapChart();
                        } else if (currentChartType === 'cost-efficiency') {
                            createCostEfficiencyChart();
                        } else if (currentChartType === 'model-preference') {
                            createModelPreferenceChart();
                        } else if (currentChartType === 'user-performance') {
                            createUserPerformanceChart();
                        } else if (currentChartType === 'activity-type-detailed') {
                            createActivityTypeDetailedChart();
                        }
                        
                        // ì°¨íŠ¸ ë Œë”ë§ ì™„ë£Œ í›„ ìºì‹œì— ì €ì¥
                        setTimeout(() => {
                            cacheChartData(currentChartType);
                            chartCache[currentChartType].filter = getCurrentFilterState();
                            chartCache[currentChartType].rendered = true;
                        }, 100);
                        
                        console.log(`âœ… ${currentChartType} ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                    } else {
                        console.log('í™œì„±í™”ëœ ì°¨íŠ¸ê°€ ì—†ìŒ');
                    }
                }
               
                console.log('=== í˜„ì¬ í•„í„°ë¡œ Overview ì—…ë°ì´íŠ¸ ì™„ë£Œ ===');
            } catch (error) {
                console.error('âŒ Overview ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ì„ íƒëœ ê¸°ê°„ ë‚´ í™œì„± ë©¤ë²„ ìˆ˜ ê³„ì‚° (ì‹¤ì œ í™œë™ ê¸°ì¤€)
        function calculatePeriodActiveMembers(events) {
            const activeUsers = new Set();
            events.forEach(event => {
                // ì‹¤ì œ í™œë™ì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ì¹´ìš´íŠ¸ (ìš”ì²­ ë¹„ìš©ì´ 0ë³´ë‹¤ í¬ê±°ë‚˜ í† í° ê¸°ë°˜ í˜¸ì¶œ)
                if (event.userEmail && event.requestsCosts > 0) {
                    activeUsers.add(event.userEmail);
                }
            });
            console.log(`ì„ íƒëœ ê¸°ê°„ ë‚´ í™œì„± ë©¤ë²„: ${activeUsers.size}ëª…`, Array.from(activeUsers));
            return activeUsers.size;
        }

        // Overview í™œë™ ë¦¬ìŠ¤íŠ¸ë§Œ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ í•¨ìˆ˜ í˜¸í™˜ì„± ìœ ì§€)
        async function updateOverviewActivityList() {
            await updateOverviewWithCurrentFilter();
        }

        // ì „ì²´ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshAllRealData() {
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            showLoadingStatus(true);
            
            // ë°ì´í„°ê°€ ìƒˆë¡œ ë¡œë“œë˜ë¯€ë¡œ ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™”
            clearChartCache();
           
            // Overviewì™€ Membersë¥¼ ë™ì‹œì— ë¡œë“œí•˜ì—¬ ì‹œê°„ ë‹¨ì¶•
            await Promise.all([
                updateOverviewWithRealData(),
                updateMembersWithRealData()
            ]);
           
            // ë¡œë”© ìƒíƒœ í•´ì œ
            showLoadingStatus(false);
        }

        // ìµœì í™”ëœ ë¡œë”© ìƒíƒœ í‘œì‹œ/í•´ì œ
        function showLoadingStatus(isLoading) {
            const pageTitle = document.getElementById('page-title');
           
            if (isLoading) {
                // Overview ì„¹ì…˜ì—ì„œëŠ” ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                if (pageTitle.textContent === 'Overview' || pageTitle.textContent === 'Dashboard Overview') {
                    return;
                }
                pageTitle.innerHTML = 'ğŸ”„ Loading Real API Data...';
            } else {
                // ì›ë˜ ì œëª©ìœ¼ë¡œ ë³µì›
                if (pageTitle.textContent === 'ğŸ”„ Loading Real API Data...') {
                    pageTitle.textContent = 'Dashboard Overview';
                }
            }
        }

        // ì „ì—­ ë³€ìˆ˜
        let currentFilterType = 'total'; // í˜„ì¬ ì„ íƒëœ í•„í„° íƒ€ì…
        let currentActivities = []; // í˜„ì¬ í™œë™ ë°ì´í„°
        let currentMembers = []; // í˜„ì¬ ë©¤ë²„ ë°ì´í„°
        let currentDateRange = null; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ ë²”ìœ„ (Overviewìš©)
        let currentUsageDateRange = null; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ ë²”ìœ„ (Usageìš©)
        let currentRawEventsData = []; // í˜„ì¬ Raw Events ì „ì²´ ë°ì´í„°
        let currentRawEventsPage = 1; // í˜„ì¬ Raw Events í˜ì´ì§€
        let currentRawEventsPageSize = 10; // í˜„ì¬ Raw Events í˜ì´ì§€ í¬ê¸°
        
        // í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ
        let chartDataStore = {
            members: [], // íŒ€ ë©¤ë²„ ë°ì´í„°
            rawEvents: [], // ì›ì‹œ ì´ë²¤íŠ¸ ë°ì´í„°
            spendingData: null, // ì§€ì¶œ ë°ì´í„°
            usageData: null, // ì‚¬ìš©ëŸ‰ ë°ì´í„°
            lastUpdated: null, // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
            currentFilter: null, // í˜„ì¬ ì ìš©ëœ í•„í„° ìƒíƒœ
            
            // ë°ì´í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            updateData: function(members, rawEvents, spendingData, usageData, filterState) {
                this.members = members || [];
                this.rawEvents = rawEvents || [];
                this.spendingData = spendingData;
                this.usageData = usageData;
                this.currentFilter = filterState;
                this.lastUpdated = new Date();
                console.log(`ğŸ“Š í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${this.members.length}ëª…, ${this.rawEvents.length}ê°œ ì´ë²¤íŠ¸`);
            },
            
            // ë°ì´í„° ìœ íš¨ì„± í™•ì¸
            isDataValid: function(filterState) {
                if (!this.members.length || !this.rawEvents.length || !this.lastUpdated) {
                    return false;
                }
                
                // í•„í„° ìƒíƒœê°€ ë™ì¼í•œì§€ í™•ì¸
                if (filterState && this.currentFilter) {
                    return isFilterStateEqual(this.currentFilter, filterState);
                }
                
                return true;
            },
            
            // ë°ì´í„° ì´ˆê¸°í™”
            clearData: function() {
                this.members = [];
                this.rawEvents = [];
                this.spendingData = null;
                this.usageData = null;
                this.lastUpdated = null;
                this.currentFilter = null;
                console.log('ğŸ“Š í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì´ˆê¸°í™”');
            }
        };
        
        // Usage ë°ì´í„° ë¡œë”© ìƒíƒœ ì¶”ì 
        let isUsageDataLoaded = false; // Usage ë°ì´í„°ê°€ í•œ ë²ˆì´ë¼ë„ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
        let isUsageLoading = false; // Usage ë°ì´í„° ë¡œë”© ì¤‘ì¸ì§€ í™•ì¸
        
        // í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜
        let currentActivityPage = 1; // í˜„ì¬ í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€
        let currentActivityPageSize = 20; // í˜„ì¬ í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ í¬ê¸°
        
        // ì°¨íŠ¸ ìºì‹± ì‹œìŠ¤í…œ
        let chartCache = {
            'activity-trend': { data: null, filter: null, rendered: false },
            'model-distribution': { data: null, filter: null, rendered: false },
            'cost-trend': { data: null, filter: null, rendered: false },
            'activity-type': { data: null, filter: null, rendered: false },
            'user-heatmap': { data: null, filter: null, rendered: false },
            'cost-efficiency': { data: null, filter: null, rendered: false },
            'model-preference': { data: null, filter: null, rendered: false },
            'user-performance': { data: null, filter: null, rendered: false },
            'activity-type-detailed': { data: null, filter: null, rendered: false }
        };
        
        // ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™” í•¨ìˆ˜
        function clearChartCache() {
            Object.keys(chartCache).forEach(key => {
                chartCache[key] = { data: null, filter: null, rendered: false };
            });
            console.log('ğŸ“Š ëª¨ë“  ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™”');
        }
        let currentActivityData = []; // í˜„ì¬ í™œë™ë¦¬ìŠ¤íŠ¸ ë°ì´í„°
        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜
        let currentUserCumulativePage = 1; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€
        let currentUserCumulativePageSize = 20; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ í¬ê¸°
        let currentUserCumulativeData = []; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ë°ì´í„°
        let currentUserCumulativeStartDate = null; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì‹œì‘ ë‚ ì§œ
        let currentUserCumulativeEndDate = null; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì¢…ë£Œ ë‚ ì§œ
        
        // Members í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜
        let currentMembersPage = 1; // í˜„ì¬ Members í˜ì´ì§€
        let currentMembersPageSize = 20; // í˜„ì¬ Members í˜ì´ì§€ í¬ê¸°
        let currentMembersData = []; // í˜„ì¬ Members ë°ì´í„°
        let originalMembersData = []; // ì›ë³¸ ë©¤ë²„ ë°ì´í„° (í•„í„°ë§ìš©)

        // ============================================================================
        // ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ (2025.07.29 ì¶”ê°€)
        // ============================================================================









        // API í˜¸ì¶œì„ ìœ„í•œ ì„¤ì •
        const API_CONFIG = {
            baseUrl: '/api', // Vercel Functions ê²½ë¡œ
            headers: {
                'Content-Type': 'application/json'
            }
        };

        // API í˜¸ì¶œ í•¨ìˆ˜ (ì‹¤ì œ API í˜¸ì¶œ)
        async function callAPI(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        ...API_CONFIG.headers
                    }
                };

                if (data && method === 'POST') {
                    options.body = JSON.stringify(data);
                }

                console.log(`ì‹¤ì œ Cursor Admin API í˜¸ì¶œ: ${method} ${API_CONFIG.baseUrl}${endpoint}`, data);
               
                const response = await fetch(API_CONFIG.baseUrl + endpoint, options);
               
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} - ${response.statusText}\n${errorText}`);
                }

                const result = await response.json();
                console.log('ì‹¤ì œ API ì‘ë‹µ ë°ì´í„°:', result);
               
                // API ì‘ë‹µì— ì˜¤ë¥˜ê°€ ìˆëŠ”ì§€ í™•ì¸
                if (result.error) {
                    throw new Error(`API ì˜¤ë¥˜: ${result.error} - ${result.message}`);
                }
               
                return result;
               
            } catch (error) {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                throw error; // ì˜¤ë¥˜ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ í˜¸ì¶œìê°€ ì²˜ë¦¬í•˜ë„ë¡ í•¨
            }
        }



        // API ì—°ê²° ìƒíƒœ í™•ì¸
        async function checkAPIConnection() {
            try {
                const response = await fetch(API_CONFIG.baseUrl + '/teams/members', {
                    method: 'GET',
                    headers: API_CONFIG.headers
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // Aggressive ìºì‹œ: íŒ€ì›/ì´ë²¤íŠ¸ ë°ì´í„° ìºì‹œ
        window.__aggressivePreviewCacheEnabled = window.__aggressivePreviewCacheEnabled ?? true; // ê¸°ë³¸ ON
        window.__membersCache = window.__membersCache || null; // { data, fetchedAt }
        window.__eventsCache = window.__eventsCache || new Map(); // key: `${startDate}_${endDate}` â†’ { data, fetchedAt }

        // íŒ€ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ê³µê²©ì  ìºì‹œ ì ìš©)
        async function getTeamMembers() {
            try {
                if (window.__aggressivePreviewCacheEnabled && window.__membersCache && window.__membersCache.data) {
                    const ttlMs = 10 * 60 * 1000; // 10ë¶„
                    if (Date.now() - (window.__membersCache.fetchedAt || 0) < ttlMs) {
                        return window.__membersCache.data;
                    }
                }
                const data = await callAPI('/teams/members');
                if (window.__aggressivePreviewCacheEnabled && data) {
                    window.__membersCache = { data, fetchedAt: Date.now() };
                }
                return data;
            } catch (e) {
                if (window.__membersCache && window.__membersCache.data) return window.__membersCache.data;
                throw e;
            }
        }

        // ì‚¬ìš©ëŸ‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function getUsageData(startDate, endDate) {
            return await callAPI('/teams/daily-usage-data', 'POST', {
                startDate: startDate,
                endDate: endDate
            });
        }

        // íŒ€ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì „ì²´ ë©¤ë²„)
        async function getTeamSpendingData() {
            try {
                console.log('ğŸ” ì „ì²´ ë©¤ë²„ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œì‘...');
                
                // ì§ì ‘ í° pageSizeë¡œ ëª¨ë“  ë©¤ë²„ ë°ì´í„° ìš”ì²­
                console.log('ğŸ“¡ API í˜¸ì¶œ: /teams/spend (pageSize: 1000)');
                const spendingData = await callAPI('/teams/spend', 'POST', {
                    page: 1,
                    pageSize: 1000
                });
                
                if (!spendingData || !spendingData.teamMemberSpend) {
                    throw new Error('ì§€ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const retrievedCount = spendingData.teamMemberSpend.length;
                const totalMembers = spendingData.totalMembers || retrievedCount;
                const totalPages = spendingData.totalPages || 1;
                
                console.log(`âœ… ì§€ì¶œ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:`);
                console.log(`   - ì¡°íšŒëœ ë©¤ë²„: ${retrievedCount}ëª…`);
                console.log(`   - ì „ì²´ ë©¤ë²„: ${totalMembers}ëª…`);
                console.log(`   - ì „ì²´ í˜ì´ì§€: ${totalPages}í˜ì´ì§€`);
                
                // ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ëŠ”ì§€ í™•ì¸
                if (retrievedCount < totalMembers && totalPages > 1) {
                    console.log('âš ï¸ ì¶”ê°€ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë” í° pageSizeë¡œ ì¬ìš”ì²­...');
                    
                    const largerData = await callAPI('/teams/spend', 'POST', {
                        page: 1,
                        pageSize: Math.max(totalMembers + 100, 2000) // ì—¬ìœ ìˆê²Œ ì„¤ì •
                    });
                    
                    if (largerData && largerData.teamMemberSpend && largerData.teamMemberSpend.length > retrievedCount) {
                        console.log(`âœ… ì¬ìš”ì²­ ì„±ê³µ: ${largerData.teamMemberSpend.length}ëª…ì˜ ë°ì´í„° í™•ë³´`);
                        return largerData;
                    }
                }
                
                console.log(`ğŸ¯ ìµœì¢… ê²°ê³¼: ${retrievedCount}ëª…ì˜ ë©¤ë²„ ë°ì´í„° ë°˜í™˜`);
                return spendingData;
                
            } catch (error) {
                console.error('âŒ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ëª¨ë“  í˜ì´ì§€ ë°ì´í„° ìˆ˜ì§‘) + ìºì‹œ
        async function getFilteredEvents(startDate, endDate) {
            try {
                console.log('=== í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œì‘ ===');
                const cacheKey = `${startDate}_${endDate}`;
                if (window.__aggressivePreviewCacheEnabled && window.__eventsCache && window.__eventsCache.has(cacheKey)) {
                    const cached = window.__eventsCache.get(cacheKey);
                    const ttlMs = 5 * 60 * 1000; // 5ë¶„
                    if (cached && cached.data && Date.now() - (cached.fetchedAt || 0) < ttlMs) {
                        console.log('ğŸ—„ï¸ ìºì‹œëœ ì´ë²¤íŠ¸ ë°ì´í„° ì‚¬ìš©');
                        return cached.data;
                    }
                }
                
                // ì²« ë²ˆì§¸ í˜ì´ì§€ ìš”ì²­
                let allEvents = [];
                let currentPage = 1;
                let hasMorePages = true;
                
                while (hasMorePages) {
                    console.log(`ğŸ“„ í˜ì´ì§€ ${currentPage} ìš”ì²­ ì¤‘...`);
                    
                    const pageData = await callAPI('/teams/filtered-usage-events', 'POST', {
                        startDate: startDate,
                        endDate: endDate,
                        page: currentPage,
                        pageSize: 1000
                    });
                    
                    if (pageData && pageData.usageEvents) {
                        allEvents = allEvents.concat(pageData.usageEvents);
                        console.log(`âœ… í˜ì´ì§€ ${currentPage}: ${pageData.usageEvents.length}ê°œ ì´ë²¤íŠ¸ ìˆ˜ì§‘ (ëˆ„ì : ${allEvents.length}ê°œ)`);
                        
                        // ë” ë§ì€ í˜ì´ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
                        hasMorePages = pageData.pagination && pageData.pagination.hasNextPage;
                        currentPage++;
                        
                        // ë¬´í•œ ë£¨í”„ ë°©ì§€ (ìµœëŒ€ 10í˜ì´ì§€)
                        if (currentPage > 10) {
                            console.log('âš ï¸ ìµœëŒ€ í˜ì´ì§€ ìˆ˜ ë„ë‹¬ - ë¬´í•œ ë£¨í”„ ë°©ì§€');
                            break;
                        }
                    } else {
                        console.log(`âŒ í˜ì´ì§€ ${currentPage} ë°ì´í„° ì—†ìŒ`);
                        hasMorePages = false;
                    }
                }
                
                console.log(`=== í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ: ì´ ${allEvents.length}ê°œ ì´ë²¤íŠ¸ ===`);
                
                // ê¸°ì¡´ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜ + ìºì‹œ ì €ì¥
                const result = {
                    totalUsageEventsCount: allEvents.length,
                    usageEvents: allEvents,
                    period: { startDate, endDate }
                };
                if (window.__aggressivePreviewCacheEnabled) {
                    window.__eventsCache.set(cacheKey, { data: result, fetchedAt: Date.now() });
                }
                return result;
                
            } catch (error) {
                console.error('âŒ í•„í„°ë§ëœ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                // ìºì‹œ í´ë°±
                try {
                    const cacheKey = `${startDate}_${endDate}`;
                    const cached = window.__eventsCache && window.__eventsCache.get(cacheKey);
                    if (cached && cached.data) {
                        console.warn('âš ï¸ ìºì‹œëœ ì´ë²¤íŠ¸ ë°ì´í„°ë¡œ í´ë°±');
                        return cached.data;
                    }
                } catch (_) {}
                throw error;
            }
        }

        // í˜„ì¬ ì„ íƒëœ í•„í„° ê¸°ê°„ ê°€ì ¸ì˜¤ê¸°
        function getCurrentFilterDays() {
            const activeBtn = document.querySelector('#overview .chart-btn.active');
            if (!activeBtn) return 30; // ê¸°ë³¸ê°’ 30ì¼
           
            const days = activeBtn.getAttribute('data-days');
            return days ? parseInt(days) : 30;
        }

        // ë‚ ì§œë¥¼ epoch millisecondsë¡œ ë³€í™˜ (í•œêµ­ ì‹œê°„ ê¸°ì¤€)
        function getDateRange(days = 7) {
            // í•œêµ­ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ í˜„ì¬ ë‚ ì§œ ê³„ì‚°
            const now = new Date();
            const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
            
            const endDate = new Date(koreaTime);
            const startDate = new Date(koreaTime);
            startDate.setDate(startDate.getDate() - days);
           
            return {
                startDate: startDate.getTime(),
                endDate: endDate.getTime()
            };
        }

        // í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (í•œêµ­ ì‹œê°„ ê¸°ì¤€)
        function updateFilterPeriodDisplay(startDate, endDate) {
            const filterPeriodText = document.getElementById('filter-period-text');
            if (!filterPeriodText) return;

            // í•œêµ­ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ë³€í™˜
            const startDateKorea = new Date(startDate + (9 * 60 * 60 * 1000));
            const endDateKorea = new Date(endDate + (9 * 60 * 60 * 1000));
            
            const startDateStr = startDateKorea.toISOString().split('T')[0];
            const endDateStr = endDateKorea.toISOString().split('T')[0];
            
            filterPeriodText.textContent = `${startDateStr} ~ ${endDateStr}`;
            console.log(`âœ… í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸: ${startDateStr} ~ ${endDateStr}`);
        }

        // Usage ì„¹ì…˜ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (í•œêµ­ ì‹œê°„ ê¸°ì¤€)
        function updateUsageFilterPeriodDisplay(startDate, endDate) {
            const filterPeriodText = document.getElementById('usage-filter-period-text');
            if (!filterPeriodText) return;

            // í•œêµ­ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ë³€í™˜
            const startDateKorea = new Date(startDate + (9 * 60 * 60 * 1000));
            const endDateKorea = new Date(endDate + (9 * 60 * 60 * 1000));
            
            const startDateStr = startDateKorea.toISOString().split('T')[0];
            const endDateStr = endDateKorea.toISOString().split('T')[0];
            
            filterPeriodText.textContent = `${startDateStr} ~ ${endDateStr}`;
            console.log(`âœ… Usage í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸: ${startDateStr} ~ ${endDateStr}`);
        }

        // Overview ë°ì´í„° ì—…ë°ì´íŠ¸ (ì´ˆê¸° ë¡œë“œìš©)
        async function updateOverviewWithRealData() {
            try {
                console.log('=== ì‹¤ì œ Cursor Admin API ë°ì´í„°ë¡œ Overview ì´ˆê¸° ë¡œë“œ ì‹œì‘ ===');
               
                // ì´ˆê¸°í™”
                currentFilterType = 'total';
                currentDateRange = null;
               
                // í˜„ì¬ í•„í„°ë¡œ ì—…ë°ì´íŠ¸
                await updateOverviewWithCurrentFilter();

                // ì°¨íŠ¸ëŠ” updateOverviewWithCurrentFilterì—ì„œ ì²˜ë¦¬ë¨ (ê¸°ë³¸ 30ì¼ í•„í„°)
                console.log('ì°¨íŠ¸ëŠ” ê¸°ë³¸ í•„í„° ì—…ë°ì´íŠ¸ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.');

                // ì´ˆê¸° ë¡œë“œ í›„ ê¸°ë³¸ ì„ íƒëœ 'total' ì¹´ë“œì— ë§ëŠ” ì‹¤ì œ ë°ì´í„° í‘œì‹œ
                console.log('ì´ˆê¸° ë¡œë“œ í›„ ì „ì²´ ë©¤ë²„ ë°ì´í„° í‘œì‹œ');
                await updateMembersByTypeWithRealData('total');
               
                // ì„ íƒ ìƒíƒœì™€ ë°ì´í„° ì¼ì¹˜ í™•ì¸
                console.log(`í˜„ì¬ ì„ íƒëœ íƒ€ì…: ${currentFilterType}`);
                console.log('ì „ì²´ ë©¤ë²„ ì¹´ë“œ ì„ íƒ ìƒíƒœ í™•ì¸ ì™„ë£Œ');

                console.log('=== ì‹¤ì œ API ë°ì´í„°ë¡œ Overview ì´ˆê¸° ë¡œë“œ ì™„ë£Œ! ===');
            } catch (error) {
                console.error('âŒ Overview ì´ˆê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('Overview ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ê³¼ API ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ì‹¤ì œ API ë°ì´í„° ì‚¬ìš©)
        function updateStatsCards(total, active, inactive) {
            const totalBox = document.querySelector('.overview-stat-box[data-type="total"] .stat-number');
            const activeBox = document.querySelector('.overview-stat-box[data-type="active"] .stat-number');
            const inactiveBox = document.querySelector('.overview-stat-box[data-type="inactive"] .stat-number');

            if (totalBox) {
                totalBox.textContent = total;
                console.log(`âœ… ì´ ë©¤ë²„ ìˆ˜ ì—…ë°ì´íŠ¸: ${total}ëª…`);
            }
            if (activeBox) {
                activeBox.textContent = active;
                console.log(`âœ… í™œì„± ë©¤ë²„ ìˆ˜ ì—…ë°ì´íŠ¸: ${active}ëª…`);
            }
            if (inactiveBox) {
                inactiveBox.textContent = inactive;
                console.log(`âœ… ë¹„í™œì„± ë©¤ë²„ ìˆ˜ ì—…ë°ì´íŠ¸: ${inactive}ëª…`);
            }

            // ë©¤ë²„ ìˆ˜ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            const memberCount = document.getElementById('member-count');
            if (memberCount) {
                memberCount.textContent = `(${total}ëª…)`;
            }
        }

        // ì°¨íŠ¸ ë°ì´í„° ìƒì„± (ì¼ë³„ ì§‘ê³„)
        function createChartData(usageData) {
            const dailyTotals = {};
           
            // ì¼ë³„ë¡œ ëª¨ë“  ì‚¬ìš©ìì˜ í™œë™ ì§‘ê³„
            usageData.forEach(dayData => {
                const dateKey = new Date(dayData.date).toDateString();
               
                if (!dailyTotals[dateKey]) {
                    dailyTotals[dateKey] = {
                        date: dayData.date,
                        totalApplies: 0,
                        totalAccepts: 0,
                        chatRequests: 0,
                        agentRequests: 0
                    };
                }
               
                dailyTotals[dateKey].totalApplies += (dayData.totalApplies || 0);
                dailyTotals[dateKey].totalAccepts += (dayData.totalAccepts || 0);
                dailyTotals[dateKey].chatRequests += (dayData.chatRequests || 0);
                dailyTotals[dateKey].agentRequests += (dayData.agentRequests || 0);
            });
           
            // ì°¨íŠ¸ ë°ì´í„° ìƒì„±
            const chartData = Object.values(dailyTotals)
                .sort((a, b) => a.date - b.date)
                .map(dayTotal => {
                    const date = new Date(dayTotal.date);
                    const activityScore = dayTotal.totalApplies + dayTotal.totalAccepts +
                                        dayTotal.chatRequests + dayTotal.agentRequests;
                   
                    // í•œêµ­ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ í‘œì‹œ
                    const koreaDate = new Date(date.getTime() + (9 * 60 * 60 * 1000));
                    const formatDate = koreaDate.toLocaleDateString('ko-KR', { 
                        month: 'numeric', 
                        day: 'numeric' 
                    }).replace(/\.$/, ''); // ëì˜ ì  ì œê±°
                    
                    return {
                        date: formatDate,
                        activity: activityScore,
                        applies: dayTotal.totalApplies,
                        accepts: dayTotal.totalAccepts,
                        chats: dayTotal.chatRequests,
                        agents: dayTotal.agentRequests
                    };
                });

            console.log('ì°¨íŠ¸ ë°ì´í„° ìƒì„±:', chartData);
            return chartData;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateChart(chartData) {
            const canvas = document.getElementById('overviewChart');
            if (!canvas || !chartData.length) return;

            // ìº”ë²„ìŠ¤ í¬ê¸°ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ë‹¤ì‹œ ì„¤ì •
            if (canvas.width === 0 || canvas.height === 0) {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = 300;
            }

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // ê¸°ì¡´ ì°¨íŠ¸ ì§€ìš°ê¸°
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);

            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
           
            // ì„¸ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= chartData.length; i++) {
                const x = (width / chartData.length) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }

            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = (height / 5) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // ë°ì´í„° í¬ì¸íŠ¸ ê³„ì‚°
            const maxActivity = Math.max(...chartData.map(d => d.activity));
            const dataPoints = chartData.map((data, index) => ({
                x: (width / (chartData.length - 1)) * index,
                y: height - (height * (data.activity / maxActivity))
            }));

            // ì„  ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            if (dataPoints.length > 1) {
                ctx.strokeStyle = '#4a9eff';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(dataPoints[0].x, dataPoints[0].y);
               
                for (let i = 1; i < dataPoints.length; i++) {
                    ctx.lineTo(dataPoints[i].x, dataPoints[i].y);
                }
                ctx.stroke();
            }

            // ë°ì´í„° í¬ì¸íŠ¸ ì› ê·¸ë¦¬ê¸°
            dataPoints.forEach(point => {
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            // ë‚ ì§œ ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
           
            chartData.forEach((data, index) => {
                const x = (width / (chartData.length - 1)) * index;
                ctx.fillText(data.date, x, height - 10);
            });
        }

        // í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„± (ì‹¤ì œ í™œë™ì´ ìˆëŠ” ë©¤ë²„ë§Œ, ì •í™•í•œ í†µê³„ ë°˜ì˜)
        function createActivityListWithLastActivity(events, members, memberSpendMap = {}) {
            console.log('=== í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹œì‘ ===');
            console.log(`ì „ì²´ ì´ë²¤íŠ¸ ìˆ˜: ${events.length}ê°œ`);
            console.log(`ì „ì²´ ë©¤ë²„ ìˆ˜: ${members.length}ëª…`);
            console.log('ì§€ì¶œ ë°ì´í„° ë§µ:', memberSpendMap);
           
            // ì‚¬ìš©ìë³„ ë§ˆì§€ë§‰ í™œë™ ë‚ ì§œ ë° í†µê³„ ê³„ì‚°
            const userActivity = {};
           
            events.forEach(event => {
                const userEmail = event.userEmail;
                const timestamp = parseInt(event.timestamp);
                const requestCost = event.requestsCosts || 0;
               
                if (!userActivity[userEmail]) {
                    userActivity[userEmail] = {
                        lastTimestamp: timestamp,
                        totalRequests: 0,
                        events: []
                    };
                }
               
                // ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
                if (timestamp > userActivity[userEmail].lastTimestamp) {
                    userActivity[userEmail].lastTimestamp = timestamp;
                }
               
                // ìš”ì²­ ìˆ˜ë§Œ ëˆ„ì  (ì‹¤ì œ ì§€ì¶œì€ /teams/spend APIì—ì„œ ê°€ì ¸ì˜´)
                userActivity[userEmail].totalRequests += requestCost;
                userActivity[userEmail].events.push(event);
            });
           
            console.log('ì‚¬ìš©ìë³„ í™œë™ í†µê³„:', userActivity);
           
            // ëª¨ë“  ë©¤ë²„ë¥¼ í¬í•¨í•˜ì—¬ í™œë™ ì •ë³´ ìƒì„± (í™œì„± + ë¹„í™œì„±)
            const activities = [];
            let activeCount = 0;
            let inactiveCount = 0;
           
            members.forEach(member => {
                const userStats = userActivity[member.email];
                const spendData = memberSpendMap[member.email] || {};
                
                // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš© (/teams/spend APIì—ì„œ)
                const actualSpend = spendData.spend || 0;
                const premiumRequests = spendData.premiumRequests || 0;
                const hardLimit = spendData.hardLimitOverride || 0;
                const limitDisplay = hardLimit > 0 ? `$${hardLimit}` : '$0';
               
                if (userStats && userStats.totalRequests > 0) {
                    // í™œë™ì´ ìˆëŠ” ë©¤ë²„
                    const lastActivityDate = new Date(userStats.lastTimestamp);
                   
                    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•œ ì¼ìˆ˜ ì°¨ì´ ê³„ì‚°
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                   
                    const activityDate = new Date(userStats.lastTimestamp);
                    activityDate.setHours(0, 0, 0, 0);
                   
                    const daysDiff = Math.floor((today - activityDate) / (1000 * 60 * 60 * 24));
                   
                    activeCount++;
                   
                    activities.push({
                        date: lastActivityDate.toLocaleDateString('ko-KR', {
                            month: '2-digit',
                            day: '2-digit'
                        }) + ` (${daysDiff === 0 ? 'ì˜¤ëŠ˜' : daysDiff + 'ì¼ ì „'})`,
                        timestamp: userStats.lastTimestamp,
                        email: member.email,
                        name: member.name || 'Unnamed',
                        type: 'active',
                        kind: userStats.events.length > 0 ? userStats.events[0].kindLabel || 'Unknown' : 'Unknown',
                        request: premiumRequests, // Premium Requests ì‚¬ìš©
                        spend: `$${actualSpend.toFixed(2)}`, // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                        limit: limitDisplay
                    });
                } else {
                    // í™œë™ì´ ì—†ëŠ” ë©¤ë²„ (ë¹„í™œì„±)
                    inactiveCount++;
                   
                    activities.push({
                        date: 'No Activity',
                        timestamp: 0,
                        email: member.email,
                        name: member.name || 'Unnamed',
                        type: 'inactive',
                        kind: 'No Activity',
                        request: 0,
                        spend: `$${actualSpend.toFixed(2)}`, // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                        limit: limitDisplay
                    });
                }
            });
           
            console.log(`í™œë™ ë¦¬ìŠ¤íŠ¸ ê²°ê³¼: ì´ ${activities.length}ëª… (í™œì„±: ${activeCount}ëª…, ë¹„í™œì„±: ${inactiveCount}ëª…)`);
           
            // ë§ˆì§€ë§‰ í™œë™ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ - ë‚´ë¦¼ì°¨ìˆœ)
            return activities.sort((a, b) => {
                return b.timestamp - a.timestamp;
            });
        }

        // ê¸°ì¡´ í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„± (í˜¸í™˜ì„± ìœ ì§€)
        function createActivityList(events) {
            return events.slice(0, 20).map(event => {
                const timestamp = new Date(parseInt(event.timestamp));
                return {
                    date: timestamp.toLocaleDateString('ko-KR', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    }),
                    email: event.userEmail || 'Unknown',
                    type: event.isTokenBasedCall ? 'active' : 'inactive',
                    kind: event.kindLabel || 'Unknown',
                    request: event.requestsCosts || 0,
                    spend: event.isTokenBasedCall ?
                        `$${(event.tokenUsage?.totalCents || 0) / 100}` :
                        '$0.00'
                };
            });
        }



        // ì´ë©”ì¼ í´ë¦­ ì‹œ Usage ì„¹ì…˜ìœ¼ë¡œ ì´ë™ ë° ê²€ìƒ‰
        function navigateToUsageWithEmail(email) {
            console.log(`ì´ë©”ì¼ í´ë¦­: ${email} - Usage ì„¹ì…˜ìœ¼ë¡œ ì´ë™ ì‹œì‘`);
            
            // ê²€ìƒ‰ ì˜ˆì • í”Œë˜ê·¸ ì„¤ì • (ìë™ ìƒˆë¡œê³ ì¹¨ ë°©ì§€ìš©)
            window.pendingEmailSearch = email;
            
            // ìˆ˜ë™ìœ¼ë¡œ ì„¹ì…˜ ì „í™˜ (ìë™ ë°ì´í„° ë¡œë“œ ë°©ì§€)
            const usageMenuItem = document.querySelector('.menu-item[data-section="usage"]');
            const allMenuItems = document.querySelectorAll('.menu-item');
            const allSections = document.querySelectorAll('.content-section');
            
            // ë©”ë‰´ ìƒíƒœ ì—…ë°ì´íŠ¸
            allMenuItems.forEach(menu => menu.classList.remove('active'));
            if (usageMenuItem) {
                usageMenuItem.classList.add('active');
            }
            
            // ì„¹ì…˜ ì „í™˜
            allSections.forEach(section => section.classList.remove('active'));
            const usageSection = document.getElementById('usage');
            if (usageSection) {
                usageSection.classList.add('active');
            }
            
            // í˜ì´ì§€ ì œëª© ì—…ë°ì´íŠ¸
            const pageTitle = document.getElementById('page-title');
            if (pageTitle) {
                pageTitle.textContent = 'Usage Analytics';
            }
            
            // Usage ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const hasData = currentRawEventsData && currentRawEventsData.length > 0;
            
            if (hasData) {
                // ë°ì´í„°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ì¦‰ì‹œ ê²€ìƒ‰ ì‹¤í–‰
                executeEmailSearch(email);
            } else {
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ë¡œë“œí•œ í›„ ê²€ìƒ‰
                console.log('Usage ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•©ë‹ˆë‹¤...');
                updateUsageWithCurrentFilter(30).then(() => {
                    // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ê²€ìƒ‰ ì‹¤í–‰
                    setTimeout(() => {
                        executeEmailSearch(email);
                    }, 500);
                }).catch(error => {
                    console.error('Usage ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    // ë¡œë“œ ì‹¤íŒ¨í•´ë„ ê²€ìƒ‰ì€ ì‹œë„
                    executeEmailSearch(email);
                });
            }
            
            console.log(`ğŸ“§ ì´ë©”ì¼ í´ë¦­ ì²˜ë¦¬ ì™„ë£Œ: ${email}`);
        }
        
        // ì´ë©”ì¼ ê²€ìƒ‰ ì‹¤í–‰ í•¨ìˆ˜
        function executeEmailSearch(email) {
            const searchBox = document.querySelector('#usage .search-box');
            if (searchBox) {
                searchBox.value = email;
                // X ë²„íŠ¼ í‘œì‹œ
                toggleSearchClearBtn('usage-search');
                filterUsageMembers(email);
                console.log(`âœ… ì´ë©”ì¼ ê²€ìƒ‰ ì™„ë£Œ: ${email}`);
                
                // ê²€ìƒ‰ ì™„ë£Œ í›„ í”Œë˜ê·¸ ì œê±°
                delete window.pendingEmailSearch;
            } else {
                console.error('âŒ Usage ì„¹ì…˜ì˜ ê²€ìƒ‰ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // í™œë™ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (Members ìŠ¤íƒ€ì¼ í˜ì´ì§€ë„¤ì´ì…˜)
        function updateActivityList(activities) {
            currentActivityData = activities; // ë°ì´í„° ì €ì¥
            renderOverviewActivityTableWithPagination(activities);
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” ë Œë”ë§ (Members ìŠ¤íƒ€ì¼)
        function renderOverviewActivityTableWithPagination(activities) {
            // í—¤ë” ì—…ë°ì´íŠ¸
            const headerElement = document.querySelector('.overview-activity-header');
            if (headerElement) {
                if (!activities || activities.length === 0) {
                    headerElement.innerHTML = 'ğŸ“‹ í™œë™ ë¦¬ìŠ¤íŠ¸';
                } else {
                    const totalActivities = activities.length;
                    const totalPages = Math.ceil(totalActivities / currentActivityPageSize);
                    const startIndex = (currentActivityPage - 1) * currentActivityPageSize;
                    const endIndex = Math.min(startIndex + currentActivityPageSize, totalActivities);
                    
                    // í˜„ì¬ í•„í„° íƒ€ì…ì— ë”°ë¥¸ ì œëª© ê²°ì •
                    const titleInfo = updateOverviewActivityTitle(currentFilterType, totalActivities, totalActivities);
                    const periodText = getCurrentOverviewPeriodText();
                    
                    headerElement.innerHTML = `
                        <span>${titleInfo.emoji} ${titleInfo.title} (${periodText})(${startIndex + 1}-${endIndex} of ${totalActivities})</span>
                        <select id="overviewActivityPageSize" onchange="changeOverviewActivityPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                            <option value="10" ${currentActivityPageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                            <option value="20" ${currentActivityPageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                            <option value="30" ${currentActivityPageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                            <option value="50" ${currentActivityPageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                            <option value="100" ${currentActivityPageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                        </select>
                    `;
                }
            }
            
            if (!activities || activities.length === 0) {
                const container = document.getElementById('overview-activity-container');
                if (container) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            í™œë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
                }
                // í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¸°ê¸°
                const pagination = document.getElementById('overview-activity-pagination');
                if (pagination) pagination.style.display = 'none';
                return;
            }

            // í˜ì´ì§€ë„¤ì´ì…˜ ê³„ì‚°
            const totalActivities = activities.length;
            const totalPages = Math.ceil(totalActivities / currentActivityPageSize);
            const startIndex = (currentActivityPage - 1) * currentActivityPageSize;
            const endIndex = Math.min(startIndex + currentActivityPageSize, totalActivities);
            const pageActivities = activities.slice(startIndex, endIndex);

            console.log(`ğŸ“„ Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${totalActivities} (í˜ì´ì§€ ${currentActivityPage}/${totalPages})`);

            // í…Œì´ë¸” ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸
            const tableContent = pageActivities.map(activity => `
                <div class="member-item">
                    <div class="member-date">${activity.date}</div>
                    <div class="member-email clickable-email" title="View usage for ${activity.email}" onclick="navigateToUsageWithEmail('${activity.email}')">${activity.email}</div>
                    <div class="member-type ${activity.type}">${activity.type === 'active' ? 'í™œì„±' : 'ë¹„í™œì„±'}</div>
                    <div class="member-kind">${activity.kind}</div>
                    <div class="member-request">${activity.request}</div>
                    <div class="member-spend">${activity.spend}</div>
                    <div class="member-limit">${activity.limit || '$0'}</div>
                </div>
            `).join('');

            // ì»¨í…Œì´ë„ˆì— í…Œì´ë¸” ë‚´ìš©ë§Œ ì‚½ì…
            const container = document.getElementById('overview-activity-container');
            if (container) {
                container.innerHTML = tableContent;
            }

            // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
            const paginationContainer = document.getElementById('overview-activity-pagination');
            if (paginationContainer && totalPages > 1) {
                paginationContainer.innerHTML = generateOverviewActivityPagination(totalPages);
                paginationContainer.style.display = 'block';
            } else if (paginationContainer) {
                paginationContainer.style.display = 'none';
            }
           
            // í†µê³„ ì—…ë°ì´íŠ¸
            const activeCount = activities.filter(a => a.type === 'active').length;
            const totalRequests = activities.reduce((sum, a) => sum + (typeof a.request === 'number' ? a.request : 0), 0);
           
            console.log(`ğŸ“Š Overview í™œë™ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸: ì´ ${activities.length}ëª…, í™œì„± ${activeCount}ëª…, ì´ ìš”ì²­ ${totalRequests}ê±´ (í˜ì´ì§€ ${currentActivityPage}/${totalPages})`);
        }



        // í•„í„° ê¸°ê°„ ì—…ë°ì´íŠ¸
        function updateFilterPeriod(startDate, endDate) {
            const start = new Date(startDate).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
            const end = new Date(endDate).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
           
            const dateFilterBtn = document.querySelector('.date-filter-btn');
            if (dateFilterBtn) {
                dateFilterBtn.textContent = `${start} - ${end}`;
            }
        }



        // ë©¤ë²„ í…Œì´ë¸”ì„ ì‹¤ì œ API ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
        async function updateMembersWithRealData() {
            try {
                console.log('=== ì‹¤ì œ Cursor Admin API ë°ì´í„°ë¡œ ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘ ===');
               
                // 1. ì‹¤ì œ íŒ€ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                console.log('1. íŒ€ì› ì •ë³´ API í˜¸ì¶œ ì¤‘...');
                const membersData = await getTeamMembers();
                console.log('íŒ€ì› ë°ì´í„° ì‘ë‹µ:', membersData);
               
                if (!membersData || !membersData.teamMembers) {
                    throw new Error('íŒ€ì› ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                console.log(`âœ… ì´ ${membersData.teamMembers.length}ëª…ì˜ íŒ€ì› ì •ë³´ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);

                // 2. ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì˜¬ë°”ë¥¸ API ì‚¬ìš©)
                console.log('2. íŒ€ ì§€ì¶œ ë°ì´í„° API í˜¸ì¶œ ì¤‘... (/teams/spend)');
                const spendingData = await getTeamSpendingData();
                console.log('ì§€ì¶œ ë°ì´í„° ì‘ë‹µ:', spendingData);
               
                if (!spendingData || !spendingData.teamMemberSpend) {
                    throw new Error('ì§€ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                console.log(`âœ… ${spendingData.teamMemberSpend.length}ëª…ì˜ ì§€ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
                console.log(`ğŸ“Š API ì‘ë‹µ ì •ë³´: ì´ ë©¤ë²„ ${spendingData.totalMembers || 'ì •ë³´ì—†ìŒ'}ëª…, ì´ í˜ì´ì§€ ${spendingData.totalPages || 'ì •ë³´ì—†ìŒ'}ê°œ`);
                
                // ì‹¤ì œë¡œ ê°€ì ¸ì˜¨ ë©¤ë²„ ìˆ˜ì™€ API ë©¤ë²„ ìˆ˜ ë¹„êµ ë¡œê¹…
                if (membersData.teamMembers.length !== spendingData.teamMemberSpend.length) {
                    console.log(`âš ï¸ ë©¤ë²„ ìˆ˜ ë¶ˆì¼ì¹˜: ë©¤ë²„ API ${membersData.teamMembers.length}ëª… vs ì§€ì¶œ API ${spendingData.teamMemberSpend.length}ëª…`);
                }

                // 3. ì´ë©”ì¼ ê¸°ì¤€ìœ¼ë¡œ ë©¤ë²„ì™€ ì§€ì¶œ ë°ì´í„° ë§¤í•‘
                console.log('3. ë©¤ë²„ì™€ ì§€ì¶œ ë°ì´í„° ë§¤í•‘ ì¤‘...');
                const memberSpendMap = {};
               
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100, // centsë¥¼ dollarsë¡œ ë³€í™˜
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });

                console.log('ì§€ì¶œ ë°ì´í„° ë§¤í•‘ ê²°ê³¼:', memberSpendMap);

                // 4. Fast Requests ë¦¬ì…‹ ë‚ ì§œ í‘œì‹œ
                console.log('4. Fast Requests ë¦¬ì…‹ ë‚ ì§œ í‘œì‹œ ì¤‘...');
                updateFastRequestsResetDate(spendingData.teamMemberSpend);
                
                // 5. ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                console.log('5. ë©¤ë²„ í…Œì´ë¸” UI ì—…ë°ì´íŠ¸ ì¤‘...');
                updateMembersTable(membersData.teamMembers, memberSpendMap);
               
                console.log('=== ì‹¤ì œ API ë°ì´í„°ë¡œ ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ! ===');
               
            } catch (error) {
                console.error('âŒ ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                
                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert(`ì‹¤ì œ API ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:\n${error.message}\n\ní”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.`);
            }
        }

        // Fast Requests ë¦¬ì…‹ ë‚ ì§œ í‘œì‹œ
        function updateFastRequestsResetDate(teamMemberSpend) {
            try {
                // Premium Requestsê°€ 0ì¸ ë©¤ë²„ë“¤ì„ ì°¾ì•„ì„œ ë¦¬ì…‹ ë‚ ì§œ ê³„ì‚°
                const zeroRequestMembers = teamMemberSpend.filter(member => 
                    member.fastPremiumRequests === 0
                );
                
                // ì‹¤ì œë¡œëŠ” APIì—ì„œ ì œê³µí•˜ëŠ” ë¦¬ì…‹ ë‚ ì§œ ì •ë³´ê°€ í•„ìš”í•˜ì§€ë§Œ,
                // í˜„ì¬ë¡œì„œëŠ” ê³ ì •ëœ ë‚ ì§œë¥¼ ì‚¬ìš©
                const resetDate = '2025ë…„ 7ì›” 22ì¼';
                
                const resetDateElement = document.getElementById('fast-requests-reset-date');
                if (resetDateElement) {
                    resetDateElement.textContent = resetDate;
                }
                
                // í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œ ì—…ë°ì´íŠ¸
                updateTodayDate();
                
                console.log(`ğŸ“… Fast Requests ë¦¬ì…‹ ë‚ ì§œ: ${resetDate} (Premium Requests 0ì¸ ë©¤ë²„: ${zeroRequestMembers.length}ëª…)`);
            } catch (error) {
                console.error('âŒ Fast Requests ë¦¬ì…‹ ë‚ ì§œ ê³„ì‚° ì˜¤ë¥˜:', error);
                const resetDateElement = document.getElementById('fast-requests-reset-date');
                if (resetDateElement) {
                    resetDateElement.textContent = '2025ë…„ 7ì›” 22ì¼';
                }
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì˜¤ëŠ˜ ë‚ ì§œëŠ” ì—…ë°ì´íŠ¸
                updateTodayDate();
            }
        }

        // í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œ ì—…ë°ì´íŠ¸
        function updateTodayDate() {
            try {
                // í•œêµ­ ì‹œê°„ ê¸°ì¤€ (UTC+9)
                const now = new Date();
                const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
                const todayDate = koreaTime.toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹
                
                const todayDateElement = document.getElementById('today-date');
                if (todayDateElement) {
                    todayDateElement.textContent = todayDate;
                    todayDateElement.style.color = '#ff9800'; // ì˜¤ë Œì§€ìƒ‰
                }
                
                console.log(`ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ (í•œêµ­ ì‹œê°„): ${todayDate}`);
            } catch (error) {
                console.error('âŒ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚° ì˜¤ë¥˜:', error);
                const todayDateElement = document.getElementById('today-date');
                if (todayDateElement) {
                    todayDateElement.textContent = '2025-08-03';
                    todayDateElement.style.color = '#ff9800'; // ì˜¤ë Œì§€ìƒ‰
                }
            }
        }

        // Export CSV ê¸°ëŠ¥ (Members ì„¹ì…˜ í•„ë“œ ê¸°ì¤€, BOM/êµ¬ë¶„ì/ê°œí–‰ ë°˜ì˜)
        function exportMembersToCSV(filenameOverride) {
            try {
                if (!currentMembersData || currentMembersData.length === 0) {
                    alert('ë‚´ë³´ë‚¼ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ì˜µì…˜ ë°˜ì˜
                const delimiter = (document.getElementById('csv-delimiter')?.value) || ',';
                const includeHeader = (document.getElementById('csv-include-header')?.value || 'yes') === 'yes';
                const newline = (document.getElementById('csv-newline')?.value || 'CRLF') === 'CRLF' ? '\r\n' : '\n';
                const encoding = (document.getElementById('csv-encoding')?.value || 'utf8-bom');

                // CSV í—¤ë” (Members ì„¹ì…˜ ê¸°ì¤€ ì»¬ëŸ¼)
                const headers = ['Name', 'Email', 'Role', 'Premium Requests', 'Spend ($)'];

                // í•„ë“œ ì•ˆì „ ì¸ìš©
                const quote = (val) => {
                    const s = (val ?? '').toString();
                    const needsQuote = s.includes('"') || s.includes(delimiter) || s.includes('\n') || s.includes('\r');
                    const escaped = s.replace(/"/g, '""');
                    return needsQuote ? `"${escaped}"` : escaped;
                };

                // CSV ë°ì´í„° ìƒì„±
                const csvRows = [];
                if (includeHeader) csvRows.push(headers.map(quote).join(delimiter));
                for (const member of currentMembersData) {
                    const row = [
                        member.name || '',
                        member.email || '',
                        member.role || '',
                        member.spendData?.premiumRequests ?? 0,
                        (member.spendData?.spend ?? 0).toFixed(2)
                    ];
                    csvRows.push(row.map(quote).join(delimiter));
                }

                const content = csvRows.join(newline);
                const bom = encoding === 'utf8-bom' ? '\uFEFF' : '';
                const blob = new Blob([bom + content], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                const filename = filenameOverride || `members_export_${new Date().toISOString().split('T')[0]}.csv`;
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                console.log(`ğŸ“Š CSV ë‚´ë³´ë‚´ê¸° ì™„ë£Œ: ${currentMembersData.length}ëª…ì˜ ë©¤ë²„ ë°ì´í„°`);
                return filename;
            } catch (error) {
                console.error('âŒ CSV ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', error);
                alert('CSV ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Excel(HTML í…Œì´ë¸” ê¸°ë°˜ .xls) Export (Members ì„¹ì…˜ í•„ë“œ ê¸°ì¤€)
        function exportMembersToExcelHTML(filenameOverride) {
            const sanitize = (s) => (s ?? '').toString()
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\"/g, '&quot;')
                .replace(/'/g, '&#39;');

            const rows = currentMembersData.map(member => `
                <tr>
                    <td>${sanitize(member.name || '')}</td>
                    <td>${sanitize(member.email || '')}</td>
                    <td>${sanitize(member.role || '')}</td>
                    <td>${sanitize(member.spendData?.premiumRequests ?? 0)}</td>
                    <td>${sanitize((member.spendData?.spend ?? 0).toFixed(2))}</td>
                </tr>`).join('');

            const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"></head><body>
                <table border="1">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Premium Requests</th>
                            <th>Spend ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rows}
                    </tbody>
                </table>
            </body></html>`;

            const blob = new Blob(['\uFEFF' + html], { type: 'application/vnd.ms-excel;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.href = url;
            const filename = filenameOverride || `members_export_${new Date().toISOString().split('T')[0]}.xls`;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            return filename;
        }

        // JSON Export (Members ì„¹ì…˜ í•„ë“œ ê¸°ì¤€)
        function exportMembersToJSON(filename) {
            try {
                const structure = (document.getElementById('json-structure')?.value || 'ndjson');
                const indentVal = document.getElementById('json-indent')?.value || '2';
                const indent = indentVal === 'minify' ? 0 : parseInt(indentVal, 10);

                const rows = currentMembersData.map(m => ({
                    name: m.name || '',
                    email: m.email || '',
                    role: m.role || '',
                    premiumRequests: m.spendData?.premiumRequests ?? 0,
                    spend: Number((m.spendData?.spend ?? 0).toFixed(2))
                }));

                let payload = '';
                if (structure === 'ndjson') {
                    payload = rows.map(r => JSON.stringify(r)).join('\n');
                } else {
                    payload = JSON.stringify(rows, null, indent);
                }

                const blob = new Blob([payload], { type: 'application/json;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.href = url;
                link.download = filename || `members_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (e) {
                console.error('JSON Export ì‹¤íŒ¨:', e);
                showSimpleAlert('âŒ JSON ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // PDF Export (Members ì„¹ì…˜ í•„ë“œ ê¸°ì¤€, ì›í´ë¦­ ì €ì¥ - html2pdf.js ì‚¬ìš©)
        function exportMembersToPDF(filename) {
            try {
                if (!window.html2pdf) {
                    console.warn('html2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•„ XLSë¡œ ëŒ€ì²´ ì €ì¥í•©ë‹ˆë‹¤.');
                    exportMembersToExcelHTML(filename?.replace(/\.pdf$/, '.xls'));
                    return;
                }

                const page = (document.getElementById('pdf-page')?.value || 'A4-portrait');
                const headerFooter = (document.getElementById('pdf-header-footer')?.value || 'yes') === 'yes';
                const [size, orientation] = page.split('-');

                const container = document.createElement('div');
                container.style.background = '#ffffff';
                container.style.color = '#000000';
                container.style.width = '794px';
                container.style.padding = '16px';
                container.style.fontFamily = "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";

                const title = headerFooter ? `<div style="text-align:center; margin-bottom:10px; font-weight:600;">Members Export - ${new Date().toLocaleDateString('ko-KR')}</div>` : '';
                const rows = currentMembersData.map(m => `
                    <tr>
                        <td style="padding:6px 8px; border: 1px solid #999;">${m.name || ''}</td>
                        <td style="padding:6px 8px; border: 1px solid #999;">${m.email || ''}</td>
                        <td style="padding:6px 8px; border: 1px solid #999;">${m.role || ''}</td>
                        <td style="padding:6px 8px; border: 1px solid #999; text-align:right;">${m.spendData?.premiumRequests ?? 0}</td>
                        <td style="padding:6px 8px; border: 1px solid #999; text-align:right;">${(m.spendData?.spend ?? 0).toFixed(2)}</td>
                    </tr>`).join('');

                container.innerHTML = `
                    ${title}
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th style="padding:6px 8px; border: 1px solid #999; background:#eee;">Name</th>
                                <th style="padding:6px 8px; border: 1px solid #999; background:#eee;">Email</th>
                                <th style="padding:6px 8px; border: 1px solid #999; background:#eee;">Role</th>
                                <th style="padding:6px 8px; border: 1px solid #999; background:#eee;">Premium Requests</th>
                                <th style="padding:6px 8px; border: 1px solid #999; background:#eee;">Spend ($)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rows}
                        </tbody>
                    </table>`;

                const opt = {
                    margin:       10,
                    filename:     filename || `members_export_${new Date().toISOString().split('T')[0]}.pdf`,
                    image:        { type: 'jpeg', quality: 0.98 },
                    html2canvas:  { scale: 2, useCORS: true },
                    jsPDF:        { unit: 'pt', format: size.toLowerCase(), orientation: (orientation === 'landscape' ? 'landscape' : 'portrait') },
                    pagebreak:    { mode: ['avoid-all','css','legacy'] }
                };

                window.html2pdf().set(opt).from(container).save();
            } catch (e) {
                console.error('PDF Export ì‹¤íŒ¨:', e);
                showSimpleAlert('âŒ PDF ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë‹¤ìš´ë¡œë“œ ìœ„ì¹˜ íŒíŠ¸ ìƒì„±
        function getDownloadLocationHint(filename) {
            const ua = navigator.userAgent || '';
            if (/Windows/i.test(ua)) {
                return `C:\\Users\\(ì‚¬ìš©ìëª…)\\Downloads\\${filename}`;
            } else if (/Macintosh|Mac OS X/i.test(ua)) {
                return `~/Downloads/${filename}`;
            } else if (/Linux/i.test(ua)) {
                return `~/Downloads/${filename}`;
            }
            return `ë¸Œë¼ìš°ì € ê¸°ë³¸ ë‹¤ìš´ë¡œë“œ í´ë” (${filename})`;
        }

        // ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©)
        function updateMembersTable(members, memberSpendMap) {
            console.log(`ğŸ”„ ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘: ${members.length}ëª…ì˜ ë©¤ë²„ ë°ì´í„°`);
            console.log('ğŸ“Š ì§€ì¶œ ë°ì´í„° ë§¤í•‘ ì •ë³´:', Object.keys(memberSpendMap));
           
            // ë©¤ë²„ ì •ë³´ì™€ ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ê²°í•©
            const membersWithSpending = members.map(member => {
                const spendData = memberSpendMap[member.email] || {
                    premiumRequests: 0,
                    spend: 0,
                    hardLimitOverride: 0
                };
               
                return {
                    ...member,
                    spendData: spendData
                };
            });
           
            console.log(`ğŸ“‹ ì²˜ë¦¬ëœ ë©¤ë²„ ë°ì´í„°: ${membersWithSpending.length}ëª…`);
           
            // Premium Requests ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ë†’ì€ ìˆœ)
            membersWithSpending.sort((a, b) => b.spendData.premiumRequests - a.spendData.premiumRequests);
           
            // ì „ì—­ ë°ì´í„° ì €ì¥
            currentMembersData = membersWithSpending;
            originalMembersData = [...membersWithSpending]; // ì›ë³¸ ë°ì´í„° ë³´ì¡´
            currentMembersPage = 1; // í˜ì´ì§€ ë¦¬ì…‹
            
            // í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë Œë”ë§
            renderMembersTableWithPagination(membersWithSpending);
        }
        
        // Members í…Œì´ë¸” í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë Œë”ë§ (All Raw Events ìŠ¤íƒ€ì¼)
        function renderMembersTableWithPagination(membersWithSpending) {
            const tableContainer = document.querySelector('#members-table-container');
            if (!tableContainer) {
                console.error('âŒ ë©¤ë²„ í…Œì´ë¸” ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            const totalMembers = membersWithSpending.length;
            const totalPages = Math.ceil(totalMembers / currentMembersPageSize);
            const startIndex = (currentMembersPage - 1) * currentMembersPageSize;
            const endIndex = Math.min(startIndex + currentMembersPageSize, totalMembers);
            const pageMembers = membersWithSpending.slice(startIndex, endIndex);
            
            console.log(`ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${totalMembers} (í˜ì´ì§€ ${currentMembersPage}/${totalPages})`);
           
            // í…Œì´ë¸” ì œëª© ë™ì  ìƒì„±
            const getTableTitle = () => {
                if (currentFilterType === 'active') {
                    return `ğŸ‘¥ í™œì„± ë©¤ë²„ ë³´ê¸° (${startIndex + 1}-${endIndex} of ${totalMembers})`;
                } else if (currentFilterType === 'inactive') {
                    return `ğŸ‘¥ ë¹„í™œì„± ë©¤ë²„ ë³´ê¸° (${startIndex + 1}-${endIndex} of ${totalMembers})`;
                } else {
                    return `ğŸ‘¥ ì „ì²´ ë©¤ë²„ ë³´ê¸° (${startIndex + 1}-${endIndex} of ${totalMembers})`;
                }
            };

            // í…Œì´ë¸” HTML ìƒì„± (All Raw Events ìŠ¤íƒ€ì¼)
            const tableHtml = `
                <div class="user-cumulative-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${getTableTitle()}</span>
                    <select id="membersPageSize" onchange="changeMembersPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                        <option value="10" ${currentMembersPageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                        <option value="20" ${currentMembersPageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                        <option value="30" ${currentMembersPageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                        <option value="50" ${currentMembersPageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                        <option value="100" ${currentMembersPageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                    </select>
                </div>
                <div class="table-header">
                    <div onclick="sortMembers('name')" style="cursor: pointer;">NAME â†•</div>
                    <div onclick="sortMembers('email')" style="cursor: pointer;">EMAIL â†•</div>
                    <div onclick="sortMembers('requests')" style="cursor: pointer;">PREMIUM REQUESTS â†•</div>
                    <div onclick="sortMembers('spend')" style="cursor: pointer;">SPEND â†•</div>
                    <div onclick="sortMembers('role')" style="cursor: pointer;">ROLE â†•</div>
                    <div></div>
                </div>
                ${pageMembers.length > 0 ? pageMembers.map(member => {
                const roleBadgeClass = member.role === 'owner' ? 'admin' : '';
                const roleText = member.role === 'owner' ? 'Admin' : 'Member';
                const requestColor = member.spendData.premiumRequests > 100 ? '#4caf50' :
                                   member.spendData.premiumRequests > 20 ? '#ff9800' :
                                   member.spendData.premiumRequests > 0 ? '#2196f3' : '#f44336';
               
                    return `
                        <div class="table-row">
                    <div>${member.name || 'Unnamed'}</div>
                    <div class="clickable-email" title="View usage for ${member.email}" onclick="navigateToUsageWithEmail('${member.email}')">${member.email}</div>
                    <div style="color: ${requestColor}; font-weight: 600;">${member.spendData.premiumRequests}</div>
                    <div>$${member.spendData.spend.toFixed(2)}</div>
                    <div><span class="role-badge ${roleBadgeClass}">${roleText}</span></div>
                    <div>â‹¯</div>
                        </div>
                    `;
                }).join('') : '<div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a; grid-column: 1 / -1;">ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
            `;
            
            tableContainer.innerHTML = tableHtml;
            
            // í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            const paginationContainer = document.getElementById('members-pagination');
            if (paginationContainer) {
                if (totalMembers > currentMembersPageSize) {
                    paginationContainer.style.display = 'block';
                    paginationContainer.innerHTML = generateMembersPagination(totalPages);
                } else {
                    paginationContainer.style.display = 'none';
                }
            }
            
            console.log(`âœ… Members í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ: í˜ì´ì§€ ${currentMembersPage}/${totalPages}, ${pageMembers.length}ê°œ ë©¤ë²„ í‘œì‹œ`);
           
            // í†µê³„ ì •ë³´ í‘œì‹œ
            const totalRequests = membersWithSpending.reduce((sum, member) => sum + member.spendData.premiumRequests, 0);
            const totalSpend = membersWithSpending.reduce((sum, member) => sum + member.spendData.spend, 0);
            const activeMembers = membersWithSpending.filter(member => member.spendData.premiumRequests > 0).length;
           
            console.log(`ğŸ“Š ë©¤ë²„ í†µê³„ (ì‹¤ì œ API ë°ì´í„°):`);
            console.log(`   - ì´ ë©¤ë²„: ${membersWithSpending.length}ëª…`);
            console.log(`   - í™œì„± ë©¤ë²„: ${activeMembers}ëª… (Premium Requests > 0)`);
            console.log(`   - ì´ Premium Requests: ${totalRequests}ê±´`);
            console.log(`   - ì´ ì§€ì¶œ: $${totalSpend.toFixed(2)}`);
        }
        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (All Raw Events ìŠ¤íƒ€ì¼)
        function generateUserCumulativePagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentUserCumulativePage > 1) {
                pagination += `<button onclick="changeUserCumulativePage(${currentUserCumulativePage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentUserCumulativePage - 2);
            let endPage = Math.min(totalPages, currentUserCumulativePage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeUserCumulativePage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentUserCumulativePage;
                pagination += `<button onclick="changeUserCumulativePage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'}; margin: 0 2px;">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeUserCumulativePage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentUserCumulativePage < totalPages) {
                pagination += `<button onclick="changeUserCumulativePage(${currentUserCumulativePage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (Membersì™€ ë™ì¼)
        function generateOverviewActivityPagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentActivityPage > 1) {
                pagination += `<button onclick="changeOverviewActivityPage(${currentActivityPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentActivityPage - 2);
            let endPage = Math.min(totalPages, currentActivityPage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeOverviewActivityPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentActivityPage;
                pagination += `<button onclick="changeOverviewActivityPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'}; margin: 0 2px;">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeOverviewActivityPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentActivityPage < totalPages) {
                pagination += `<button onclick="changeOverviewActivityPage(${currentActivityPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ ë³€ê²½
        function changeOverviewActivityPage(page) {
            currentActivityPage = page;
            renderOverviewActivityTableWithPagination(currentActivityData);
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeOverviewActivityPageSize(pageSize) {
            currentActivityPageSize = parseInt(pageSize);
            currentActivityPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderOverviewActivityTableWithPagination(currentActivityData);
        }

        // Members í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (All Raw Eventsì™€ ë™ì¼)
        function generateMembersPagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentMembersPage > 1) {
                pagination += `<button onclick="changeMembersPage(${currentMembersPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentMembersPage - 2);
            let endPage = Math.min(totalPages, currentMembersPage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeMembersPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentMembersPage;
                pagination += `<button onclick="changeMembersPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'}; margin: 0 2px;">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeMembersPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentMembersPage < totalPages) {
                pagination += `<button onclick="changeMembersPage(${currentMembersPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Members í˜ì´ì§€ ë³€ê²½
        function changeMembersPage(page) {
            currentMembersPage = page;
            renderMembersTableWithPagination(currentMembersData);
        }

        // Members í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeMembersPageSize(pageSize) {
            currentMembersPageSize = parseInt(pageSize);
            currentMembersPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderMembersTableWithPagination(currentMembersData);
        }

        // ê²€ìƒ‰ì°½ X ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function toggleSearchClearBtn(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            
            if (searchInput && clearBtn) {
                if (searchInput.value.length > 0) {
                    clearBtn.style.display = 'flex';
                } else {
                    clearBtn.style.display = 'none';
                }
            }
        }

        // ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
        function clearSearch(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = '';
                clearBtn.style.display = 'none';
                
                // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
                if (autocomplete) {
                    autocomplete.style.display = 'none';
                }
                
                // ê²€ìƒ‰ í•„í„° ì´ˆê¸°í™”
                if (searchId === 'members-search') {
                    filterMembers('');
                } else if (searchId === 'usage-search') {
                    filterUsageMembers('');
                } else if (searchId === 'user-performance-search') {
                    filterUserPerformance('');
                }
            }
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
        function clearUserPerformanceSearch(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = '';
                clearBtn.style.display = 'none';
                
                // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
                if (autocomplete) {
                    autocomplete.style.display = 'none';
                }
                
                // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ì¬ìƒì„± (ì „ì²´ ì‚¬ìš©ì)
                filterUserPerformance('');
            }
        }

        // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function showAutocomplete(searchId) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (!searchInput || !autocomplete) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            // ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            let users = [];
            if (searchId === 'members-search') {
                users = getMembersUsers();
            } else if (searchId === 'usage-search') {
                users = getUsageUsers();
            }
            
            // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ì‚¬ìš©ì í‘œì‹œ, ìˆìœ¼ë©´ í•„í„°ë§
            let filteredUsers = users;
            if (searchTerm.length > 0) {
                filteredUsers = users.filter(user => 
                    user.name.toLowerCase().includes(searchTerm) || 
                    user.email.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredUsers.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            // ë“œë¡­ë‹¤ìš´ HTML ìƒì„±
            const dropdownHTML = filteredUsers.map(user => `
                <div class="autocomplete-item" onclick="selectUser('${searchId}', '${user.email}')">
                    <div class="user-name">${user.name}</div>
                    <div class="user-email">${user.email}</div>
                </div>
            `).join('');
            
            autocomplete.innerHTML = dropdownHTML;
            autocomplete.style.display = 'block';
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function showUserPerformanceAutocomplete(searchId) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (!searchInput || !autocomplete) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            // ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const users = getUserPerformanceUsers();
            
            // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ì‚¬ìš©ì í‘œì‹œ, ìˆìœ¼ë©´ í•„í„°ë§
            let filteredUsers = users;
            if (searchTerm.length > 0) {
                filteredUsers = users.filter(user => 
                    user.name.toLowerCase().includes(searchTerm) || 
                    user.email.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredUsers.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            // ë“œë¡­ë‹¤ìš´ HTML ìƒì„±
            const dropdownHTML = filteredUsers.map(user => `
                <div class="autocomplete-item" onclick="selectUserPerformanceUser('${searchId}', '${user.email}')">
                    <div class="user-name">${user.name}</div>
                    <div class="user-email">${user.email}</div>
                </div>
            `).join('');
            
            autocomplete.innerHTML = dropdownHTML;
            autocomplete.style.display = 'block';
        }

        // ì°¨íŠ¸ ê²€ìƒ‰ì°½ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function showChartAutocomplete(searchId) {
            const searchInput = document.getElementById(searchId);
            
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            const chartSelect = document.getElementById('chartSelect');
            const currentChartType = chartSelect ? chartSelect.value : 'activity-trend';
            
            // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            if (currentChartType === 'user-performance') {
                // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ì˜ ê²½ìš° ì „ì²´ ì‚¬ìš©ì í‘œì‹œ
                const users = getUserPerformanceUsers();
                
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ì‚¬ìš©ì í‘œì‹œ, ìˆìœ¼ë©´ í•„í„°ë§
                let filteredUsers = users;
                if (searchTerm.length > 0) {
                    filteredUsers = users.filter(user => 
                        user.name.toLowerCase().includes(searchTerm) || 
                        user.email.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (filteredUsers.length === 0) {
                    return;
                }
                
                // ë“œë¡­ë‹¤ìš´ HTML ìƒì„± (ìµœëŒ€ 20ê°œ)
                const dropdownHTML = filteredUsers.slice(0, 20).map(user => `
                    <div class="autocomplete-item" onclick="selectChartUser('${searchId}', '${user.email}')">
                        <div class="user-name">${user.name}</div>
                        <div class="user-email">${user.email}</div>
                    </div>
                `).join('');
                
                // ê¸°ì¡´ ë“œë¡­ë‹¤ìš´ ì œê±° í›„ ìƒˆë¡œ ìƒì„±
                const existingDropdown = document.getElementById('chart-autocomplete-dropdown');
                if (existingDropdown) {
                    existingDropdown.remove();
                }
                
                const dropdown = document.createElement('div');
                dropdown.id = 'chart-autocomplete-dropdown';
                dropdown.className = 'autocomplete-dropdown';
                dropdown.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background-color: #2a2a2a;
                    border: 1px solid #3a3a3a;
                    border-radius: 6px;
                    max-height: 200px;
                    overflow-y: auto;
                    z-index: 1000;
                    margin-top: 2px;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
                `;
                dropdown.innerHTML = dropdownHTML;
                
                // ê²€ìƒ‰ì°½ ì»¨í…Œì´ë„ˆì— ë“œë¡­ë‹¤ìš´ ì¶”ê°€
                const inputContainer = searchInput.parentElement;
                inputContainer.style.position = 'relative';
                inputContainer.appendChild(dropdown);
                
                dropdown.style.display = 'block';
            }
        }

        // ì°¨íŠ¸ ê²€ìƒ‰ì°½ ì‚¬ìš©ì ì„ íƒ
        function selectChartUser(searchId, userEmail) {
            const searchInput = document.getElementById(searchId);
            const dropdown = document.getElementById('chart-autocomplete-dropdown');
            
            if (searchInput) {
                searchInput.value = userEmail;
                
                // ì°¨íŠ¸ ê²€ìƒ‰ ì‹¤í–‰
                handleChartSearch(userEmail);
                
                // X ë²„íŠ¼ í‘œì‹œ
                toggleSearchClearBtn(searchId);
            }
            
            // ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }

        // ì‚¬ìš©ì ì„ íƒ
        function selectUser(searchId, userEmail) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = userEmail;
                
                // ê²€ìƒ‰ ì‹¤í–‰
                if (searchId === 'members-search') {
                    filterMembers(userEmail);
                } else if (searchId === 'usage-search') {
                    filterUsageMembers(userEmail);
                }
                
                // X ë²„íŠ¼ í‘œì‹œ
                toggleSearchClearBtn(searchId);
            }
            
            // ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
            if (autocomplete) {
                autocomplete.style.display = 'none';
            }
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ì‚¬ìš©ì ì„ íƒ
        function selectUserPerformanceUser(searchId, userEmail) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = userEmail;
                
                // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ í•„í„°ë§
                filterUserPerformance(userEmail);
                
                // X ë²„íŠ¼ í‘œì‹œ
                toggleSearchClearBtn(searchId);
            }
            
            // ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
            if (autocomplete) {
                autocomplete.style.display = 'none';
            }
        }

        // Members ì„¹ì…˜ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getMembersUsers() {
            if (!currentMembersData || currentMembersData.length === 0) {
                return [];
            }
            
            return currentMembersData.map(member => ({
                name: member.name || 'Unnamed',
                email: member.email
            }));
        }

        // Usage ì„¹ì…˜ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getUsageUsers() {
            if (!currentUserCumulativeData || currentUserCumulativeData.length === 0) {
                return [];
            }
            
            return currentUserCumulativeData.map(user => ({
                name: user.name || 'Unnamed',
                email: user.email
            }));
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getUserPerformanceUsers() {
            const members = currentMembersData || [];
            const rawEvents = currentRawEventsData || [];
            
            if (members.length === 0 || rawEvents.length === 0) {
                return [];
            }
            
            // ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„±
            const userPerformance = [];
            const userMap = new Map();
            
            // ë©¤ë²„ ì •ë³´ë¡œ ì´ˆê¸°í™”
            members.forEach(member => {
                userMap.set(member.email, {
                    name: member.name || 'Unnamed',
                    email: member.email,
                    requests: 0,
                    costs: 0,
                    activeDays: 0
                });
            });
            
            // ì´ë²¤íŠ¸ ë°ì´í„°ë¡œ ì„±ê³¼ ê³„ì‚°
            rawEvents.forEach(event => {
                const userEmail = event.email;
                const user = userMap.get(userEmail);
                
                if (user) {
                    user.requests += event.requests || 0;
                    user.costs += event.requestsCosts || 0;
                    
                    // í™œë™ ì¼ìˆ˜ ê³„ì‚° (ë‚ ì§œë³„ë¡œ í•œ ë²ˆë§Œ ì¹´ìš´íŠ¸)
                    const eventDate = new Date(parseInt(event.timestamp)).toDateString();
                    if (!user.activeDaysSet) {
                        user.activeDaysSet = new Set();
                    }
                    user.activeDaysSet.add(eventDate);
                }
            });
            
            // Setì„ ê°œìˆ˜ë¡œ ë³€í™˜
            userMap.forEach(user => {
                user.activeDays = user.activeDaysSet ? user.activeDaysSet.size : 0;
                delete user.activeDaysSet;
                userPerformance.push(user);
            });
            
            return userPerformance;
        }

        // ë©¤ë²„ ê²€ìƒ‰ ê¸°ëŠ¥
        function filterMembers(searchTerm) {
            const rows = document.querySelectorAll('#members .table-row');
            const searchLower = searchTerm.toLowerCase();
           
            rows.forEach(row => {
                const name = row.children[0].textContent.toLowerCase();
                const email = row.children[1].textContent.toLowerCase();
               
                if (name.includes(searchLower) || email.includes(searchLower)) {
                    row.style.display = 'grid';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ í•„í„°ë§
        function filterUserPerformance(searchTerm) {
            console.log(`ğŸ” ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ í•„í„°ë§: "${searchTerm}"`);
            
            const searchLower = searchTerm.toLowerCase().trim();
            
            // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì „ì²´ ì‚¬ìš©ì ì„±ê³¼ ì°¨íŠ¸ í‘œì‹œ
            if (searchLower === '') {
                createUserPerformanceChart();
                return;
            }
            
            // íŠ¹ì • ì‚¬ìš©ìì— ëŒ€í•œ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±
            createFilteredUserPerformanceChart(searchLower);
        }

        // ì°¨íŠ¸ ë°ì´í„° í•„í„°ë§ (ì¼ë°˜ì ì¸ ì°¨íŠ¸ ê²€ìƒ‰)
        function filterChartData(searchTerm) {
            console.log(`ğŸ” ì°¨íŠ¸ ë°ì´í„° í•„í„°ë§: "${searchTerm}"`);
            
            const searchLower = searchTerm.toLowerCase().trim();
            const chartSelect = document.getElementById('chartSelect');
            const currentChartType = chartSelect ? chartSelect.value : 'activity-trend';
            
            // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ í˜„ì¬ ì°¨íŠ¸ ì¬ìƒì„±
            if (searchLower === '') {
                switchChart(currentChartType).catch(error => {
                    console.error('ì°¨íŠ¸ ì¬ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                });
                return;
            }
            
            // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ í•„í„°ë§ ì ìš©
            switch (currentChartType) {
                case 'user-performance':
                    filterUserPerformance(searchTerm);
                    break;
                case 'user-heatmap':
                    // ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ í•„í„°ë§
                    createFilteredUserHeatmapChart(searchTerm);
                    break;
                case 'model-preference':
                    // ëª¨ë¸ ì„ í˜¸ë„ í•„í„°ë§
                    createFilteredModelPreferenceChart(searchTerm);
                    break;
                default:
                    // ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì°¨íŠ¸ ì¬ìƒì„±
                    switchChart(currentChartType).catch(error => {
                        console.error('ì°¨íŠ¸ ì¬ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                    });
                    break;
            }
        }

        // ì°¨íŠ¸ ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
        function clearChartSearch(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            
            if (searchInput) {
                searchInput.value = '';
                clearBtn.style.display = 'none';
                
                // í˜„ì¬ ì°¨íŠ¸ íƒ€ì… í™•ì¸
                const chartSelect = document.getElementById('chartSelect');
                const currentChartType = chartSelect ? chartSelect.value : 'activity-trend';
                
                // ê²€ìƒ‰ì°½ì´ ìˆëŠ” ì°¨íŠ¸ë“¤ì˜ ê²½ìš° ì¦‰ì‹œ ê¸°ë³¸ ì°¨íŠ¸ë¡œ ì „í™˜
                if (currentChartType === 'user-heatmap') {
                    console.log('ğŸ”¥ ê²€ìƒ‰ì°½ í´ë¦¬ì–´ - ìƒìœ„ 20ëª… íˆíŠ¸ë§µìœ¼ë¡œ ì „í™˜');
                    createUserHeatmapChart();
                } else if (currentChartType === 'model-preference') {
                    console.log('ğŸ”¥ ê²€ìƒ‰ì°½ í´ë¦¬ì–´ - ìƒìœ„ 20ëª… ëª¨ë¸ ì„ í˜¸ë„ë¡œ ì „í™˜');
                    createModelPreferenceChart();
                } else {
                    // ë‹¤ë¥¸ ì°¨íŠ¸ëŠ” ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ì¬ìƒì„±
                    switchChart(currentChartType).catch(error => {
                        console.error('ì°¨íŠ¸ ì¬ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                    });
                }
            }
        }

        // ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬ (íˆíŠ¸ë§µ ë° ëª¨ë¸ ì„ í˜¸ë„)
        function handleChartSearch(searchTerm) {
            console.log('ğŸ” ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬:', searchTerm);
            
            const chartSelect = document.getElementById('chartSelect');
            if (!chartSelect) return;
            
            const selectedChart = chartSelect.value;
            
            // íˆíŠ¸ë§µ ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬
            if (selectedChart === 'user-heatmap') {
                if (searchTerm.trim() === '') {
                    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ ê¸°ë³¸ íˆíŠ¸ë§µ í‘œì‹œ (ìƒìœ„ 20ëª…)
                    createUserHeatmapChart();
                } else {
                    // ê²€ìƒ‰ì–´ë¡œ ì‚¬ìš©ì í•„í„°ë§
                    const filteredUsers = getFilteredUsers(searchTerm);
                    
                    if (filteredUsers.length === 1) {
                        // ì •í™•íˆ 1ëª…ì´ë©´ ìš”ì¼ë³„ ì°¨íŠ¸ í‘œì‹œ
                        createFilteredUserHeatmapChart(filteredUsers[0].email.split('@')[0]);
                    } else if (filteredUsers.length > 1) {
                        // ì—¬ëŸ¬ ëª…ì´ë©´ ìƒìœ„ 20ëª…ê¹Œì§€ ë§‰ëŒ€ ì°¨íŠ¸ í‘œì‹œ
                        createMultiUserHeatmapChart(filteredUsers.slice(0, 20));
                    } else {
                        // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
                        showNoSearchResults(searchTerm);
                    }
                }
            }
            // ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬
            else if (selectedChart === 'model-preference') {
                if (searchTerm.trim() === '') {
                    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ëª¨ë¸ ì„ í˜¸ë„ í‘œì‹œ (ìƒìœ„ 20ëª…)
                    createModelPreferenceChart();
                } else {
                    // ê²€ìƒ‰ì–´ë¡œ ì‚¬ìš©ì í•„í„°ë§
                    const filteredUsers = getFilteredUsers(searchTerm);
                    
                    if (filteredUsers.length === 1) {
                        // ì •í™•íˆ 1ëª…ì´ë©´ í•´ë‹¹ ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ í‘œì‹œ
                        createFilteredModelPreferenceChart(filteredUsers[0].email.split('@')[0]);
                    } else if (filteredUsers.length > 1) {
                        // ì—¬ëŸ¬ ëª…ì´ë©´ ìƒìœ„ 20ëª…ê¹Œì§€ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ í‘œì‹œ
                        createMultiUserModelPreferenceChart(filteredUsers.slice(0, 20));
                    } else {
                        // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
                        showNoSearchResults(searchTerm);
                    }
                }
            }
        }

        // ê²€ìƒ‰ì–´ë¡œ ì‚¬ìš©ì í•„í„°ë§ (ID ê¸°ë°˜)
        function getFilteredUsers(searchTerm) {
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            
            if (!members || members.length === 0) return [];
            
            // IDë¡œë§Œ ê²€ìƒ‰ (ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²½ìš°)
            const exactMatch = members.find(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase() === searchTerm.toLowerCase();
            });
            
            if (exactMatch) {
                return [exactMatch]; // ì •í™•íˆ 1ëª…ë§Œ ë°˜í™˜
            }
            
            // ë¶€ë¶„ ê²€ìƒ‰ (IDì— í¬í•¨ë˜ëŠ” ê²½ìš°)
            return members.filter(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase().includes(searchTerm.toLowerCase());
            });
        }

        // ì—¬ëŸ¬ ì‚¬ìš©ì íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ë¶€ë¶„ ê²€ìƒ‰ ê²°ê³¼)
        function createMultiUserHeatmapChart(filteredUsers) {
            console.log('ğŸ”¥ createMultiUserHeatmapChart ì‹œì‘:', filteredUsers.length, 'ëª…');
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ í™œë™ ë°ì´í„° ìƒì„±
            const heatmapData = generateFilteredHeatmapBarData(filteredUsers);
            
            if (heatmapData.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('í™œë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawHeatmapBarChart(ctx, width, height, heatmapData);
        }

        // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ íˆíŠ¸ë§µ ë°ì´í„° ìƒì„±
        function generateFilteredHeatmapBarData(filteredUsers) {
            console.log('ğŸ”¥ generateFilteredHeatmapBarData ì‹œì‘:', filteredUsers.length, 'ëª…');
            
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ìˆ˜ ê³„ì‚°
            const userActivityMap = new Map();
            filteredUsers.forEach((member, userIndex) => {
                const userEmail = member.email;
                const userName = member.name;
                const userId = userEmail.split('@')[0];
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                const totalActivity = userEvents.length;
                
                userActivityMap.set(userIndex, {
                    name: userName,
                    email: userEmail,
                    id: userId,
                    totalActivity: totalActivity
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬
            const sortedUsers = Array.from(userActivityMap.entries())
                .sort((a, b) => b[1].totalActivity - a[1].totalActivity);
            
            const data = sortedUsers.map(([userIndex, userData]) => ({
                userId: userData.id,
                userName: userData.name,
                email: userData.email,
                activity: userData.totalActivity
            }));
            
            console.log(`ğŸ”¥ í•„í„°ëœ íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ëª…`);
            return data;
        }

        // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ í‘œì‹œ
        function showNoSearchResults(searchTerm) {
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
        }

        // íˆíŠ¸ë§µìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
        function populateHeatmapEmailDropdown() {
            console.log('ğŸ“§ íˆíŠ¸ë§µìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„± ì¤‘...');
            
            const searchInput = document.getElementById('chart-search-input');
            if (!searchInput) {
                console.error('âŒ chart-search-input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê¸°ì¡´ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ì œê±°
            const existingDropdown = document.getElementById('custom-heatmap-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
            }
            
            // ìƒˆ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
            const dropdown = document.createElement('div');
            dropdown.id = 'custom-heatmap-dropdown';
            dropdown.style.cssText = `
                position: absolute;
                top: calc(100% + 4px);
                left: 0;
                right: 0;
                background-color: #2a2a2a;
                border: 1px solid #3a3a3a;
                border-radius: 8px;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                display: none;
            `;
            
            // ë©¤ë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì „ì²´ ë©¤ë²„ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë“œë¡­ë‹¤ìš´ ëª©ë¡ ìƒì„±
            const allMembers = [];
            members.forEach(member => {
                const emailId = member.email.split('@')[0];
                allMembers.push({
                    id: emailId,
                    name: member.name,
                    email: member.email
                });
            });
            
            console.log(`ğŸ“‹ ì „ì²´ ë©¤ë²„ ëª©ë¡ ìƒì„±: ${allMembers.length}ëª…`);
            
            // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì‹¤ì‹œê°„ í•„í„°ë§)
            function updateDropdownOptions(searchTerm = '') {
                dropdown.innerHTML = '';
                
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ë©¤ë²„ í‘œì‹œ (ìµœëŒ€ 50ê°œ)
                if (searchTerm.trim() === '') {
                    const displayMembers = allMembers.slice(0, 50);
                    displayMembers.forEach(member => {
                        const option = createDropdownOption(member, '');
                        dropdown.appendChild(option);
                    });
                    return;
                }
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•„í„°ë§ëœ ë©¤ë²„ë§Œ í‘œì‹œ
                const filteredMembers = allMembers.filter(member => 
                    member.id.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                if (filteredMembers.length === 0) {
                    const noResult = document.createElement('div');
                    noResult.style.cssText = `
                        padding: 12px;
                        color: #7a7a7a;
                        text-align: center;
                        font-size: 14px;
                    `;
                    noResult.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤';
                    dropdown.appendChild(noResult);
                    return;
                }
                
                // í•„í„°ë§ëœ ê²°ê³¼ëŠ” ìµœëŒ€ 30ê°œê¹Œì§€ í‘œì‹œ
                const displayMembers = filteredMembers.slice(0, 30);
                
                displayMembers.forEach(member => {
                    const option = createDropdownOption(member, searchTerm);
                    dropdown.appendChild(option);
                });
            }
            
            // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„± í•¨ìˆ˜
            function createDropdownOption(member, searchTerm) {
                const option = document.createElement('div');
                option.style.cssText = `
                    padding: 8px 12px;
                    cursor: pointer;
                    color: #e1e1e1;
                    border-bottom: 1px solid #3a3a3a;
                    transition: background-color 0.2s ease;
                `;
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•˜ì´ë¼ì´íŠ¸, ì—†ìœ¼ë©´ ì¼ë°˜ í‘œì‹œ
                let displayId = member.id;
                if (searchTerm && searchTerm.trim() !== '') {
                    displayId = member.id.replace(
                        new RegExp(searchTerm, 'gi'),
                        match => `<span style="background-color: #4a9eff; color: white; padding: 1px 2px; border-radius: 2px;">${match}</span>`
                    );
                }
                
                option.innerHTML = `
                    <div style="font-weight: 500; font-size: 14px;">${displayId}</div>
                    <div style="font-size: 12px; color: #7a7a7a;">${member.name} â€¢ ${member.email}</div>
                `;
                
                // í˜¸ë²„ íš¨ê³¼
                option.addEventListener('mouseenter', () => {
                    option.style.backgroundColor = '#3a3a3a';
                });
                option.addEventListener('mouseleave', () => {
                    option.style.backgroundColor = 'transparent';
                });
                
                // í´ë¦­ ì´ë²¤íŠ¸
                option.addEventListener('click', () => {
                    searchInput.value = member.id;
                    dropdown.style.display = 'none';
                    handleChartSearch(member.id);
                });
                
                return option;
            }
            
            // ê²€ìƒ‰ ì…ë ¥ ì»¨í…Œì´ë„ˆì— ë“œë¡­ë‹¤ìš´ ì¶”ê°€
            const inputContainer = searchInput.parentElement;
            inputContainer.style.position = 'relative';
            inputContainer.appendChild(dropdown);
            
            // ì…ë ¥ ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ í•„í„°ë§
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                if (dropdown.style.display !== 'none') {
                    updateDropdownOptions(searchTerm);
                }
            });
            
            // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            searchInput.addEventListener('focus', () => {
                updateDropdownOptions(searchInput.value);
                dropdown.style.display = 'block';
            });
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    dropdown.style.display = 'none';
                }
            });
            
            // ë¸”ëŸ¬ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            searchInput.addEventListener('blur', (e) => {
                setTimeout(() => {
                    if (!dropdown.contains(document.activeElement)) {
                        dropdown.style.display = 'none';
                    }
                }, 200);
            });
            
            console.log(`âœ… ì „ì²´ ë©¤ë²„ ëŒ€ìƒ ì‹¤ì‹œê°„ í•„í„°ë§ ë“œë¡­ë‹¤ìš´ ìƒì„± ì™„ë£Œ: ${allMembers.length}ëª…ì˜ ì‚¬ìš©ì`);
        }

        // ëª¨ë¸ ì„ í˜¸ë„ìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
        function populateModelPreferenceDropdown() {
            console.log('ğŸ“§ ëª¨ë¸ ì„ í˜¸ë„ìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„± ì¤‘...');
            
            const searchInput = document.getElementById('chart-search-input');
            if (!searchInput) {
                console.error('âŒ chart-search-input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê¸°ì¡´ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ì œê±°
            const existingDropdown = document.getElementById('custom-model-preference-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
            }
            
            // ìƒˆ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
            const dropdown = document.createElement('div');
            dropdown.id = 'custom-model-preference-dropdown';
            dropdown.style.cssText = `
                position: absolute;
                top: calc(100% + 4px);
                left: 0;
                right: 0;
                background-color: #2a2a2a;
                border: 1px solid #3a3a3a;
                border-radius: 8px;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                display: none;
            `;
            
            // ë©¤ë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì „ì²´ ë©¤ë²„ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë“œë¡­ë‹¤ìš´ ëª©ë¡ ìƒì„±
            const allMembers = [];
            members.forEach(member => {
                const emailId = member.email.split('@')[0];
                allMembers.push({
                    id: emailId,
                    name: member.name,
                    email: member.email
                });
            });
            
            console.log(`ğŸ“‹ ì „ì²´ ë©¤ë²„ ëª©ë¡ ìƒì„±: ${allMembers.length}ëª…`);
            
            // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì‹¤ì‹œê°„ í•„í„°ë§)
            function updateDropdownOptions(searchTerm = '') {
                dropdown.innerHTML = '';
                
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ë©¤ë²„ í‘œì‹œ (ìµœëŒ€ 50ê°œ)
                if (searchTerm.trim() === '') {
                    const displayMembers = allMembers.slice(0, 50);
                    displayMembers.forEach(member => {
                        const option = createModelPreferenceDropdownOption(member, '');
                        dropdown.appendChild(option);
                    });
                    return;
                }
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•„í„°ë§ëœ ë©¤ë²„ë§Œ í‘œì‹œ
                const filteredMembers = allMembers.filter(member => 
                    member.id.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                if (filteredMembers.length === 0) {
                    const noResult = document.createElement('div');
                    noResult.style.cssText = `
                        padding: 12px;
                        color: #7a7a7a;
                        text-align: center;
                        font-size: 14px;
                    `;
                    noResult.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤';
                    dropdown.appendChild(noResult);
                    return;
                }
                
                // í•„í„°ë§ëœ ê²°ê³¼ëŠ” ìµœëŒ€ 30ê°œê¹Œì§€ í‘œì‹œ
                const displayMembers = filteredMembers.slice(0, 30);
                
                displayMembers.forEach(member => {
                    const option = createModelPreferenceDropdownOption(member, searchTerm);
                    dropdown.appendChild(option);
                });
            }
            
            // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„± í•¨ìˆ˜
            function createModelPreferenceDropdownOption(member, searchTerm) {
                const option = document.createElement('div');
                option.style.cssText = `
                    padding: 8px 12px;
                    cursor: pointer;
                    color: #e1e1e1;
                    border-bottom: 1px solid #3a3a3a;
                    transition: background-color 0.2s ease;
                `;
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•˜ì´ë¼ì´íŠ¸, ì—†ìœ¼ë©´ ì¼ë°˜ í‘œì‹œ
                let displayId = member.id;
                if (searchTerm && searchTerm.trim() !== '') {
                    displayId = member.id.replace(
                        new RegExp(searchTerm, 'gi'),
                        match => `<span style="background-color: #4a9eff; color: white; padding: 1px 2px; border-radius: 2px;">${match}</span>`
                    );
                }
                
                option.innerHTML = `
                    <div style="font-weight: 500; font-size: 14px;">${displayId}</div>
                    <div style="font-size: 12px; color: #7a7a7a;">${member.name} â€¢ ${member.email}</div>
                `;
                
                // í˜¸ë²„ íš¨ê³¼
                option.addEventListener('mouseenter', () => {
                    option.style.backgroundColor = '#3a3a3a';
                });
                option.addEventListener('mouseleave', () => {
                    option.style.backgroundColor = 'transparent';
                });
                
                // í´ë¦­ ì´ë²¤íŠ¸
                option.addEventListener('click', () => {
                    searchInput.value = member.id;
                    dropdown.style.display = 'none';
                    handleChartSearch(member.id);
                });
                
                return option;
            }
            
            // ê²€ìƒ‰ ì…ë ¥ ì»¨í…Œì´ë„ˆì— ë“œë¡­ë‹¤ìš´ ì¶”ê°€
            const inputContainer = searchInput.parentElement;
            inputContainer.style.position = 'relative';
            inputContainer.appendChild(dropdown);
            
            // ì…ë ¥ ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ í•„í„°ë§
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                if (dropdown.style.display !== 'none') {
                    updateDropdownOptions(searchTerm);
                }
            });
            
            // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            searchInput.addEventListener('focus', () => {
                updateDropdownOptions(searchInput.value);
                dropdown.style.display = 'block';
            });
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    dropdown.style.display = 'none';
                }
            });
            
            // ë¸”ëŸ¬ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            searchInput.addEventListener('blur', (e) => {
                setTimeout(() => {
                    if (!dropdown.contains(document.activeElement)) {
                        dropdown.style.display = 'none';
                    }
                }, 200);
            });
            
            console.log(`âœ… ëª¨ë¸ ì„ í˜¸ë„ìš© ì‹¤ì‹œê°„ í•„í„°ë§ ë“œë¡­ë‹¤ìš´ ìƒì„± ì™„ë£Œ: ${allMembers.length}ëª…ì˜ ì‚¬ìš©ì`);
        }

        // íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ìƒì„± (ë§‰ëŒ€ ê·¸ë˜í”„)
        function createFilteredModelPreferenceChart(userId) {
            console.log('ğŸ”¥ createFilteredModelPreferenceChart ì‹œì‘:', userId);
            
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë°ì´í„° ìƒì„±
            const userModelData = generateUserModelUsageData(userId);
            
            if (!userModelData || userModelData.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${userId}ì˜ ëª¨ë¸ ì‚¬ìš© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`, width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawUserModelBarChart(ctx, width, height, userModelData, userId);
        }

        // íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë°ì´í„° ìƒì„±
        function generateUserModelUsageData(userId) {
            console.log('ğŸ”¥ generateUserModelUsageData ì‹œì‘:', userId);
            
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!members || members.length === 0 || !rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                return [];
            }
            
            // ì‚¬ìš©ì ì°¾ê¸°
            const user = members.find(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase() === userId.toLowerCase();
            });
            
            if (!user) {
                console.log('âš ï¸ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // í•´ë‹¹ ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ í•„í„°ë§
            const userEvents = rawEvents.filter(event => 
                event.userEmail === user.email || event.email === user.email
            );
            
            // ëª¨ë¸ë³„ ì‚¬ìš© íšŸìˆ˜ ê³„ì‚°
            const modelUsage = new Map();
            userEvents.forEach(event => {
                const model = event.model || 'unknown';
                modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
            });
            
            // ë°°ì—´ë¡œ ë³€í™˜ ë° ì‚¬ìš© íšŸìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬
            const data = Array.from(modelUsage.entries())
                .map(([model, count]) => ({ model, count }))
                .sort((a, b) => b.count - a.count);
            
            console.log(`ğŸ”¥ ${userId}ì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë°ì´í„°:`, data);
            return data;
        }

        // ì‚¬ìš©ìë³„ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸° (ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ìŠ¤íƒ€ì¼)
        function drawUserModelBarChart(ctx, width, height, data, userId) {
            console.log('ğŸ” drawUserModelBarChart ì‹œì‘...');
            console.log('ğŸ“Š ì…ë ¥ ë°ì´í„°:', data);
            console.log('ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸°:', width, 'x', height);
            
            if (data.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - (padding * 2);
            const chartHeight = height - (padding * 2);
            const barWidth = chartWidth / data.length * 0.8;
            const barSpacing = chartWidth / data.length * 0.2;
            
            // ìµœëŒ€ê°’ ê³„ì‚°
            const maxValue = Math.max(...data.map(d => d.count));
            
            // Yì¶• ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Xì¶• ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Yì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxValue / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸° (ë‹¤ì–‘í•œ ìƒ‰ìƒ)
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4', '#ff5722', '#795548', '#607d8b', '#e91e63'];
            
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barSpacing / 2;
                const barHeight = (item.count / maxValue) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸° (ë‹¤ì–‘í•œ ìƒ‰ìƒ)
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.count.toString(), x + barWidth / 2, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ëª¨ë¸ëª…)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                const modelName = item.model.length > 12 ? item.model.substring(0, 12) + '...' : item.model;
                ctx.fillText(modelName, x + barWidth / 2, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`${userId}ì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰`, width / 2, 25);
            
            // Yì¶• ì œëª©
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.save();
            ctx.translate(20, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ì‚¬ìš© íšŸìˆ˜', 0, 0);
            ctx.restore();
        }

        // ì—¬ëŸ¬ ì‚¬ìš©ì ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„± (ë¶€ë¶„ ê²€ìƒ‰ ê²°ê³¼)
        function createMultiUserModelPreferenceChart(filteredUsers) {
            console.log('ğŸ”¥ createMultiUserModelPreferenceChart ì‹œì‘:', filteredUsers.length, 'ëª…');
            
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„±
            const preferenceData = generateFilteredModelPreferenceData(filteredUsers);
            
            if (preferenceData.size === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', width / 2, height / 2);
                return;
            }
            
            // ìŠ¤íƒ ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawStackedBarChart(ctx, width, height, preferenceData);
        }

        // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„±
        function generateFilteredModelPreferenceData(filteredUsers) {
            console.log('ğŸ”¥ generateFilteredModelPreferenceData ì‹œì‘:', filteredUsers.length, 'ëª…');
            
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ë° ëª¨ë¸ ì‚¬ìš©ëŸ‰ ê³„ì‚°
            const userActivityData = [];
            filteredUsers.forEach(member => {
                const userEmail = member.email;
                const userId = userEmail.split('@')[0];
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                // í™œë™ì´ ì—†ëŠ” ì‚¬ìš©ìëŠ” ì œì™¸
                if (userEvents.length === 0) {
                    return;
                }
                
                const modelUsage = new Map();
                userEvents.forEach(event => {
                    const model = event.model || 'unknown';
                    modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
                });
                
                userActivityData.push({
                    userId: userId,
                    email: userEmail,
                    totalActivity: userEvents.length,
                    modelUsage: modelUsage
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 20ëª… ì„ íƒ
            const sortedUsers = userActivityData
                .sort((a, b) => b.totalActivity - a.totalActivity)
                .slice(0, 20);
            
            // Map í˜•íƒœë¡œ ë³€í™˜
            const userModelPreference = new Map();
            sortedUsers.forEach(user => {
                userModelPreference.set(user.userId, user.modelUsage);
            });
            
            console.log(`ğŸ“Š í•„í„°ëœ ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${userModelPreference.size}ëª…ì˜ í™œì„± ì‚¬ìš©ì`);
            return userModelPreference;
        }

        // Usage ì„¹ì…˜ í˜„ì¬ í•„í„°ë¡œ ì—…ë°ì´íŠ¸
        async function updateUsageWithCurrentFilter(days = 30, showLoading = true) {
            try {
                // ì´ë¯¸ ë¡œë”© ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
                if (isUsageLoading) {
                    console.log('âš ï¸ Usage ë°ì´í„° ë¡œë”© ì¤‘ - ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');
                    return;
                }
                
                console.log(`=== Usage ì„¹ì…˜ ${days}ì¼ í•„í„°ë¡œ ì—…ë°ì´íŠ¸ ì‹œì‘ (ë¡œë”© í‘œì‹œ: ${showLoading}) ===`);
                
                isUsageLoading = true;
                
                // ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
                const dateRange = getDateRange(days);
                currentUsageDateRange = null; // ì‚¬ìš©ì ì •ì˜ ë²”ìœ„ ì´ˆê¸°í™”
                
                // í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                updateUsageFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
                
                await updateUsageWithDateRange(dateRange.startDate, dateRange.endDate, showLoading);
                
                // ì²« ë²ˆì§¸ ë¡œë”© ì™„ë£Œ í‘œì‹œ
                if (showLoading) {
                    isUsageDataLoaded = true;
                }
                
                isUsageLoading = false;
                console.log(`=== Usage ì„¹ì…˜ ${days}ì¼ í•„í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ ===`);
            } catch (error) {
                console.error('âŒ Usage í•„í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                isUsageLoading = false;
            }
        }

        // Usage ì„¹ì…˜ íŠ¹ì • ë‚ ì§œ ë²”ìœ„ë¡œ ì—…ë°ì´íŠ¸
        async function updateUsageWithDateRange(startDate, endDate, showLoading = true) {
            try {
                console.log(`=== Usage ì„¹ì…˜ ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸ ì‹œì‘: ${new Date(startDate).toLocaleDateString()} ~ ${new Date(endDate).toLocaleDateString()} (ë¡œë”© í‘œì‹œ: ${showLoading}) ===`);
                
                // ë¡œë”© ìƒíƒœ í‘œì‹œ (ì²« ë²ˆì§¸ ë¡œë”©ì—ë§Œ)
                if (showLoading) {
                    showUsageLoadingState(true);
                }
                
                // API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const [membersData, eventsData, usageData, spendingData] = await Promise.all([
                    getTeamMembers(),
                    getFilteredEvents(startDate, endDate),
                    getUsageData(startDate, endDate),
                    getTeamSpendingData()
                ]);
                
                // Usage ì¹´ë“œ ì—…ë°ì´íŠ¸
                updateUsageCards(usageData, eventsData);
                
                // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸
                updateUserCumulativeInfo(membersData, eventsData, spendingData, startDate, endDate);
                
                // All Raw Events ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ì´ˆê¸°í™”)
                currentRawEventsPage = 1;
                updateRawEventsTable(eventsData);
                
                // ë¡œë”© ìƒíƒœ í•´ì œ (ì²« ë²ˆì§¸ ë¡œë”©ì—ë§Œ)
                if (showLoading) {
                    showUsageLoadingState(false);
                }
                
                console.log(`=== Usage ì„¹ì…˜ ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸ ì™„ë£Œ ===`);
            } catch (error) {
                console.error('âŒ Usage ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                if (showLoading) {
                    showUsageLoadingState(false);
                }
            }
        }

        // Usage ë¡œë”© ìƒíƒœ í‘œì‹œ/í•´ì œ
        function showUsageLoadingState(isLoading) {
            const usageCards = document.querySelectorAll('#usage .usage-card-number');
            const userTables = document.querySelectorAll('#usage .user-cumulative-info');
            
            if (isLoading) {
                usageCards.forEach(card => {
                    card.textContent = '-';
                });
                userTables.forEach(table => {
                    table.style.opacity = '0.5';
                });
            } else {
                userTables.forEach(table => {
                    table.style.opacity = '1';
                });
            }
        }

        // Usage ì¹´ë“œ ì—…ë°ì´íŠ¸ (Overviewì™€ Usage ì„¹ì…˜ ëª¨ë‘)
        function updateUsageCards(usageData, eventsData) {
            // Overview ì„¹ì…˜ê³¼ Usage ì„¹ì…˜ ëª¨ë‘ì˜ ì¹´ë“œë¥¼ ì°¾ìŒ
            const overviewCards = document.querySelectorAll('#overview .usage-card-number');
            const usageCards = document.querySelectorAll('#usage .usage-card-number');
            const allCards = [...overviewCards, ...usageCards];
            
            if (!usageData || !usageData.data) {
                allCards.forEach((card, index) => {
                    const cardIndex = index % 4; // 4ê°œ ì¹´ë“œ ë°˜ë³µ
                    card.textContent = '0';
                });
                console.log('ğŸ“Š Usage ì¹´ë“œ ì—…ë°ì´íŠ¸: ë°ì´í„° ì—†ìŒ - ëª¨ë“  ê°’ì„ 0ìœ¼ë¡œ ì„¤ì •');
                return;
            }
            
            // ì‹¤ì œ í™œë™í•œ ì‚¬ìš©ì ìˆ˜ ê³„ì‚°
            const activeUsers = new Set();
            if (eventsData && eventsData.usageEvents) {
                eventsData.usageEvents.forEach(event => {
                    if (event.userEmail && event.requestsCosts > 0) {
                        activeUsers.add(event.userEmail);
                    }
                });
            }
            
            // ì§‘ê³„ ê³„ì‚°
            let totalLinesAdded = 0;
            let totalLinesAccepted = 0;
            let totalTabsAccepted = 0;
            let totalChats = 0;
            
            usageData.data.forEach(dayData => {
                totalLinesAdded += (dayData.totalLinesAdded || 0);
                totalLinesAccepted += (dayData.acceptedLinesAdded || 0);
                totalTabsAccepted += (dayData.totalTabsAccepted || 0);
                totalChats += (dayData.chatRequests || 0);
            });
            
            // ì¹´ë“œ ì—…ë°ì´íŠ¸ (Overviewì™€ Usage ì„¹ì…˜ ëª¨ë‘)
            const values = [
                activeUsers.size.toLocaleString(), // Total Users
                (totalLinesAdded + totalLinesAccepted).toLocaleString(), // Lines of Agent Edits
                totalTabsAccepted.toLocaleString(), // Tabs Accepted
                totalChats.toLocaleString() // Chats
            ];
            
            allCards.forEach((card, index) => {
                const cardIndex = index % 4; // 4ê°œ ì¹´ë“œ ë°˜ë³µ
                card.textContent = values[cardIndex];
            });
            
            console.log(`Usage ì¹´ë“œ ì—…ë°ì´íŠ¸: ì‚¬ìš©ì ${activeUsers.size}ëª…, ë¼ì¸ ${totalLinesAdded + totalLinesAccepted}ì¤„, íƒ­ ${totalTabsAccepted}ê°œ, ì±„íŒ… ${totalChats}ê±´`);
        }

        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” ë Œë”ë§ (All Raw Events ìŠ¤íƒ€ì¼)
        function renderUserCumulativeTableWithPagination(userInfos, startDate, endDate) {
            console.log('ğŸ¨ renderUserCumulativeTableWithPagination í•¨ìˆ˜ í˜¸ì¶œë¨');
            console.log('ğŸ“Š ë Œë”ë§ ë°ì´í„°:', {
                userInfos: userInfos ? `${userInfos.length}ëª…` : 'null',
                startDate: startDate,
                endDate: endDate
            });
            
            // í—¤ë” ì—…ë°ì´íŠ¸
            const headerElement = document.querySelector('.user-cumulative-info .user-cumulative-header');
            if (headerElement) {
                if (!userInfos || userInfos.length === 0) {
                    headerElement.innerHTML = 'ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´';
                } else {
                    const totalUsers = userInfos.length;
                    const totalPages = Math.ceil(totalUsers / currentUserCumulativePageSize);
                    const startIndex = (currentUserCumulativePage - 1) * currentUserCumulativePageSize;
                    const endIndex = Math.min(startIndex + currentUserCumulativePageSize, totalUsers);
                    
                    // ë‚ ì§œ í˜•ì‹ ë³€ê²½ (ë‚ ì§œ ëì˜ "." ì œê±°)
                    const cleanStartDate = new Date(startDate).toLocaleDateString('ko-KR').replace(/\.$/, '');
                    const cleanEndDate = new Date(endDate).toLocaleDateString('ko-KR').replace(/\.$/, '');
                    
                    headerElement.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ (${cleanStartDate} ~ ${cleanEndDate})(${startIndex + 1}-${endIndex} of ${totalUsers})</span>
                            <select id="userCumulativePageSize" onchange="changeUserCumulativePageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                                <option value="10" ${currentUserCumulativePageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                                <option value="20" ${currentUserCumulativePageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                                <option value="30" ${currentUserCumulativePageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                                <option value="50" ${currentUserCumulativePageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                                <option value="100" ${currentUserCumulativePageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                            </select>
                        </div>
                    `;
                }
            }
            
            if (!userInfos || userInfos.length === 0) {
                const container = document.getElementById('user-cumulative-container');
                if (container) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
                }
                // í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¸°ê¸°
                const pagination = document.getElementById('user-cumulative-pagination');
                if (pagination) pagination.style.display = 'none';
                return;
            }
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ê³„ì‚°
            const totalUsers = userInfos.length;
            const totalPages = Math.ceil(totalUsers / currentUserCumulativePageSize);
            const startIndex = (currentUserCumulativePage - 1) * currentUserCumulativePageSize;
            const endIndex = Math.min(startIndex + currentUserCumulativePageSize, totalUsers);
            const pageUsers = userInfos.slice(startIndex, endIndex);

            console.log(`ğŸ“„ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${totalUsers} (í˜ì´ì§€ ${currentUserCumulativePage}/${totalPages})`);
            
            // í…Œì´ë¸” ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸
            const tableContent = pageUsers.map(user => `
                <div class="user-cumulative-row">
                    <div>${user.name}</div>
                    <div class="user-email clickable-email" title="View usage for ${user.email}" onclick="navigateToUsageWithEmail('${user.email}')">${user.email}</div>
                    <div><span class="role-badge ${user.role === 'owner' ? 'admin' : ''}">${user.role === 'owner' ? 'Admin' : 'Member'}</span></div>
                    <div style="font-weight: 600;">${user.periodRequests}</div>
                    <div>$${user.spend.toFixed(2)}</div>
                    <div>${user.lastActivity}</div>
                </div>
            `).join('');
            
            // ì»¨í…Œì´ë„ˆì— í…Œì´ë¸” ë‚´ìš©ë§Œ ì‚½ì…
            const container = document.getElementById('user-cumulative-container');
            if (container) {
                container.innerHTML = tableContent;
            }

            // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
            const paginationContainer = document.getElementById('user-cumulative-pagination');
            if (paginationContainer && totalPages > 1) {
                paginationContainer.innerHTML = generateUserCumulativePagination(totalPages);
                paginationContainer.style.display = 'block';
            } else if (paginationContainer) {
                paginationContainer.style.display = 'none';
            }
            
            console.log('âœ… ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” HTML ë Œë”ë§ ì™„ë£Œ');
            console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸: ì´ ${userInfos.length}ëª… (í˜ì´ì§€ ${currentUserCumulativePage}/${totalPages})`);
        }
        

        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ ë³€ê²½ (All Raw Events ìŠ¤íƒ€ì¼)
        function changeUserCumulativePage(page) {
            currentUserCumulativePage = page;
            renderUserCumulativeTableWithPagination(currentUserCumulativeData, currentUserCumulativeStartDate, currentUserCumulativeEndDate);
        }
        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ í¬ê¸° ë³€ê²½ (All Raw Events ìŠ¤íƒ€ì¼)
        function changeUserCumulativePageSize(pageSize) {
            currentUserCumulativePageSize = parseInt(pageSize);
            currentUserCumulativePage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderUserCumulativeTableWithPagination(currentUserCumulativeData, currentUserCumulativeStartDate, currentUserCumulativeEndDate);
        }

        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateUserCumulativeInfo(membersData, eventsData, spendingData, startDate, endDate) {
            console.log('ğŸ” updateUserCumulativeInfo í•¨ìˆ˜ í˜¸ì¶œë¨');
            console.log('ğŸ“Š ì „ë‹¬ë°›ì€ ë°ì´í„°:', {
                membersData: membersData ? `${membersData.teamMembers?.length || 0}ëª…` : 'null',
                eventsData: eventsData ? `${eventsData.usageEvents?.length || 0}ê°œ ì´ë²¤íŠ¸` : 'null',
                spendingData: spendingData ? `${spendingData.teamMemberSpend?.length || 0}ê°œ ì§€ì¶œ` : 'null',
                startDate: startDate,
                endDate: endDate
            });
            
            if (!membersData || !membersData.teamMembers) {
                console.log('âš ï¸ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´: ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                console.log('ìƒì„¸ ì •ë³´:', {
                    membersData: !!membersData,
                    teamMembers: membersData?.teamMembers?.length || 0
                });
                return;
            }
            
            console.log('=== ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹œì‘ ===');
            
            // ì§€ì¶œ ë°ì´í„° ë§¤í•‘
            const memberSpendMap = {};
            if (spendingData && spendingData.teamMemberSpend) {
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100,
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });
            }
            
            // ì„ íƒëœ ê¸°ê°„ ë‚´ ì‚¬ìš©ìë³„ í™œë™ í†µê³„ ê³„ì‚°
            const userPeriodStats = {};
            if (eventsData && eventsData.usageEvents) {
                eventsData.usageEvents.forEach(event => {
                    const userEmail = event.userEmail;
                    const timestamp = parseInt(event.timestamp);
                    
                    if (!userPeriodStats[userEmail]) {
                        userPeriodStats[userEmail] = {
                            lastTimestamp: timestamp,
                            periodRequests: 0
                        };
                    }
                    
                    // ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if (timestamp > userPeriodStats[userEmail].lastTimestamp) {
                        userPeriodStats[userEmail].lastTimestamp = timestamp;
                    }
                    
                    // ì„ íƒëœ ê¸°ê°„ ë‚´ ìš”ì²­ ë¹„ìš© ëˆ„ì  (All Raw Eventsì˜ COSTê°’ê³¼ ë™ì¼)
                    const requestCost = event.requestsCosts || 0;
                    userPeriodStats[userEmail].periodRequests += requestCost;
                    
                    // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ (ì²˜ìŒ 5ê°œ ì´ë²¤íŠ¸ë§Œ)
                    if (Object.keys(userPeriodStats).length <= 5 && userPeriodStats[userEmail].periodRequests <= requestCost * 3) {
                        console.log(`ğŸ’° ${userEmail}: +${requestCost} (ëˆ„ì : ${userPeriodStats[userEmail].periodRequests})`);
                    }
                });
            }
            
            // ì‚¬ìš©ì ì •ë³´ ìƒì„±
            const userInfos = membersData.teamMembers.map(member => {
                const spendData = memberSpendMap[member.email] || {};
                const periodStats = userPeriodStats[member.email] || {};
                const actualSpend = spendData.spend || 0;
                const totalPremiumRequests = spendData.premiumRequests || 0; // ì „ì²´ ê¸°ê°„ Premium Requests
                const periodRequests = periodStats.periodRequests || 0; // ì„ íƒëœ ê¸°ê°„ ë‚´ ìš”ì²­ ìˆ˜
                
                // ë§ˆì§€ë§‰ í™œë™ ë‚ ì§œ ê³„ì‚°
                let lastActivityText = 'No Activity';
                if (periodStats.lastTimestamp) {
                    const lastDate = new Date(periodStats.lastTimestamp);
                    const today = new Date();
                    const daysDiff = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff === 0) {
                        lastActivityText = 'ì˜¤ëŠ˜';
                    } else if (daysDiff === 1) {
                        lastActivityText = 'ì–´ì œ';
                    } else {
                        lastActivityText = `${daysDiff}ì¼ ì „`;
                    }
                }
                
                return {
                    name: member.name || 'Unnamed',
                    email: member.email,
                    role: member.role,
                    totalPremiumRequests: totalPremiumRequests, // ì „ì²´ Premium Requests
                    periodRequests: periodRequests, // ì„ íƒëœ ê¸°ê°„ ë‚´ ìš”ì²­ ìˆ˜
                    spend: actualSpend,
                    lastActivity: lastActivityText,
                    lastTimestamp: periodStats.lastTimestamp || 0
                };
            });
            
            // 1. Last Act ìµœì‹ ìˆœ, 2. Request ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
            userInfos.sort((a, b) => {
                // 1ì°¨ ì •ë ¬: Last Act (ë§ˆì§€ë§‰ í™œë™) ìµœì‹ ìˆœ - timestamp ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ
                if (b.lastTimestamp !== a.lastTimestamp) {
                    return b.lastTimestamp - a.lastTimestamp;
                }
                // 2ì°¨ ì •ë ¬: Request ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ
                return b.periodRequests - a.periodRequests;
            });
            
            // ë°ì´í„° ì €ì¥ ë° í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            currentUserCumulativeData = userInfos;
            currentUserCumulativeStartDate = startDate;
            currentUserCumulativeEndDate = endDate;
            currentUserCumulativePage = 1; // ì²« í˜ì´ì§€ë¡œ ë¦¬ì…‹
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            renderUserCumulativeTableWithPagination(userInfos, startDate, endDate);
            
            console.log(`ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${userInfos.length}ëª…`);
            console.log(`ì„ íƒëœ ê¸°ê°„ ë‚´ ì´ ìš”ì²­ ìˆ˜: ${userInfos.reduce((sum, user) => sum + user.periodRequests, 0)}ê±´`);
        }

        // All Raw Events í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateRawEventsTable(eventsData) {
            const tableContainer = document.querySelector('#usage .user-cumulative-info:last-child');
            if (!tableContainer || !eventsData || !eventsData.usageEvents) return;
            
            // ê²€ìƒ‰ ì¤‘ì¸ ê²½ìš° ìë™ ì—…ë°ì´íŠ¸ ë°©ì§€
            if (window.pendingEmailSearch) {
                console.log(`â³ ì´ë©”ì¼ ê²€ìƒ‰ ëŒ€ê¸° ì¤‘ (${window.pendingEmailSearch}) - Raw Events í…Œì´ë¸” ìë™ ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€`);
                // ë°ì´í„°ëŠ” ì €ì¥í•˜ë˜ í…Œì´ë¸” ë Œë”ë§ì€ í•˜ì§€ ì•ŠìŒ
                currentRawEventsData = eventsData.usageEvents.sort((a, b) => {
                    const timestampA = parseInt(a.timestamp) || 0;
                    const timestampB = parseInt(b.timestamp) || 0;
                    return timestampB - timestampA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  â†’ ê³¼ê±°)
                });
                return;
            }
            
            // ì „ì²´ ë°ì´í„° ì €ì¥ ë° DATE ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            currentRawEventsData = eventsData.usageEvents.sort((a, b) => {
                const timestampA = parseInt(a.timestamp) || 0;
                const timestampB = parseInt(b.timestamp) || 0;
                return timestampB - timestampA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  â†’ ê³¼ê±°)
            });
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            renderRawEventsTableWithPagination();
        }

        // Raw Events í…Œì´ë¸” í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë Œë”ë§
        function renderRawEventsTableWithPagination() {
            const tableContainer = document.querySelector('#usage .user-cumulative-info:last-child');
            if (!tableContainer || !currentRawEventsData.length) return;
            
            const totalEvents = currentRawEventsData.length;
            const totalPages = Math.ceil(totalEvents / currentRawEventsPageSize);
            const startIndex = (currentRawEventsPage - 1) * currentRawEventsPageSize;
            const endIndex = Math.min(startIndex + currentRawEventsPageSize, totalEvents);
            const pageEvents = currentRawEventsData.slice(startIndex, endIndex);
            
            const tableHtml = `
                <div class="user-cumulative-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“‹ All Raw Events (${startIndex + 1}-${endIndex} of ${totalEvents})</span>
                    <select id="rawEventsPageSize" onchange="changeRawEventsPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                        <option value="10" ${currentRawEventsPageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                        <option value="20" ${currentRawEventsPageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                        <option value="30" ${currentRawEventsPageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                        <option value="50" ${currentRawEventsPageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                        <option value="100" ${currentRawEventsPageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                    </select>
                </div>
                <div class="user-cumulative-table">
                    <div>DATE</div>
                    <div>USER</div>
                    <div>KIND</div>
                    <div>MAX_MODEL</div>
                    <div>MODEL</div>
                    <div>COST</div>
                </div>
                ${pageEvents.map(event => {
                    const date = new Date(parseInt(event.timestamp));
                    const dateText = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    return `
                        <div class="user-cumulative-row">
                            <div>${dateText}</div>
                            <div class="user-email">${event.userEmail}</div>
                            <div>${(event.kindLabel || 'Unknown').substring(0, 15)}${(event.kindLabel || '').length > 15 ? '...' : ''}</div>
                            <div>${event.maxMode ? 'Yes' : 'No'}</div>
                            <div>${(event.model || 'auto').substring(0, 10)}${(event.model || '').length > 10 ? '...' : ''}</div>
                            <div>${event.requestsCosts || 0}</div>
                        </div>
                    `;
                }).join('')}
                ${totalPages > 1 ? `
                    <div style="padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        ${generateRawEventsPagination(totalPages)}
                    </div>
                ` : ''}
            `;
            
            tableContainer.innerHTML = tableHtml;
            
            console.log(`Raw Events í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ: í˜ì´ì§€ ${currentRawEventsPage}/${totalPages}, ${pageEvents.length}ê°œ ì´ë²¤íŠ¸ í‘œì‹œ`);
        }

        // Raw Events í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„±
        function generateRawEventsPagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentRawEventsPage > 1) {
                pagination += `<button onclick="changeRawEventsPage(${currentRawEventsPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentRawEventsPage - 2);
            let endPage = Math.min(totalPages, currentRawEventsPage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeRawEventsPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentRawEventsPage;
                pagination += `<button onclick="changeRawEventsPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'};">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeRawEventsPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentRawEventsPage < totalPages) {
                pagination += `<button onclick="changeRawEventsPage(${currentRawEventsPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Raw Events í˜ì´ì§€ ë³€ê²½
        function changeRawEventsPage(page) {
            currentRawEventsPage = page;
            renderRawEventsTableWithPagination();
        }

        // Raw Events í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeRawEventsPageSize(pageSize) {
            currentRawEventsPageSize = parseInt(pageSize);
            currentRawEventsPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderRawEventsTableWithPagination();
        }

        // í•„í„°ë§ëœ Raw Events í…Œì´ë¸” ë Œë”ë§ (í˜ì´ì§€ë„¤ì´ì…˜ í¬í•¨)
        function renderFilteredRawEventsTable(filteredEvents, container) {
            if (!container || !filteredEvents) return;
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì • - ê¸°ì¡´ ì„¤ì •ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
            const pageSize = window.currentFilteredEventsPageSize || 20;
            const currentPage = window.currentFilteredEventsPage || 1;
            const totalPages = Math.ceil(filteredEvents.length / pageSize);
            
            // í˜„ì¬ í˜ì´ì§€ì˜ ì´ë²¤íŠ¸ë§Œ ì¶”ì¶œ
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, filteredEvents.length);
            const pageEvents = filteredEvents.slice(startIndex, endIndex);
            
            console.log(`ğŸ“„ í•„í„°ë§ëœ Raw Events í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${filteredEvents.length} (í˜ì´ì§€ ${currentPage}/${totalPages})`);
            
            // ì¼ë°˜ í…Œì´ë¸”ê³¼ ë™ì¼í•œ êµ¬ì¡°ë¡œ HTML ìƒì„± (í˜ì´ì§€ë„¤ì´ì…˜ í¬í•¨)
            const tableHtml = `
                <div class="user-cumulative-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“‹ All Raw Events - ê²€ìƒ‰ ê²°ê³¼ (${startIndex + 1}-${endIndex} of ${filteredEvents.length})</span>
                    <select onchange="changeFilteredEventsPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                        <option value="10" ${pageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                        <option value="20" ${pageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                        <option value="30" ${pageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                        <option value="50" ${pageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                        <option value="100" ${pageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                    </select>
                </div>
                <div class="user-cumulative-table">
                    <div>DATE</div>
                    <div>USER</div>
                    <div>KIND</div>
                    <div>MAX_MODEL</div>
                    <div>MODEL</div>
                    <div>COST</div>
                </div>
                ${pageEvents.map(event => {
                    const date = new Date(parseInt(event.timestamp));
                    const dateText = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    return `
                        <div class="user-cumulative-row">
                            <div>${dateText}</div>
                            <div class="user-email">${event.userEmail}</div>
                            <div>${(event.kindLabel || 'Unknown').substring(0, 15)}${(event.kindLabel || '').length > 15 ? '...' : ''}</div>
                            <div>${event.maxMode ? 'Yes' : 'No'}</div>
                            <div>${(event.model || 'auto').substring(0, 10)}${(event.model || '').length > 10 ? '...' : ''}</div>
                            <div>${event.requestsCosts || 0}</div>
                        </div>
                    `;
                }).join('')}
                ${totalPages > 1 ? `
                    <div style="padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        ${generateFilteredEventsPagination(totalPages, currentPage)}
                    </div>
                ` : ''}
            `;
            
            container.innerHTML = tableHtml;
            
            // í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„° ì €ì¥ (í˜ì´ì§€ë„¤ì´ì…˜ìš©)
            window.currentFilteredEvents = filteredEvents;
            window.currentFilteredEventsPage = currentPage;
            window.currentFilteredEventsPageSize = pageSize;
            
            console.log(`í•„í„°ë§ëœ Raw Events í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ: ${filteredEvents.length}ê°œ ì´ë²¤íŠ¸ (í˜ì´ì§€ ${currentPage}/${totalPages}, í˜ì´ì§€ë‹¹ ${pageSize}ê°œ)`);
        }

        // ë¹ˆ Raw Events í…Œì´ë¸” ë Œë”ë§
        function renderEmptyRawEventsTable(container, searchedEmails) {
            if (!container) return;
            
            const emailList = searchedEmails.join(', ');
            
            const tableHtml = `
                <div class="user-cumulative-header">
                    <span>ğŸ“‹ All Raw Events - ê²€ìƒ‰ ê²°ê³¼ (0ê°œ)</span>
                </div>
                <div class="user-cumulative-table">
                    <div>DATE</div>
                    <div>USER</div>
                    <div>KIND</div>
                    <div>MAX_MODEL</div>
                    <div>MODEL</div>
                    <div>COST</div>
                </div>
                <div style="padding: 40px 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a; grid-column: 1 / -1;">
                    <h3 style="color: #e1e1e1; margin-bottom: 10px;">ê²€ìƒ‰ëœ ì‚¬ìš©ìì˜ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p style="margin-bottom: 15px;">ê²€ìƒ‰ ëŒ€ìƒ: <strong style="color: #4a9eff;">${emailList}</strong></p>
                    <p style="font-size: 14px; line-height: 1.4;">
                        â€¢ í•´ë‹¹ ì‚¬ìš©ìê°€ ì„ íƒëœ ê¸°ê°„ì— í™œë™í•˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
                        â€¢ ë‹¤ë¥¸ ë‚ ì§œ ë²”ìœ„ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”<br>
                        â€¢ ë˜ëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”
                    </p>
                </div>
            `;
            
            container.innerHTML = tableHtml;
            console.log(`ë¹ˆ Raw Events í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ (ê²€ìƒ‰ ëŒ€ìƒ: ${emailList})`);
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (ì¼ë°˜ í…Œì´ë¸”ê³¼ ë™ì¼í•œ êµ¬ì¡°)
        function generateFilteredEventsPagination(totalPages, currentPage) {
            let pagination = '';
            
            // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
            if (currentPage > 1) {
                pagination += `<button onclick="changeFilteredEventsPage(${currentPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);
            
            // ì‹œì‘ í˜ì´ì§€ê°€ 1ì´ ì•„ë‹ˆë©´ ì²« í˜ì´ì§€ ë²„íŠ¼ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeFilteredEventsPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentPage;
                pagination += `<button onclick="changeFilteredEventsPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">${i}</button>`;
            }
            
            // ë í˜ì´ì§€ê°€ totalPagesê°€ ì•„ë‹ˆë©´ ë§ˆì§€ë§‰ í˜ì´ì§€ ë²„íŠ¼ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeFilteredEventsPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
            if (currentPage < totalPages) {
                pagination += `<button onclick="changeFilteredEventsPage(${currentPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€º</button>`;
            }
            
            return pagination;
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ ë³€ê²½
        function changeFilteredEventsPage(page) {
            if (!window.currentFilteredEvents) {
                console.log('âš ï¸ í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            window.currentFilteredEventsPage = page;
            const filteredEvents = window.currentFilteredEvents;
            const container = document.querySelector('#usage .user-cumulative-info:last-child');
            
            console.log(`ğŸ“„ í•„í„°ë§ëœ Raw Events í˜ì´ì§€ ë³€ê²½: í˜ì´ì§€ ${page}ë¡œ ì´ë™`);
            console.log(`ğŸ“„ ì»¨í…Œì´ë„ˆ ë°œê²¬: ${!!container}, í•„í„°ë§ëœ ì´ë²¤íŠ¸ ìˆ˜: ${filteredEvents.length}`);
            
            if (container) {
                // renderFilteredRawEventsTable í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©
                renderFilteredRawEventsTable(filteredEvents, container);
            } else {
                console.error('âŒ Raw Events ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeFilteredEventsPageSize(newPageSize) {
            console.log(`ğŸ”§ changeFilteredEventsPageSize í˜¸ì¶œë¨: ${newPageSize}`);
            console.log(`ğŸ“Š í˜„ì¬ ìƒíƒœ: currentFilteredEvents=${!!window.currentFilteredEvents}, currentFilteredEventsPage=${window.currentFilteredEventsPage}, currentFilteredEventsPageSize=${window.currentFilteredEventsPageSize}`);
            
            if (!window.currentFilteredEvents) {
                console.log('âš ï¸ í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            window.currentFilteredEventsPageSize = parseInt(newPageSize);
            window.currentFilteredEventsPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            
            const filteredEvents = window.currentFilteredEvents;
            const container = document.querySelector('#usage .user-cumulative-info:last-child');
            
            console.log(`ğŸ“„ í•„í„°ë§ëœ Raw Events í˜ì´ì§€ í¬ê¸° ë³€ê²½: ${newPageSize}ê°œë¡œ ë³€ê²½, ì²« í˜ì´ì§€ë¡œ ì´ë™`);
            console.log(`ğŸ“„ ì»¨í…Œì´ë„ˆ ë°œê²¬: ${!!container}, í•„í„°ë§ëœ ì´ë²¤íŠ¸ ìˆ˜: ${filteredEvents.length}`);
            
            if (container) {
                // renderFilteredRawEventsTable í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©
                renderFilteredRawEventsTable(filteredEvents, container);
            } else {
                console.error('âŒ Raw Events ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë””ë²„ê¹…ìš© ì „ì—­ í•¨ìˆ˜
        window.debugFilteredEvents = function() {
            console.log('=== í•„í„°ë§ëœ ì´ë²¤íŠ¸ ìƒíƒœ ë””ë²„ê¹… ===');
            console.log('currentFilteredEvents:', window.currentFilteredEvents ? window.currentFilteredEvents.length + 'ê°œ' : 'null');
            console.log('currentFilteredEventsPage:', window.currentFilteredEventsPage);
            console.log('currentFilteredEventsPageSize:', window.currentFilteredEventsPageSize);
            console.log('ì»¨í…Œì´ë„ˆ:', document.querySelector('#usage .user-cumulative-info:last-child'));
            console.log('==============================');
        };



        // Usage ë©¤ë²„ ê²€ìƒ‰ ê¸°ëŠ¥ (ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ì™€ All Raw Events í…Œì´ë¸” ì—°ë™)
        function filterUsageMembers(searchTerm) {
            const searchLower = searchTerm.toLowerCase().trim();
            
            console.log(`ğŸ” Usage ë©¤ë²„ ê²€ìƒ‰ ì‹œì‘: "${searchTerm}"`);
            
            // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ëª¨ë“  í–‰ í‘œì‹œ
            if (searchLower === '') {
                const allRows = document.querySelectorAll('#usage .user-cumulative-row');
                allRows.forEach(row => {
                    row.style.display = 'grid';
                });
                
                // ì „ì²´ ì´ë²¤íŠ¸ ë¡œê·¸ í…Œì´ë¸”ë„ í•¨ê»˜ ê°±ì‹ 
                if (currentRawEventsData && currentRawEventsData.length > 0) {
                    // í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë³€ìˆ˜ë“¤ ì •ë¦¬
                    delete window.currentFilteredEvents;
                    delete window.currentFilteredEventsPage;
                    delete window.currentFilteredEventsPageSize;
                    
                    renderRawEventsTableWithPagination();
                    console.log('âœ… ê²€ìƒ‰ì–´ ì—†ìŒ - ì „ì²´ Raw Events í˜ì´ì§€ë„¤ì´ì…˜ ë³µì›');
                }
                
                console.log('âœ… ê²€ìƒ‰ì–´ ì—†ìŒ - ëª¨ë“  í–‰ í‘œì‹œ ë° ì „ì²´ ì´ë²¤íŠ¸ ë¡œê·¸ ê°±ì‹ ');
                return;
            }
            
            // ì´ë©”ì¼ ì£¼ì†Œì¸ì§€ í™•ì¸ (@ í¬í•¨ ì—¬ë¶€ë¡œ íŒë‹¨)
            const isEmailSearch = searchLower.includes('@');
            
            // ëª¨ë“  Usage ì„¹ì…˜ì˜ user-cumulative-info ì»¨í…Œì´ë„ˆ ê°€ì ¸ì˜¤ê¸°
            const userInfoContainers = document.querySelectorAll('#usage .user-cumulative-info');
            
            if (userInfoContainers.length === 0) {
                console.log('âš ï¸ Usage ì„¹ì…˜ì˜ user-cumulative-info ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log(`ğŸ“‹ ë°œê²¬ëœ í…Œì´ë¸” ì»¨í…Œì´ë„ˆ: ${userInfoContainers.length}ê°œ`);
            
            // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” (ì²« ë²ˆì§¸ ì»¨í…Œì´ë„ˆ)ê³¼ All Raw Events í…Œì´ë¸” (ë‘ ë²ˆì§¸ ì»¨í…Œì´ë„ˆ) êµ¬ë¶„
            const userCumulativeContainer = userInfoContainers[0]; // ì²« ë²ˆì§¸: ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´
            const rawEventsContainer = userInfoContainers[1]; // ë‘ ë²ˆì§¸: All Raw Events
            
            // 1. ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸”ì—ì„œ í•„í„°ë§í•˜ê³  ë§¤ì¹­ëœ ì´ë©”ì¼ ìˆ˜ì§‘
            const matchedEmails = new Set();
            
            // ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­ì´ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸
            let hasExactMatch = false;
            if (isEmailSearch) {
                const allEmailElements = userCumulativeContainer.querySelectorAll('.user-cumulative-row .user-email, .user-cumulative-row div:nth-child(2)');
                hasExactMatch = Array.from(allEmailElements).some(element => 
                    element.textContent.toLowerCase().trim() === searchLower
                );
                console.log(`ğŸ” ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­ í™•ì¸: ${hasExactMatch ? 'ë°œê²¬ë¨' : 'ì—†ìŒ'}`);
            }
            
            // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” í•„í„°ë§
            const userCumulativeRows = userCumulativeContainer.querySelectorAll('.user-cumulative-row');
            console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´: ${userCumulativeRows.length}ê°œ í–‰ ë°œê²¬`);
            
            userCumulativeRows.forEach(row => {
                if (row.children.length < 2) return; // ì¶©ë¶„í•œ ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                
                const name = row.children[0].textContent.toLowerCase().trim();
                const email = row.children[1].textContent.toLowerCase().trim();
                
                let shouldShow = false;
                
                if (isEmailSearch) {
                    if (hasExactMatch) {
                        // ì •í™•í•œ ë§¤ì¹­ì´ ìˆìœ¼ë©´ ì •í™•í•œ ë§¤ì¹­ë§Œ í‘œì‹œ
                        shouldShow = email === searchLower;
                    } else {
                        // ì •í™•í•œ ë§¤ì¹­ì´ ì—†ìœ¼ë©´ ë¶€ë¶„ ë§¤ì¹­ í—ˆìš©
                        shouldShow = email.includes(searchLower);
                    }
                } else {
                    // ì¼ë°˜ ê²€ìƒ‰: ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ ë¶€ë¶„ ë§¤ì¹­
                    shouldShow = name.includes(searchLower) || email.includes(searchLower);
                }
                
                if (shouldShow) {
                    row.style.display = 'grid';
                    // ë§¤ì¹­ëœ ì´ë©”ì¼ì„ ìˆ˜ì§‘ (ì›ë³¸ ì´ë©”ì¼ ì €ì¥)
                    const originalEmail = row.children[1].textContent.trim();
                    matchedEmails.add(originalEmail);
                } else {
                    row.style.display = 'none';
                }
            });
            
            console.log(`ğŸ“§ ë§¤ì¹­ëœ ì´ë©”ì¼: ${Array.from(matchedEmails).join(', ')}`);
            
            // 2. All Raw Events í…Œì´ë¸” ì—°ë™ í•„í„°ë§ (ì „ì²´ ë°ì´í„°ì—ì„œ ê²€ìƒ‰)
            if (rawEventsContainer && currentRawEventsData && currentRawEventsData.length > 0) {
                console.log(`ğŸ“‹ All Raw Events ì „ì²´ ë°ì´í„°: ${currentRawEventsData.length}ê°œ ì´ë²¤íŠ¸`);
                console.log(`ğŸ” ë§¤ì¹­ ëŒ€ìƒ ì´ë©”ì¼: ${Array.from(matchedEmails).join(', ')}`);
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ë§¤ì¹­ëœ ì´ë©”ì¼ì˜ ì´ë²¤íŠ¸ë§Œ í•„í„°ë§
                if (matchedEmails.size > 0) {
                    // ìƒˆë¡œìš´ ê²€ìƒ‰ ì‹œì‘ ì‹œ í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜ ì´ˆê¸°í™”
                    window.currentFilteredEventsPage = 1;
                    window.currentFilteredEventsPageSize = window.currentFilteredEventsPageSize || 20;
                    
                    const filteredEvents = currentRawEventsData.filter(event => {
                        const eventUserEmail = event.userEmail?.trim() || '';
                        
                        // ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­ë§Œ ìˆ˜í–‰ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
                        return Array.from(matchedEmails).some(email => {
                            const emailLower = email.toLowerCase().trim();
                            const eventEmailLower = eventUserEmail.toLowerCase().trim();
                            return emailLower === eventEmailLower;
                        });
                    });
                    
                    console.log(`âœ… í•„í„°ë§ëœ Raw Events: ${filteredEvents.length}ê°œ`);
                    
                    if (filteredEvents.length > 0) {
                        // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
                        renderFilteredRawEventsTable(filteredEvents, rawEventsContainer);
                        console.log(`âœ… ${filteredEvents.length}ê°œì˜ ë§¤ì¹­ëœ ì´ë²¤íŠ¸ë¥¼ í‘œì‹œí–ˆìŠµë‹ˆë‹¤.`);
                        console.log(`ğŸ“Š ì „ì—­ ë³€ìˆ˜ ìƒíƒœ: currentFilteredEvents=${!!window.currentFilteredEvents}, currentFilteredEventsPage=${window.currentFilteredEventsPage}, currentFilteredEventsPageSize=${window.currentFilteredEventsPageSize}`);
                    } else {
                        // ë§¤ì¹­ëœ ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ ë¹ˆ í…Œì´ë¸” í‘œì‹œ
                        renderEmptyRawEventsTable(rawEventsContainer, Array.from(matchedEmails));
                        console.log('âš ï¸ ë§¤ì¹­ëœ ì‚¬ìš©ìì˜ Raw Eventsê°€ ì—†ìŠµë‹ˆë‹¤.');
                        console.log('ğŸ’¡ í•´ë‹¹ ì‚¬ìš©ìê°€ ì„ íƒëœ ê¸°ê°„ì— í™œë™í•˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    }
                } else {
                    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì›ë˜ í˜ì´ì§€ë„¤ì´ì…˜ ë°©ì‹ìœ¼ë¡œ ë³µì›
                    renderRawEventsTableWithPagination();
                    console.log('âœ… ê²€ìƒ‰ì–´ ì—†ìŒ - ì „ì²´ Raw Events í˜ì´ì§€ë„¤ì´ì…˜ ë³µì›');
                }
            } else {
                console.log('âš ï¸ All Raw Events ì»¨í…Œì´ë„ˆ ë˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.log(`   - ì»¨í…Œì´ë„ˆ ì¡´ì¬: ${!!rawEventsContainer}`);
                console.log(`   - ë°ì´í„° ì¡´ì¬: ${!!currentRawEventsData}`);
                console.log(`   - ë°ì´í„° ê¸¸ì´: ${currentRawEventsData?.length || 0}`);
            }
            
            const matchingType = isEmailSearch ? (hasExactMatch ? 'ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­' : 'ì´ë©”ì¼ ë¶€ë¶„ ë§¤ì¹­') : 'ë¶€ë¶„ ë§¤ì¹­';
            console.log(`âœ… Usage ê²€ìƒ‰ ì™„ë£Œ: "${searchTerm}" - ${matchingType}ìœ¼ë¡œ ë‘ í…Œì´ë¸” ì—°ë™ í•„í„°ë§ ì™„ë£Œ (ë§¤ì¹­ëœ ì‚¬ìš©ì ${matchedEmails.size}ëª…)`);
            
            // ê²€ìƒ‰ ì™„ë£Œ í›„ ëŒ€ê¸° ì¤‘ì¸ ì´ë©”ì¼ ê²€ìƒ‰ í”Œë˜ê·¸ ì œê±°
            if (window.pendingEmailSearch) {
                console.log(`ğŸ”„ ì´ë©”ì¼ ê²€ìƒ‰ í”Œë˜ê·¸ ì œê±°: ${window.pendingEmailSearch}`);
                delete window.pendingEmailSearch;
            }
        }

        // ë©¤ë²„ ì •ë ¬ ê¸°ëŠ¥
        let currentSortField = 'requests';
        let currentSortDirection = 'desc';

        function sortMembers(field) {
            const dataTable = document.querySelector('#members .data-table');
            const rows = Array.from(dataTable.querySelectorAll('.table-row'));
           
            // ì •ë ¬ ë°©í–¥ í† ê¸€
            if (currentSortField === field) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortDirection = 'asc';
            }
           
            // ì •ë ¬ í•¨ìˆ˜
            rows.sort((a, b) => {
                let aValue, bValue;
               
                switch(field) {
                    case 'name':
                        aValue = a.children[0].textContent.toLowerCase();
                        bValue = b.children[0].textContent.toLowerCase();
                        break;
                    case 'email':
                        aValue = a.children[1].textContent.toLowerCase();
                        bValue = b.children[1].textContent.toLowerCase();
                        break;
                    case 'requests':
                        aValue = parseInt(a.children[2].textContent.replace(/,/g, '')) || 0;
                        bValue = parseInt(b.children[2].textContent.replace(/,/g, '')) || 0;
                        break;
                    case 'spend':
                        aValue = parseFloat(a.children[3].textContent.replace('$', '')) || 0;
                        bValue = parseFloat(b.children[3].textContent.replace('$', '')) || 0;
                        break;
                    case 'role':
                        aValue = a.children[4].textContent.toLowerCase();
                        bValue = b.children[4].textContent.toLowerCase();
                        break;
                    default:
                        return 0;
                }
               
                if (currentSortDirection === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
           
            // ì •ë ¬ëœ í–‰ë“¤ì„ ë‹¤ì‹œ ì¶”ê°€
            rows.forEach(row => dataTable.appendChild(row));
           
            // í—¤ë” ì—…ë°ì´íŠ¸
            updateSortHeaders(field);
        }

        // ì •ë ¬ í—¤ë” ì—…ë°ì´íŠ¸
        function updateSortHeaders(field) {
            const headers = document.querySelectorAll('#members .table-header > div');
            headers.forEach((header, index) => {
                if (index < 5) { // ë§ˆì§€ë§‰ ë¹ˆ ì—´ ì œì™¸
                    const text = header.textContent.replace(/[â†‘â†“]/, '');
                    if (index === 0 && field === 'name') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 1 && field === 'email') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 2 && field === 'requests') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 3 && field === 'spend') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 4 && field === 'role') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else header.textContent = text + ' â†•';
                }
            });
        }

        // ê²€ìƒ‰ì°½ ì™¸ë¶€ í´ë¦­ ì‹œ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
        document.addEventListener('click', function(e) {
            const autocompleteDropdowns = document.querySelectorAll('.autocomplete-dropdown');
            const searchContainers = document.querySelectorAll('.search-container');
            
            let clickedInsideSearch = false;
            searchContainers.forEach(container => {
                if (container.contains(e.target)) {
                    clickedInsideSearch = true;
                }
            });
            
            if (!clickedInsideSearch) {
                autocompleteDropdowns.forEach(dropdown => {
                    dropdown.style.display = 'none';
                });
            }
        });

        // ìœ í‹¸ë¦¬í‹° ê°€ë“œ: PerformanceMonitor / updatePerformanceIndicator / SkeletonUIê°€ ì—†ìœ¼ë©´ ì•ˆì „í•œ ê¸°ë³¸ êµ¬í˜„ ì œê³µ
        (function(){
            try {
                if (typeof window.PerformanceMonitor === 'undefined') {
                    window.PerformanceMonitor = {
                        _marks: new Map(),
                        start(label) {
                            try { this._marks.set(label, (window.performance && performance.now) ? performance.now() : Date.now()); } catch (_) {}
                        },
                        end(label) {
                            try {
                                const start = this._marks.get(label);
                                const now = (window.performance && performance.now) ? performance.now() : Date.now();
                                const delta = (start != null) ? Math.round(now - start) : 0;
                                this._marks.delete(label);
                                return delta;
                            } catch (_) { return 0; }
                        }
                    };
                }
                if (typeof window.updatePerformanceIndicator === 'undefined') {
                    window.updatePerformanceIndicator = function(){ /* no-op */ };
                }
                if (typeof window.SkeletonUI === 'undefined') {
                    window.SkeletonUI = { show: function(){}, hide: function(){} };
                }
                if (typeof window.DataCache === 'undefined') {
                    window.DataCache = {
                        members: null,
                        events: null,
                        _ts: {},
                        set(key, value) { this[key] = value; this._ts[key] = Date.now(); },
                        get(key) { return this[key]; },
                        isValid(key, ttlMs = 5 * 60 * 1000) { // ê¸°ë³¸ TTL 5ë¶„
                            const ts = this._ts[key];
                            return !!ts && (Date.now() - ts) < ttlMs && !!this[key];
                        },
                        clear() { this.members = null; this.events = null; this._ts = {}; }
                    };
                }
            } catch (_) { /* ignore guard setup errors */ }
        })();

        // ìµœì í™”ëœ í˜ì´ì§€ ì´ˆê¸°í™” (Progressive Loading)
        document.addEventListener('DOMContentLoaded', async function() {
            PerformanceMonitor.start('í˜ì´ì§€ ì „ì²´ ë¡œë“œ');
            console.log('ğŸš€ ìµœì í™”ëœ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
           
            try {
                // 1ë‹¨ê³„: ì¦‰ì‹œ ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ (0ms)
                SkeletonUI.show('overview');
                updatePerformanceIndicator('loading', 'UI ì´ˆê¸°í™”');
                console.log('ğŸ’€ ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ ì™„ë£Œ');
               
                // 2ë‹¨ê³„: ê¸°ë³¸ UI ì´ˆê¸°í™” (ì¦‰ì‹œ)
                initOverviewStats();
               
                // Overview í•„í„° ê¸°ë³¸ê°’ì„ 30ì¼ë¡œ ì„¤ì •
                document.querySelectorAll('#overview .chart-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('#overview .chart-btn[data-days="30"]').classList.add('active');
                
                // ì´ˆê¸° í•„í„° ê¸°ê°„ í‘œì‹œ ì„¤ì • (30ì¼)
                const initialDateRange = getDateRange(30);
                updateFilterPeriodDisplay(initialDateRange.startDate, initialDateRange.endDate);
               
                createOverviewChart(); // ë¹ˆ ì°¨íŠ¸ ë¨¼ì € í‘œì‹œ
                window.overviewChartInitialized = true; // ì°¨íŠ¸ ì´ˆê¸°í™” í”Œë˜ê·¸ ì„¤ì •
                
                // ê¸°ë³¸ ì°¨íŠ¸ íƒ­ í™œì„±í™” (ì¼ë³„ í™œë™ ì¶”ì´)
                switchChart('activity-trend');
               
                // 3ë‹¨ê³„: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œì‘ (ë¹„ë™ê¸°)
                console.log('ğŸ“¡ ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
               
                // ìºì‹œ í™•ì¸ ë° ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ë¨¼ì € í‘œì‹œ
                if (DataCache.isValid('members') && DataCache.members) {
                    console.log('ğŸš€ ìºì‹œëœ ë©¤ë²„ ë°ì´í„°ë¡œ ì¦‰ì‹œ ê¸°ë³¸ UI ì—…ë°ì´íŠ¸');
                    updatePerformanceIndicator('cached', 'ìºì‹œ ì‚¬ìš©');
                    const totalMembers = DataCache.members.teamMembers?.length || 0;
                    updateStatsCards(totalMembers, 0, 0); // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¨¼ì € í‘œì‹œ
                } else {
                    updatePerformanceIndicator('loading', 'API í˜¸ì¶œ');
                }
               
                // 4ë‹¨ê³„: ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ë° ì—…ë°ì´íŠ¸
                await refreshAllRealData();
               
                // ì´ˆê¸° ë¡œë“œ ì™„ë£Œ í›„ ê¸°ë³¸ ì„ íƒ ìƒíƒœ ì„¤ì • (ì „ì²´ ë©¤ë²„)
                console.log('ì´ˆê¸° ë¡œë“œ ì™„ë£Œ í›„ ì „ì²´ ë©¤ë²„ ê¸°ë³¸ ì„ íƒ');
                document.querySelectorAll('.overview-stat-box').forEach(box => {
                    box.classList.remove('selected');
                });
                document.querySelector('.overview-stat-box[data-type="total"]').classList.add('selected');
                currentFilterType = 'total';
                
                // ë‚ ì§œ ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupAutoRefreshEvents();
                
                // ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupDateInputEvents();
                
                // Overview ì„¹ì…˜ì„ ìµœì´ˆ ë°©ë¬¸í•œ ê²ƒìœ¼ë¡œ í‘œì‹œ
                sectionVisited.overview = true;
               
                const totalLoadTime = PerformanceMonitor.end('í˜ì´ì§€ ì „ì²´ ë¡œë“œ');
                updatePerformanceIndicator('ready', `${totalLoadTime}ms`);
                console.log('âœ… ìµœì í™”ëœ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ!');
                
                // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™”
                console.log('ğŸ“… [INIT] ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™” ì‹œì‘');
                try {
                    // Settings í† ê¸€ ìƒíƒœ í™•ì¸
                    console.log(`ğŸ“… [INIT] emailSchedulerActive ì´ˆê¸° ìƒíƒœ: ${emailSchedulerActive}`);
                    
                    // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í™•ì¸
                    if (window.emailScheduleList && window.emailScheduleList.length > 0) {
                        console.log(`ğŸ“… [INIT] ì €ì¥ëœ ì˜ˆì•½ ë°œê²¬: ${window.emailScheduleList.length}ê°œ`);
                        
                        // í™œì„± ì˜ˆì•½ í™•ì¸
                        const activeSchedules = window.emailScheduleList.filter(s => s.status === 'í™œì„±');
                        console.log(`ğŸ“… [INIT] í™œì„± ì˜ˆì•½: ${activeSchedules.length}ê°œ`);
                        
                        if (activeSchedules.length > 0) {
                            console.log('ğŸ“… [INIT] í™œì„± ì˜ˆì•½ì´ ìˆìœ¼ë¯€ë¡œ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ìë™ ì‹œì‘í•©ë‹ˆë‹¤.');
                            
                            // ìŠ¤ì¼€ì¤„ëŸ¬ í™œì„±í™” (í† ê¸€ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ)
                            emailSchedulerActive = true;
                            console.log('ğŸ“… [INIT] emailSchedulerActiveë¥¼ trueë¡œ ì„¤ì •');
                            
                            // ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
                            startEmailScheduler();
                            console.log('ğŸ“… [INIT] ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘ ì™„ë£Œ');
                        } else {
                            console.log('ğŸ“… [INIT] í™œì„± ì˜ˆì•½ì´ ì—†ì–´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‹œì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        }
                    } else {
                        console.log('ğŸ“… [INIT] ì €ì¥ëœ ì˜ˆì•½ì´ ì—†ì–´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‹œì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error('âŒ [INIT] ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                }
               
            } catch (error) {
                PerformanceMonitor.end('í˜ì´ì§€ ì „ì²´ ë¡œë“œ');
                updatePerformanceIndicator('error', error.message.substring(0, 20));
                console.error('âŒ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
               
                // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ê¸°ë³¸ UIëŠ” í‘œì‹œ
                const errorMessage = `
                    <div style="text-align: center; padding: 50px; color: #ff6b6b;">
                        <h3>âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                `;
               
                const overviewSection = document.getElementById('overview');
                if (overviewSection) {
                    overviewSection.innerHTML = errorMessage;
                }
            }
        });

        // ìºì‹œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ (ë²„íŠ¼ìš©)
        function forceCacheRefresh() {
            console.log('ğŸ—‘ï¸ ìºì‹œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');
            DataCache.clear();
            location.reload();
        }

        // Refresh ì‹¤í–‰ ìƒíƒœ ê´€ë¦¬ (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
        let isRefreshInProgress = false;

        // ì§„í–‰ë°” ì œì–´ í•¨ìˆ˜ë“¤
        function showRefreshProgress() {
            const progressContainer = document.querySelector('.refresh-progress');
            const progressBar = document.querySelector('.refresh-progress-bar');
            if (progressContainer && progressBar) {
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
            }
        }

        function updateRefreshProgress(percentage) {
            const progressBar = document.querySelector('.refresh-progress-bar');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        }

        function hideRefreshProgress() {
            const progressContainer = document.querySelector('.refresh-progress');
            if (progressContainer) {
                progressContainer.style.display = 'none';
            }
        }

        // Refresh ë©”ë‰´ í´ë¦­ í•¸ë“¤ëŸ¬ (ì™„ì „ ë°±ê·¸ë¼ìš´ë“œ ë™ì‘)
        async function handleRefreshClick() {
            // ì´ë¯¸ refreshê°€ ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
            if (isRefreshInProgress) {
                console.log('ğŸ”„ Refresh ì´ë¯¸ ì§„í–‰ ì¤‘ - ìš”ì²­ ë¬´ì‹œ');
                return;
            }

            // ì§„í–‰ë°” í‘œì‹œ
            showRefreshProgress();
            
            // Refresh ì‹œì‘ (ì‚¬ìš©ìì—ê²ŒëŠ” ì•„ë¬´ ë³€í™” ì—†ìŒ)
            isRefreshInProgress = true;
            
            try {
                console.log('ğŸ”„ Refresh ì‹œì‘ - ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ê°±ì‹  (ì‚¬ìš©ì í™”ë©´ ë³€í™” ì—†ìŒ)');
                
                // í˜„ì¬ í™œì„±í™”ëœ ì„¹ì…˜ í™•ì¸
                const activeSection = document.querySelector('.content-section.active');
                const activeSectionId = activeSection ? activeSection.id : 'overview';
                
                console.log(`í˜„ì¬ í™œì„± ì„¹ì…˜: ${activeSectionId}`);
                
                // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëª¨ë“  ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ë³‘ë ¬ ì²˜ë¦¬)
                console.log('ğŸ“¡ ë°±ê·¸ë¼ìš´ë“œ API ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                
                // ì§„í–‰ë°” ë‹¨ê³„ë³„ ì—…ë°ì´íŠ¸
                updateRefreshProgress(20);
                await refreshOverviewData();
                updateRefreshProgress(50);
                await refreshMembersData();
                updateRefreshProgress(80);
                await refreshUsageData();
                updateRefreshProgress(90);
                
                // í˜„ì¬ ì„¹ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ í™”ë©´ ì—…ë°ì´íŠ¸
                await updateCurrentSectionDisplay(activeSectionId);
                updateRefreshProgress(100);
                
                console.log('âœ… Refresh ì™„ë£Œ - ëª¨ë“  ë°ì´í„°ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê°±ì‹ ë¨');
                
            } catch (error) {
                console.error('âŒ Refresh ì‹¤íŒ¨:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ì‚¬ìš©ì í™”ë©´ì—ëŠ” ë³€í™” ì—†ìŒ (ì½˜ì†”ì—ë§Œ ë¡œê·¸)
            } finally {
                // ì§„í–‰ë°” ìˆ¨ê¸°ê¸°
                setTimeout(() => {
                    hideRefreshProgress();
                }, 500);
                
                // Refresh ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
                isRefreshInProgress = false;
            }
        }

        // Overview ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨
        async function refreshOverviewData() {
            try {
                console.log('ğŸ“Š Overview ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì¤‘...');
                await updateOverviewWithRealData();
                console.log('âœ… Overview ë°ì´í„° ê°±ì‹  ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ Overview ë°ì´í„° ê°±ì‹  ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // Members ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨
        async function refreshMembersData() {
            try {
                console.log('ğŸ‘¥ Members ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì¤‘...');
                await updateMembersWithRealData();
                console.log('âœ… Members ë°ì´í„° ê°±ì‹  ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ Members ë°ì´í„° ê°±ì‹  ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // Usage ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨ (í™”ë©´ ë³€í™” ì—†ì´ ìºì‹œë§Œ ê°±ì‹ )
        async function refreshUsageData() {
            try {
                console.log('ğŸ“ˆ Usage ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì¤‘ (í™”ë©´ ë³€í™” ì—†ìŒ)...');
                
                // ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
                const dateRange = getDateRange(30);
                
                // API ë°ì´í„°ë§Œ ê°€ì ¸ì™€ì„œ ìºì‹œì— ì €ì¥ (í™”ë©´ ì—…ë°ì´íŠ¸ ì—†ìŒ)
                const [membersData, eventsData, usageData, spendingData] = await Promise.all([
                    getTeamMembers(),
                    getFilteredEvents(dateRange.startDate, dateRange.endDate),
                    getUsageData(dateRange.startDate, dateRange.endDate),
                    getTeamSpendingData()
                ]);
                
                // ìºì‹œì—ë§Œ ì €ì¥í•˜ê³  í™”ë©´ì€ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
                console.log('ğŸ’¾ Usage ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥ (í™”ë©´ ì—…ë°ì´íŠ¸ ì•ˆí•¨)');
                
                // ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„° ì €ì¥ (í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ)
                // ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°ëŠ” ìµœì‹ ìœ¼ë¡œ ìœ ì§€ë˜ì§€ë§Œ í™”ë©´ì€ ë³€ê²½ë˜ì§€ ì•ŠìŒ
                
                console.log('âœ… Usage ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì™„ë£Œ (ìºì‹œë§Œ ì—…ë°ì´íŠ¸)');
            } catch (error) {
                console.error('âŒ Usage ë°ì´í„° ê°±ì‹  ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // í˜„ì¬ ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸ (ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  í›„)
        async function updateCurrentSectionDisplay(activeSectionId) {
            try {
                console.log(`ğŸ–¥ï¸ í˜„ì¬ ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸: ${activeSectionId}`);
                switch(activeSectionId) {
                    case 'overview':
                        await updateOverviewWithCurrentFilter();
                        break;
                    case 'members':
                        // MembersëŠ” ì´ë¯¸ refreshMembersData()ì—ì„œ ê°±ì‹ ë¨
                        // ì¶”ê°€ í™”ë©´ ì—…ë°ì´íŠ¸ ì—†ìŒ
                        break;
                    case 'usage':
                        // UsageëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œë§Œ ë°ì´í„° ê°±ì‹ ë¨
                        // í™”ë©´ ì—…ë°ì´íŠ¸ í•˜ì§€ ì•ŠìŒ (ì‚¬ìš©ìê°€ ë³´ê³  ìˆëŠ” í™”ë©´ ìœ ì§€)
                        console.log('Usage ì„¹ì…˜: í™”ë©´ ì—…ë°ì´íŠ¸ ì•ˆí•¨ (ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹ ë§Œ)');
                        break;
                    case 'settings':
                        // SettingsëŠ” ë³„ë„ API ë°ì´í„°ê°€ ì—†ìŒ
                        break;
                }
                console.log(`âœ… ${activeSectionId} ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
            } catch (error) {
                console.error(`âŒ ${activeSectionId} ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`, error);
            }
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ì„¤ì •
        function setupAutoRefreshEvents() {
            console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
            
            // Overview ë‚ ì§œ ì…ë ¥ í•„ë“œ
            const overviewStartDate = document.getElementById('start-date');
            const overviewEndDate = document.getElementById('end-date');
            
            if (overviewStartDate && overviewEndDate) {
                overviewStartDate.addEventListener('change', debounce(async () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        console.log('Overview ì‹œì‘ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyDateFilter();
                    }
                }, 500));
                
                overviewEndDate.addEventListener('change', debounce(async () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        console.log('Overview ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyDateFilter();
                    }
                }, 500));
            }
            
            // Usage ë‚ ì§œ ì…ë ¥ í•„ë“œ
            const usageStartDate = document.getElementById('usage-start-date');
            const usageEndDate = document.getElementById('usage-end-date');
            
            if (usageStartDate && usageEndDate) {
                usageStartDate.addEventListener('change', debounce(async () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        console.log('Usage ì‹œì‘ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyUsageDateFilter();
                    }
                }, 500));
                
                usageEndDate.addEventListener('change', debounce(async () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        console.log('Usage ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyUsageDateFilter();
                    }
                }, 500));
            }
            
            console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì„¤ì •
        function setupDateInputEvents() {
            console.log('ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
            
            // Overview ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            const overviewStartDate = document.getElementById('start-date');
            const overviewEndDate = document.getElementById('end-date');
            
            if (overviewStartDate && overviewEndDate) {
                // ì‹œì‘ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                overviewStartDate.addEventListener('input', () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        const startDate = new Date(overviewStartDate.value).getTime();
                        const endDate = new Date(overviewEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateFilterPeriodDisplay(startDate, endDate);
                    }
                });
                
                // ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                overviewEndDate.addEventListener('input', () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        const startDate = new Date(overviewStartDate.value).getTime();
                        const endDate = new Date(overviewEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateFilterPeriodDisplay(startDate, endDate);
                    }
                });
            }
            
            // Usage ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            const usageStartDate = document.getElementById('usage-start-date');
            const usageEndDate = document.getElementById('usage-end-date');
            
            if (usageStartDate && usageEndDate) {
                // ì‹œì‘ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                usageStartDate.addEventListener('input', () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        const startDate = new Date(usageStartDate.value).getTime();
                        const endDate = new Date(usageEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateUsageFilterPeriodDisplay(startDate, endDate);
                    }
                });
                
                // ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                usageEndDate.addEventListener('input', () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        const startDate = new Date(usageStartDate.value).getTime();
                        const endDate = new Date(usageEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateUsageFilterPeriodDisplay(startDate, endDate);
                    }
                });
            }
            
            console.log('ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜ (ì—°ì† í˜¸ì¶œ ë°©ì§€)
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }



        // Email Report ì„¤ì • - ì§ì ‘ ì…ë ¥ ì²´í¬ë°•ìŠ¤ í† ê¸€ í•¨ìˆ˜
        function toggleCustomEmailInput(checkbox) {
            const customEmailInput = document.getElementById('custom-email-input');
            if (checkbox.checked) {
                customEmailInput.style.display = 'block';
                console.log('ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì˜ì—­ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                customEmailInput.style.display = 'none';
                console.log('ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì˜ì—­ì´ ìˆ¨ê²¨ì¡ŒìŠµë‹ˆë‹¤.');
            }
            updateRecipientCount();
        }

        // ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚° ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateRecipientCount() {
            let totalCount = 0;
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            const customEmails = document.getElementById('custom-emails');
            
            // ê´€ë¦¬ì ìˆ˜ ê³„ì‚°
            if (adminCheckbox && adminCheckbox.checked) {
                const adminCount = originalMembersData ? originalMembersData.filter(member => member.role === 'owner').length : 0;
                totalCount += adminCount;
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ ê³„ì‚°
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembersCount = originalMembersData ? originalMembersData.length : 0;
                totalCount += allMembersCount;
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ ê³„ì‚°
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveCount = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0).length : 0;
                totalCount += inactiveCount;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ìˆ˜ ê³„ì‚°
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim()) {
                const emailList = customEmails.value.split(',').filter(email => email.trim().length > 0);
                totalCount += emailList.length;
            }
            
            // ìˆ˜ì‹ ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const recipientCountElement = document.getElementById('recipient-count');
            if (recipientCountElement) {
                recipientCountElement.textContent = totalCount;
            }
            
            console.log(`ìˆ˜ì‹ ì ìˆ˜ ì—…ë°ì´íŠ¸: ${totalCount}ëª…`);
        }

        // Email Report ì„¤ì • - ë©”ì‹œì§€ ê¸€ì ìˆ˜ ì¹´ìš´í„° í•¨ìˆ˜
        function updateMessageCharCount() {
            const messageInput = document.getElementById('email-report-message');
            const charCount = document.getElementById('report-message-char-count');
            
            if (messageInput && charCount) {
                const maxLength = 1000;
                const currentLength = messageInput.value.length;
                
                // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
                charCount.textContent = currentLength;
                
                // ê¸€ì ìˆ˜ ì œí•œ
                if (currentLength > maxLength) {
                    messageInput.value = messageInput.value.substring(0, maxLength);
                    charCount.textContent = maxLength;
                }
                
                // ê¸€ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (currentLength >= maxLength * 0.9) {
                    charCount.style.color = '#ff9800'; // ê²½ê³  ìƒ‰ìƒ (90% ì´ìƒ)
                } else if (currentLength >= maxLength * 0.8) {
                    charCount.style.color = '#ff9800'; // ì£¼ì˜ ìƒ‰ìƒ (80% ì´ìƒ)
                } else {
                    charCount.style.color = '#7a7a7a'; // ê¸°ë³¸ ìƒ‰ìƒ
                }
            }
        }

        // ë©”ì‹œì§€ ì…ë ¥ë€ ë™ê¸°í™” í•¨ìˆ˜
        function syncMessageInputs(sourceId) {
            const emailReportMessage = document.getElementById('email-report-message');
            const emailMessageInput = document.getElementById('email-message-input');
            
            if (sourceId === 'email-report-message' && emailReportMessage && emailMessageInput) {
                // Email Report í…Œì´ë¸”ì˜ ì…ë ¥ë€ì—ì„œ ìˆ˜ì‹ ì ë³´ê¸° íŒì—…ì˜ ì…ë ¥ë€ìœ¼ë¡œ ë™ê¸°í™”
                emailMessageInput.value = emailReportMessage.value;
                
                // íŒì—…ì˜ ê¸€ì ìˆ˜ ì¹´ìš´í„°ë„ ì—…ë°ì´íŠ¸
                const popupCharCount = document.getElementById('message-char-count');
                if (popupCharCount) {
                    popupCharCount.textContent = emailReportMessage.value.length;
                }
                
                console.log('ë©”ì‹œì§€ ë™ê¸°í™”: Email Report â†’ ìˆ˜ì‹ ì ë³´ê¸° íŒì—…');
            } else if (sourceId === 'email-message-input' && emailMessageInput && emailReportMessage) {
                // ìˆ˜ì‹ ì ë³´ê¸° íŒì—…ì˜ ì…ë ¥ë€ì—ì„œ Email Report í…Œì´ë¸”ì˜ ì…ë ¥ë€ìœ¼ë¡œ ë™ê¸°í™”
                emailReportMessage.value = emailMessageInput.value;
                
                // Email Reportì˜ ê¸€ì ìˆ˜ ì¹´ìš´í„°ë„ ì—…ë°ì´íŠ¸
                updateMessageCharCount();
                
                console.log('ë©”ì‹œì§€ ë™ê¸°í™”: ìˆ˜ì‹ ì ë³´ê¸° íŒì—… â†’ Email Report');
            }
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ë³´ê¸° í•¨ìˆ˜
        function showEmailScheduleList() {
            // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('email-schedule-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™” (ì´ì „ íŒì—…ì—ì„œ ë‚¨ì€ ì„ íƒìœ¼ë¡œ ì˜¤ì‘ë™ ë°©ì§€)
            window._selectedScheduleIds = new Set();

            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ë°ì´í„° (ì €ì¥ëœ ì˜ˆì•½ë§Œ í‘œì‹œ)
            let scheduleList = [];
            
            // ìˆ˜ì‹ ì ë¬¸ìì—´ ì •ë¦¬ í•¨ìˆ˜ (ê³¼ê±°ì— ì˜ëª» ì €ì¥ëœ ë¹„ìˆ˜ì‹ ì í† í° ì œê±°)
            const sanitizeRecipients = (recipients) => {
                if (!recipients || typeof recipients !== 'string') return recipients || '';
                const validTokens = new Set(['ê´€ë¦¬ì', 'ì „ì²´ ë©¤ë²„', 'ë¹„í™œì„± ë©¤ë²„', 'ì§ì ‘ì…ë ¥', 'ì§ì ‘ ì…ë ¥']);
                const cleaned = [];
                recipients.split(',').forEach(token => {
                    const t = token.trim();
                    if (validTokens.has(t) && !cleaned.includes(t)) {
                        cleaned.push(t);
                    }
                });
                return cleaned.join(', ');
            };

            // ì €ì¥ëœ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì¶”ê°€ (ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í¬í•¨)
            if (window.emailScheduleList && window.emailScheduleList.length > 0) {
                // ê¸°ì¡´ ë°ì´í„°ì— currentSend í•„ë“œê°€ ì—†ëŠ” ê²½ìš° ì¶”ê°€ ë° ì‹œê°„ ê°±ì‹ 
                const migratedScheduleList = window.emailScheduleList.map(schedule => {
                    if (!schedule.currentSend) {
                        // currentSendê°€ ì—†ìœ¼ë©´ nextSendë¥¼ currentSendë¡œ ë³µì‚¬í•˜ê³  ìƒˆë¡œìš´ nextSend ê³„ì‚°
                        schedule.currentSend = schedule.nextSend;
                        const frequency = getFrequencyValue(schedule.frequency);
                        if (frequency) {
                            schedule.nextSend = calculateNextSendTimeFromCurrent(schedule.currentSend, frequency);
                        }
                        console.log(`ğŸ“‹ ê¸°ì¡´ ì˜ˆì•½ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜: ${schedule.title}`);
                    }
                    
                    // ì‹œê°„ ê°±ì‹ : ì´ë²ˆ ë°œì†¡ ì‹œê°„ì´ ê³¼ê±°ì¸ ê²½ìš° ê°±ì‹ 
                    updateScheduleTimeIfNeeded(schedule);

                    // ìˆ˜ì‹ ì ë¬¸ìì—´ ì •ë¦¬: ë¹„ìˆ˜ì‹ ì í† í°(ì˜ˆ: ì‚¬ìš©ëŸ‰) ì œê±° ë° ì¤‘ë³µ ì œê±°
                    if (schedule.recipients) {
                        const before = schedule.recipients;
                        schedule.recipients = sanitizeRecipients(schedule.recipients);
                        if (before !== schedule.recipients) {
                            console.log(`ğŸ§¹ ìˆ˜ì‹ ì ì •ë¦¬: '${before}' â†’ '${schedule.recipients}'`);
                        }
                    }
                    
                    return schedule;
                });
                scheduleList = scheduleList.concat(migratedScheduleList);
            }

            // ëª¨ë‹¬ HTML ìƒì„±
            const modalHTML = `
                <div id="email-schedule-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        background-color: #2a2a2a;
                        margin: 5% auto;
                        padding: 25px;
                        border-radius: 8px;
                        width: 90%;
                        max-width: 800px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                        max-height: 85vh;
                        overflow-y: auto;
                        border: 1px solid #3a3a3a;
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 25px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid #3a3a3a;
                        ">
                            <div style="color: #fff; font-size: 18px; font-weight: 600;">ë©”ì¼ ë°œì†¡ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸</div>
                            <button onclick="closeEmailScheduleModal()" style="
                                background: none;
                                border: none;
                                color: #7a7a7a;
                                font-size: 20px;
                                cursor: pointer;
                                padding: 5px;
                                border-radius: 3px;
                                transition: color 0.2s ease;
                            " onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#7a7a7a'">Ã—</button>
                        </div>

                        <!-- ê²€ìƒ‰ ë° í•„í„° -->
                        <div style="margin-bottom: 20px;">
                            <div style="
                                position: relative;
                                display: flex;
                                align-items: center;
                                background-color: #1a1a1a;
                                border: 1px solid #3a3a3a;
                                border-radius: 4px;
                                padding: 0 12px;
                                transition: all 0.2s ease;
                                margin-bottom: 15px;
                            " onfocus="this.style.backgroundColor='#2a2a2a'; this.style.borderColor='#4a9eff'" onblur="this.style.backgroundColor='#1a1a1a'; this.style.borderColor='#3a3a3a'">
                                <span style="
                                    color: #7a7a7a;
                                    margin-right: 8px;
                                    font-size: 14px;
                                ">ğŸ”</span>
                                <input 
                                    type="text" 
                                    id="schedule-search" 
                                    placeholder="ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰..."
                                    style="
                                        flex: 1;
                                        padding: 10px 0;
                                        border: none;
                                        background: transparent;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        outline: none;
                                    "
                                >
                            </div>
                            
                            <!-- í•„í„° ë²„íŠ¼ -->
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <button class="analytics-btn" onclick="deleteAllSchedules()">ì „ì²´ ì‚­ì œ</button>
                                <button class="chart-btn active" data-filter="all" onclick="filterScheduleList('all')">ì „ì²´</button>
                                <button class="chart-btn" data-filter="active" onclick="filterScheduleList('active')">í™œì„±</button>
                                <button class="chart-btn" data-filter="inactive" onclick="filterScheduleList('inactive')">ë¹„í™œì„±</button>
                            </div>
                        </div>

                        <!-- ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
                        <div style="
                            background-color: #1a1a1a;
                            border-radius: 4px;
                            overflow: hidden;
                            margin-bottom: 20px;
                        ">
                            <!-- í…Œì´ë¸” í—¤ë” -->
                            <div style="
                                display: grid;
                                grid-template-columns: 0.6fr 2fr 1fr 1.2fr 1.2fr 1.5fr 0.8fr 0.8fr 0.8fr;
                                gap: 15px;
                                padding: 15px;
                                border-bottom: 1px solid #3a3a3a;
                                font-weight: 600;
                                color: #fff;
                                font-size: 14px;
                            ">
                                <div style="text-align:center;">
                                    <input type="checkbox" id="select-all-schedules" style="width: 16px; height: 16px; accent-color: #4a9eff;">
                                </div>
                                <div>ì œëª©</div>
                                <div>ì£¼ê¸°</div>
                                <div>ì´ë²ˆ ë°œì†¡</div>
                                <div>ë‹¤ìŒ ë°œì†¡</div>
                                <div>ìˆ˜ì‹ ì</div>
                                <div>í™œì„±</div>
                                <div>ë¹„í™œì„±</div>
                                <div>ì‚­ì œ</div>
                            </div>

                            <!-- í…Œì´ë¸” ë‚´ìš© -->
                            <div id="schedule-list-content">
                                ${scheduleList.map(item => `
                                    <div class="schedule-item" data-id="${item.id}" data-status="${item.status}" style="
                                        display: grid;
                                        grid-template-columns: 0.6fr 2fr 1fr 1.2fr 1.2fr 1.5fr 0.8fr 0.8fr 0.8fr;
                                        gap: 15px;
                                        padding: 15px;
                                        border-bottom: 1px solid #3a3a3a;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        transition: background-color 0.2s ease;
                                    " onmouseover="this.style.backgroundColor='#3a3a3a'" onmouseout="this.style.backgroundColor='transparent'">
                                        <!-- ì„ íƒ ì²´í¬ë°•ìŠ¤ -->
                                        <div style="text-align: center;">
                                            <input type="checkbox" class="schedule-select-checkbox" data-id="${item.id}" onchange="handleSelectSchedule(${item.id}, this.checked)" style="
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                        </div>
                                        <!-- ì œëª© (ìš”ì•½ í‘œì‹œ) -->
                                        <div>
                                            <div class="editable-field" data-field="title" style="font-weight: 600; color: #fff; margin-bottom: 5px;">${item.title}</div>
                                            <div style="color: #7a7a7a; font-size: 12px; display:-webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${(() => { const limit = (window.PREVIEW_MESSAGE_MAX || 80); const m=(item.message||'').toString().replace(/\s+/g,' ').trim(); return m.length>limit? m.slice(0,limit)+'â€¦': m; })()}</div>
                                        </div>
                                        <!-- ì£¼ê¸° -->
                                        <div>
                                            <div class="editable-field" data-field="frequency">${item.frequency}</div>
                                        </div>
                                        <!-- ì´ë²ˆ ë°œì†¡ -->
                                        <div>
                                            <div class="editable-field" data-field="currentSend" style="color: #ff9800; font-weight: 600;">${item.currentSend || item.nextSend}</div>
                                        </div>
                                        <!-- ë‹¤ìŒ ë°œì†¡ (ìë™ ê³„ì‚°) -->
                                        <div class="next-send-time" style="color: #7a7a7a;">${item.nextSend}</div>
                                        <!-- ìˆ˜ì‹ ì -->
                                        <div>
                                            <div class="editable-field" data-field="recipients">${item.recipients}</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <input type="radio" name="status-${item.id}" value="active" ${item.status === 'í™œì„±' ? 'checked' : ''} 
                                                   onchange="updateScheduleStatus(${item.id}, 'í™œì„±')" style="
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                        </div>
                                        <div style="text-align: center;">
                                            <input type="radio" name="status-${item.id}" value="inactive" ${item.status === 'ë¹„í™œì„±' ? 'checked' : ''} 
                                                   onchange="updateScheduleStatus(${item.id}, 'ë¹„í™œì„±')" style="
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                        </div>
                                        <div style="text-align: center;">
                                            <button onclick="deleteSchedule(${item.id})" style="
                                                background: none;
                                                border: none;
                                                color: #ff4757;
                                                cursor: pointer;
                                                padding: 4px;
                                                font-size: 16px;
                                                font-weight: bold;
                                            ">Ã—</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                        <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #3a3a3a; padding-top: 20px;">
                            <div style="color: #7a7a7a; font-size: 14px;">
                                ì´ ${scheduleList.length}ê°œì˜ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="chart-btn" onclick="showSelectedSchedulePreview()">ë¯¸ë¦¬ë³´ê¸°</button>
                                <button class="chart-btn" onclick="editSelectedSchedule()">ìˆ˜ì •</button>
                                <button class="chart-btn" onclick="saveScheduleChanges()">ì €ì¥</button>
                                <button class="chart-btn" onclick="closeEmailScheduleModal()">ë‹«ê¸°</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
            setTimeout(() => {
                const searchInput = document.getElementById('schedule-search');
                const selectAll = document.getElementById('select-all-schedules');
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();
                        const scheduleItems = document.querySelectorAll('#email-schedule-modal .schedule-item');
                        
                        scheduleItems.forEach(item => {
                            const text = item.textContent.toLowerCase();
                            if (text.includes(searchTerm)) {
                                item.style.display = 'grid';
                            } else {
                                item.style.display = 'none';
                            }
                        });
                    });
                }
                if (selectAll) {
                    selectAll.addEventListener('change', function() {
                        const checked = this.checked;
                        const checkboxes = document.querySelectorAll('#email-schedule-modal .schedule-select-checkbox');
                        checkboxes.forEach(cb => {
                            cb.checked = checked;
                            const id = parseInt(cb.getAttribute('data-id'));
                            handleSelectSchedule(id, checked);
                        });
                    });
                }
            }, 100);
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ì„ íƒ ìƒíƒœ ê´€ë¦¬
        window._selectedScheduleIds = new Set();
        function handleSelectSchedule(id, isSelected) {
            if (!window._selectedScheduleIds) window._selectedScheduleIds = new Set();
            if (isSelected) window._selectedScheduleIds.add(id);
            else window._selectedScheduleIds.delete(id);
            // ë‹¨ì¼ ì„ íƒ ë³´ì¥ ì˜µì…˜: í•˜ë‚˜ë§Œ ì„ íƒë˜ì–´ì•¼ í•˜ëŠ” ì•¡ì…˜ ëŒ€ë¹„ ì•ˆì „ì¥ì¹˜
            // ì²´í¬í•œ ì§í›„ì—ë„ DOMì—ì„œ ë‹¤ì‹œ í™•ì¸ ê°€ëŠ¥
        }

        // ì„ íƒëœ ì˜ˆì•½ ë¯¸ë¦¬ë³´ê¸° (ì²¨ë¶€ íŒŒì¼ í¬í•¨)
        async function showSelectedSchedulePreview() {
            const ids = Array.from(window._selectedScheduleIds || []);
            if (!ids.length) {
                showSimpleAlert('âš ï¸ ë¯¸ë¦¬ë³´ê¸°í•  ì˜ˆì•½ì„ ì„ íƒí•˜ì„¸ìš”.', 'warning');
                return;
            }
            const schedules = (window.emailScheduleList || []).filter(s => ids.includes(s.id));
            if (!schedules.length) {
                showSimpleAlert('âš ï¸ ì„ íƒëœ ì˜ˆì•½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            // ì²¨ë¶€ íŒŒì¼ í˜„ì¬ ì„¤ì • ìš”ì•½
            // ì²¨ë¶€ ì„¤ì •: ì €ì¥ëœ ì˜ˆì•½ì˜ ìŠ¤ëƒ…ìƒ· ìš°ì„ , ì—†ìœ¼ë©´ í˜„ì¬ UI ê°’ ì‚¬ìš©
            const saved = schedules[0] || {};
            const attAll = (typeof saved.attachAllMembers === 'boolean') ? saved.attachAllMembers : !!document.getElementById('attachment-all-members')?.checked;
            const attInactive = (typeof saved.attachInactiveMembers === 'boolean') ? saved.attachInactiveMembers : !!document.getElementById('attachment-inactive-members')?.checked;
            const attCustom = (typeof saved.attachCustom === 'boolean') ? saved.attachCustom : !!document.getElementById('attachment-custom')?.checked;
            const attAllUsage = (typeof saved.attachAllUsage === 'boolean')
                ? saved.attachAllUsage
                : !!document.getElementById('attachment-all-usage')?.checked;
            const attInactiveUsage = (typeof saved.attachInactiveUsage === 'boolean')
                ? saved.attachInactiveUsage
                : !!document.getElementById('attachment-inactive-usage')?.checked;
            const attCustomUsage = (typeof saved.attachCustomUsage === 'boolean')
                ? saved.attachCustomUsage
                : !!document.getElementById('attachment-custom-usage')?.checked;
            const usagePeriodText = (() => {
                const savedText = (saved.usagePeriodText && saved.usagePeriodText.trim()) || '';
                const fromAttachment = (document.getElementById('usage-attachment-period-text')?.textContent || '').trim();
                const fromUsage = (document.getElementById('usage-filter-period-text')?.textContent || '').trim();
                const fromOverview = (document.getElementById('filter-period-text')?.textContent || '').trim();
                const isUnset = (t) => !t || t === 'ê¸°ê°„ì„ ì„ íƒí•˜ì„¸ìš”';
                if (!isUnset(savedText)) return savedText;
                if (!isUnset(fromAttachment)) return fromAttachment;
                if (!isUnset(fromUsage)) return fromUsage;
                return fromOverview;
            })();
            const customAttachmentEmails = (document.getElementById('attachment-custom-emails')?.value || '').trim();

            // 1) ì¦‰ì‹œ í‘œì‹œìš© ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ì‰˜ì„ ë¨¼ì € ë Œë”ë§ (ë¡œë”© ìƒíƒœ)
            (function renderPreviewShell(){
                try {
                    if (document.getElementById('schedule-preview-modal')) return;
                    const schedule = schedules[0] || {};
                    const chipsHTML = (() => {
                        const r=(schedule?.recipients||'');
                        const map={ 'ê´€ë¦¬ì':'admin','ì „ì²´ ë©¤ë²„':'all','ë¹„í™œì„± ë©¤ë²„':'inactive','ì§ì ‘ì…ë ¥':'custom'};
                        const chips=['ê´€ë¦¬ì','ì „ì²´ ë©¤ë²„','ë¹„í™œì„± ë©¤ë²„','ì§ì ‘ì…ë ¥']
                            .filter(x=>r.includes(x))
                            .map(x=>`<span class=\"recipient-chip\" data-group=\"${map[x]}\" style=\"background:#2a2a2a; border:1px solid #ff9800; color:#ff9800; padding:4px 8px; border-radius:999px; font-size:12px; cursor:pointer;\">${x}</span>`)
                            .join(' ');
                        return chips || '<span style=\"color:#7a7a7a;\">ì„ íƒëœ ê·¸ë£¹ ì—†ìŒ</span>';
                    })();
                    const shell = `
                        <div id=\"schedule-preview-modal\" style=\"position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:1100;\">
                            <div style=\"position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:900px; max-height:85vh; overflow:auto; background:#2a2a2a; border:1px solid #3a3a3a; border-radius:8px; padding:20px;\">
                                <div style=\"display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #3a3a3a; padding-bottom:12px; margin-bottom:16px;\">
                                    <div style=\"color:#fff; font-size:18px; font-weight:600;\">ì˜ˆì•½ ë¯¸ë¦¬ë³´ê¸°</div>
                                    <button class=\"chart-btn\" onclick=\"document.getElementById('schedule-preview-modal').remove()\">ë‹«ê¸°</button>
                                </div>
                                <div style=\"background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px; padding:12px;\">
                                    <div style=\"font-size:14px; margin-top:12px;\">
                                        <div style=\"color:#fff; font-weight:600; margin-bottom:6px;\">ë°œì†¡ ë©”ì‹œì§€</div>
                                        <div id=\"preview-message-content\" style=\"background:#0f0f0f; border:1px solid #3a3a3a; border-radius:6px; padding:12px; color:#ff9800; white-space:pre-wrap;\">ë¡œë”© ì¤‘...</div>
                                    </div>
                                    <div style=\"margin-top:12px;\">
                                        <div style=\"color:#fff; font-weight:600; margin-bottom:8px;\">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                                        <div id=\"recipient-chips\" style=\"display:flex; gap:8px; flex-wrap:wrap;\">${chipsHTML}</div>
                                    </div>
                                </div>
                                <div style=\"color:#e1e1e1; font-size:14px; margin:16px 0;\">
                                    <div style=\"color:#fff; font-size:16px; font-weight:600; margin-bottom:8px;\">ì²¨ë¶€ íŒŒì¼ ìš”ì•½</div>
                                    <div id=\"attachments-summary-content\" style=\"background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px; padding:12px; color:#7a7a7a;\">ë¡œë”© ì¤‘...</div>
                                </div>
                                <div style=\"margin-top:16px; background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px;\">
                                    <div style=\"display:flex; justify-content:space-between; align-items:center; color:#fff; font-size:16px; font-weight:600; border-bottom:1px solid #3a3a3a; padding:12px;\">
                                        <div>ì²¨ë¶€ íŒŒì¼ ë‚´ìš©</div>
                                        <div style=\"display:flex; gap:8px;\">
                                            <button id=\"attachments-csv-download\" class=\"analytics-btn\" disabled>CSV ë‹¤ìš´ë¡œë“œ</button>
                                        </div>
                                    </div>
                                    <div style=\"padding:12px;\">
                                        <pre id=\"attachments-csv-content\" style=\"white-space:pre; overflow:auto; max-height:50vh; background:#0f0f0f; border:1px solid #3a3a3a; border-radius:6px; padding:12px; color:#7a7a7a;\">ìƒì„± ì¤‘...</pre>
                                    </div>
                                </div>
                                <div style=\"display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:16px; border-top:1px solid #3a3a3a; padding-top:16px;\">
                                    <div>
                                        <button id=\"schedule-preview-send-now-btn\" class=\"analytics-btn\" disabled>ğŸ“§ ì¦‰ì‹œ ë°œì†¡</button>
                                    </div>
                                    <div style=\"display:flex; gap:10px;\">
                                        <button id=\"schedule-preview-edit-btn\" class=\"chart-btn\" disabled>ìˆ˜ì •</button>
                                        <button class=\"chart-btn\" onclick=\"document.getElementById('schedule-preview-modal').remove()\">ë‹«ê¸°</button>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    document.body.insertAdjacentHTML('beforeend', shell);
                } catch (e) {}
            })();

            // í‘œë³¸ ë°ì´í„° ìƒì„±: ë¹„í™œì„± ë©¤ë²„ ìƒìœ„ Nëª…, ì „ì²´ ë©¤ë²„ ìƒìœ„ Nëª…, ì§ì ‘ì…ë ¥ Nê°œ, ì‚¬ìš©ëŸ‰ ê¸°ê°„ ìš”ì•½
            const SAMPLE_COUNT = 10;
            let inactiveSamples = [];
            let allMemberSamples = [];
            let customSamples = [];

            try {
                if ((attInactive || attAll) && typeof getTeamMembers === 'function') {
                    const membersData = await getTeamMembers();
                    const members = membersData && membersData.teamMembers ? membersData.teamMembers : [];
                    if (attInactive) {
                        const inactives = members.filter(m => (m.spendData && m.spendData.premiumRequests === 0));
                        inactiveSamples = inactives.slice(0, SAMPLE_COUNT).map(m => `${m.name || m.email || 'unknown'} <${m.email || ''}>`);
                    }
                    if (attAll) {
                        allMemberSamples = members.slice(0, SAMPLE_COUNT).map(m => `${m.name || m.email || 'unknown'} <${m.email || ''}>`);
                    }
                }
            } catch (e) {
                console.warn('ì²¨ë¶€ í‘œë³¸ ë°ì´í„° ìˆ˜ì§‘ ì¤‘ ì˜¤ë¥˜:', e);
            }

            if (attCustom) {
                const list = (customAttachmentEmails || '')
                    .split(',')
                    .map(s => s.trim())
                    .filter(Boolean);
                customSamples = list.slice(0, SAMPLE_COUNT);
            }

            let attachmentSummaryHTML = "";

            // ìƒì„¸ ì²¨ë¶€ ìš”ì•½ì„ ìœ„í•œ ì „ì²´ ëª©ë¡ ë° ì¹´ìš´íŠ¸ ê³„ì‚°
            const allMemberFullList = [];
            const inactiveFullList = [];
            const customFullList = (customAttachmentEmails || '').split(',').map(s => s.trim()).filter(Boolean);

            const allMemberCount = 0;
            const inactiveCount = 0;
            const customCount = attCustom ? customFullList.length : 0;

            const sampleBlock = (items) => {
                const take = items.slice(0, Math.max(3, Math.min(10, items.length)));
                if (!take.length) return '<div style="color:#7a7a7a;">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return `<pre style=\"white-space:pre-wrap; background:#0f0f0f; border:1px solid #3a3a3a; border-radius:6px; padding:10px; color:#e1e1e1; max-height:120px; overflow:auto;\">${take.join('\n')}${items.length>take.length?'\nâ€¦':''}</pre>`;
            };

            const attachmentRows = [];
            attachmentRows.push(`<div>â€¢ ì „ì²´ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸: <span style=\"color:#ff9800; font-weight:600;\">${attAll ? 'í¬í•¨' : 'ë¯¸í¬í•¨'}${attAllUsage ? ' (ì‚¬ìš©ëŸ‰ í¬í•¨)' : ''}</span>${attAll ? ` <span style=\"color:#b1b1b1;\">(ì´ ${allMemberCount}ëª…)</span>` : ''} ${attAll ? `<button id=\"view-all-all-members\" class=\"chart-btn\" style=\"padding:2px 8px; font-size:12px; margin-left:6px;\">ì „ì²´ ë³´ê¸°</button>` : ''}</div>`);
            if (attAll) attachmentRows.push(`<div style=\"margin-top:6px;\">${'<div style="color:#7a7a7a;">ëª©ë¡ì€ ë©¤ë²„ ë¡œë”© í›„ í‘œì‹œë©ë‹ˆë‹¤.</div>'}</div>`);
            attachmentRows.push(`<div style=\"margin-top:10px;\">â€¢ ë¹„í™œì„± ë©¤ë²„ ë¦¬ìŠ¤íŠ¸: <span style=\"color:#ff9800; font-weight:600;\">${attInactive ? 'í¬í•¨' : 'ë¯¸í¬í•¨'}${attInactiveUsage ? ' (ì‚¬ìš©ëŸ‰ í¬í•¨)' : ''}</span>${attInactive ? ` <span style=\"color:#b1b1b1;\">(ì´ ${inactiveCount}ëª…)</span>` : ''} ${attInactive ? `<button id=\"view-all-inactive-members\" class=\"chart-btn\" style=\"padding:2px 8px; font-size:12px; margin-left:6px;\">ì „ì²´ ë³´ê¸°</button>` : ''}</div>`);
            if (attInactive) attachmentRows.push(`<div style=\"margin-top:6px;\">${'<div style="color:#7a7a7a;">ëª©ë¡ì€ ë©¤ë²„ ë¡œë”© í›„ í‘œì‹œë©ë‹ˆë‹¤.</div>'}</div>`);
            attachmentRows.push(`<div style=\"margin-top:10px;\">â€¢ ì§ì ‘ ì…ë ¥ ë¦¬ìŠ¤íŠ¸: <span style=\"color:#ff9800; font-weight:600;\">${attCustom ? 'í¬í•¨' : 'ë¯¸í¬í•¨'}${attCustomUsage ? ' (ì‚¬ìš©ëŸ‰ í¬í•¨)' : ''}</span>${attCustom ? ` <span style=\"color:#b1b1b1;\">(ì´ ${customCount}ëª…)</span>` : ''} ${attCustom ? `<button id=\"view-all-custom\" class=\"chart-btn\" style=\"padding:2px 8px; font-size:12px; margin-left:6px;\">ì „ì²´ ë³´ê¸°</button>` : ''}</div>`);
            if (attCustom) attachmentRows.push(`<div style=\"margin-top:6px;\">${sampleBlock(customFullList)}</div>`);

            attachmentSummaryHTML = attachmentRows.join('');

            // CSV ìƒì„± ì¤€ë¹„
            const delimiter = ',';
            const newline = '\n';
            const quote = (val) => {
                const s = (val ?? '').toString();
                const needsQuote = s.includes('"') || s.includes(delimiter) || s.includes('\n') || s.includes('\r');
                const escaped = s.replace(/"/g, '""');
                return needsQuote ? `"${escaped}"` : escaped;
            };

            // ì‚¬ìš©ëŸ‰ ê¸°ê°„ íŒŒì‹±
            let startDate = null, endDate = null;
            const periodMatch = usagePeriodText.match(/(\d{4}-\d{2}-\d{2})\s*~\s*(\d{4}-\d{2}-\d{2})/);
            if (periodMatch) {
                startDate = periodMatch[1];
                endDate = periodMatch[2];
            }

            // ë©¤ë²„/ì´ë²¤íŠ¸ ë°ì´í„° ìˆ˜ì§‘
            let members = [];
            try {
                const membersData = await getTeamMembers();
                members = membersData && membersData.teamMembers ? membersData.teamMembers : [];
            } catch (e) {
                console.warn('ë¯¸ë¦¬ë³´ê¸° ë©¤ë²„ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:', e);
            }

            // ì´ë²¤íŠ¸ ë§µ: ê¸°ê°„ì´ ì„¤ì •ë˜ë©´ ì´ë²¤íŠ¸ ë¨¼ì € ìˆ˜ì§‘í•´ ë¹„í™œì„± ê³„ì‚°ì— ì‚¬ìš©
            let emailToUsageCost = new Map();
            let emailToLastTs = new Map();
            const anyUsage = (attAllUsage || attInactiveUsage || attCustomUsage) && startDate && endDate;
            const needEventsForInactivity = attInactive && startDate && endDate;
            const shouldFetchEvents = (anyUsage || needEventsForInactivity) && startDate && endDate;
            if (shouldFetchEvents) {
                try {
                    const eventsData = await getFilteredEvents(startDate, endDate);
                    if (eventsData && eventsData.usageEvents) {
                        for (const ev of eventsData.usageEvents) {
                            const key = ev.userEmail || ev.email;
                            if (!key) continue;
                            const prev = emailToUsageCost.get(key) || 0;
                            emailToUsageCost.set(key, prev + (ev.requestsCosts || 0));
                            const ts = parseInt(ev.timestamp || 0) || 0;
                            const prevTs = emailToLastTs.get(key) || 0;
                            if (ts > prevTs) emailToLastTs.set(key, ts);
                        }
                    }
                } catch (e) {
                    console.warn('ë¯¸ë¦¬ë³´ê¸° ì‚¬ìš©ëŸ‰ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨:', e);
                }
            }

            // ë©¤ë²„ í™•ë³´ í›„ ì²¨ë¶€ ìš”ì•½ ìƒì„± (ì‹¤ì œ ëª©ë¡/ì¹´ìš´íŠ¸/ìƒ˜í”Œ/ì „ì²´ë³´ê¸°)
            (function(){
                try {
                    const allMemberFullList = (members || []).map(m => `${m.name || m.email || 'unknown'} <${m.email || ''}>`).filter(Boolean);
                    const customFullList = (customAttachmentEmails || '').split(',').map(s => s.trim()).filter(Boolean);

                    // ë¹„í™œì„± ê¸°ì¤€: ì²¨ë¶€ íŒŒì¼ ì„¹ì…˜ê³¼ ë™ì¼í•˜ê²Œ "ìµœê·¼ Nì¼ ë¬´í™œë™" ê¸°ì¤€ ì‚¬ìš©
                    const inactivityDays = (window.attachmentInactiveState && window.attachmentInactiveState.days)
                        || parseInt(document.getElementById('attachment-inactive-days')?.value)
                        || 14;
                    const rawEventsNow = (typeof currentRawEventsData !== 'undefined' && Array.isArray(currentRawEventsData)
                        ? currentRawEventsData
                        : (window.currentRawEventsData || []));
                    const allowedEventsNow = rawEventsNow.filter(ev => ev && ev.userEmail && typeof ev.requestsCosts === 'number' && ev.requestsCosts > 0 && !isNaN(parseInt(ev.timestamp)));
                    const cutoffTs = Date.now() - (inactivityDays * 24 * 60 * 60 * 1000);
                    const activeEmailsSet = new Set();
                    for (const ev of allowedEventsNow) {
                        const ts = parseInt(ev.timestamp);
                        if (ts >= cutoffTs) {
                            activeEmailsSet.add(ev.userEmail);
                        }
                    }
                    const inactiveByDays = (members || []).filter(m => !activeEmailsSet.has(m.email));
                    const inactiveFullList = inactiveByDays.map(m => `${m.name || m.email || 'unknown'} <${m.email || ''}>`).filter(Boolean);

                    const allMemberCount = attAll ? allMemberFullList.length : 0;
                    const inactiveCount = attInactive ? inactiveFullList.length : 0;
                    const customCount = attCustom ? customFullList.length : 0;

                    const sampleBlock = (items) => {
                        const take = items.slice(0, Math.max(3, Math.min(10, items.length)));
                        if (!take.length) return '<div style=\"color:#7a7a7a;\">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                        return `<pre style=\"white-space:pre-wrap; background:#0f0f0f; border:1px solid #3a3a3a; border-radius:6px; padding:10px; color:#e1e1e1; max-height:120px; overflow:auto;\">${take.join('\\n')}${items.length>take.length?'\\nâ€¦':''}</pre>`;
                    };

                    const attachmentRows = [];
                    attachmentRows.push(`<div>â€¢ ì „ì²´ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸: <span style=\"color:#ff9800; font-weight:600;\">${attAll ? 'í¬í•¨' : 'ë¯¸í¬í•¨'}${attAllUsage ? ' (ì‚¬ìš©ëŸ‰ í¬í•¨)' : ''}</span>${attAll ? ` <span style=\"color:#b1b1b1;\">(ì´ ${allMemberCount}ëª…)</span>` : ''} ${attAll ? `<button id=\"view-all-all-members\" class=\"chart-btn\" style=\"padding:2px 8px; font-size:12px; margin-left:6px;\">ì „ì²´ ë³´ê¸°</button>` : ''}</div>`);
                    if (attAll) attachmentRows.push(`<div style=\"margin-top:6px;\">${sampleBlock(allMemberFullList)}</div>`);
                    attachmentRows.push(`<div style=\"margin-top:10px;\">â€¢ ë¹„í™œì„± ë©¤ë²„ ë¦¬ìŠ¤íŠ¸: <span style=\"color:#ff9800; font-weight:600;\">${attInactive ? 'í¬í•¨' : 'ë¯¸í¬í•¨'}${attInactiveUsage ? ' (ì‚¬ìš©ëŸ‰ í¬í•¨)' : ''}</span>${attInactive ? ` <span style=\"color:#b1b1b1;\">(ì´ ${inactiveCount}ëª…)</span>` : ''} ${attInactive ? `<button id=\"view-all-inactive-members\" class=\"chart-btn\" style=\"padding:2px 8px; font-size:12px; margin-left:6px;\">ì „ì²´ ë³´ê¸°</button>` : ''}</div>`);
                    if (attInactive) attachmentRows.push(`<div style=\"margin-top:6px;\">${sampleBlock(inactiveFullList)}</div>`);
                    attachmentRows.push(`<div style=\"margin-top:10px;\">â€¢ ì§ì ‘ ì…ë ¥ ë¦¬ìŠ¤íŠ¸: <span style=\"color:#ff9800; font-weight:600;\">${attCustom ? 'í¬í•¨' : 'ë¯¸í¬í•¨'}${attCustomUsage ? ' (ì‚¬ìš©ëŸ‰ í¬í•¨)' : ''}</span>${attCustom ? ` <span style=\"color:#b1b1b1;\">(ì´ ${customCount}ëª…)</span>` : ''} ${attCustom ? `<button id=\"view-all-custom\" class=\"chart-btn\" style=\"padding:2px 8px; font-size:12px; margin-left:6px;\">ì „ì²´ ë³´ê¸°</button>` : ''}</div>`);
                    if (attCustom) attachmentRows.push(`<div style=\"margin-top:6px;\">${sampleBlock(customFullList)}</div>`);
                    // ì‚¬ìš©ëŸ‰ ê¸°ê°„ì€ ì‚¬ìš©ëŸ‰ ì˜µì…˜ì´ í•˜ë‚˜ë¼ë„ ì²´í¬ëœ ê²½ìš°, ìš”ì•½ ë§¨ í•˜ë‹¨ì— í‘œì‹œ
                    if (attAllUsage || attInactiveUsage || attCustomUsage) {
                        attachmentRows.push(`<div style=\"margin-top:10px;\">â€¢ ì‚¬ìš©ëŸ‰ ê¸°ê°„: <span style=\"color:#ff9800; font-weight:600;\">${usagePeriodText || 'ì„¤ì • ì—†ìŒ'}</span></div>`);
                    }

                    attachmentSummaryHTML = attachmentRows.join('');

                    // ëª¨ë‹¬ì—ì„œ ì‚¬ìš©í•  ë¹„í™œì„± ì´ë©”ì¼ ëª©ë¡ ì €ì¥ (ì²¨ë¶€ ì„¹ì…˜ê³¼ ë™ì¼ ê¸°ì¤€)
                    window.__previewInactiveEmailsByPeriod = inactiveByDays.map(m => m.email).filter(Boolean);
                } catch (e) { console.warn('ì²¨ë¶€ ìš”ì•½ ìƒì„± ì‹¤íŒ¨:', e); }
            })();

            // CSV í—¤ë” êµ¬ì„± (ì‚¬ìš©ëŸ‰ ì»¬ëŸ¼ì€ ê·¸ë£¹ë³„ ì‚¬ìš©ëŸ‰ ì˜µì…˜ì´ í•˜ë‚˜ë¼ë„ ì„ íƒëœ ê²½ìš° í¬í•¨)
            const includeUsageCol = (attAllUsage || attInactiveUsage || attCustomUsage);
            const headers = ['Type', 'Name', 'Email', 'Role', 'Premium Requests', 'Spend ($)']
                .concat(includeUsageCol ? ['Usage RequestsCosts'] : []);
            const rows = [headers];

            // ì „ì²´ ë©¤ë²„
            if (attAll) {
                const usageOn = !!attAllUsage;
                for (const m of members) {
                    const row = [
                        'ì „ì²´',
                        m.name || '',
                        m.email || '',
                        m.role || '',
                        m.spendData?.premiumRequests ?? 0,
                        (m.spendData?.spend ?? 0).toFixed(2)
                    ];
                    if (includeUsageCol) {
                        row.push(usageOn ? (emailToUsageCost.get(m.email) || 0) : '');
                    }
                    rows.push(row);
                }
            }

            // ë¹„í™œì„± ë©¤ë²„ (ì²¨ë¶€ ì„¹ì…˜ê³¼ ë™ì¼ ê¸°ì¤€: ìµœê·¼ Nì¼ ë¬´í™œë™)
            if (attInactive) {
                const usageOn = !!attInactiveUsage;
                const byDaysSet = new Set(Array.isArray(window.__previewInactiveEmailsByPeriod) ? window.__previewInactiveEmailsByPeriod : []);
                const inactives = (members || []).filter(m => byDaysSet.has(m.email));
                for (const m of inactives) {
                    const row = [
                        'ë¹„í™œì„±',
                        m.name || '',
                        m.email || '',
                        m.role || '',
                        m.spendData?.premiumRequests ?? 0,
                        (m.spendData?.spend ?? 0).toFixed(2)
                    ];
                    if (includeUsageCol) {
                        row.push(usageOn ? (emailToUsageCost.get(m.email) || 0) : '');
                    }
                    rows.push(row);
                }
            }

            // ì§ì ‘ ì…ë ¥ ë¦¬ìŠ¤íŠ¸
            if (attCustom) {
                const usageOn = !!attCustomUsage;
                const list = (customAttachmentEmails || '')
                    .split(',')
                    .map(s => s.trim())
                    .filter(Boolean);
                for (const email of list) {
                    const row = [
                        'ì§ì ‘ì…ë ¥',
                        '',
                        email,
                        'custom',
                        '',
                        ''
                    ];
                    if (includeUsageCol) {
                        row.push(usageOn ? (emailToUsageCost.get(email) || 0) : '');
                    }
                    rows.push(row);
                }
            }

            // CSV ë¬¸ìì—´ ìƒì„±
            const csvLines = rows.map(r => r.map(quote).join(delimiter));
            const csvContent = csvLines.join(newline);
            window.__attachmentsCsvContent = csvContent;

            const schedule = schedules[0] || {};
            const html = `
                <div id="schedule-preview-modal" style="
                    position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1100;
                ">
                    <div style="
                        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                        width: 90%; max-width: 900px; max-height: 85vh; overflow: auto;
                        background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; padding: 20px;
                    ">
                        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #3a3a3a; padding-bottom:12px; margin-bottom:16px;">
                            <div style="color:#fff; font-size:18px; font-weight:600;">ì˜ˆì•½ ë¯¸ë¦¬ë³´ê¸°</div>
                        </div>
                        <!-- ìˆ˜ì‹ ì ë³´ê¸° ìŠ¤íƒ€ì¼ì˜ ìƒë‹¨ ì •ë³´ ë¸”ë¡ (ì‹¤ë°ì´í„°ëŠ” ì˜¤ë Œì§€ìƒ‰) -->
                        <div style="background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px; padding:12px;">
                            <div style="display:grid; grid-template-columns: 1fr 3fr; gap:8px;">
                                <div style="color:#b1b1b1;">ì£¼ê¸°</div>
                                <div style="color:#ff9800;">${schedules[0]?.frequency || ''}</div>
                                <div style="color:#b1b1b1;">ì‹œê°„</div>
                                <div>${(() => { const s=schedules[0]||{}; const d=parseNextSendTime((s.currentSend||s.nextSend||'')); if(d){ const h=d.getHours(); const m=String(d.getMinutes()).padStart(2,'0'); const ampm = h<12 ? 'ì˜¤ì „' : 'ì˜¤í›„'; const h12 = h===0?12:(h<=12?h:h-12); return `<span style=\"color:#ff9800;\">${ampm} ${h12}ì‹œ ${m}ë¶„</span>`; } const t=s.time||''; return `<span style=\"color:#ff9800;\">${t}</span>`; })()}</div>
                            </div>
                            <div style="font-size:14px; margin-top:12px;">
                                <div style="color:#fff; font-weight:600; margin-bottom:6px;">ë°œì†¡ ë©”ì‹œì§€</div>
                                <div style="background:#0f0f0f; border:1px solid #3a3a3a; border-radius:6px; padding:12px; color:#ff9800; white-space:pre-wrap;">${schedules[0]?.message || ''}</div>
                            </div>
                            <div style="margin-top:12px;">
                                <div style="color:#fff; font-weight:600; margin-bottom:8px;">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                    ${(() => { const r=(schedule?.recipients||''); const map={ 'ê´€ë¦¬ì':'admin','ì „ì²´ ë©¤ë²„':'all','ë¹„í™œì„± ë©¤ë²„':'inactive','ì§ì ‘ì…ë ¥':'custom'}; const chips=['ê´€ë¦¬ì','ì „ì²´ ë©¤ë²„','ë¹„í™œì„± ë©¤ë²„','ì§ì ‘ì…ë ¥'].filter(x=>r.includes(x)).map(x=>`<span class=\"recipient-chip\" data-group=\"${map[x]}\" style=\"background:#2a2a2a; border:1px solid #ff9800; color:#ff9800; padding:4px 8px; border-radius:999px; font-size:12px; cursor:pointer;\">${x}</span>`).join(' '); return chips || '<span style=\"color:#7a7a7a;\">ì„ íƒëœ ê·¸ë£¹ ì—†ìŒ</span>'; })()}
                                </div>
                            </div>
                        </div>
                        <div style="color:#e1e1e1; font-size:14px; margin:16px 0;">
                            <div style="color:#fff; font-size:16px; font-weight:600; margin-bottom:8px;">ì²¨ë¶€ íŒŒì¼ ìš”ì•½</div>
                            <div id="attachments-summary-content" style="background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px; padding:12px; color:#e1e1e1; line-height:1.6;">${attachmentSummaryHTML}</div>
                        </div>

                        <!-- ì²¨ë¶€ íŒŒì¼ ë‚´ìš© (ìˆ˜ì‹ ì ë¦¬ìŠ¤íŠ¸ + ì‚¬ìš©ëŸ‰ í‘œ + CSV ë¯¸ë¦¬ë³´ê¸°) -->
                        <div style="margin-top:16px; background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px;">
                            <div style="display:flex; justify-content:space-between; align-items:center; color:#fff; font-size:16px; font-weight:600; border-bottom:1px solid #3a3a3a; padding:12px;">
                                <div>ì²¨ë¶€ íŒŒì¼ ë‚´ìš©</div>
                                <div style="display:flex; gap:8px;">
                                    <button class="analytics-btn" onclick="downloadAttachmentsPreviewCSV()">CSV ë‹¤ìš´ë¡œë“œ</button>
                                </div>
                            </div>
                            <div style="padding:12px; display:flex; flex-direction:column; gap:12px;">
                                <!-- ë°•ìŠ¤ 1: ì²´í¬ë°•ìŠ¤ ì„ íƒ/ì…ë ¥ëœ ìˆ˜ì‹ ì ë¦¬ìŠ¤íŠ¸ -->
                                <div id="attachments-detail-recipient-box" style="background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px; padding:12px;">
                                    <div style="color:#fff; font-weight:600; margin-bottom:8px;">ìˆ˜ì‹ ì ë¦¬ìŠ¤íŠ¸</div>
                                    <div style="color:#7a7a7a;">ë¡œë”© ì¤‘...</div>
                                </div>
                                <!-- ë°•ìŠ¤ 2: ì‚¬ìš©ëŸ‰ ì²´í¬ ì‹œ ëˆ„ì  ì‚¬ìš©ëŸ‰ í‘œ -->
                                <div id="attachments-detail-usage-box" style="background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px; padding:12px;">
                                    <div style="display:flex; justify-content:space-between; align-items:center;">
                                        <div style="color:#fff; font-weight:600;">ëˆ„ì  ì‚¬ìš©ëŸ‰</div>
                                        <div style="color:#ff9800; font-size:12px;">ê¸°ê°„: ${usagePeriodText || 'ì„¤ì • ì—†ìŒ'}</div>
                                    </div>
                                    <div style="margin-top:8px; color:#7a7a7a;">ë¡œë”© ì¤‘...</div>
                                </div>
                                <!-- CSV ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ ì œê±° (ìš”ì²­ ì‚¬í•­) -->
                            </div>
                        </div>

                        <!-- í•˜ë‹¨ ë²„íŠ¼: ì¢Œì¸¡ ì¦‰ì‹œ ë°œì†¡, ìš°ì¸¡ ìˆ˜ì •/ë‹«ê¸° -->
                        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:16px; border-top:1px solid #3a3a3a; padding-top:16px;">
                            <div>
                                <button id="schedule-preview-send-now-btn" class="analytics-btn">ğŸ“§ ì¦‰ì‹œ ë°œì†¡</button>
                            </div>
                            <div style="display:flex; gap:10px;">
                                <button id="schedule-preview-edit-btn" class="chart-btn">ìˆ˜ì •</button>
                            <button class="chart-btn" onclick="document.getElementById('schedule-preview-modal').remove()">ë‹«ê¸°</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            // ì´ë¯¸ ì‰˜ì„ ë Œë”ë§í–ˆë‹¤ë©´, í•´ë‹¹ ì‰˜ì˜ ì½˜í…ì¸ ë¥¼ ì‹¤ì œ ë‚´ìš©ìœ¼ë¡œ êµì²´
            const shellModal = document.getElementById('schedule-preview-modal');
            if (shellModal) {
                shellModal.outerHTML = html;
            } else {
                document.body.insertAdjacentHTML('beforeend', html);
            }

            // ë¯¸ë¦¬ë³´ê¸° CSV ë‹¤ìš´ë¡œë“œ í•¸ë“¤ëŸ¬ë¥¼ ìœ„í•œ ì „ì—­ í•¨ìˆ˜ ë°”ì¸ë”©
            window.downloadAttachmentsPreviewCSV = async function() {
                try {
                    const sheetsPayload = window.__attachmentsSheets;
                    if (!sheetsPayload || !Array.isArray(sheetsPayload.sheets) || sheetsPayload.sheets.length === 0) {
                        showSimpleAlert('âš ï¸ ë‹¤ìš´ë¡œë“œí•  ì²¨ë¶€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                        return;
                    }
                    const resp = await fetch('/api/generate-xlsx', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(sheetsPayload)
                    });
                    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                    const blob = await resp.blob();
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = sheetsPayload.filename || `email_attachments_${new Date().toISOString().split('T')[0]}.xlsx`;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    URL.revokeObjectURL(url);
                } catch (e) {
                    console.error('XLSX ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', e);
                    showSimpleAlert('âŒ ì—‘ì…€ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };

            // ì²¨ë¶€ ìƒì„¸ ë°•ìŠ¤ ë Œë”ë§ (ìˆ˜ì‹ ì ë¦¬ìŠ¤íŠ¸ + ëˆ„ì  ì‚¬ìš©ëŸ‰ í‘œ)
            (function renderAttachmentDetailBoxes(){
                try {
                    const recBox = document.getElementById('attachments-detail-recipient-box');
                    const usageBox = document.getElementById('attachments-detail-usage-box');
                    if (!recBox || !usageBox) return;

                    // 1) ìˆ˜ì‹ ì ë¦¬ìŠ¤íŠ¸ êµ¬ì„±
                    const sections = [];
                    const monoList = (arr) => arr && arr.length
                        ? `<pre style="white-space:pre-wrap; background:#0f0f0f; border:1px solid #3a3a3a; border-radius:6px; padding:10px; color:#ff9800; max-height:200px; overflow:auto;">${arr.join('\n')}</pre>`
                        : `<div style="color:#7a7a7a;">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;

                    // ì „ì²´ ë©¤ë²„
                    if (attAll) {
                        const emails = (members || []).map(m => m.email).filter(Boolean);
                        const names = (members || []).map(m => `${m.name || m.email || 'unknown'} <${m.email || ''}>`).filter(Boolean);
                        sections.push(`
                            <div style="margin-bottom:10px;">
                                <div style="color:#fff; font-weight:600;">ì „ì²´ ë©¤ë²„ <span style="color:#b1b1b1; font-weight:400;">(${emails.length}ëª…)</span></div>
                                ${monoList(names)}
                            </div>
                        `);
                    }

                    // ë¹„í™œì„± ë©¤ë²„ (ì²¨ë¶€ ì„¹ì…˜ê³¼ ë™ì¼ ê¸°ì¤€: ìµœê·¼ Nì¼ ë¬´í™œë™)
                    if (attInactive) {
                        const byPeriod = Array.isArray(window.__previewInactiveEmailsByPeriod) ? window.__previewInactiveEmailsByPeriod : [];
                        let inactiveEmails = byPeriod && byPeriod.length ? byPeriod : [];
                        if (!inactiveEmails.length) {
                            // ë³´ì¡°: ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°ì—ë§Œ spendData ê¸°ì¤€ ì‚¬ìš©
                            inactiveEmails = (members || []).filter(m => (m.spendData && m.spendData.premiumRequests === 0)).map(m => m.email).filter(Boolean);
                        }
                        const inactiveRows = (members || [])
                            .filter(m => inactiveEmails.includes(m.email))
                            .map(m => `${m.name || m.email || 'unknown'} <${m.email || ''}>`);
                        sections.push(`
                            <div style="margin-bottom:10px;">
                                <div style="color:#fff; font-weight:600;">ë¹„í™œì„± ë©¤ë²„ <span style="color:#b1b1b1; font-weight:400;">(${inactiveEmails.length}ëª…)</span></div>
                                ${monoList(inactiveRows)}
                            </div>
                        `);
                    }

                    // ì§ì ‘ ì…ë ¥
                    if (attCustom) {
                        const customList = (customAttachmentEmails || '').split(',').map(s => s.trim()).filter(Boolean);
                        sections.push(`
                            <div style="margin-bottom:10px;">
                                <div style="color:#fff; font-weight:600;">ì§ì ‘ ì…ë ¥ <span style="color:#b1b1b1; font-weight:400;">(${customList.length}ëª…)</span></div>
                                ${monoList(customList)}
                            </div>
                        `);
                    }

                    recBox.innerHTML = `
                        <div style="color:#fff; font-weight:600; margin-bottom:8px;">ìˆ˜ì‹ ì ë¦¬ìŠ¤íŠ¸</div>
                        ${sections.join('') || '<div style="color:#7a7a7a;">ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>'}
                    `;

                    // 2) ëˆ„ì  ì‚¬ìš©ëŸ‰ í‘œ êµ¬ì„±
                    const anyUsageSelected = (attAllUsage || attInactiveUsage || attCustomUsage);
                    if (!anyUsageSelected) {
                        usageBox.style.display = 'none';
                        return;
                    }

                    if (!(startDate && endDate)) {
                        usageBox.innerHTML = `
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div style="color:#fff; font-weight:600;">ëˆ„ì  ì‚¬ìš©ëŸ‰</div>
                                <div style="color:#ff9800; font-size:12px;">ê¸°ê°„: ì„¤ì • ì—†ìŒ</div>
                            </div>
                            <div style="margin-top:8px; color:#7a7a7a;">ì‚¬ìš©ëŸ‰ ê¸°ê°„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì²¨ë¶€ ì‚¬ìš©ëŸ‰ ê¸°ê°„ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.</div>
                        `;
                        return;
                    }

                    const rows = [];
                    const pushRow = (group, name, email, usage) => {
                        rows.push({ group, name: name || '', email: email || '', usage: usage || 0 });
                    };

                    // ì „ì²´ ë©¤ë²„ ì‚¬ìš©ëŸ‰
                    if (attAll && attAllUsage) {
                        (members || []).forEach(m => {
                            pushRow('ì „ì²´', m.name || '', m.email || '', emailToUsageCost.get(m.email) || 0);
                        });
                    }

                    // ë¹„í™œì„± ë©¤ë²„ ì‚¬ìš©ëŸ‰ (ì²¨ë¶€ ì„¹ì…˜ê³¼ ë™ì¼ ë¹„í™œì„± ì§‘í•© ê¸°ì¤€)
                    if (attInactive && attInactiveUsage) {
                        const inactiveSet = new Set(Array.isArray(window.__previewInactiveEmailsByPeriod) ? window.__previewInactiveEmailsByPeriod : []);
                        (members || []).forEach(m => {
                            if (inactiveSet.has(m.email)) {
                                pushRow('ë¹„í™œì„±', m.name || '', m.email || '', emailToUsageCost.get(m.email) || 0);
                            }
                        });
                    }

                    // ì§ì ‘ ì…ë ¥ ì‚¬ìš©ëŸ‰
                    if (attCustom && attCustomUsage) {
                        const customList = (customAttachmentEmails || '').split(',').map(s => s.trim()).filter(Boolean);
                        customList.forEach(email => {
                            const m = (members || []).find(x => x.email === email);
                            pushRow('ì§ì ‘ì…ë ¥', m?.name || '', email, emailToUsageCost.get(email) || 0);
                        });
                    }

                    // ìƒˆ í•„ë“œ êµ¬ì„±: NAME, EMAIL, ROLE, REQUEST, SPEND, LAST ACT
                    // rows: { group, name, email, usage } â†’ ë©¤ë²„ ì •ë³´ì™€ spendData, lastTsë¥¼ ì¡°í•©í•˜ì—¬ ë³€í™˜
                    const toLastAct = (email) => {
                        const ts = emailToLastTs.get(email) || 0;
                        if (!ts) return '-';
                        const d = new Date(ts);
                        const yyyy = d.getFullYear();
                        const mm = String(d.getMonth() + 1).padStart(2, '0');
                        const dd = String(d.getDate()).padStart(2, '0');
                        const hh = String(d.getHours()).padStart(2, '0');
                        const mi = String(d.getMinutes()).padStart(2, '0');
                        return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
                    };

                    const emailToMember = new Map((members || []).map(m => [m.email, m]));
                    const detailedRows = rows.map(r => {
                        const m = emailToMember.get(r.email) || {};
                        const roleLabel = (m.role === 'owner') ? 'Admin' : (m.role ? 'Member' : '');
                        // REQUESTëŠ” ì„¤ì • ì„¹ì…˜ê³¼ ë™ì¼í•˜ê²Œ ê¸°ê°„ ë‚´ ìš”ì²­ í•©ê³„(usageEvents.requestsCosts) ì‚¬ìš©
                        const req = (typeof r.usage === 'number') ? r.usage : 0;
                        const spend = (m.spendData && typeof m.spendData.spend === 'number') ? m.spendData.spend : 0;
                        return {
                            name: r.name || '-',
                            email: r.email || '-',
                            role: roleLabel,
                            request: req,
                            spend: spend,
                            lastAct: toLastAct(r.email)
                        };
                    });

                    // ì •ë ¬: ìš”ì²­ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ
                    detailedRows.sort((a, b) => (b.request || 0) - (a.request || 0));

                    const headerHTML = `
                        <div class="table-grid" style="display:grid; grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1.5fr; gap:12px; align-items:center; font-weight:600; color:#e1e1e1; border-bottom:1px solid #3a3a3a; padding-bottom:8px;">
                            <div>NAME</div>
                            <div>EMAIL</div>
                            <div>ROLE</div>
                            <div>REQUEST</div>
                            <div>SPEND</div>
                            <div>LAST ACT</div>
                        </div>`;

                    const bodyHTML = detailedRows.length ? detailedRows.map(r => `
                        <div style="display:grid; grid-template-columns: 2fr 3fr 1fr 1fr 1fr 1.5fr; gap:12px; align-items:center; padding:8px 10px; border-bottom:1px solid #2a2a2a; background:#000; color:#ff9800;">
                            <div>${r.name}</div>
                            <div>${r.email}</div>
                            <div>${r.role}</div>
                            <div>${r.request}</div>
                            <div>$${(r.spend || 0).toFixed(2)}</div>
                            <div>${r.lastAct}</div>
                        </div>
                    `).join('') : `<div style="padding:8px 0; color:#7a7a7a;">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;

                    usageBox.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div style="color:#fff; font-weight:600;">ëˆ„ì  ì‚¬ìš©ëŸ‰</div>
                            <div style="color:#ff9800; font-size:12px;">ê¸°ê°„: ${usagePeriodText || 'ì„¤ì • ì—†ìŒ'}</div>
                        </div>
                        <div style="margin-top:10px;">${headerHTML}${bodyHTML}</div>
                    `;

                    // ì²¨ë¶€ìš© XLSX ì‹œíŠ¸ ë°ì´í„° êµ¬ì„±: Recipients + Usage(ìˆì„ ë•Œ)
                    const recipientsRows = [];
                    if (attAll) {
                        (members || []).forEach(m => {
                            recipientsRows.push([m.name || '', m.email || '', 'ì „ì²´']);
                        });
                    }
                    if (attInactive) {
                        const inactiveSet = new Set(Array.isArray(window.__previewInactiveEmailsByPeriod) ? window.__previewInactiveEmailsByPeriod : []);
                        (members || []).forEach(m => {
                            if (inactiveSet.has(m.email)) {
                                recipientsRows.push([m.name || '', m.email || '', 'ë¹„í™œì„±']);
                            }
                        });
                    }
                    if (attCustom) {
                        const customList = (customAttachmentEmails || '').split(',').map(s => s.trim()).filter(Boolean);
                        customList.forEach(email => {
                            recipientsRows.push(['', email, 'ì§ì ‘ì…ë ¥']);
                        });
                    }

                    const usageRows = detailedRows.map(r => [
                        r.name, r.email, r.role, r.request, Number(r.spend || 0).toFixed(2), r.lastAct
                    ]);

                    window.__attachmentsSheets = {
                        filename: `email_attachments_${new Date().toISOString().split('T')[0]}.xlsx`,
                        sheets: [
                            { name: 'Recipients', headers: ['Name','Email','Group'], rows: recipientsRows }
                        ].concat(usageRows.length ? [{ name: 'Usage', headers: ['NAME','EMAIL','ROLE','REQUEST','SPEND','LAST ACT'], rows: usageRows }] : [])
                    };
                } catch (e) {
                    console.warn('ì²¨ë¶€ ìƒì„¸ ë°•ìŠ¤ ë Œë”ë§ ì‹¤íŒ¨:', e);
                }
            })();

            // ì²¨ë¶€ ìš”ì•½ì˜ 'ì „ì²´ ë³´ê¸°' ë²„íŠ¼ ë° ìˆ˜ì‹ ì ê·¸ë£¹ ì¹© í´ë¦­ ì‹œ ì‹¤ì œ ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
            (function(){
                function showEmailsModal(title, emails){
                    const listHTML = (emails && emails.length)
                        ? `<div style="max-height:50vh; overflow:auto; background:#0f0f0f; border:1px solid #3a3a3a; border-radius:6px; padding:12px; color:#e1e1e1; font-family:monospace; white-space:pre-wrap;">${emails.join('\n')}</div>`
                        : `<div style="padding:12px; color:#7a7a7a; background:#1a1a1a; border:1px solid #3a3a3a; border-radius:6px;">í‘œì‹œí•  ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    const m = `
                        <div id="recipient-emails-modal" style="position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:1200;">
                            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:700px; background:#2a2a2a; border:1px solid #3a3a3a; border-radius:8px; padding:20px;">
                                <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #3a3a3a; padding-bottom:12px; margin-bottom:16px;">
                                    <div style="color:#fff; font-size:16px; font-weight:600;">${title}</div>
                                    <button class="chart-btn" onclick="document.getElementById('recipient-emails-modal').remove()">ë‹«ê¸°</button>
                                </div>
                                ${listHTML}
                            </div>
                        </div>`;
                    document.body.insertAdjacentHTML('beforeend', m);
                }

                const chipEls = document.querySelectorAll('#schedule-preview-modal .recipient-chip');
                chipEls.forEach(chip => {
                    chip.addEventListener('click', () => {
                        const group = chip.getAttribute('data-group');
                        let emails = [];
                        if (group === 'admin') {
                            emails = (members || []).filter(m => (m.role === 'owner')).map(m => m.email).filter(Boolean);
                            showEmailsModal('ê´€ë¦¬ì ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸', emails);
                        } else if (group === 'all') {
                            emails = (members || []).map(m => m.email).filter(Boolean);
                            showEmailsModal('ì „ì²´ ë©¤ë²„ ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸', emails);
                        } else if (group === 'inactive') {
                            // ê¸°ê°„ì´ ì„ íƒë˜ì—ˆë‹¤ë©´ ê¸°ê°„ ê¸°ë°˜ ë¹„í™œì„± ëª©ë¡ ì‚¬ìš©, ì•„ë‹ˆë©´ ê¸°ì¡´ ê¸°ì¤€ ì‚¬ìš©
                            const byPeriod = Array.isArray(window.__previewInactiveEmailsByPeriod) ? window.__previewInactiveEmailsByPeriod : null;
                            emails = (byPeriod && byPeriod.length)
                                ? byPeriod
                                : (members || []).filter(m => (m.spendData && m.spendData.premiumRequests === 0)).map(m => m.email).filter(Boolean);
                            showEmailsModal('ë¹„í™œì„± ë©¤ë²„ ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸', emails);
                        } else if (group === 'custom') {
                            let customs = Array.isArray(schedule.customEmails) ? schedule.customEmails : [];
                            if (!customs || customs.length === 0) {
                                customs = (customAttachmentEmails || '').split(',').map(s => s.trim()).filter(Boolean);
                            }
                            showEmailsModal('ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸', customs);
                        }
                    });
                });

                // ì²¨ë¶€ ìš”ì•½ì˜ ì „ì²´ ë³´ê¸° ë²„íŠ¼ ì—°ê²°
                const btnAllMembers = document.getElementById('view-all-all-members');
                if (btnAllMembers) {
                    btnAllMembers.addEventListener('click', () => {
                        const emails = (members || []).map(m => m.email).filter(Boolean);
                        showEmailsModal('ì „ì²´ ë©¤ë²„ ì´ë©”ì¼ ì „ì²´ ëª©ë¡', emails);
                    });
                }
                const btnInactive = document.getElementById('view-all-inactive-members');
                if (btnInactive) {
                    btnInactive.addEventListener('click', () => {
                        const byPeriod = Array.isArray(window.__previewInactiveEmailsByPeriod) ? window.__previewInactiveEmailsByPeriod : null;
                        const emails = (byPeriod && byPeriod.length)
                            ? byPeriod
                            : (members || []).filter(m => (m.spendData && m.spendData.premiumRequests === 0)).map(m => m.email).filter(Boolean);
                        showEmailsModal('ë¹„í™œì„± ë©¤ë²„ ì´ë©”ì¼ ì „ì²´ ëª©ë¡', emails);
                    });
                }
                const btnCustom = document.getElementById('view-all-custom');
                if (btnCustom) {
                    btnCustom.addEventListener('click', () => {
                        let customs = Array.isArray(schedule.customEmails) ? schedule.customEmails : [];
                        if (!customs || customs.length === 0) {
                            customs = (customAttachmentEmails || '').split(',').map(s => s.trim()).filter(Boolean);
                        }
                        showEmailsModal('ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì „ì²´ ëª©ë¡', customs);
                    });
                }
            })();

            // ì¦‰ì‹œ ë°œì†¡ ë²„íŠ¼ ë™ì‘ (ì˜ˆì•½ ë¯¸ë¦¬ë³´ê¸° ê¸°ì¤€ìœ¼ë¡œ ìˆ˜ì‹ ì ì‚°ì¶œ)
            (function(){
                const btn = document.getElementById('schedule-preview-send-now-btn');
                if (!btn) return;
                btn.addEventListener('click', async (ev) => {
                    const original = btn.innerHTML; btn.disabled = true; btn.style.opacity='0.6'; btn.innerHTML='ğŸ“§ ë°œì†¡ ì¤‘...';
                    try {
                        const r = (schedule.recipients || '');
                        let emails = [];
                        if (r.includes('ê´€ë¦¬ì')) {
                            emails = emails.concat((members || []).filter(m => m.role === 'owner').map(m => m.email).filter(Boolean));
                        }
                        if (r.includes('ì „ì²´ ë©¤ë²„')) {
                            emails = emails.concat((members || []).map(m => m.email).filter(Boolean));
                        }
                        if (r.includes('ë¹„í™œì„± ë©¤ë²„')) {
                            const byDays = Array.isArray(window.__previewInactiveEmailsByPeriod) ? window.__previewInactiveEmailsByPeriod : [];
                            if (byDays && byDays.length) {
                                emails = emails.concat(byDays);
                            } else {
                                emails = emails.concat((members || []).filter(m => (m.spendData && m.spendData.premiumRequests === 0)).map(m => m.email).filter(Boolean));
                            }
                        }
                        if (r.includes('ì§ì ‘ì…ë ¥') && Array.isArray(schedule.customEmails)) {
                            emails = emails.concat(schedule.customEmails);
                        }
                        const unique = Array.from(new Set(emails));
                        if (!unique.length) { showSimpleAlert('âš ï¸ ë°œì†¡í•  ìˆ˜ì‹ ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning'); return; }
                        const payload = {
                            message: (schedule.message || 'ì‚¼ì„± AI Experience Group ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.'),
                            selectedGroups: ['ê´€ë¦¬ì','ì „ì²´ ë©¤ë²„','ë¹„í™œì„± ë©¤ë²„','ì§ì ‘ì…ë ¥'].filter(x=>r.includes(x)),
                            customEmails: Array.isArray(schedule.customEmails) ? schedule.customEmails : [],
                            allEmails: unique,
                            timestamp: new Date().toLocaleString('ko-KR'),
                            source: 'preview',
                            scheduleTitle: schedule.title || 'ì˜ˆì•½ ë¦¬í¬íŠ¸',
                            attachmentsSheets: (window.__attachmentsSheets || schedule.attachmentsSheets || null)
                        };
                        await sendEmailViaSMTP(payload);
                        showSimpleAlert('âœ… ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    } catch (e) {
                        console.error(e); showSimpleAlert('âŒ ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                    } finally {
                        btn.innerHTML = original; btn.disabled = false; btn.style.opacity='1';
                    }
                });
            })();

            // ìˆ˜ì • ë²„íŠ¼: ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
            (function(){
                const editBtn = document.getElementById('schedule-preview-edit-btn');
                if (!editBtn) return;
                editBtn.addEventListener('click', () => {
                    try { openEditScheduleModal(schedule); } catch(e) { console.error(e); }
                });
            })();
        }

        // ì„ íƒëœ ì˜ˆì•½ ìˆ˜ì • ì—´ê¸°
        function editSelectedSchedule() {
            // DOMì—ì„œ ì‹¤ì œ ì²´í¬ëœ ìƒíƒœë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì—¬ ì‹ ë¢°ì„± ë³´ê°•
            const domChecked = Array.from(document.querySelectorAll('#email-schedule-modal .schedule-select-checkbox'))
                .filter(cb => cb.checked)
                .map(cb => parseInt(cb.getAttribute('data-id')))
                .filter(id => !isNaN(id));
            const ids = domChecked.length ? domChecked : Array.from(window._selectedScheduleIds || []);
            if (ids.length !== 1) {
                showSimpleAlert('âš ï¸ í•˜ë‚˜ì˜ ì˜ˆì•½ë§Œ ì„ íƒí•˜ì—¬ ìˆ˜ì •í•˜ì„¸ìš”.', 'warning');
                return;
            }
            const id = ids[0];
            const schedule = (window.emailScheduleList || []).find(s => s.id === id);
            if (!schedule) {
                showSimpleAlert('âš ï¸ ì„ íƒëœ ì˜ˆì•½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }
            // ê¸°ì¡´ ì¸ë¼ì¸ í¸ì§‘(ì œëª©/ì£¼ê¸°/ì‹œê°„/ìˆ˜ì‹ ì í´ë¦­ í¸ì§‘) ìœ ì§€ + ë³„ë„ ìˆ˜ì • ëª¨ë‹¬ ì œê³µ
            openEditScheduleModal(schedule);
        }

        function openEditScheduleModal(schedule) {
            // ê°„ë‹¨í•œ ìˆ˜ì • ëª¨ë‹¬: ì œëª©, ë©”ì‹œì§€, ì£¼ê¸°(ì…€ë ‰íŠ¸), ì‹œê°„(ì‹œê°„ ì„ íƒ), ìˆ˜ì‹ ì ë¬¸ìì—´
            const html = `
                <div id="edit-schedule-modal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1100;">
                    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:720px; background:#2a2a2a; border:1px solid #3a3a3a; border-radius:8px; padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #3a3a3a; padding-bottom:12px; margin-bottom:16px;">
                            <div style="color:#fff; font-size:18px; font-weight:600;">ì˜ˆì•½ ìˆ˜ì •</div>
                            <button style="background:none; border:none; color:#7a7a7a; font-size:18px; cursor:pointer;" onclick="document.getElementById('edit-schedule-modal').remove()">Ã—</button>
                        </div>
                        <div style="display:grid; gap:12px;">
                            <label style="color:#e1e1e1; font-size:14px;">ì œëª©
                                <input id="edit-title" class="search-box" style="width:100%; margin-top:6px; color:#ff9800;" value="${schedule.title || ''}">
                            </label>
                            <label style="color:#e1e1e1; font-size:14px;">ë©”ì‹œì§€
                                <textarea id="edit-message" class="search-box" style="width:100%; height:90px; margin-top:6px; color:#ff9800;">${schedule.message || ''}</textarea>
                            </label>
                            <label style="color:#e1e1e1; font-size:14px;">ì£¼ê¸°
                                <select id="edit-frequency" class="setting-select" style="background-color: transparent; width:100%; margin-top:6px; color:#ff9800;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                    ${['ë§¤ì¼','ë§¤ì£¼','ë§¤ì›”'].map(opt => `<option value="${opt}" ${opt===(schedule.frequency||'')?'selected':''}>${opt}</option>`).join('')}
                                </select>
                            </label>
                            <label style="color:#e1e1e1; font-size:14px;">ì´ë²ˆ ë°œì†¡
                                <input id="edit-current-send-dt" type="datetime-local" class="search-box" style="width:100%; margin-top:6px; color:#ff9800;" value="${(() => { const dv = parseNextSendTime(schedule.currentSend || schedule.nextSend || ''); if(!dv) return ''; const y=dv.getFullYear(); const m=String(dv.getMonth()+1).padStart(2,'0'); const d=String(dv.getDate()).padStart(2,'0'); const hh=String(dv.getHours()).padStart(2,'0'); const mm=String(dv.getMinutes()).padStart(2,'0'); return `${y}-${m}-${d}T${hh}:${mm}`; })()}">
                            </label>
                            <div style="color:#e1e1e1; font-size:14px;">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                            <div style="display:flex; gap:10px; flex-wrap: wrap; align-items:center;">
                                <label style="display:flex; align-items:center; gap:6px;">
                                    <input type="checkbox" id="edit-admin-checkbox" ${((schedule.recipients||'').includes('ê´€ë¦¬ì')) ? 'checked' : ''} style="width:16px; height:16px;">
                                    <span style="color:#e1e1e1; font-size:14px;">ê´€ë¦¬ì</span>
                                </label>
                                <label style="display:flex; align-items:center; gap:6px;">
                                    <input type="checkbox" id="edit-all-members-checkbox" ${((schedule.recipients||'').includes('ì „ì²´ ë©¤ë²„')) ? 'checked' : ''} style="width:16px; height:16px;">
                                    <span style="color:#e1e1e1; font-size:14px;">ì „ì²´ ë©¤ë²„</span>
                                </label>
                                <label style="display:flex; align-items:center; gap:6px;">
                                    <input type="checkbox" id="edit-inactive-members-checkbox" ${((schedule.recipients||'').includes('ë¹„í™œì„± ë©¤ë²„')) ? 'checked' : ''} style="width:16px; height:16px;">
                                    <span style="color:#e1e1e1; font-size:14px;">ë¹„í™œì„± ë©¤ë²„</span>
                                </label>
                                <label style="display:flex; align-items:center; gap:6px;">
                                    <input type="checkbox" id="edit-custom-email-checkbox" ${((Array.isArray(schedule.customEmails) && schedule.customEmails.length>0) || (schedule.recipients||'').includes('ì§ì ‘ì…ë ¥')) ? 'checked' : ''} onclick="(function(){var c=document.getElementById('edit-custom-email-container'); if(c){ c.style.display = document.getElementById('edit-custom-email-checkbox').checked ? 'block' : 'none'; } })()" style="width:16px; height:16px;">
                                    <span style="color:#e1e1e1; font-size:14px;">ì§ì ‘ ì…ë ¥</span>
                                </label>
                            </div>
                            <div id="edit-custom-email-container" style="display: ${(Array.isArray(schedule.customEmails) && schedule.customEmails.length>0) ? 'block' : 'none'}; margin-top:8px;">
                                <textarea id="edit-custom-emails" placeholder="emailì„ ì§ì ‘ ì…ë ¥ í•˜ì„¸ìš”.(example1@samsung.com, example2@samsung.com)" style="width: 100%; height: 100px; padding: 10px 12px; background-color: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 4px; color: #ff9800; font-size: 14px; outline: none; resize: vertical; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">${Array.isArray(schedule.customEmails) ? schedule.customEmails.join(', ') : ''}</textarea>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:16px;">
                            <button class="chart-btn" onclick="(function(){
                                const t=document.getElementById('edit-title').value.trim();
                                const m=document.getElementById('edit-message').value.trim();
                                const f=document.getElementById('edit-frequency').value;
                                const dtVal=document.getElementById('edit-current-send-dt').value; // yyyy-MM-ddTHH:mm
                                // ìˆ˜ì‹ ì ê·¸ë£¹ ìˆ˜ì§‘
                                var groups=[];
                                if (document.getElementById('edit-admin-checkbox') && document.getElementById('edit-admin-checkbox').checked) groups.push('ê´€ë¦¬ì');
                                if (document.getElementById('edit-all-members-checkbox') && document.getElementById('edit-all-members-checkbox').checked) groups.push('ì „ì²´ ë©¤ë²„');
                                if (document.getElementById('edit-inactive-members-checkbox') && document.getElementById('edit-inactive-members-checkbox').checked) groups.push('ë¹„í™œì„± ë©¤ë²„');
                                var customList = [];
                                var customChecked = document.getElementById('edit-custom-email-checkbox') && document.getElementById('edit-custom-email-checkbox').checked;
                                var customValEl = document.getElementById('edit-custom-emails');
                                if (customChecked) {
                                    var raw = (customValEl && customValEl.value) ? customValEl.value : '';
                                    var parts = raw.split(',').map(function(s){return s.trim();}).filter(function(s){return s.length>0;});
                                    // ê°„ë‹¨í•œ ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬
                                    var re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                                    for (var i=0;i<parts.length;i++){ if(!re.test(parts[i])){ showSimpleAlert('âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: '+parts[i], 'warning'); return; } }
                                    if (parts.length>0) { customList = parts; groups.push('ì§ì ‘ì…ë ¥'); }
                                }
                                const list=window.emailScheduleList||[];
                                const idx=list.findIndex(s=>s.id===${schedule.id});
                                if(idx>=0){
                                    list[idx].title=t||list[idx].title;
                                    list[idx].message=m;
                                    list[idx].frequency=f||list[idx].frequency;
                                    // ì‹œê°„ ë°˜ì˜: ì¸ë¼ì¸ í¸ì§‘ê³¼ ë™ì¼í•˜ê²Œ datetime-local ê¸°ì¤€ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                                    if (dtVal) {
                                        var mdt = dtVal.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/);
                                        if (mdt) {
                                            var yy = parseInt(mdt[1],10);
                                            var mo = parseInt(mdt[2],10);
                                            var dd = parseInt(mdt[3],10);
                                            var hhs = mdt[4];
                                            var mms = mdt[5];
                                            list[idx].currentSend = yy + '. ' + mo + '. ' + dd + '. ' + hhs + ':' + mms;
                                            var hourNum=parseInt(hhs,10);
                                            var minuteNum=parseInt(mms,10);
                                            var ampm = (hourNum===0) ? 'ì˜¤ì „' : (hourNum<12 ? 'ì˜¤ì „' : 'ì˜¤í›„');
                                            var hour12 = (hourNum===0)?12 : (hourNum<=12?hourNum:hourNum-12);
                                            list[idx].time = ampm + ' ' + hour12 + 'ì‹œ ' + String(minuteNum).padStart(2,'0') + 'ë¶„';
                                            try {
                                                var freqVal2 = (typeof getFrequencyValue === 'function') ? getFrequencyValue(list[idx].frequency) : null;
                                                if (freqVal2 && typeof calculateNextSendTimeFromCurrent === 'function') {
                                                    list[idx].nextSend = calculateNextSendTimeFromCurrent(list[idx].currentSend, freqVal2);
                                                }
                                            } catch(e) {}
                                        }
                                    }
                                    list[idx].recipients = groups.join(', ');
                                    list[idx].customEmails = customList;
                                }
                                document.getElementById('edit-schedule-modal').remove();
                                // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ í‘œì‹œ
                                const modal=document.getElementById('email-schedule-modal');
                                if(modal){
                                    // í…Œì´ë¸”ë§Œ ìƒˆë¡œ ê·¸ë¦¼
                                    const content=document.getElementById('schedule-list-content');
                                    if(content){
                                        // ê°„ë‹¨íˆ ì „ì²´ íŒì—… ì¬í˜¸ì¶œë¡œ ë°˜ì˜
                                        modal.remove();
                                        showEmailScheduleList();
                                    }
                                }
                                showSimpleAlert('âœ… ì˜ˆì•½ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                            })()">ì €ì¥</button>
                            <button class="chart-btn" onclick="document.getElementById('edit-schedule-modal').remove()">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }

        // ë¯¸ë¦¬ë³´ê¸° í–‰ì˜ ë³¸ë¬¸(ë©”ì‹œì§€) í´ë¦­ ì‹œ ì „ì²´ ë³´ê¸° + ìˆ˜ì • ëª¨ë‹¬
        function openPreviewMessageEditor(id) {
            try {
                const schedule = (window.emailScheduleList || []).find(s => s.id === id);
                if (!schedule) {
                    showSimpleAlert('âš ï¸ ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }
                const html = `
                    <div id="message-editor-modal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1200;">
                        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:720px; background:#2a2a2a; border:1px solid #3a3a3a; border-radius:8px; padding:20px;">
                            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #3a3a3a; padding-bottom:12px; margin-bottom:16px;">
                                <div style="color:#fff; font-size:18px; font-weight:600;">ë©”ì‹œì§€ ë³´ê¸°/ìˆ˜ì •</div>
                                <button class="chart-btn" onclick="document.getElementById('message-editor-modal').remove()">ë‹«ê¸°</button>
                            </div>
                            <div style="display:grid; gap:10px;">
                                <div style="color:#e1e1e1; font-size:14px;">ì „ì²´ ë³¸ë¬¸</div>
                                <textarea id="message-editor-text" class="search-box" style="width:100%; height:260px;">${(schedule.message || '').toString().replace(/</g,'&lt;').replace(/>/g,'&gt;')}</textarea>
                                <div style="color:#7a7a7a; font-size:12px;">ë¯¸ë¦¬ë³´ê¸° (2ì¤„ ìš”ì•½, ê¸¸ì´ ì œí•œ ì ìš©): ${(() => { const limit = (window.PREVIEW_MESSAGE_MAX || 80); const __m = (schedule.message || '').toString().replace(/\s+/g,' ').trim(); return __m.length > limit ? __m.slice(0, limit) + 'â€¦' : __m; })()}</div>
                            </div>
                            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:12px;">
                                <button class="analytics-btn" onclick="(function(){
                                    const ta=document.getElementById('message-editor-text');
                                    const val=ta ? ta.value : '';
                                    const list=window.emailScheduleList||[];
                                    const idx=list.findIndex(s=>s.id===${id});
                                    if(idx>=0){ list[idx].message=val; }
                                    // ë¯¸ë¦¬ë³´ê¸° í–‰ ìš”ì•½ë„ ì—…ë°ì´íŠ¸
                                    const preview=document.getElementById('preview-message-${id}');
                                    if(preview){
                                        var _v = (val || '').toString().replace(/\s+/g,' ').trim();
                                        var _max = (window.PREVIEW_MESSAGE_MAX || 80);
                                        preview.textContent = _v.length > _max ? _v.slice(0, _max) + 'â€¦' : _v;
                                    }
                                    document.getElementById('message-editor-modal').remove();
                                    showSimpleAlert('âœ… ë³¸ë¬¸ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤.', 'success');
                                })()">ì €ì¥</button>
                            </div>
                        </div>
                    </div>`;
                document.body.insertAdjacentHTML('beforeend', html);
            } catch (e) {
                console.error('ë©”ì‹œì§€ ì—ë””í„° ì—´ê¸° ì‹¤íŒ¨:', e);
                showSimpleAlert('âŒ ë©”ì‹œì§€ ì—ë””í„°ë¥¼ ì—¬ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ìˆ˜ì‹ ì ë³´ê¸° í•¨ìˆ˜
        async function showEmailRecipients() {
            // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('email-recipients-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // í˜„ì¬ ì„¤ì • ê°’ë“¤ ìˆ˜ì§‘
            const frequency = document.getElementById('email-frequency-select');
            const timeInput = document.getElementById('email-time-input');
            
            const frequencyText = frequency ? frequency.options[frequency.selectedIndex].text : 'ë§¤ì£¼';
            
            // ì‹œê°„ ì…ë ¥ ì²˜ë¦¬
            let timeText = 'ì˜¤ì „ 9ì‹œ 00ë¶„';
            if (timeInput && timeInput.value) {
                const [hours, minutes] = timeInput.value.split(':');
                const hour = parseInt(hours);
                const minute = parseInt(minutes);
                
                if (hour < 12) {
                    timeText = `ì˜¤ì „ ${hour}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else if (hour === 12) {
                    timeText = `ì˜¤í›„ 12ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else {
                    timeText = `ì˜¤í›„ ${hour - 12}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                }
            }

            // ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ í™•ì¸ ë° ì‹¤ì œ ë©¤ë²„ ë°ì´í„° ìˆ˜ì§‘
            const selectedGroups = [];
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            let allRecipients = [];
            
            // ê´€ë¦¬ì ìˆ˜ì§‘
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                allRecipients = allRecipients.concat(admins);
                selectedGroups.push('ê´€ë¦¬ì');
                console.log(`ê´€ë¦¬ì ${admins.length}ëª… ì¶”ê°€`);
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ì§‘
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                allRecipients = allRecipients.concat(allMembers);
                selectedGroups.push('ì „ì²´ ë©¤ë²„');
                console.log(`ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì¶”ê°€`);
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ì§‘ (ì‹¤ì‹œê°„ ì¡°íšŒ)
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                try {
                    // ì‹¤ì‹œê°„ìœ¼ë¡œ ë¹„í™œì„± ë©¤ë²„ ì¡°íšŒ
                    const currentMembersData = await getTeamMembers();
                    const currentInactiveMembers = currentMembersData ? currentMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                    allRecipients = allRecipients.concat(currentInactiveMembers);
                    selectedGroups.push('ë¹„í™œì„± ë©¤ë²„');
                    console.log(`í˜„ì¬ ì‹œì  ë¹„í™œì„± ë©¤ë²„ ${currentInactiveMembers.length}ëª… ì¶”ê°€`);
                } catch (error) {
                    console.error('ë¹„í™œì„± ë©¤ë²„ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    // ì‹¤íŒ¨ ì‹œ ìºì‹œëœ ë°ì´í„° ì‚¬ìš©
                    const inactiveMembers = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                    allRecipients = allRecipients.concat(inactiveMembers);
                    selectedGroups.push('ë¹„í™œì„± ë©¤ë²„');
                    console.log(`ìºì‹œëœ ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì¶”ê°€`);
                }
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ í™•ì¸
            const customEmails = document.getElementById('custom-emails');
            const customEmailList = customEmails && customEmails.value.trim() ? customEmails.value.trim() : '';
            
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmailList) {
                const emailList = customEmailList.split(',').filter(email => email.trim().length > 0);
                emailList.forEach(email => {
                    allRecipients.push({
                        name: 'ì§ì ‘ ì…ë ¥',
                        email: email.trim(),
                        role: 'custom',
                        spendData: { premiumRequests: 0, spend: 0 }
                    });
                });
                selectedGroups.push('ì§ì ‘ ì…ë ¥');
                console.log(`ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ${emailList.length}ê°œ ì¶”ê°€`);
            }
            
            // ì¤‘ë³µ ì œê±° (ì´ë©”ì¼ ê¸°ì¤€)
            const uniqueRecipients = [];
            const seenEmails = new Set();
            allRecipients.forEach(recipient => {
                if (!seenEmails.has(recipient.email)) {
                    seenEmails.add(recipient.email);
                    uniqueRecipients.push(recipient);
                }
            });
            
            console.log(`ì´ ${uniqueRecipients.length}ëª…ì˜ ê³ ìœ  ìˆ˜ì‹ ì ìˆ˜ì§‘ ì™„ë£Œ`);

            // ëª¨ë‹¬ HTML ìƒì„±
            const modalHTML = `
                <div id="email-recipients-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        background-color: #2a2a2a;
                        margin: 5% auto;
                        padding: 25px;
                        border-radius: 8px;
                        width: 90%;
                        max-width: 700px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                        max-height: 85vh;
                        overflow-y: auto;
                        border: 1px solid #3a3a3a;
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 25px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid #3a3a3a;
                        ">
                            <div style="color: #fff; font-size: 18px; font-weight: 600;">ìˆ˜ì‹ ì ë¯¸ë¦¬ë³´ê¸°</div>
                            <button onclick="closeEmailRecipientsModal()" style="
                                background: none;
                                border: none;
                                color: #7a7a7a;
                                font-size: 20px;
                                cursor: pointer;
                                padding: 5px;
                                border-radius: 3px;
                                transition: color 0.2s ease;
                            " onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#7a7a7a'">Ã—</button>
                        </div>

                        <!-- ë°œì†¡ ì„¤ì • -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ë°œì†¡ ì„¤ì •</div>
                            <div style="
                                color: #b1b1b1;
                                font-size: 14px;
                                line-height: 1.6;
                            ">
                                <div style="
                                    margin-bottom: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    background-color: transparent;
                                ">â€¢ ì£¼ê¸°: <span style="color: #ff9800;">${frequencyText}</span></div>
                                <div style="
                                    margin-bottom: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    background-color: transparent;
                                ">â€¢ ì‹œê°„: <span style="color: #ff9800;">${timeText}</span></div>

                            </div>
                        </div>

                        <!-- ë°œì†¡ ë©”ì‹œì§€ -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ë°œì†¡ ë©”ì‹œì§€</div>
                            <div style="
                                position: relative;
                                background-color: #1a1a1a;
                                border: 1px solid #3a3a3a;
                                border-radius: 4px;
                                transition: all 0.2s ease;
                            ">
                                <textarea 
                                    id="email-message-input" 
                                    placeholder="ì´ë©”ì¼ì— í¬í•¨ë  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                    style="
                                        width: 100%;
                                        height: 120px;
                                        padding: 12px;
                                        border: none;
                                        background: transparent;
                                        color: #ff9800;
                                        font-size: 14px;
                                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                        line-height: 1.5;
                                        outline: none;
                                        resize: vertical;
                                        min-height: 120px;
                                        max-height: 200px;
                                    "
                                    onfocus="this.parentElement.style.backgroundColor='#2a2a2a'; this.parentElement.style.borderColor='#4a9eff'"
                                    onblur="this.parentElement.style.backgroundColor='#1a1a1a'; this.parentElement.style.borderColor='#3a3a3a'"
                                    oninput="syncMessageInputs('email-message-input')"
                                ></textarea>
                            </div>
                            <div style="
                                color: #7a7a7a;
                                font-size: 12px;
                                margin-top: 5px;
                                text-align: right;
                            ">
                                <span id="message-char-count">0</span>/1000 ê¸€ì
                            </div>
                        </div>

                        <!-- ìˆ˜ì‹ ì ê·¸ë£¹ -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                            
                            <!-- ìˆ˜ì‹ ì ê²€ìƒ‰ ì°½ -->
                            <div style="margin-bottom: 20px; position: relative;">
                                <div style="
                                    position: relative;
                                    display: flex;
                                    align-items: center;
                                    background-color: #1a1a1a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    padding: 0 12px;
                                    transition: all 0.2s ease;
                                " onfocus="this.style.backgroundColor='#2a2a2a'; this.style.borderColor='#4a9eff'" onblur="this.style.backgroundColor='#1a1a1a'; this.style.borderColor='#3a3a3a'">
                                    <span style="
                                        color: #7a7a7a;
                                        margin-right: 8px;
                                        font-size: 14px;
                                    ">ğŸ”</span>
                                    <input 
                                        type="text" 
                                        id="recipient-search" 
                                        placeholder="ìˆ˜ì‹ ì ê²€ìƒ‰..."
                                        style="
                                            flex: 1;
                                            padding: 10px 0;
                                            border: none;
                                            background: transparent;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                            outline: none;
                                        "
                                    >
                                    <button 
                                        id="clear-search" 
                                        onclick="clearRecipientSearch()"
                                        style="
                                            background: none;
                                            border: none;
                                            color: #7a7a7a;
                                            cursor: pointer;
                                            padding: 4px;
                                            font-size: 16px;
                                            margin-left: 8px;
                                            display: none;
                                        "
                                        onmouseover="this.style.color='#fff'" 
                                        onmouseout="this.style.color='#7a7a7a'"
                                    >Ã—</button>
                                </div>
                            </div>

                            ${generateRecipientGroups(selectedGroups, customEmailList)}
                            
                            <!-- ì´ ìˆ˜ì‹ ì ìˆ˜ í‘œì‹œ -->
                            <div style="
                                margin-top: 20px;
                                padding: 15px;
                                background-color: #1a1a1a;
                                border-radius: 4px;
                                border: 1px solid #3a3a3a;
                            ">
                                <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 10px;">ğŸ“Š ìˆ˜ì‹ ì í†µê³„</div>
                                <div style="color: #b1b1b1; font-size: 14px; line-height: 1.6;">
                                    <div>â€¢ ì´ ìˆ˜ì‹ ì: <span style="color: #ff9800; font-weight: 600;">${uniqueRecipients.length}ëª…</span></div>
                                    <div>â€¢ ì¤‘ë³µ ì œê±°: <span style="color: #4a9eff; font-weight: 600;">${allRecipients.length - uniqueRecipients.length}ëª…</span></div>
                                    <div>â€¢ ì„ íƒëœ ê·¸ë£¹: <span style="color: #4a9eff; font-weight: 600;">${selectedGroups.join(', ')}</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                        <div style="display: flex; justify-content: space-between; gap: 10px; border-top: 1px solid #3a3a3a; padding-top: 20px;">
                            <button onclick="sendEmailFromPreview()" class="analytics-btn" style="padding: 10px 20px;">ğŸ“§ ì¦‰ì‹œ ë°œì†¡</button>
                            <button onclick="closeEmailRecipientsModal()" class="chart-btn" style="padding: 10px 20px;">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // ìˆ˜ì‹ ì ê²€ìƒ‰ ê¸°ëŠ¥ ë° ë©”ì‹œì§€ ì…ë ¥ì°½ ê¸°ëŠ¥ ì¶”ê°€
            setTimeout(() => {
                const searchInput = document.getElementById('recipient-search');
                const clearButton = document.getElementById('clear-search');
                const messageInput = document.getElementById('email-message-input');
                const charCount = document.getElementById('message-char-count');
                
                // ìˆ˜ì‹ ì ê²€ìƒ‰ ê¸°ëŠ¥
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();
                        const recipientRows = document.querySelectorAll('#email-recipients-modal .recipient-row');
                        
                        // X ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
                        if (clearButton) {
                            clearButton.style.display = this.value ? 'block' : 'none';
                        }
                        
                        recipientRows.forEach(row => {
                            const text = row.textContent.toLowerCase();
                            if (text.includes(searchTerm)) {
                                row.style.display = 'grid';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    });
                }
                
                // ë©”ì‹œì§€ ì…ë ¥ì°½ ì´ˆê¸° ë™ê¸°í™” ë° ê¸€ì ìˆ˜ ì¹´ìš´í„° ê¸°ëŠ¥
                if (messageInput && charCount) {
                    const maxLength = 1000;
                    
                    // Email Report í…Œì´ë¸”ì˜ ë©”ì‹œì§€ë¥¼ íŒì—…ìœ¼ë¡œ ë™ê¸°í™”
                    const emailReportMessage = document.getElementById('email-report-message');
                    if (emailReportMessage && emailReportMessage.value) {
                        messageInput.value = emailReportMessage.value;
                        console.log('íŒì—… ì—´ë¦´ ë•Œ ë©”ì‹œì§€ ë™ê¸°í™”:', emailReportMessage.value);
                    }
                    
                    // ì´ˆê¸° ê¸€ì ìˆ˜ ì„¤ì •
                    charCount.textContent = messageInput.value.length;
                    
                    messageInput.addEventListener('input', function() {
                        const currentLength = this.value.length;
                        charCount.textContent = currentLength;
                        
                        // ê¸€ì ìˆ˜ ì œí•œ
                        if (currentLength > maxLength) {
                            this.value = this.value.substring(0, maxLength);
                            charCount.textContent = maxLength;
                        }
                        
                        // ê¸€ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                        if (currentLength >= maxLength * 0.9) {
                            charCount.style.color = '#ff9800'; // ê²½ê³  ìƒ‰ìƒ
                        } else if (currentLength >= maxLength * 0.8) {
                            charCount.style.color = '#ff9800'; // ì£¼ì˜ ìƒ‰ìƒ
                        } else {
                            charCount.style.color = '#7a7a7a'; // ê¸°ë³¸ ìƒ‰ìƒ
                        }
                    });
                }
            }, 100);
        }

        // ì´ ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜
        function calculateTotalRecipients(selectedGroups, customEmailList) {
            let total = 0;
            
            // ì‹¤ì œ ë©¤ë²„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë£¹ë³„ ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚°
            selectedGroups.forEach(group => {
                switch(group) {
                    case 'ê´€ë¦¬ì':
                        const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                        total += admins.length;
                        break;
                    case 'ì „ì²´ ë©¤ë²„':
                        const allMembers = originalMembersData ? [...originalMembersData] : [];
                        total += allMembers.length;
                        break;
                    case 'ë¹„í™œì„± ë©¤ë²„':
                        const inactiveMembers = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                        total += inactiveMembers.length;
                        break;
                }
            });
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ìˆ˜ ì¶”ê°€
            if (customEmailList) {
                const emails = customEmailList.split(',').filter(email => email.trim().length > 0);
                total += emails.length;
            }
            
            return total;
        }

        // ìˆ˜ì‹ ì ê·¸ë£¹ HTML ìƒì„± í•¨ìˆ˜
        function generateRecipientGroups(selectedGroups, customEmailList) {
            let html = '';
            
            // ì‹¤ì œ ë©¤ë²„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë£¹ë³„ ìˆ˜ì‹ ì í‘œì‹œ
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            // ê´€ë¦¬ì ê·¸ë£¹
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ê´€ë¦¬ì <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${admins.length}ëª…</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${admins.length > 0 ? admins.map(admin => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #ff9800; border-right: 1px solid #3a3a3a;">${admin.name || 'Unnamed'}</div>
                                    <div style="padding: 10px; color: #ff9800;">${admin.email}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
            // ì „ì²´ ë©¤ë²„ ê·¸ë£¹
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ì „ì²´ ë©¤ë²„ <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${allMembers.length}ëª…</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${allMembers.length > 0 ? allMembers.map(member => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #4CAF50; border-right: 1px solid #3a3a3a;">${member.name || 'Unnamed'}</div>
                                    <div style="padding: 10px; color: #4CAF50;">${member.email}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ê·¸ë£¹
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveMembers = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ë¹„í™œì„± ë©¤ë²„ <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${inactiveMembers.length}ëª…</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${inactiveMembers.length > 0 ? inactiveMembers.map(member => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #7a7a7a; border-right: 1px solid #3a3a3a;">${member.name || 'Unnamed'}</div>
                                    <div style="padding: 10px; color: #7a7a7a;">${member.email}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ë¹„í™œì„± ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ê·¸ë£¹
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmailList) {
                const emailList = customEmailList.split(',').filter(email => email.trim().length > 0);
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ì§ì ‘ ì…ë ¥ <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${emailList.length}ê°œ</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${emailList.length > 0 ? emailList.map(email => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #4a9eff; border-right: 1px solid #3a3a3a;">ì§ì ‘ ì…ë ¥</div>
                                    <div style="padding: 10px; color: #4a9eff;">${email.trim()}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ì§ì ‘ ì…ë ¥ëœ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
           
            
            
            return html;
        }

        // ë©¤ë²„ í–‰ ìƒì„± í•¨ìˆ˜
        function generateMemberRows(count, type) {
            let html = '';
            const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„', 'ìœ¤ì„œì—°', 'ê°•íƒœìš°', 'ì„ì§€ì˜', 'í•œìŠ¹ìš°', 'ì†¡ë¯¸ë¼'];
            const domains = ['samsung.com', 'samsung.co.kr'];
            
            for (let i = 0; i < count; i++) {
                const name = names[i % names.length] + (Math.floor(i / names.length) + 1);
                const domain = domains[i % domains.length];
                const email = `${name.toLowerCase().replace(/[ê°€-í£]/g, '')}@${domain}`;
                
                html += `
                    <div class="recipient-row" style="
                        display: grid;
                        grid-template-columns: 1fr 2fr;
                        ${i < count - 1 ? 'border-bottom: 1px solid #3a3a3a;' : ''}
                    ">
                        <div style="padding: 10px; color: #ff9800; border-right: 1px solid #3a3a3a;">${name}</div>
                        <div style="padding: 10px; color: #ff9800;">${email}</div>
                    </div>
                `;
            }
            
            return html;
        }

        // ê²€ìƒ‰ì°½ ì´ˆê¸°í™” í•¨ìˆ˜
        function clearRecipientSearch() {
            const searchInput = document.getElementById('recipient-search');
            const clearButton = document.getElementById('clear-search');
            
            if (searchInput) {
                searchInput.value = '';
                if (clearButton) {
                    clearButton.style.display = 'none';
                }
                
                // ëª¨ë“  í–‰ ë‹¤ì‹œ í‘œì‹œ
                const recipientRows = document.querySelectorAll('#email-recipients-modal .recipient-row');
                recipientRows.forEach(row => {
                    row.style.display = 'grid';
                });
            }
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeEmailScheduleModal() {
            const modal = document.getElementById('email-schedule-modal');
            if (modal) {
                modal.remove();
            }
        }



        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ í•¨ìˆ˜
        function filterScheduleList(filter) {
            const filterButtons = document.querySelectorAll('#email-schedule-modal [data-filter]');
            const scheduleItems = document.querySelectorAll('#email-schedule-modal .schedule-item');
            
            // í•„í„° ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            filterButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ì•„ì´í…œ í•„í„°ë§
            scheduleItems.forEach(item => {
                if (filter === 'all') {
                    // ì „ì²´ ë³´ê¸°: ëª¨ë“  ì•„ì´í…œ í‘œì‹œ
                    item.style.display = 'grid';
                } else if (filter === 'active') {
                    // í™œì„± ë³´ê¸°: í™œì„± ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì²´í¬ëœ ì•„ì´í…œë§Œ í‘œì‹œ
                    const activeRadio = item.querySelector('input[value="active"]');
                    if (activeRadio && activeRadio.checked) {
                    item.style.display = 'grid';
                } else {
                    item.style.display = 'none';
                    }
                } else if (filter === 'inactive') {
                    // ë¹„í™œì„± ë³´ê¸°: ë¹„í™œì„± ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì²´í¬ëœ ì•„ì´í…œë§Œ í‘œì‹œ
                    const inactiveRadio = item.querySelector('input[value="inactive"]');
                    if (inactiveRadio && inactiveRadio.checked) {
                        item.style.display = 'grid';
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
        }

        // ì˜ˆì•½ ìƒì„¸ ë³´ê¸° í•¨ìˆ˜
        function showScheduleDetail(id) {
            alert(`ì˜ˆì•½ ID ${id}ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.`);
            // ì‹¤ì œë¡œëŠ” ìƒì„¸ ëª¨ë‹¬ì„ ë„ìš°ê±°ë‚˜ í˜ì´ì§€ë¥¼ ì´ë™
        }

        // ì˜ˆì•½ í¸ì§‘ í•¨ìˆ˜
        function editSchedule(id) {
            alert(`ì˜ˆì•½ ID ${id}ë¥¼ í¸ì§‘í•©ë‹ˆë‹¤.`);
            // ì‹¤ì œë¡œëŠ” í¸ì§‘ ëª¨ë‹¬ì„ ë„ìš°ê±°ë‚˜ í˜ì´ì§€ë¥¼ ì´ë™
        }

        // ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateScheduleStatus(id, status) {
            // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
            if (window.emailScheduleList) {
                const schedule = window.emailScheduleList.find(s => s.id === id);
                if (schedule) {
                    schedule.status = status;
                    console.log(`ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸: ${id} -> ${status}`);
                    
                    // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸
                    checkSchedulerStatus();
                }
            }
        }

        // ì „ì²´ ì˜ˆì•½ ì‚­ì œ í•¨ìˆ˜
        function deleteAllSchedules() {
            // ì „ì²´ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ìƒì„±
            const modalHTML = `
                <div id="delete-all-confirm-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 2000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 90%;
                        max-width: 400px;
                        background-color: #1a1a1a;
                        border: 1px solid #3a3a3a;
                        border-radius: 8px;
                        padding: 30px;
                        text-align: center;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            margin-bottom: 20px;
                            color: #fff;
                            font-size: 18px;
                            font-weight: 600;
                        ">ì „ì²´ ì˜ˆì•½ ì‚­ì œ</div>
                        
                        <!-- í™•ì¸ ë©”ì‹œì§€ -->
                        <div style="
                            margin-bottom: 25px;
                            color: #e1e1e1;
                            font-size: 14px;
                            line-height: 1.5;
                        ">ì •ë§ë¡œ ëª¨ë“  ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="chart-btn" onclick="closeDeleteAllConfirmModal()" style="min-width: 80px;">ì·¨ì†Œ</button>
                            <button class="analytics-btn" onclick="confirmDeleteAllSchedules()" style="min-width: 80px;">í™•ì¸</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // ì „ì²´ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeDeleteAllConfirmModal() {
            const modal = document.getElementById('delete-all-confirm-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ì „ì²´ ì˜ˆì•½ ì‚­ì œ í™•ì¸ í•¨ìˆ˜
        function confirmDeleteAllSchedules() {
            // ëª¨ë‹¬ ë‹«ê¸°
            closeDeleteAllConfirmModal();
            
            // ëª¨ë“  ì˜ˆì•½ ì‚­ì œ
            window.emailScheduleList = [];
            
            // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸
            checkSchedulerStatus();
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            showSimpleAlert('âœ… ëª¨ë“  ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            
            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í™”ë©´ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                showEmailScheduleList();
            }, 1000);
        }

        // ì˜ˆì•½ ì‚­ì œ í•¨ìˆ˜
        function deleteSchedule(id) {
            // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ìƒì„±
            const modalHTML = `
                <div id="delete-confirm-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 2000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 90%;
                        max-width: 400px;
                        background-color: #1a1a1a;
                        border: 1px solid #3a3a3a;
                        border-radius: 8px;
                        padding: 30px;
                        text-align: center;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            margin-bottom: 20px;
                            color: #fff;
                            font-size: 18px;
                            font-weight: 600;
                        ">ì˜ˆì•½ ì‚­ì œ</div>
                        
                        <!-- í™•ì¸ ë©”ì‹œì§€ -->
                        <div style="
                            margin-bottom: 25px;
                            color: #e1e1e1;
                            font-size: 14px;
                            line-height: 1.5;
                        ">ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="chart-btn" onclick="closeDeleteConfirmModal()" style="min-width: 80px;">ì·¨ì†Œ</button>
                            <button class="analytics-btn" onclick="confirmDeleteSchedule(${id})" style="min-width: 80px;">í™•ì¸</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeDeleteConfirmModal() {
            const modal = document.getElementById('delete-confirm-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ì˜ˆì•½ ì‚­ì œ í™•ì¸ í•¨ìˆ˜
        function confirmDeleteSchedule(id) {
            // ëª¨ë‹¬ ë‹«ê¸°
            closeDeleteConfirmModal();
            
            // ì „ì—­ ë³€ìˆ˜ì—ì„œ ì‚­ì œ
            if (window.emailScheduleList) {
                window.emailScheduleList = window.emailScheduleList.filter(schedule => schedule.id !== id);
            }
            
            // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸
            checkSchedulerStatus();
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            showSimpleAlert('âœ… ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            
            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í™”ë©´ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                showEmailScheduleList();
            }, 1000);
            
            console.log(`ì˜ˆì•½ ID ${id}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ìƒˆ ì˜ˆì•½ ì¶”ê°€ í•¨ìˆ˜
        function addNewSchedule() {
            // ê¸°ì¡´ ëª¨ë‹¬ ë‹«ê¸°
            closeEmailScheduleModal();
            
            // ìƒˆ ì˜ˆì•½ ì…ë ¥ ëª¨ë‹¬ ìƒì„±
            const modalHTML = `
                <div id="new-schedule-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 95%;
                        max-width: 1200px;
                        max-height: 90vh;
                        background-color: #1a1a1a;
                        border: 1px solid #3a3a3a;
                        border-radius: 8px;
                        padding: 30px;
                        overflow-y: auto;
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 25px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid #3a3a3a;
                        ">
                            <div style="color: #fff; font-size: 18px; font-weight: 600;">ìƒˆ ì˜ˆì•½ ì¶”ê°€</div>
                            <button onclick="closeNewScheduleModal()" style="
                                background: none;
                                border: none;
                                color: #7a7a7a;
                                font-size: 20px;
                                cursor: pointer;
                                padding: 5px;
                                border-radius: 3px;
                                transition: color 0.2s ease;
                            " onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#7a7a7a'">Ã—</button>
                        </div>

                        <!-- ì˜ˆì•½ ì…ë ¥ í¼ -->
                        <div style="margin-bottom: 20px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ì˜ˆì•½ ì •ë³´</div>
                            
                            <!-- ì œëª© ì…ë ¥ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ì œëª©</div>
                                <input type="text" id="new-schedule-title" placeholder="ì˜ˆì•½ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="
                                    width: 100%;
                                    padding: 10px 12px;
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    color: #e1e1e1;
                                    font-size: 14px;
                                    outline: none;
                                " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'">
                            </div>

                            <!-- ì£¼ê¸° ì„ íƒ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ì£¼ê¸°</div>
                                <select id="new-schedule-frequency" style="
                                    width: 100%;
                                    padding: 10px 12px;
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    color: #e1e1e1;
                                    font-size: 14px;
                                    outline: none;
                                " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'">
                                    <option value="daily">ë§¤ì¼</option>
                                    <option value="weekly" selected>ë§¤ì£¼</option>
                                    <option value="monthly">ë§¤ì›”</option>
                                </select>
                            </div>

                            <!-- ì‹œê°„ ì…ë ¥ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ì‹œê°„</div>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="new-schedule-hour" style="
                                        background-color: #2a2a2a;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 10px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        outline: none;
                                        flex: 1;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'" onchange="updateNewScheduleTime()">
                                        <option value="00">ì˜¤ì „ 12ì‹œ</option>
                                        <option value="01">ì˜¤ì „ 1ì‹œ</option>
                                        <option value="02">ì˜¤ì „ 2ì‹œ</option>
                                        <option value="03">ì˜¤ì „ 3ì‹œ</option>
                                        <option value="04">ì˜¤ì „ 4ì‹œ</option>
                                        <option value="05">ì˜¤ì „ 5ì‹œ</option>
                                        <option value="06">ì˜¤ì „ 6ì‹œ</option>
                                        <option value="07">ì˜¤ì „ 7ì‹œ</option>
                                        <option value="08">ì˜¤ì „ 8ì‹œ</option>
                                        <option value="09" selected>ì˜¤ì „ 9ì‹œ</option>
                                        <option value="10">ì˜¤ì „ 10ì‹œ</option>
                                        <option value="11">ì˜¤ì „ 11ì‹œ</option>
                                        <option value="12">ì˜¤í›„ 12ì‹œ</option>
                                        <option value="13">ì˜¤í›„ 1ì‹œ</option>
                                        <option value="14">ì˜¤í›„ 2ì‹œ</option>
                                        <option value="15">ì˜¤í›„ 3ì‹œ</option>
                                        <option value="16">ì˜¤í›„ 4ì‹œ</option>
                                        <option value="17">ì˜¤í›„ 5ì‹œ</option>
                                        <option value="18">ì˜¤í›„ 6ì‹œ</option>
                                        <option value="19">ì˜¤í›„ 7ì‹œ</option>
                                        <option value="20">ì˜¤í›„ 8ì‹œ</option>
                                        <option value="21">ì˜¤í›„ 9ì‹œ</option>
                                        <option value="22">ì˜¤í›„ 10ì‹œ</option>
                                        <option value="23">ì˜¤í›„ 11ì‹œ</option>
                                    </select>
                                    <select id="new-schedule-minute" style="
                                        background-color: #2a2a2a;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 10px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        outline: none;
                                        min-width: 100px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'" onchange="updateNewScheduleTime()">
                                        <option value="00" selected>00ë¶„</option>
                                        <option value="01">01ë¶„</option>
                                        <option value="02">02ë¶„</option>
                                        <option value="03">03ë¶„</option>
                                        <option value="04">04ë¶„</option>
                                        <option value="05">05ë¶„</option>
                                        <option value="06">06ë¶„</option>
                                        <option value="07">07ë¶„</option>
                                        <option value="08">08ë¶„</option>
                                        <option value="09">09ë¶„</option>
                                        <option value="10">10ë¶„</option>
                                        <option value="11">11ë¶„</option>
                                        <option value="12">12ë¶„</option>
                                        <option value="13">13ë¶„</option>
                                        <option value="14">14ë¶„</option>
                                        <option value="15">15ë¶„</option>
                                        <option value="16">16ë¶„</option>
                                        <option value="17">17ë¶„</option>
                                        <option value="18">18ë¶„</option>
                                        <option value="19">19ë¶„</option>
                                        <option value="20">20ë¶„</option>
                                        <option value="21">21ë¶„</option>
                                        <option value="22">22ë¶„</option>
                                        <option value="23">23ë¶„</option>
                                        <option value="24">24ë¶„</option>
                                        <option value="25">25ë¶„</option>
                                        <option value="26">26ë¶„</option>
                                        <option value="27">27ë¶„</option>
                                        <option value="28">28ë¶„</option>
                                        <option value="29">29ë¶„</option>
                                        <option value="30">30ë¶„</option>
                                        <option value="31">31ë¶„</option>
                                        <option value="32">32ë¶„</option>
                                        <option value="33">33ë¶„</option>
                                        <option value="34">34ë¶„</option>
                                        <option value="35">35ë¶„</option>
                                        <option value="36">36ë¶„</option>
                                        <option value="37">37ë¶„</option>
                                        <option value="38">38ë¶„</option>
                                        <option value="39">39ë¶„</option>
                                        <option value="40">40ë¶„</option>
                                        <option value="41">41ë¶„</option>
                                        <option value="42">42ë¶„</option>
                                        <option value="43">43ë¶„</option>
                                        <option value="44">44ë¶„</option>
                                        <option value="45">45ë¶„</option>
                                        <option value="46">46ë¶„</option>
                                        <option value="47">47ë¶„</option>
                                        <option value="48">48ë¶„</option>
                                        <option value="49">49ë¶„</option>
                                        <option value="50">50ë¶„</option>
                                        <option value="51">51ë¶„</option>
                                        <option value="52">52ë¶„</option>
                                        <option value="53">53ë¶„</option>
                                        <option value="54">54ë¶„</option>
                                        <option value="55">55ë¶„</option>
                                        <option value="56">56ë¶„</option>
                                        <option value="57">57ë¶„</option>
                                        <option value="58">58ë¶„</option>
                                        <option value="59">59ë¶„</option>
                                    </select>
                                    <!-- ìˆ¨ê²¨ì§„ time input (ê¸°ì¡´ ë¡œì§ í˜¸í™˜ì„±ì„ ìœ„í•´) -->
                                    <input type="time" id="new-schedule-time" value="09:00" style="display: none;">
                                </div>
                            </div>

                            <!-- ìˆ˜ì‹ ì ê·¸ë£¹ ì„ íƒ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                                <div style="
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    padding: 12px;
                                ">
                                    <!-- ê´€ë¦¬ì ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-admin-checkbox" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ê´€ë¦¬ì
                                        </label>
                                    </div>
                                    
                                    <!-- ì „ì²´ ë©¤ë²„ ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-all-members-checkbox" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ì „ì²´ ë©¤ë²„
                                        </label>
                                    </div>
                                    
                                    <!-- ë¹„í™œì„± ë©¤ë²„ ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-inactive-members-checkbox" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ë¹„í™œì„± ë©¤ë²„
                                        </label>
                                    </div>
                                    
                                    <!-- ì§ì ‘ ì…ë ¥ ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-custom-email-checkbox" onclick="toggleNewCustomEmailInput()" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ì§ì ‘ ì…ë ¥
                                        </label>
                                    </div>
                                    
                                    <!-- ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ í…ìŠ¤íŠ¸ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
                                    <div id="new-custom-email-container" style="display: none; margin-top: 8px;">
                                        <textarea id="new-custom-emails" placeholder="emailì„ ì§ì ‘ ì…ë ¥ í•˜ì„¸ìš”.(example1@samsung.com, example2@samsung.com)" style="
                                            width: 100%;
                                            padding: 8px 12px;
                                            background-color: #1a1a1a;
                                            border: 1px solid #3a3a3a;
                                            border-radius: 4px;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                            outline: none;
                                            resize: vertical;
                                            min-height: 60px;
                                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                        " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- ë©”ì‹œì§€ ì…ë ¥ -->
                            <div style="margin-bottom: 20px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ë©”ì‹œì§€</div>
                                <textarea id="new-schedule-message" placeholder="ë°œì†¡í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="
                                    width: 100%;
                                    height: 100px;
                                    padding: 10px 12px;
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    color: #e1e1e1;
                                    font-size: 14px;
                                    outline: none;
                                    resize: vertical;
                                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'"></textarea>
                            </div>
                        </div>

                        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                        <div style="display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #3a3a3a; padding-top: 20px;">
                            <button class="chart-btn" onclick="closeNewScheduleModal()">ì·¨ì†Œ</button>
                            <button class="analytics-btn" onclick="saveNewSchedule()">ì €ì¥</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // ìƒˆ ì˜ˆì•½ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeNewScheduleModal() {
            const modal = document.getElementById('new-schedule-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ìƒˆ ì˜ˆì•½ ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ í† ê¸€ í•¨ìˆ˜
        function toggleNewCustomEmailInput() {
            const customEmailCheckbox = document.getElementById('new-custom-email-checkbox');
            const customEmailContainer = document.getElementById('new-custom-email-container');
            
            if (customEmailCheckbox && customEmailContainer) {
                if (customEmailCheckbox.checked) {
                    customEmailContainer.style.display = 'block';
                } else {
                    customEmailContainer.style.display = 'none';
                    // ì²´í¬ í•´ì œ ì‹œ ì…ë ¥ê°’ ì´ˆê¸°í™”
                    const customEmails = document.getElementById('new-custom-emails');
                    if (customEmails) {
                        customEmails.value = '';
                    }
                }
            }
        }

        // ìƒˆ ì˜ˆì•½ ì €ì¥ í•¨ìˆ˜
        function saveNewSchedule() {
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const title = document.getElementById('new-schedule-title').value.trim();
            const frequencySelect = document.getElementById('new-schedule-frequency');
            const timeInput = document.getElementById('new-schedule-time');
            const message = document.getElementById('new-schedule-message').value.trim();

            // ì œëª© ê¸°ë³¸ê°’ ì„¤ì •
            const titleText = title || 'ì œëª© ì—†ìŒ';

            // ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ í™•ì¸
            const selectedGroups = [];
            const adminCheckbox = document.getElementById('new-admin-checkbox');
            const allMembersCheckbox = document.getElementById('new-all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('new-inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('new-custom-email-checkbox');

            if (adminCheckbox && adminCheckbox.checked) {
                selectedGroups.push('ê´€ë¦¬ì');
            }
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                selectedGroups.push('ì „ì²´ ë©¤ë²„');
            }
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                selectedGroups.push('ë¹„í™œì„± ë©¤ë²„');
            }

            // ì§ì ‘ ì…ë ¥ì´ ì„ íƒëœ ê²½ìš° ìˆ˜ì‹ ì ê·¸ë£¹ì— ì¶”ê°€
            if (customEmailCheckbox && customEmailCheckbox.checked) {
                selectedGroups.push('ì§ì ‘ì…ë ¥');
            }

            if (selectedGroups.length === 0) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ì ê·¸ë£¹ì„ ìµœì†Œ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            // ì§ì ‘ ì…ë ¥ ì²´í¬ ì‹œ ì´ë©”ì¼ ì£¼ì†Œ í™•ì¸
            const customEmails = document.getElementById('new-custom-emails');
            
            if (customEmailCheckbox && customEmailCheckbox.checked) {
                if (!customEmails || !customEmails.value.trim()) {
                    showSimpleAlert('âš ï¸ ì§ì ‘ ì…ë ¥ì„ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.\nì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }
                
                // ì´ë©”ì¼ í˜•ì‹ ê°„ë‹¨ ê²€ì¦
                const emailList = customEmails.value.split(',');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of emailList) {
                    email = email.trim();
                    if (email && !emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}\n\nì˜¬ë°”ë¥¸ í˜•ì‹: example@samsung.com`, 'warning');
                        return;
                    }
                }
            }

            // ì£¼ê¸° í…ìŠ¤íŠ¸ ë³€í™˜
            const frequencyText = frequencySelect.options[frequencySelect.selectedIndex].text;
            const frequencyValue = frequencySelect.value;

            // ì‹œê°„ í…ìŠ¤íŠ¸ ë³€í™˜
            let timeText = 'ì˜¤ì „ 9ì‹œ 00ë¶„';
            let timeValue = '09:00';
            if (timeInput && timeInput.value) {
                const [hours, minutes] = timeInput.value.split(':');
                const hour = parseInt(hours);
                const minute = parseInt(minutes);
                timeValue = timeInput.value;
                
                if (hour < 12) {
                    timeText = `ì˜¤ì „ ${hour}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else if (hour === 12) {
                    timeText = `ì˜¤í›„ 12ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else {
                    timeText = `ì˜¤í›„ ${hour - 12}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                }
            }

            // ë©”ì‹œì§€ ê¸°ë³¸ê°’ ì„¤ì •
            const messageText = message || 'ì…ë ¥ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';

            // ìˆ˜ì‹ ì ì •ë³´ ìˆ˜ì§‘
            const recipientsText = selectedGroups.join(', ');

            // ìƒˆ ì˜ˆì•½ ìƒì„±
            const newSchedule = {
                id: Date.now(),
                title: titleText,
                frequency: frequencyText,
                time: timeText,
                recipients: recipientsText,
                status: "í™œì„±",
                nextSend: calculateNextSendTime(frequencyValue, timeValue),
                message: messageText,
                // ì²¨ë¶€ íŒŒì¼ ì„¤ì • ìŠ¤ëƒ…ìƒ·
                attachAllMembers: !!document.getElementById('attachment-all-members')?.checked,
                attachInactiveMembers: !!document.getElementById('attachment-inactive-members')?.checked,
                attachCustom: !!document.getElementById('attachment-custom')?.checked,
                attachAllUsage: !!document.getElementById('attachment-all-usage')?.checked,
                attachInactiveUsage: !!document.getElementById('attachment-inactive-usage')?.checked,
                attachCustomUsage: !!document.getElementById('attachment-custom-usage')?.checked,
                usagePeriodText: (document.getElementById('usage-attachment-period-text')?.textContent || '').trim(),
                // ìƒˆ ì˜ˆì•½ ëª¨ë‹¬ì—ì„œ ì…ë ¥í•œ ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì €ì¥
                customEmails: (function(){
                    const chk = document.getElementById('new-custom-email-checkbox');
                    const ta = document.getElementById('new-custom-emails');
                    if (chk && chk.checked && ta && ta.value.trim()) {
                        return ta.value.split(',').map(e => e.trim()).filter(Boolean);
                    }
                    return [];
                })(),
                // ì²¨ë¶€ ì‹œíŠ¸ ìŠ¤ëƒ…ìƒ· (ìˆìœ¼ë©´ ì €ì¥)
                attachmentsSheets: (window.__attachmentsSheets || null)
            };

            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
            if (!window.emailScheduleList) {
                window.emailScheduleList = [];
            }

            // ì¤‘ë³µ ë°ì´í„° ì²´í¬
            const isDuplicate = window.emailScheduleList.some(existingSchedule => {
                return existingSchedule.frequency === newSchedule.frequency &&
                       existingSchedule.time === newSchedule.time &&
                       existingSchedule.recipients === newSchedule.recipients &&
                       existingSchedule.message === newSchedule.message;
            });

            // ì¤‘ë³µì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì¶”ê°€
            if (!isDuplicate) {
                window.emailScheduleList.push(newSchedule);
                
                // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸
                checkSchedulerStatus();
                
                // ëª¨ë‹¬ ë‹«ê¸°
                closeNewScheduleModal();
                
                // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€
                showSimpleAlert('âœ… ìƒˆ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('ìƒˆ ì˜ˆì•½ ì¶”ê°€ ì™„ë£Œ', newSchedule);
                
                // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í™”ë©´ìœ¼ë¡œ ì´ë™
                setTimeout(() => {
                    showEmailScheduleList();
                }, 1000);
            } else {
                // ì¤‘ë³µì¸ ê²½ìš° ê²½ê³  ë©”ì‹œì§€
                showSimpleAlert('âš ï¸ ë™ì¼í•œ ì„¤ì •ì˜ ì˜ˆì•½ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.', 'warning');
            }
        }

        // ìˆ˜ì‹ ì ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeEmailRecipientsModal() {
            const modal = document.getElementById('email-recipients-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ì„¤ì • ì €ì¥ í•¨ìˆ˜
        async function saveEmailSettings() {
            // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ í† ê¸€ í™•ì¸
            const emailToggle = document.querySelector('#settings .toggle-switch');
            const isEmailSchedulerEnabled = emailToggle && !emailToggle.classList.contains('off');

            if (!isEmailSchedulerEnabled) {
                showSimpleAlert('âš ï¸ ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ê°€ ë¹„í™œì„±í™” ìƒíƒœì…ë‹ˆë‹¤.\nì„¤ì •ì„ ì €ì¥í•˜ê¸° ì „ì— ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            // ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ í™•ì¸ (ì§ì ‘ ì…ë ¥ ì œì™¸)
            // ìˆ˜ì‹ ì ê·¸ë£¹ ì „ìš© ì²´í¬ë°•ìŠ¤ë§Œ ëŒ€ìƒìœ¼ë¡œ í•œì •í•˜ì—¬ ë‹¤ë¥¸ ì„¤ì •(ì˜ˆ: ì‚¬ìš©ëŸ‰) ì²´í¬ë°•ìŠ¤ê°€ í¬í•¨ë˜ì§€ ì•Šë„ë¡ í•¨
            const selectedGroups = [];
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailToggle = document.getElementById('custom-email-checkbox');

            if (adminCheckbox && adminCheckbox.checked) {
                selectedGroups.push('ê´€ë¦¬ì');
            }
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                selectedGroups.push('ì „ì²´ ë©¤ë²„');
            }
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                selectedGroups.push('ë¹„í™œì„± ë©¤ë²„');
            }

            // ì§ì ‘ ì…ë ¥ ì²´í¬ ì‹œ ì´ë©”ì¼ ì£¼ì†Œ í™•ì¸
            const customEmailCheckbox = customEmailToggle;
            const customEmails = document.getElementById('custom-emails');
            
            // ìˆ˜ì‹ ì ê·¸ë£¹ì´ë‚˜ ì§ì ‘ ì…ë ¥ ì¤‘ í•˜ë‚˜ë¼ë„ ì„ íƒë˜ì–´ì•¼ í•¨
            const hasCustomEmail = customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim();
            
            if (selectedGroups.length === 0 && !hasCustomEmail) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ì ê·¸ë£¹ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            if (hasCustomEmail) {
                // ì´ë©”ì¼ í˜•ì‹ ê°„ë‹¨ ê²€ì¦
                const emailList = customEmails.value.split(',');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of emailList) {
                    email = email.trim();
                    if (email && !emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}\n\nì˜¬ë°”ë¥¸ í˜•ì‹: example@samsung.com`, 'warning');
                        return;
                    }
                }
            }



            // ë©”ì‹œì§€ ì…ë ¥ í™•ì¸ ë° ê¸°ë³¸ê°’ ì„¤ì •
            const messageInput = document.getElementById('email-report-message');
            let messageText = messageInput ? messageInput.value.trim() : '';
            
            // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì„¤ì •
            if (!messageText) {
                messageText = 'ì…ë ¥ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';
            }

            // í˜„ì¬ ì„¤ì • ê°’ë“¤ ìˆ˜ì§‘
            const frequency = document.getElementById('email-frequency-select');
            const timeInput = document.getElementById('email-time-input');
            
            const frequencyText = frequency ? frequency.options[frequency.selectedIndex].text : 'ë§¤ì£¼';
            const frequencyValue = frequency ? frequency.value : 'weekly';
            
            // ì‹œê°„ ì…ë ¥ ì²˜ë¦¬
            let timeText = 'ì˜¤ì „ 9ì‹œ 00ë¶„';
            let timeValue = '09:00';
            if (timeInput && timeInput.value) {
                const [hours, minutes] = timeInput.value.split(':');
                const hour = parseInt(hours);
                const minute = parseInt(minutes);
                timeValue = timeInput.value;
                
                if (hour < 12) {
                    timeText = `ì˜¤ì „ ${hour}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else if (hour === 12) {
                    timeText = `ì˜¤í›„ 12ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else {
                    timeText = `ì˜¤í›„ ${hour - 12}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                }
            }

            // ìˆ˜ì‹ ì ì •ë³´ ìˆ˜ì§‘ (ë¹„í™œì„± ë©¤ë²„ ì‹¤ì‹œê°„ ì¡°íšŒ í¬í•¨)
            let recipientsText = selectedGroups.join(', ');
            
            // ë¹„í™œì„± ë©¤ë²„ê°€ ì„ íƒëœ ê²½ìš° ì‹¤ì‹œê°„ ì¡°íšŒ
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                try {
                    // ì‹¤ì‹œê°„ìœ¼ë¡œ ë¹„í™œì„± ë©¤ë²„ ì¡°íšŒ
                    const currentMembersData = await getTeamMembers();
                    const currentInactiveMembers = currentMembersData ? currentMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                    console.log(`ì˜ˆì•½ ë°œì†¡ ì‹œì  ë¹„í™œì„± ë©¤ë²„ ${currentInactiveMembers.length}ëª… ì¡°íšŒ`);
                } catch (error) {
                    console.error('ì˜ˆì•½ ë°œì†¡ ì‹œ ë¹„í™œì„± ë©¤ë²„ ì¡°íšŒ ì‹¤íŒ¨:', error);
                }
            }
            
            if (hasCustomEmail) {
                // ì§ì ‘ ì…ë ¥ì´ ì²´í¬ë˜ê³  ì´ë©”ì¼ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì¶”ê°€
                recipientsText += recipientsText ? ', ì§ì ‘ì…ë ¥' : 'ì§ì ‘ì…ë ¥';
            }

            // ì´ë²ˆ ë°œì†¡ ì‹œê°„ ê³„ì‚° (í˜„ì¬ ì„¤ì •ëœ ì‹œê°„)
            const currentSendTime = calculateCurrentSendTime(frequencyValue, timeValue);
            
            // ìƒˆ ì˜ˆì•½ ìƒì„±
            const newSchedule = {
                id: Date.now(), // ê³ ìœ  ID ìƒì„±
                title: `${frequencyText} ë¦¬í¬íŠ¸`,
                frequency: frequencyText,
                time: timeText,
                recipients: recipientsText,
                status: "í™œì„±",
                currentSend: currentSendTime, // ì´ë²ˆ ë°œì†¡ ì‹œê°„
                nextSend: calculateNextSendTime(frequencyValue, timeValue),
                message: messageText,
                // ì²¨ë¶€ íŒŒì¼ ì„¤ì • ìŠ¤ëƒ…ìƒ·
                attachAllMembers: !!document.getElementById('attachment-all-members')?.checked,
                attachInactiveMembers: !!document.getElementById('attachment-inactive-members')?.checked,
                attachCustom: !!document.getElementById('attachment-custom')?.checked,
                attachAllUsage: !!document.getElementById('attachment-all-usage')?.checked,
                attachInactiveUsage: !!document.getElementById('attachment-inactive-usage')?.checked,
                attachCustomUsage: !!document.getElementById('attachment-custom-usage')?.checked,
                usagePeriodText: (document.getElementById('usage-attachment-period-text')?.textContent || '').trim(),
                // Settingsì—ì„œì˜ ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì €ì¥
                customEmails: (function(){
                    const chk = document.getElementById('custom-email-checkbox');
                    const ta = document.getElementById('custom-emails');
                    if (chk && chk.checked && ta && ta.value.trim()) {
                        return ta.value.split(',').map(e => e.trim()).filter(Boolean);
                    }
                    return [];
                })(),
                // ì²¨ë¶€ ì‹œíŠ¸ ìŠ¤ëƒ…ìƒ· (ìˆìœ¼ë©´ ì €ì¥)
                attachmentsSheets: (window.__attachmentsSheets || null)
            };

            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (ì „ì—­ ë³€ìˆ˜ë¡œ ê´€ë¦¬)
            if (!window.emailScheduleList) {
                window.emailScheduleList = [];
            }

            // ì¤‘ë³µ ë°ì´í„° ì²´í¬
            const isDuplicate = window.emailScheduleList.some(existingSchedule => {
                return existingSchedule.frequency === newSchedule.frequency &&
                       existingSchedule.time === newSchedule.time &&
                       existingSchedule.recipients === newSchedule.recipients &&
                       existingSchedule.message === newSchedule.message;
            });

            // ì¤‘ë³µì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì¶”ê°€
            if (!isDuplicate) {
            window.emailScheduleList.push(newSchedule);

                // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€ - ì‹¬í”Œí•œ íŒì—…ìœ¼ë¡œ ë³€ê²½
                showSimpleAlert('âœ… Email Report ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìƒˆë¡œìš´ ì˜ˆì•½ì´ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            console.log('Email Report ì„¤ì • ì €ì¥ ì™„ë£Œ', newSchedule);
            } else {
                // ì¤‘ë³µì¸ ê²½ìš° ì•„ë¬´ëŸ° ë°˜ì‘ ì—†ìŒ (ì¡°ìš©íˆ ë¬´ì‹œ)
                console.log('ì¤‘ë³µëœ ì„¤ì •ì´ë¯€ë¡œ ì €ì¥í•˜ì§€ ì•ŠìŒ:', newSchedule);
            }
        }

        // ì‹¬í”Œí•œ ì•Œë¦¼ íŒì—… í•¨ìˆ˜
        function showSimpleAlert(message, type = 'info') {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existingAlert = document.querySelector('.simple-alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            // ì•Œë¦¼ íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
            let bgColor, textColor, icon;
            switch(type) {
                case 'success':
                    bgColor = '#4CAF50';
                    textColor = '#fff';
                    icon = 'âœ…';
                    break;
                case 'warning':
                    bgColor = '#ff9800';
                    textColor = '#fff';
                    icon = 'âš ï¸';
                    break;
                case 'error':
                    bgColor = '#f44336';
                    textColor = '#fff';
                    icon = 'âŒ';
                    break;
                default:
                    bgColor = '#4a9eff';
                    textColor = '#fff';
                    icon = 'â„¹ï¸';
            }

            // ì•Œë¦¼ ìš”ì†Œ ìƒì„±
            const alertElement = document.createElement('div');
            alertElement.className = 'simple-alert';
            alertElement.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${bgColor};
                color: ${textColor};
                padding: 15px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                max-width: 400px;
                word-wrap: break-word;
                line-height: 1.4;
                animation: slideInRight 0.3s ease-out;
            `;
            alertElement.innerHTML = `${icon} ${message}`;

            // ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€
            if (!document.querySelector('#simple-alert-styles')) {
                const style = document.createElement('style');
                style.id = 'simple-alert-styles';
                style.textContent = `
                    @keyframes slideInRight {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    @keyframes slideOutRight {
                        from {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        to {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            // ì•Œë¦¼ í‘œì‹œ
            document.body.appendChild(alertElement);

            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alertElement.parentNode) {
                    alertElement.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        if (alertElement.parentNode) {
                            alertElement.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // ì´ë²ˆ ë°œì†¡ ì‹œê°„ ê³„ì‚° í•¨ìˆ˜ (ì„¤ì • ì €ì¥ ì‹œ ì§€ì •ëœ ì‹œê°„)
        function calculateCurrentSendTime(frequency, time) {
            const now = new Date();
            const [hours, minutes] = time.split(':');
            let currentDate = new Date();
            
            // í˜„ì¬ ë‚ ì§œì— ì„¤ì •ëœ ì‹œê°„ ì ìš©
            currentDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            
            // ë§Œì•½ í˜„ì¬ ì‹œê°„ì´ ì´ë¯¸ ì§€ë‚¬ìœ¼ë©´, ë‹¤ìŒ ì£¼ê¸°ë¡œ ì„¤ì •
            if (currentDate <= now) {
                switch(frequency) {
                    case 'daily':
                        // ë‚´ì¼ ê°™ì€ ì‹œê°„
                        currentDate.setDate(currentDate.getDate() + 1);
                        break;
                    case 'weekly':
                        // ë‹¤ìŒì£¼ ê°™ì€ ì‹œê°„
                        currentDate.setDate(currentDate.getDate() + 7);
                        break;
                    case 'monthly':
                        // ë‹¤ìŒë‹¬ ê°™ì€ ì‹œê°„
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        break;
                }
            }
            
            return currentDate.toLocaleDateString('ko-KR') + ' ' + currentDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }

        // ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° í•¨ìˆ˜ (ì˜ˆì•½ ìƒì„± ì‹œ ì‚¬ìš©)
        function calculateNextSendTime(frequency, time) {
            const now = new Date();
            const [hours, minutes] = time.split(':');
            let nextDate = new Date();
            
            // ì‹œê°„ ì„¤ì •
            nextDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            
            // í˜„ì¬ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ í•œ ì£¼ê¸° í›„ë¡œ ì„¤ì •
            switch(frequency) {
                case 'daily':
                    // 1ì¼ í›„ë¡œ ì„¤ì •
                    nextDate.setDate(nextDate.getDate() + 1);
                    break;
                case 'weekly':
                    // 1ì£¼ í›„ë¡œ ì„¤ì • 
                    nextDate.setDate(nextDate.getDate() + 7);
                    break;
                case 'monthly':
                    // 1ê°œì›” í›„ë¡œ ì„¤ì • (ì •í™•í•œ ì›” ê³„ì‚°)
                    const currentMonth = nextDate.getMonth();
                    const currentYear = nextDate.getFullYear();
                    const currentDay = nextDate.getDate();
                    
                    let nextMonth = currentMonth + 1;
                    let nextYear = currentYear;
                    
                    if (nextMonth > 11) {
                        nextMonth = 0;
                        nextYear++;
                    }
                    
                    // ë‹¤ìŒ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ ì„ í™•ì¸í•˜ì—¬ ë‚ ì§œ ì¡°ì •
                    const lastDayOfNextMonth = new Date(nextYear, nextMonth + 1, 0).getDate();
                    const adjustedDay = Math.min(currentDay, lastDayOfNextMonth);
                    
                    nextDate.setFullYear(nextYear, nextMonth, adjustedDay);
                    break;
            }
            
            // í˜„ì¬ ì‹œê°„ë³´ë‹¤ ì´ì „ì´ë©´ ì¶”ê°€ ì¡°ì •
            while (nextDate <= now) {
                switch(frequency) {
                    case 'daily':
                        nextDate.setDate(nextDate.getDate() + 1);
                        break;
                    case 'weekly':
                        nextDate.setDate(nextDate.getDate() + 7);
                        break;
                    case 'monthly':
                        const month = nextDate.getMonth();
                        const year = nextDate.getFullYear();
                        const day = nextDate.getDate();
                        
                        let newMonth = month + 1;
                        let newYear = year;
                        
                        if (newMonth > 11) {
                            newMonth = 0;
                            newYear++;
                        }
                        
                        const lastDayOfNewMonth = new Date(newYear, newMonth + 1, 0).getDate();
                        const newAdjustedDay = Math.min(day, lastDayOfNewMonth);
                        
                        nextDate.setFullYear(newYear, newMonth, newAdjustedDay);
                        break;
                }
            }
            
            console.log(`ğŸ“… ì˜ˆì•½ ìƒì„± ì‹œ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°: ${frequency} ì£¼ê¸°, ì‹œê°„: ${time}, ë‹¤ìŒ: ${nextDate.toLocaleString('ko-KR')}`);
            
            return nextDate.toLocaleDateString('ko-KR') + ' ' + nextDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }

        // ì¦‰ì‹œ ë°œì†¡ í•¨ìˆ˜
        async function sendEmailImmediately() {
            console.log('ğŸ“§ ì¦‰ì‹œ ë°œì†¡ ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // í˜„ì¬ ì„¤ì •ëœ ì •ë³´ ìˆ˜ì§‘
            const emailData = collectCurrentEmailSettings();
            
            if (!emailData) {
                return; // ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ (collectCurrentEmailSettingsì—ì„œ ì•Œë¦¼ ì²˜ë¦¬)
            }
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            const sendButton = event.target;
            const originalText = sendButton.innerHTML;
            sendButton.innerHTML = 'ğŸ“§ ë°œì†¡ ì¤‘...';
            sendButton.disabled = true;
            sendButton.style.opacity = '0.6';
            
            try {
                // SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡
                await sendEmailViaSMTP(emailData);
                
                // ì„±ê³µ ë©”ì‹œì§€
                showSimpleAlert('âœ… ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('âœ… ì¦‰ì‹œ ë°œì†¡ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
                showSimpleAlert('âŒ ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                // ë²„íŠ¼ ë³µì›
                sendButton.innerHTML = originalText;
                sendButton.disabled = false;
                sendButton.style.opacity = '1';
            }
        }

        // í˜„ì¬ ì„¤ì •ëœ ì •ë³´ ìˆ˜ì§‘ í•¨ìˆ˜
        function collectCurrentEmailSettings() {
            console.log('ğŸ“‹ í˜„ì¬ ì„¤ì • ì •ë³´ ìˆ˜ì§‘ ì‹œì‘');
            
            // ë©”ì‹œì§€ ìˆ˜ì§‘
            const messageInput = document.getElementById('email-report-message');
            let messageText = messageInput ? messageInput.value.trim() : '';
            
            // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì„¤ì •
            if (!messageText) {
                messageText = 'ì‚¼ì„± AI Experience Group ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.';
            }
            
            // ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            const selectedRecipients = [];
            let allRecipientEmails = [];
            
            // ê´€ë¦¬ì ìˆ˜ì§‘
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                const adminEmails = admins.map(admin => admin.email);
                allRecipientEmails = allRecipientEmails.concat(adminEmails);
                selectedRecipients.push('ê´€ë¦¬ì');
                console.log(`âœ“ ê´€ë¦¬ì ${admins.length}ëª… ì„ íƒ:`, adminEmails);
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ì§‘
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                const allMemberEmails = allMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(allMemberEmails);
                selectedRecipients.push('ì „ì²´ ë©¤ë²„');
                console.log(`âœ“ ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì„ íƒ:`, allMemberEmails);
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ì§‘
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveMembers = originalMembersData ? originalMembersData.filter(member => {
                    // spendDataê°€ ìˆëŠ” ê²½ìš°ì™€ ì—†ëŠ” ê²½ìš° ëª¨ë‘ ì²˜ë¦¬
                    if (member.spendData) {
                        return member.spendData.premiumRequests === 0;
                    }
                    return true; // spendDataê°€ ì—†ìœ¼ë©´ ë¹„í™œì„±ìœ¼ë¡œ ê°„ì£¼
                }) : [];
                const inactiveMemberEmails = inactiveMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(inactiveMemberEmails);
                selectedRecipients.push('ë¹„í™œì„± ë©¤ë²„');
                console.log(`âœ“ ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì„ íƒ:`, inactiveMemberEmails);
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì£¼ì†Œ ìˆ˜ì§‘
            const customEmails = document.getElementById('custom-emails');
            let customEmailList = [];
            
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim()) {
                const emails = customEmails.value.split(',').map(email => email.trim()).filter(email => email);
                customEmailList = emails;
                allRecipientEmails = allRecipientEmails.concat(customEmailList);
                console.log('ğŸ“§ ì§ì ‘ ì…ë ¥ëœ ì´ë©”ì¼:', customEmailList);
            }
            
            // ìˆ˜ì‹ ìê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜
            if (selectedRecipients.length === 0 && customEmailList.length === 0) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. (ê´€ë¦¬ì, ì „ì²´ ë©¤ë²„, ë¹„í™œì„± ë©¤ë²„ ë˜ëŠ” ì§ì ‘ ì…ë ¥)', 'warning');
                return null;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ì´ ìˆëŠ” ê²½ìš° ìœ íš¨ì„± ê²€ì‚¬
            if (customEmailList.length > 0) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of customEmailList) {
                    if (!emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}`, 'warning');
                        return null;
                    }
                }
            }
            
            // ì¤‘ë³µ ì´ë©”ì¼ ì œê±°
            const uniqueEmails = [...new Set(allRecipientEmails)];
            console.log(`ğŸ“¬ ì´ ìˆ˜ì‹ ì ${uniqueEmails.length}ëª… (ì¤‘ë³µ ì œê±° í›„):`, uniqueEmails);
            
            // ë°œì‹ ì ì •ë³´ ìˆ˜ì§‘ (ì˜µì…˜)
            const senderNameEl = document.getElementById('email-sender-name');
            const senderEmailEl = document.getElementById('email-sender-address');
            const fromName = senderNameEl ? senderNameEl.value.trim() : '';
            const fromEmail = senderEmailEl ? senderEmailEl.value.trim() : '';

            return {
                message: messageText,
                selectedGroups: selectedRecipients,
                customEmails: customEmailList,
                allEmails: uniqueEmails, // ëª¨ë“  ìˆ˜ì‹ ì ì´ë©”ì¼ (ì¤‘ë³µ ì œê±°)
                timestamp: new Date().toLocaleString('ko-KR'),
                fromName,
                fromEmail
            };
        }

        // ìˆ˜ì‹ ì ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ì¦‰ì‹œ ë°œì†¡í•˜ëŠ” í•¨ìˆ˜
        async function sendEmailFromPreview() {
            console.log('ğŸ“§ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ì¦‰ì‹œ ë°œì†¡ ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // ë¯¸ë¦¬ë³´ê¸° íŒì—…ì—ì„œ í˜„ì¬ ì„¤ì •ëœ ì •ë³´ ë‹¤ì‹œ ìˆ˜ì§‘
            const emailData = collectEmailDataFromPreview();
            
            if (!emailData) {
                return; // ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ
            }
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            const sendButton = event.target;
            const originalText = sendButton.innerHTML;
            sendButton.innerHTML = 'ğŸ“§ ë°œì†¡ ì¤‘...';
            sendButton.disabled = true;
            sendButton.style.opacity = '0.6';
            
            try {
                // SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡
                await sendEmailViaSMTP(emailData);
                
                // ì„±ê³µ ë©”ì‹œì§€ (ìë™ ë‹«ê¸° ì œê±°)
                showSimpleAlert('âœ… ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('âœ… ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ì¦‰ì‹œ ë°œì†¡ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
                showSimpleAlert('âŒ ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                // ë²„íŠ¼ ë³µì›
                sendButton.innerHTML = originalText;
                sendButton.disabled = false;
                sendButton.style.opacity = '1';
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° íŒì—…ì—ì„œ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜
        function collectEmailDataFromPreview() {
            console.log('ğŸ“‹ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í˜„ì¬ ì„¤ì • ì •ë³´ ìˆ˜ì§‘ ì‹œì‘');
            
            // ë©”ì‹œì§€ ìˆ˜ì§‘ (ë¯¸ë¦¬ë³´ê¸° íŒì—…ì˜ ë©”ì‹œì§€ ì…ë ¥ì°½ì—ì„œ)
            const messageInput = document.getElementById('email-preview-message');
            let messageText = messageInput ? messageInput.value.trim() : '';
            
            // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ì›ë³¸ ì…ë ¥ì°½ì—ì„œ ê°€ì ¸ì˜¤ê¸°
            if (!messageText) {
                const originalMessageInput = document.getElementById('email-report-message');
                messageText = originalMessageInput ? originalMessageInput.value.trim() : '';
            }
            
            // ë©”ì‹œì§€ê°€ ì—¬ì „íˆ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì„¤ì •
            if (!messageText) {
                messageText = 'ì‚¼ì„± AI Experience Group ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.';
            }
            
            // í˜„ì¬ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì—¬ ìˆ˜ì‹ ì ìˆ˜ì§‘
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            const selectedRecipients = [];
            let allRecipientEmails = [];
            
            // ê´€ë¦¬ì ìˆ˜ì§‘
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                const adminEmails = admins.map(admin => admin.email);
                allRecipientEmails = allRecipientEmails.concat(adminEmails);
                selectedRecipients.push('ê´€ë¦¬ì');
                console.log(`âœ“ ê´€ë¦¬ì ${admins.length}ëª… ì„ íƒ:`, adminEmails);
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ì§‘
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                const allMemberEmails = allMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(allMemberEmails);
                selectedRecipients.push('ì „ì²´ ë©¤ë²„');
                console.log(`âœ“ ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì„ íƒ:`, allMemberEmails);
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ì§‘
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveMembers = originalMembersData ? originalMembersData.filter(member => {
                    if (member.spendData) {
                        return member.spendData.premiumRequests === 0;
                    }
                    return true;
                }) : [];
                const inactiveMemberEmails = inactiveMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(inactiveMemberEmails);
                selectedRecipients.push('ë¹„í™œì„± ë©¤ë²„');
                console.log(`âœ“ ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì„ íƒ:`, inactiveMemberEmails);
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì£¼ì†Œ ìˆ˜ì§‘
            const customEmails = document.getElementById('custom-emails');
            let customEmailList = [];
            
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim()) {
                const emails = customEmails.value.split(',').map(email => email.trim()).filter(email => email);
                customEmailList = emails;
                allRecipientEmails = allRecipientEmails.concat(customEmailList);
                console.log('ğŸ“§ ì§ì ‘ ì…ë ¥ëœ ì´ë©”ì¼:', customEmailList);
            }
            
            // ìˆ˜ì‹ ìê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜
            if (selectedRecipients.length === 0 && customEmailList.length === 0) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. (ê´€ë¦¬ì, ì „ì²´ ë©¤ë²„, ë¹„í™œì„± ë©¤ë²„ ë˜ëŠ” ì§ì ‘ ì…ë ¥)', 'warning');
                return null;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ì´ ìˆëŠ” ê²½ìš° ìœ íš¨ì„± ê²€ì‚¬
            if (customEmailList.length > 0) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of customEmailList) {
                    if (!emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}`, 'warning');
                        return null;
                    }
                }
            }
            
            // ë°œì‹ ì ì •ë³´ ìˆ˜ì§‘ (ì˜µì…˜)
            const senderNameEl = document.getElementById('email-sender-name');
            const senderEmailEl = document.getElementById('email-sender-address');
            const fromName = senderNameEl ? senderNameEl.value.trim() : '';
            const fromEmail = senderEmailEl ? senderEmailEl.value.trim() : '';

            // ì¤‘ë³µ ì´ë©”ì¼ ì œê±°
            const uniqueEmails = [...new Set(allRecipientEmails)];
            console.log(`ğŸ“¬ ì´ ìˆ˜ì‹ ì ${uniqueEmails.length}ëª… (ì¤‘ë³µ ì œê±° í›„):`, uniqueEmails);
            
            return {
                message: messageText,
                selectedGroups: selectedRecipients,
                customEmails: customEmailList,
                allEmails: uniqueEmails,
                timestamp: new Date().toLocaleString('ko-KR'),
                source: 'preview', // ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ë°œì†¡ë¨ì„ í‘œì‹œ
                attachmentsSheets: (window.__attachmentsSheets || null),
                fromName,
                fromEmail
            };
        }

            // SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ í•¨ìˆ˜
        async function sendEmailViaSMTP(emailData) {
            console.log('ğŸ“¤ SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ ì‹œì‘');
            
            // ìˆ˜ì‹ ì ëª©ë¡ í…ìŠ¤íŠ¸ ìƒì„±
            let recipientText = '';
            if (emailData.selectedGroups.length > 0) {
                recipientText += `ì„ íƒëœ ê·¸ë£¹: ${emailData.selectedGroups.join(', ')}`;
                recipientText += ` (ì´ ${emailData.allEmails.length}ëª…)`;
            }
            if (emailData.customEmails.length > 0) {
                if (recipientText) recipientText += '\n';
                recipientText += `ì§ì ‘ ì…ë ¥ ì´ë©”ì¼: ${emailData.customEmails.join(', ')}`;
            }
            
            // ë°œì†¡ ë°ì´í„° ì¤€ë¹„
            const emailPayload = {
                to_emails: emailData.allEmails,
                subject: emailData.source === 'scheduled' 
                    ? `[Samsung AI Dashboard] ${emailData.scheduleTitle || 'ì˜ˆì•½ ë¦¬í¬íŠ¸'}` 
                    : '[Samsung AI Dashboard] ì¦‰ì‹œ ë°œì†¡ ë¦¬í¬íŠ¸',
                message: emailData.message,
                recipients: recipientText,
                timestamp: emailData.timestamp,
                dashboard_url: window.location.href,
                recipient_count: emailData.allEmails ? emailData.allEmails.length : 0,
                attachmentsSheets: emailData.attachmentsSheets || null,
                from_email: (emailData.fromEmail || '').trim() || null,
                from_name: (emailData.fromName || '').trim() || null
            };
            
            console.log('ğŸ“§ SMTP ë°œì†¡ ë°ì´í„°:', emailPayload);
            console.log(`ğŸ“¬ ë°œì†¡ ëŒ€ìƒ: ${emailData.allEmails ? emailData.allEmails.length : 0}ëª…`);
            console.log('ğŸ“§ ìˆ˜ì‹ ì ëª©ë¡:', emailData.allEmails);
            
            // SMTP ì„œë²„ë¡œ ë°œì†¡ ìš”ì²­
            try {
                const response = await fetch('/api/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailPayload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('âœ… SMTP ë°œì†¡ ì„±ê³µ:', result);
                return result;
                
            } catch (error) {
                console.error('âŒ SMTP ë°œì†¡ ì‹¤íŒ¨:', error);
                throw new Error(`SMTP ë°œì†¡ ì‹¤íŒ¨: ${error.message}`);
            }
        }

        // =====================================================
        // ğŸ“… ìë™ ë©”ì¼ ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œìŠ¤í…œ
        // =====================================================

        // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ê´€ë¦¬
        let emailSchedulerInterval = null;
        let isSchedulerRunning = false;

        // ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘ í•¨ìˆ˜
        function startEmailScheduler() {
            console.log('ğŸ”§ [SCHEDULER] startEmailScheduler() í˜¸ì¶œë¨');
            
            if (isSchedulerRunning) {
                console.log('ğŸ“… [SCHEDULER] ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                console.log(`ğŸ“… [SCHEDULER] í˜„ì¬ ì¸í„°ë²Œ ID: ${emailSchedulerInterval}`);
                return;
            }

            console.log('ğŸ“… [SCHEDULER] ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
            console.log(`ğŸ“… [SCHEDULER] í˜„ì¬ ì‹œê°„: ${new Date().toLocaleString('ko-KR')}`);
            
            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ìƒíƒœ í™•ì¸
            if (window.emailScheduleList) {
                console.log(`ğŸ“‹ [SCHEDULER] í˜„ì¬ ì €ì¥ëœ ì˜ˆì•½ ê°œìˆ˜: ${window.emailScheduleList.length}ê°œ`);
                window.emailScheduleList.forEach((schedule, index) => {
                    console.log(`ğŸ“‹ [SCHEDULER] ì˜ˆì•½ ${index + 1}: ${schedule.title} (ìƒíƒœ: ${schedule.status})`);
                    console.log(`ğŸ“‹ [SCHEDULER]   - ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                    console.log(`ğŸ“‹ [SCHEDULER]   - ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
                });
            } else {
                console.log('ğŸ“‹ [SCHEDULER] ì €ì¥ëœ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            isSchedulerRunning = true;

            // 1ë¶„ë§ˆë‹¤ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ê²€ì‚¬
            emailSchedulerInterval = setInterval(() => {
                console.log('â° [SCHEDULER] ì •ê¸° ê²€ì‚¬ ì‹œì‘ (1ë¶„ ê°„ê²©)');
                checkAndSendScheduledEmails();
            }, 60000); // 60ì´ˆ = 1ë¶„

            console.log(`âœ… [SCHEDULER] ì¸í„°ë²Œ ì„¤ì • ì™„ë£Œ, ID: ${emailSchedulerInterval}`);

            // ì¦‰ì‹œ í•œ ë²ˆ ê²€ì‚¬
            console.log('ğŸš€ [SCHEDULER] ì´ˆê¸° ê²€ì‚¬ ì‹œì‘');
            checkAndSendScheduledEmails();
        }

        // ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€ í•¨ìˆ˜
        function stopEmailScheduler() {
            if (emailSchedulerInterval) {
                clearInterval(emailSchedulerInterval);
                emailSchedulerInterval = null;
                isSchedulerRunning = false;
                console.log('ğŸ“… ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì˜ˆì•½ëœ ì´ë©”ì¼ ê²€ì‚¬ ë° ë°œì†¡
        async function checkAndSendScheduledEmails() {
            console.log('ğŸ” [CHECK] ===== ì˜ˆì•½ëœ ì´ë©”ì¼ ê²€ì‚¬ ì‹œì‘ =====');
            console.log(`ğŸ” [CHECK] ê²€ì‚¬ ì‹œê°„: ${new Date().toLocaleString('ko-KR')}`);
            
            // í† ê¸€ ìƒíƒœ í™•ì¸
            console.log(`ğŸ”§ [CHECK] emailSchedulerActive ìƒíƒœ: ${emailSchedulerActive}`);
            if (!emailSchedulerActive) {
                console.log('âŒ [CHECK] ì˜ˆì•½ ë©”ì¼ ë°œì†¡ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                console.log('âŒ [CHECK] Settingsì—ì„œ "ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬" í† ê¸€ì„ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
            console.log(`ğŸ”§ [CHECK] window.emailScheduleList ì¡´ì¬: ${!!window.emailScheduleList}`);
            if (!window.emailScheduleList) {
                console.log('âŒ [CHECK] window.emailScheduleListê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log(`ğŸ”§ [CHECK] ì „ì²´ ì˜ˆì•½ ê°œìˆ˜: ${window.emailScheduleList.length}ê°œ`);
            if (window.emailScheduleList.length === 0) {
                console.log('ğŸ“… [CHECK] ì˜ˆì•½ëœ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const now = new Date();
            console.log(`â° [CHECK] í˜„ì¬ ì‹œê°„: ${now.toLocaleString('ko-KR')}`);
            console.log(`â° [CHECK] í˜„ì¬ ì‹œê°„ (timestamp): ${now.getTime()}`);

            // ëª¨ë“  ì˜ˆì•½ ìƒíƒœ ë¡œê·¸
            window.emailScheduleList.forEach((schedule, index) => {
                console.log(`ğŸ“‹ [CHECK] ì˜ˆì•½ ${index + 1}: "${schedule.title}"`);
                console.log(`ğŸ“‹ [CHECK]   - ID: ${schedule.id}`);
                console.log(`ğŸ“‹ [CHECK]   - ìƒíƒœ: ${schedule.status}`);
                console.log(`ğŸ“‹ [CHECK]   - ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                console.log(`ğŸ“‹ [CHECK]   - ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
                console.log(`ğŸ“‹ [CHECK]   - ì£¼ê¸°: ${schedule.frequency}`);
                console.log(`ğŸ“‹ [CHECK]   - ìˆ˜ì‹ ì: ${schedule.recipients}`);
            });

            // í™œì„± ìƒíƒœì¸ ì˜ˆì•½ë§Œ ê²€ì‚¬
            const activeSchedules = window.emailScheduleList.filter(schedule => 
                schedule.status === 'í™œì„±'
            );

            console.log(`ğŸ” [CHECK] í™œì„± ì˜ˆì•½ í•„í„°ë§ ê²°ê³¼: ${activeSchedules.length}ê°œ`);
            
            if (activeSchedules.length === 0) {
                console.log('ğŸ“‹ [CHECK] í™œì„± ìƒíƒœì¸ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í™œì„± ì˜ˆì•½ ìƒì„¸ ë¡œê·¸
            activeSchedules.forEach((schedule, index) => {
                console.log(`âœ… [CHECK] í™œì„± ì˜ˆì•½ ${index + 1}: "${schedule.title}" (ID: ${schedule.id})`);
            });

            for (const schedule of activeSchedules) {
                console.log(`ğŸ”„ [PROCESS] ì˜ˆì•½ ì²˜ë¦¬ ì‹œì‘: "${schedule.title}" (ID: ${schedule.id})`);
                
                try {
                    // ë¨¼ì € ë°œì†¡ ì‹œê°„ ë„ë‹¬ ì—¬ë¶€ ê²€ì‚¬ (ì‹œê°„ ê°±ì‹  ì „ì—!)
                    console.log(`ğŸ”„ [PROCESS] ë°œì†¡ ì‹œê°„ ë„ë‹¬ ì—¬ë¶€ ê²€ì‚¬ ì¤‘... (ì‹œê°„ ê°±ì‹  ì „)`);
                    const shouldSend = shouldSendEmailNow(schedule, now);
                    console.log(`ğŸ”„ [PROCESS] ë°œì†¡ ì—¬ë¶€ ê²°ê³¼: ${shouldSend}`);
                    
                    // ë°œì†¡ í›„ì— ì‹œê°„ ê°±ì‹  ì ìš©
                    console.log(`ğŸ”„ [PROCESS] ì‹œê°„ ê°±ì‹  ê²€ì‚¬ ì¤‘... (ë°œì†¡ ê²€ì‚¬ í›„)`);
                    updateScheduleTimeIfNeeded(schedule);
                    
                    if (shouldSend) {
                        console.log(`ğŸ“§ [SEND] ì˜ˆì•½ ë°œì†¡ ì‹œì‘: ${schedule.title} (ID: ${schedule.id})`);
                        
                        // ì˜ˆì•½ì— ë”°ë¥¸ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘
                        console.log(`ğŸ“‹ [SEND] ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...`);
                        const emailData = await collectEmailDataFromSchedule(schedule);
                        
                        if (emailData) {
                            console.log(`âœ… [SEND] ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ ì„±ê³µ`);
                            console.log(`ğŸ“§ [SEND] ìˆ˜ì‹ ì ${emailData.allEmails ? emailData.allEmails.length : 0}ëª…`);
                            
                            // ì´ë©”ì¼ ë°œì†¡
                            console.log(`ğŸ“¤ [SEND] SMTP ë°œì†¡ ì‹œì‘...`);
                            await sendEmailViaSMTP(emailData);
                            console.log(`âœ… [SEND] SMTP ë°œì†¡ ì™„ë£Œ`);
                            
                            // ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ì—…ë°ì´íŠ¸
                            console.log(`ğŸ”„ [SEND] ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ì—…ë°ì´íŠ¸ ì¤‘...`);
                            updateNextSendTime(schedule);
                            
                            console.log(`ğŸ‰ [SEND] ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ: ${schedule.title}`);
                            
                            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—…ì´ ì—´ë ¤ìˆìœ¼ë©´ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                            refreshEmailScheduleList();
                            
                            // ì„±ê³µ ë¡œê·¸ë¥¼ UIì— í‘œì‹œ (ì˜µì…˜)
                            showScheduledEmailNotification(schedule, 'success');
                        } else {
                            console.error(`âŒ [SEND] ì˜ˆì•½ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨: ${schedule.title}`);
                            showScheduledEmailNotification(schedule, 'error');
                        }
                    } else {
                        console.log(`â° [PROCESS] ì•„ì§ ë°œì†¡ ì‹œê°„ì´ ì•„ë‹˜: ${schedule.title}`);
                    }
                } catch (error) {
                    console.error(`âŒ [PROCESS] ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: ${schedule.title}`, error);
                    showScheduledEmailNotification(schedule, 'error');
                }
            }
        }

        // í˜„ì¬ ì‹œê°„ì— ì´ë©”ì¼ì„ ë°œì†¡í•´ì•¼ í•˜ëŠ”ì§€ ê²€ì‚¬
        function shouldSendEmailNow(schedule, currentTime) {
            console.log(`ğŸ• [TIME] ë°œì†¡ ì‹œê°„ ê²€ì‚¬: "${schedule.title}"`);
            
            // currentSend ì‹œê°„ì„ ìš°ì„  ì²´í¬, ì—†ìœ¼ë©´ nextSend ì‚¬ìš©
            const targetSendTimeStr = schedule.currentSend || schedule.nextSend;
            console.log(`ğŸ• [TIME] ëŒ€ìƒ ë°œì†¡ ì‹œê°„ ë¬¸ìì—´: "${targetSendTimeStr}"`);
            
            const targetSendTime = parseNextSendTime(targetSendTimeStr);
            console.log(`ğŸ• [TIME] íŒŒì‹±ëœ ë°œì†¡ ì‹œê°„: ${targetSendTime ? targetSendTime.toLocaleString('ko-KR') : 'null'}`);
            
            if (!targetSendTime) {
                console.warn(`âš ï¸ [TIME] ë°œì†¡ ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨: ${targetSendTimeStr}`);
                return false;
            }

            // í˜„ì¬ ì‹œê°„ì´ ì˜ˆì•½ ì‹œê°„ê³¼ ê°™ê±°ë‚˜ ì§€ë‚¬ëŠ”ì§€ í™•ì¸ (1ë¶„ ì˜¤ì°¨ í—ˆìš©)
            const timeDiff = currentTime.getTime() - targetSendTime.getTime();
            console.log(`ğŸ• [TIME] ì‹œê°„ ì°¨ì´: ${timeDiff}ms (${Math.round(timeDiff / 1000)}ì´ˆ)`);
            console.log(`ğŸ• [TIME] í˜„ì¬ ì‹œê°„: ${currentTime.toLocaleString('ko-KR')} (${currentTime.getTime()})`);
            console.log(`ğŸ• [TIME] ë°œì†¡ ì‹œê°„: ${targetSendTime.toLocaleString('ko-KR')} (${targetSendTime.getTime()})`);
            
            const shouldSend = timeDiff >= 0 && timeDiff < 60000; // 1ë¶„ ì´ë‚´
            console.log(`ğŸ• [TIME] ë°œì†¡ ì¡°ê±´: timeDiff >= 0 (${timeDiff >= 0}) && timeDiff < 60000 (${timeDiff < 60000})`);
            console.log(`ğŸ• [TIME] ìµœì¢… ë°œì†¡ ì—¬ë¶€: ${shouldSend}`);

            if (shouldSend) {
                console.log(`â° [TIME] âœ… ë°œì†¡ ì‹œê°„ ë„ë‹¬: ${schedule.title}`);
                console.log(`â° [TIME]   - ì´ë²ˆ ë°œì†¡: ${targetSendTimeStr}`);
                console.log(`â° [TIME]   - í˜„ì¬ ì‹œê°„: ${currentTime.toLocaleString('ko-KR')}`);
            } else {
                console.log(`â° [TIME] âŒ ì•„ì§ ë°œì†¡ ì‹œê°„ ì•„ë‹˜: ${schedule.title}`);
                if (timeDiff < 0) {
                    console.log(`â° [TIME]   - ë°œì†¡ ì˜ˆì •: ${Math.abs(Math.round(timeDiff / 1000))}ì´ˆ í›„`);
                } else {
                    console.log(`â° [TIME]   - ë°œì†¡ ì‹œê°„ ì§€ë‚¨: ${Math.round(timeDiff / 1000)}ì´ˆ ì „`);
                }
            }

            return shouldSend;
        }

        // nextSend ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜ (ì˜¤ì „/ì˜¤í›„ 12ì‹œê°„í˜•ì‹ê³¼ 24ì‹œê°„í˜•ì‹ ëª¨ë‘ ì§€ì›)
        function parseNextSendTime(nextSendStr) {
            try {
                if (!nextSendStr || typeof nextSendStr !== 'string') return null;

                // 1) "2025. 8. 7. ì˜¤ì „ 9:00" í˜•ì‹
                const ampmPattern = /(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.\s*(ì˜¤ì „|ì˜¤í›„)\s*(\d{1,2}):(\d{2})/;
                const ampmMatch = nextSendStr.match(ampmPattern);
                if (ampmMatch) {
                    const year = parseInt(ampmMatch[1]);
                    const month = parseInt(ampmMatch[2]) - 1;
                    const day = parseInt(ampmMatch[3]);
                    const ampm = ampmMatch[4];
                    let hour = parseInt(ampmMatch[5]);
                    const minute = parseInt(ampmMatch[6]);

                    if (ampm === 'ì˜¤í›„' && hour !== 12) {
                        hour += 12;
                    } else if (ampm === 'ì˜¤ì „' && hour === 12) {
                        hour = 0;
                    }
                    return new Date(year, month, day, hour, minute, 0, 0);
                }

                // 2) "2025. 8. 7. 09:00" í˜•ì‹ (24ì‹œê°„)
                const h24Pattern = /(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.\s*(\d{1,2}):(\d{2})/;
                const h24Match = nextSendStr.match(h24Pattern);
                if (h24Match) {
                    const year = parseInt(h24Match[1]);
                    const month = parseInt(h24Match[2]) - 1;
                    const day = parseInt(h24Match[3]);
                    const hour = parseInt(h24Match[4]);
                    const minute = parseInt(h24Match[5]);
                    return new Date(year, month, day, hour, minute, 0, 0);
                }

                // 3) ì¼ë°˜ Date íŒŒì‹± ì‹œë„ (fallback)
                const fallback = new Date(nextSendStr);
                if (!isNaN(fallback.getTime())) return fallback;

                return null;
            } catch (error) {
                console.error('nextSend ì‹œê°„ íŒŒì‹± ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ì˜ˆì•½ì—ì„œ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘
        async function collectEmailDataFromSchedule(schedule) {
            console.log(`ğŸ“‹ ì˜ˆì•½ì—ì„œ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘: ${schedule.title}`);

            try {
                // ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ë¡œë“œ
                if (!originalMembersData || originalMembersData.length === 0) {
                    console.log('ğŸ“¥ ë©¤ë²„ ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•©ë‹ˆë‹¤...');
                    const membersData = await getTeamMembers();
                    if (membersData && membersData.teamMembers) {
                        originalMembersData = membersData.teamMembers;
                        console.log(`âœ… ë©¤ë²„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${originalMembersData.length}ëª…`);
                    } else {
                        console.error('âŒ ë©¤ë²„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                        return null;
                    }
                }

                // ìˆ˜ì‹ ì ê·¸ë£¹ íŒŒì‹±
                const recipients = schedule.recipients.split(', ');
                const selectedRecipients = [];
                let allRecipientEmails = [];
                let customEmailList = Array.isArray(schedule.customEmails) ? schedule.customEmails : [];

                // ê° ìˆ˜ì‹ ì ê·¸ë£¹ ì²˜ë¦¬
                for (const recipient of recipients) {
                    if (recipient === 'ê´€ë¦¬ì') {
                        const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                        const adminEmails = admins.map(admin => admin.email);
                        allRecipientEmails = allRecipientEmails.concat(adminEmails);
                        selectedRecipients.push('ê´€ë¦¬ì');
                        console.log(`âœ“ ê´€ë¦¬ì ${admins.length}ëª… ì¶”ê°€`);
                    } else if (recipient === 'ì „ì²´ ë©¤ë²„') {
                        const allMembers = originalMembersData ? [...originalMembersData] : [];
                        const allMemberEmails = allMembers.map(member => member.email);
                        allRecipientEmails = allRecipientEmails.concat(allMemberEmails);
                        selectedRecipients.push('ì „ì²´ ë©¤ë²„');
                        console.log(`âœ“ ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì¶”ê°€`);
                    } else if (recipient === 'ë¹„í™œì„± ë©¤ë²„') {
                        const inactiveMembers = originalMembersData ? originalMembersData.filter(member => {
                            if (member.spendData) {
                                return member.spendData.premiumRequests === 0;
                            }
                            return true;
                        }) : [];
                        const inactiveMemberEmails = inactiveMembers.map(member => member.email);
                        allRecipientEmails = allRecipientEmails.concat(inactiveMemberEmails);
                        selectedRecipients.push('ë¹„í™œì„± ë©¤ë²„');
                        console.log(`âœ“ ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì¶”ê°€`);
                    } else if (recipient === 'ì§ì ‘ì…ë ¥') {
                        // ìŠ¤ì¼€ì¤„ì— ì €ì¥ëœ ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì¶”ê°€
                        if (customEmailList.length > 0) {
                            allRecipientEmails = allRecipientEmails.concat(customEmailList);
                            selectedRecipients.push('ì§ì ‘ì…ë ¥');
                            console.log(`âœ“ ì§ì ‘ì…ë ¥ ${customEmailList.length}ëª… ì¶”ê°€`);
                        } else {
                            console.warn('âš ï¸ ìŠ¤ì¼€ì¤„ì— ì €ì¥ëœ ì§ì ‘ì…ë ¥ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                        }
                    }
                }

                // ì¤‘ë³µ ì´ë©”ì¼ ì œê±°
                const uniqueEmails = [...new Set(allRecipientEmails)];
                console.log(`ğŸ“¬ ì´ ìˆ˜ì‹ ì ${uniqueEmails.length}ëª… (ì¤‘ë³µ ì œê±° í›„)`);

                if (uniqueEmails.length === 0) {
                    console.warn('âš ï¸ ìˆ˜ì‹ ìê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return null;
                }

                return {
                    message: schedule.message || 'ì˜ˆì•½ëœ ì‚¼ì„± AI Experience Group ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.',
                    selectedGroups: selectedRecipients,
                    customEmails: customEmailList,
                    allEmails: uniqueEmails,
                    timestamp: new Date().toLocaleString('ko-KR'),
                    source: 'scheduled',
                    fromName: (document.getElementById('email-sender-name')?.value || '').trim(),
                    fromEmail: (document.getElementById('email-sender-address')?.value || '').trim(),
                    scheduleId: schedule.id,
                    scheduleTitle: schedule.title,
                    attachmentsSheets: (function(){
                        try {
                            // ìŠ¤ì¼€ì¤„ì— ì €ì¥ëœ ì‚¬ìš©ëŸ‰ ì²¨ë¶€ ì˜µì…˜ê³¼ ê¸°ê°„ í…ìŠ¤íŠ¸ê°€ ìˆëŠ” ê²½ìš°, ê°€ëŠ¥í•˜ë©´ ìµœì‹  ë°ì´í„°ë¡œ ì¬êµ¬ì„±
                            const usageText = (document.getElementById('usage-attachment-period-text')?.textContent || '').trim();
                        const sheets = (schedule.attachmentsSheets && Array.isArray(schedule.attachmentsSheets.sheets))
                            ? schedule.attachmentsSheets.sheets
                            : (window.__attachmentsSheets && Array.isArray(window.__attachmentsSheets.sheets) ? window.__attachmentsSheets.sheets : []);
                            if (sheets.length) {
                                return {
                                    filename: `email_attachments_${new Date().toISOString().split('T')[0]}.xlsx`,
                                    sheets: sheets
                                };
                            }
                            return null;
                        } catch(e){ return null; }
                    })()
                };

            } catch (error) {
                console.error('ì˜ˆì•½ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ë°œì†¡ ì™„ë£Œ í›„ ì‹œê°„ ì—…ë°ì´íŠ¸ (ì´ë²ˆ ë°œì†¡ â†’ ë‹¤ìŒ ë°œì†¡ ì´ë™)
        function updateNextSendTime(schedule) {
            const frequency = getFrequencyValue(schedule.frequency);
            const time = getTimeValue(schedule.time);
            
            if (frequency && time) {
                // í˜„ì¬ ì‹œê°„ì„ ì´ë²ˆ ë°œì†¡ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
                const now = new Date();
                schedule.currentSend = now.toLocaleDateString('ko-KR') + ' ' + now.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                
                // ìƒˆë¡œìš´ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° (ì´ë²ˆ ë°œì†¡ ê¸°ì¤€ìœ¼ë¡œ í•œ ì£¼ê¸° í›„)
                schedule.nextSend = calculateNextSendTimeFromCurrent(schedule.currentSend, frequency);
                
                console.log(`â° ë°œì†¡ ì™„ë£Œ í›„ ì‹œê°„ ì—…ë°ì´íŠ¸: ${schedule.title}`);
                console.log(`   ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                console.log(`   ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
                
                // ì—…ë°ì´íŠ¸ëœ ì •ë³´ë¥¼ ì €ì¥ì†Œì— ë°˜ì˜
                saveScheduleUpdatesToStorage(schedule);
            }
        }

        // ì´ë²ˆ ë°œì†¡ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°
        function calculateNextSendTimeFromCurrent(currentSendStr, frequency) {
            try {
                // currentSend ì‹œê°„ì„ Date ê°ì²´ë¡œ ë³€í™˜
                const currentSendTime = parseNextSendTime(currentSendStr);
                if (!currentSendTime) {
                    console.error('currentSend ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨:', currentSendStr);
                    return currentSendStr; // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ê°’ ìœ ì§€
                }

                // ì£¼ê¸°ì— ë”°ë¼ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°
                const nextSendTime = new Date(currentSendTime);
                switch(frequency) {
                    case 'daily':
                        // ë§¤ì¼: 1ì¼ í›„
                        nextSendTime.setDate(nextSendTime.getDate() + 1);
                        break;
                    case 'weekly':
                        // ë§¤ì£¼: 7ì¼ í›„
                        nextSendTime.setDate(nextSendTime.getDate() + 7);
                        break;
                    case 'monthly':
                        // ë§¤ì›”: 1ê°œì›” í›„ (ì •í™•í•œ ì›” ê³„ì‚°)
                        const currentMonth = nextSendTime.getMonth();
                        const currentYear = nextSendTime.getFullYear();
                        const currentDay = nextSendTime.getDate();
                        
                        // ë‹¤ìŒ ë‹¬ì˜ ê°™ì€ ë‚ ì§œë¡œ ì„¤ì •
                        let nextMonth = currentMonth + 1;
                        let nextYear = currentYear;
                        
                        if (nextMonth > 11) {
                            nextMonth = 0;
                            nextYear++;
                        }
                        
                        // ë‹¤ìŒ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ ì„ í™•ì¸í•˜ì—¬ ë‚ ì§œ ì¡°ì •
                        const lastDayOfNextMonth = new Date(nextYear, nextMonth + 1, 0).getDate();
                        const adjustedDay = Math.min(currentDay, lastDayOfNextMonth);
                        
                        nextSendTime.setFullYear(nextYear, nextMonth, adjustedDay);
                        break;
                }

                console.log(`ğŸ“… ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°: ${frequency} ì£¼ê¸°, í˜„ì¬: ${currentSendTime.toLocaleString('ko-KR')}, ë‹¤ìŒ: ${nextSendTime.toLocaleString('ko-KR')}`);

                return nextSendTime.toLocaleDateString('ko-KR') + ' ' + nextSendTime.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
            } catch (error) {
                console.error('ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° ì˜¤ë¥˜:', error);
                return currentSendStr; // ì˜¤ë¥˜ ì‹œ ê¸°ì¡´ ê°’ ìœ ì§€
            }
        }

        // ì£¼ê¸° í…ìŠ¤íŠ¸ë¥¼ ê°’ìœ¼ë¡œ ë³€í™˜
        function getFrequencyValue(frequencyText) {
            switch(frequencyText) {
                case 'ë§¤ì¼': return 'daily';
                case 'ë§¤ì£¼': return 'weekly';
                case 'ë§¤ì›”': return 'monthly';
                default: return 'weekly';
            }
        }

        // ì‹œê°„ í…ìŠ¤íŠ¸ë¥¼ ê°’ìœ¼ë¡œ ë³€í™˜
        function getTimeValue(timeText) {
            try {
                // "ì˜¤ì „ 9ì‹œ 00ë¶„" í˜•íƒœë¥¼ "09:00" í˜•íƒœë¡œ ë³€í™˜
                const match = timeText.match(/(ì˜¤ì „|ì˜¤í›„)\s*(\d{1,2})ì‹œ\s*(\d{2})ë¶„/);
                if (!match) return '09:00';

                const ampm = match[1];
                let hour = parseInt(match[2]);
                const minute = match[3];

                if (ampm === 'ì˜¤í›„' && hour !== 12) {
                    hour += 12;
                } else if (ampm === 'ì˜¤ì „' && hour === 12) {
                    hour = 0;
                }

                return `${hour.toString().padStart(2, '0')}:${minute}`;
            } catch (error) {
                console.error('ì‹œê°„ ë³€í™˜ ì˜¤ë¥˜:', error);
                return '09:00';
            }
        }

        // ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì•Œë¦¼ í‘œì‹œ
        function showScheduledEmailNotification(schedule, type) {
            let message = '';
            let alertType = 'info';

            switch(type) {
                case 'success':
                    message = `âœ… ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ\n\n${schedule.title}\në‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`;
                    alertType = 'success';
                    break;
                case 'error':
                    message = `âŒ ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨\n\n${schedule.title}\në‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`;
                    alertType = 'error';
                    break;
            }

            // ì¡°ìš©í•œ ì•Œë¦¼ (ì½˜ì†”ì—ë§Œ ê¸°ë¡, UI ì•Œë¦¼ì€ ì„ íƒì‚¬í•­)
            console.log(`ğŸ“¢ ${message}`);
            
            // í•„ìš”ì‹œ UI ì•Œë¦¼ë„ í‘œì‹œ
            // showSimpleAlert(message, alertType);
        }

        // ìŠ¤ì¼€ì¤„ëŸ¬ UI ì œì–´ í•¨ìˆ˜
        function toggleEmailScheduler() {
            if (isSchedulerRunning) {
                stopEmailScheduler();
                updateSchedulerUI(false);
                showSimpleAlert('ğŸ“… ì˜ˆì•½ ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            } else {
                startEmailScheduler();
                updateSchedulerUI(true);
                showSimpleAlert('ğŸ“… ì˜ˆì•½ ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.\n1ë¶„ë§ˆë‹¤ í™œì„± ì˜ˆì•½ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.', 'success');
            }
        }

        // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ UI ì—…ë°ì´íŠ¸
        function updateSchedulerUI(isRunning) {
            const statusIndicator = document.getElementById('scheduler-status-indicator');
            const controlBtn = document.getElementById('scheduler-control-btn');

            if (statusIndicator && controlBtn) {
                if (isRunning) {
                    statusIndicator.textContent = 'ì‹¤í–‰ ì¤‘';
                    statusIndicator.style.backgroundColor = '#4a9eff';
                    controlBtn.textContent = 'ì¤‘ì§€';
                    controlBtn.style.color = '#ff6b35';
                } else {
                    statusIndicator.textContent = 'ì¤‘ì§€ë¨';
                    statusIndicator.style.backgroundColor = '#5a5a5a';
                    controlBtn.textContent = 'ì‹œì‘';
                    controlBtn.style.color = '#e1e1e1';
                }
            }
        }

        // ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateTimeInput() {
            const hourSelect = document.getElementById('email-hour-select');
            const minuteSelect = document.getElementById('email-minute-select');
            const timeInput = document.getElementById('email-time-input');
            
            if (hourSelect && minuteSelect && timeInput) {
                const hour = hourSelect.value.padStart(2, '0');
                const minute = minuteSelect.value.padStart(2, '0');
                timeInput.value = `${hour}:${minute}`;
                
                console.log(`â° ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸: ${hour}:${minute}`);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initializeTimeDropdowns() {
            const timeInput = document.getElementById('email-time-input');
            const hourSelect = document.getElementById('email-hour-select');
            const minuteSelect = document.getElementById('email-minute-select');
            
            if (timeInput && hourSelect && minuteSelect) {
                const [hours, minutes] = timeInput.value.split(':');
                hourSelect.value = hours;
                minuteSelect.value = minutes;
                
                console.log(`â° ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”: ${hours}:${minutes}`);
            }
        }

        // ìƒˆ ì˜ˆì•½ ëª¨ë‹¬ ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateNewScheduleTime() {
            const hourSelect = document.getElementById('new-schedule-hour');
            const minuteSelect = document.getElementById('new-schedule-minute');
            const timeInput = document.getElementById('new-schedule-time');
            
            if (hourSelect && minuteSelect && timeInput) {
                const hour = hourSelect.value.padStart(2, '0');
                const minute = minuteSelect.value.padStart(2, '0');
                timeInput.value = `${hour}:${minute}`;
                
                console.log(`â° ìƒˆ ì˜ˆì•½ ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸: ${hour}:${minute}`);
            }
        }

        // ì˜ˆì•½ ì‹œê°„ ê°±ì‹  í•¨ìˆ˜ (ì´ë²ˆ ë°œì†¡ ì‹œê°„ì´ ê³¼ê±°ì¸ ê²½ìš°)
        function updateScheduleTimeIfNeeded(schedule) {
            const now = new Date();
            const currentSendTime = parseNextSendTime(schedule.currentSend);
            
            if (!currentSendTime) {
                console.warn(`âš ï¸ ì´ë²ˆ ë°œì†¡ ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨: ${schedule.currentSend}`);
                return;
            }
            
            // ì´ë²ˆ ë°œì†¡ ì‹œê°„ì´ í˜„ì¬ë³´ë‹¤ ê³¼ê±°ì¸ ê²½ìš° ê°±ì‹ 
            if (currentSendTime < now) {
                console.log(`â° ì˜ˆì•½ ì‹œê°„ ê°±ì‹  í•„ìš”: ${schedule.title}`);
                console.log(`   í˜„ì¬ ì‹œê°„: ${now.toLocaleString('ko-KR')}`);
                console.log(`   ì´ë²ˆ ë°œì†¡ ì‹œê°„: ${currentSendTime.toLocaleString('ko-KR')}`);
                
                // ì´ë²ˆ ë°œì†¡ <- ë‹¤ìŒ ë°œì†¡
                schedule.currentSend = schedule.nextSend;
                
                // ë‹¤ìŒ ë°œì†¡ <- ë‹¤ìŒ ë°œì†¡ + ì£¼ê¸°
                const frequency = getFrequencyValue(schedule.frequency);
                if (frequency) {
                    schedule.nextSend = calculateNextSendTimeFromCurrent(schedule.currentSend, frequency);
                }
                
                console.log(`   ê°±ì‹  í›„ ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                console.log(`   ê°±ì‹  í›„ ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
                
                // ê°±ì‹ ëœ ë‚´ìš©ì„ window.emailScheduleListì— ì €ì¥
                saveScheduleUpdatesToStorage(schedule);
                
                // ì‹œê°„ì´ ê°±ì‹ ë˜ì—ˆìœ¼ë¯€ë¡œ íŒì—…ë„ ìƒˆë¡œê³ ì¹¨
                console.log('ğŸ”„ ì‹œê°„ ê°±ì‹ ìœ¼ë¡œ ì¸í•œ íŒì—… ìƒˆë¡œê³ ì¹¨ ìš”ì²­');
                refreshEmailScheduleList();
            }
        }
        
        // ì˜ˆì•½ ì •ë³´ ì—…ë°ì´íŠ¸ë¥¼ ì €ì¥ì†Œì— ë°˜ì˜í•˜ëŠ” í•¨ìˆ˜
        function saveScheduleUpdatesToStorage(updatedSchedule) {
            if (window.emailScheduleList) {
                const index = window.emailScheduleList.findIndex(s => s.id === updatedSchedule.id);
                if (index !== -1) {
                    window.emailScheduleList[index] = updatedSchedule;
                    console.log(`ğŸ’¾ ì˜ˆì•½ ì •ë³´ ì €ì¥ì†Œ ì—…ë°ì´íŠ¸: ${updatedSchedule.title}`);
                }
            }
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ (ë©”ì¼ ë°œì†¡ í›„ ì‚¬ìš©)
        function refreshEmailScheduleList() {
            console.log('ğŸ”„ [POPUP] ===== ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ ì‹œì‘ =====');
            
            const modal = document.getElementById('email-schedule-modal');
            console.log(`ğŸ”„ [POPUP] ëª¨ë‹¬ ì¡´ì¬ ì—¬ë¶€: ${!!modal}`);
            
            if (modal) {
                console.log('ğŸ”„ [POPUP] ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ ì¤‘...');
                console.log(`ğŸ”„ [POPUP] ìƒˆë¡œê³ ì¹¨ ì‹œê°„: ${new Date().toLocaleString('ko-KR')}`);
                
                // window.emailScheduleList ì¡´ì¬ ì—¬ë¶€ í™•ì¸
                console.log(`ğŸ”„ [POPUP] window.emailScheduleList ì¡´ì¬: ${!!window.emailScheduleList}`);
                if (window.emailScheduleList) {
                    console.log(`ğŸ”„ [POPUP] ì˜ˆì•½ ê°œìˆ˜: ${window.emailScheduleList.length}ê°œ`);
                }
                
                // ì‹œê°„ ê°±ì‹  ì ìš©
                if (window.emailScheduleList) {
                    console.log('ğŸ”„ [POPUP] ê° ì˜ˆì•½ì— ëŒ€í•´ ì‹œê°„ ê°±ì‹  ì ìš© ì¤‘...');
                    window.emailScheduleList.forEach((schedule, index) => {
                        console.log(`ğŸ”„ [POPUP] ì˜ˆì•½ ${index + 1} ê°±ì‹  ì „:`);
                        console.log(`ğŸ”„ [POPUP]   - ì œëª©: ${schedule.title}`);
                        console.log(`ğŸ”„ [POPUP]   - ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                        console.log(`ğŸ”„ [POPUP]   - ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
                        
                        updateScheduleTimeIfNeeded(schedule);
                        
                        console.log(`ğŸ”„ [POPUP] ì˜ˆì•½ ${index + 1} ê°±ì‹  í›„:`);
                        console.log(`ğŸ”„ [POPUP]   - ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                        console.log(`ğŸ”„ [POPUP]   - ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
                    });
                }
                
                // í…Œì´ë¸” ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸ (ëª¨ë‹¬ì€ ìœ ì§€)
                const tableContent = document.getElementById('schedule-list-content');
                console.log(`ğŸ”„ [POPUP] í…Œì´ë¸” ì»¨í…ì¸  ìš”ì†Œ ì¡´ì¬: ${!!tableContent}`);
                
                if (tableContent && window.emailScheduleList) {
                    const scheduleList = window.emailScheduleList;
                    console.log(`ğŸ”„ [POPUP] í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘, ì˜ˆì•½ ê°œìˆ˜: ${scheduleList.length}ê°œ`);
                    
                    // ê° ì˜ˆì•½ í•­ëª©ë³„ HTML ìƒì„± ì‹œ ë¡œê·¸
                    console.log('ğŸ”„ [POPUP] ê° ì˜ˆì•½ë³„ HTML ìƒì„± ì¤‘...');
                    scheduleList.forEach((item, index) => {
                        console.log(`ğŸ”„ [POPUP] ì˜ˆì•½ ${index + 1} HTML ìƒì„±:`);
                        console.log(`ğŸ”„ [POPUP]   - ID: ${item.id}`);
                        console.log(`ğŸ”„ [POPUP]   - ì œëª©: ${item.title}`);
                        console.log(`ğŸ”„ [POPUP]   - ìƒíƒœ: ${item.status}`);
                        console.log(`ğŸ”„ [POPUP]   - ì´ë²ˆ ë°œì†¡ (HTMLìš©): ${item.currentSend || item.nextSend}`);
                        console.log(`ğŸ”„ [POPUP]   - ë‹¤ìŒ ë°œì†¡ (HTMLìš©): ${item.nextSend}`);
                    });

                    // í…Œì´ë¸” ë‚´ìš© ì¬ìƒì„±
                    const newHTML = scheduleList.map(item => `
                        <div class="schedule-item" data-id="${item.id}" data-status="${item.status}" style="
                            display: grid;
                            grid-template-columns: 2fr 1fr 1.2fr 1.2fr 1.5fr 0.8fr 0.8fr 0.8fr;
                            gap: 15px;
                            padding: 15px;
                            border-bottom: 1px solid #3a3a3a;
                            color: #e1e1e1;
                            font-size: 14px;
                            transition: background-color 0.2s ease;
                        " onmouseover="this.style.backgroundColor='#3a3a3a'" onmouseout="this.style.backgroundColor='transparent'">
                            <!-- ì œëª© (í¸ì§‘ ê°€ëŠ¥) -->
                            <div style="cursor: pointer;" onclick="editField(this, ${item.id}, 'title')">
                                <div class="editable-field" data-field="title" style="font-weight: 600; color: #fff; margin-bottom: 5px;">${item.title}</div>
                                <div style="color: #7a7a7a; font-size: 12px;">${item.message}</div>
                            </div>
                            <!-- ì£¼ê¸° (í¸ì§‘ ê°€ëŠ¥) -->
                            <div style="cursor: pointer;" onclick="editField(this, ${item.id}, 'frequency')">
                                <div class="editable-field" data-field="frequency">${item.frequency}</div>
                            </div>
                            <!-- ì´ë²ˆ ë°œì†¡ (í¸ì§‘ ê°€ëŠ¥) -->
                            <div style="cursor: pointer;" onclick="editField(this, ${item.id}, 'currentSend')">
                                <div class="editable-field" data-field="currentSend" style="color: #ff9800; font-weight: 600;">${item.currentSend || item.nextSend}</div>
                            </div>
                            <!-- ë‹¤ìŒ ë°œì†¡ (ìë™ ê³„ì‚°) -->
                            <div class="next-send-time" style="color: #7a7a7a;">${item.nextSend}</div>
                            <!-- ìˆ˜ì‹ ì (í¸ì§‘ ê°€ëŠ¥) -->
                            <div style="cursor: pointer;" onclick="editField(this, ${item.id}, 'recipients')">
                                <div class="editable-field" data-field="recipients">${item.recipients}</div>
                            </div>
                            <div style="text-align: center;">
                                <input type="radio" name="status-${item.id}" value="active" ${item.status === 'í™œì„±' ? 'checked' : ''} 
                                       onchange="updateScheduleStatus(${item.id}, 'í™œì„±')" style="
                                    width: 16px;
                                    height: 16px;
                                    accent-color: #4a9eff;
                                ">
                            </div>
                            <div style="text-align: center;">
                                <input type="radio" name="status-${item.id}" value="inactive" ${item.status === 'ë¹„í™œì„±' ? 'checked' : ''} 
                                       onchange="updateScheduleStatus(${item.id}, 'ë¹„í™œì„±')" style="
                                    width: 16px;
                                    height: 16px;
                                    accent-color: #4a9eff;
                                ">
                            </div>
                            <div style="text-align: center;">
                                <button onclick="deleteSchedule(${item.id})" style="
                                    background: none;
                                    border: none;
                                    color: #ff4757;
                                    cursor: pointer;
                                    padding: 4px;
                                    font-size: 16px;
                                    font-weight: bold;
                                ">Ã—</button>
                            </div>
                        </div>
                    `).join('');
                    
                    console.log('ğŸ”„ [POPUP] í…Œì´ë¸” innerHTML ì—…ë°ì´íŠ¸ ì¤‘...');
                    console.log(`ğŸ”„ [POPUP] ê¸°ì¡´ innerHTML ê¸¸ì´: ${tableContent.innerHTML.length}`);
                    tableContent.innerHTML = newHTML;
                    console.log(`ğŸ”„ [POPUP] ìƒˆë¡œìš´ innerHTML ê¸¸ì´: ${tableContent.innerHTML.length}`);
                    console.log('âœ… [POPUP] í…Œì´ë¸” HTML ì—…ë°ì´íŠ¸ ì™„ë£Œ!');
                    
                    // ì´ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                    const totalCountElement = modal.querySelector('.pagination-info span');
                    console.log(`ğŸ”„ [POPUP] ì´ ê°œìˆ˜ ìš”ì†Œ ì¡´ì¬: ${!!totalCountElement}`);
                    if (totalCountElement) {
                        const oldCount = totalCountElement.textContent;
                        totalCountElement.textContent = scheduleList.length;
                        console.log(`ğŸ”„ [POPUP] ì´ ê°œìˆ˜ ì—…ë°ì´íŠ¸: ${oldCount} â†’ ${scheduleList.length}`);
                    }
                    
                    console.log('âœ… [POPUP] ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                } else {
                    console.log('âŒ [POPUP] í…Œì´ë¸” ì»¨í…ì¸  ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
                }
            } else {
                console.log('âŒ [POPUP] ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ì´ ì—†ì–´ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
            }
            
            console.log('ğŸ”„ [POPUP] ===== ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ ì¢…ë£Œ =====');
        }

        document.addEventListener('DOMContentLoaded', function() {
            
            // ê¸°ë³¸ ì„¤ì • í›„
            setTimeout(async () => {
                // ë“œë¡­ë‹¤ìš´ì—ì„œ ì´ˆê¸° ì°¨íŠ¸ ì„¤ì •
                const chartSelect = document.getElementById('chartSelect');
                if (chartSelect) {
                    chartSelect.value = 'activity-trend';
                    await switchChart('activity-trend');
                }
                console.log('=== í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘ ===');
                await refreshAllRealData(); // ìë™ ìƒˆë¡œê³ ì¹¨
                
                // ìˆ˜ì‹ ì ìˆ˜ ì´ˆê¸°í™”
                setTimeout(() => {
                    updateRecipientCount();
                }, 2000); // ë°ì´í„° ë¡œë“œ í›„ ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚°

                // ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
                setTimeout(() => {
                    initializeTimeDropdowns();
                    initializeBackupTimeDropdowns();
                }, 1000); // UI ë¡œë“œ í›„ ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”

                // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ í† ê¸€ ìƒíƒœ ì´ˆê¸°í™”
                setTimeout(() => {
                    const emailToggle = document.querySelector('#settings .toggle-switch');
                    if (emailToggle) {
                        // ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™” ìƒíƒœë¡œ ì‹œì‘
                        emailToggle.classList.remove('off');
                        emailSchedulerActive = true;
                        console.log('ğŸ“… ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ í† ê¸€ ì´ˆê¸°í™”: í™œì„±í™” ìƒíƒœ');
                        
                        // ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
                        startEmailScheduler();

                        // ì´ˆê¸° í‘œì‹œ ìƒíƒœ ì ìš©
                        const freqEl = document.getElementById('email-frequency-setting');
                        const timeEl = document.getElementById('email-time-setting');
                        if (freqEl) freqEl.style.display = '';
                        if (timeEl) timeEl.style.display = '';
                    }

                    // ìë™ ë°±ì—… í† ê¸€ì€ ê¸°ë³¸ ë¹„í™œì„± ìƒíƒœ ìœ ì§€, í‘œì‹œ ìƒíƒœë§Œ ì´ˆê¸°í™”
                    const backupToggleItem = Array.from(document.querySelectorAll('#settings .setting-item'))
                        .find(item => item.querySelector('.setting-label') && item.querySelector('.setting-label').textContent.trim() === 'ìë™ ë°±ì—…');
                    if (backupToggleItem) {
                        const toggle = backupToggleItem.querySelector('.toggle-switch');
                        if (toggle && toggle.classList.contains('off')) {
                            handleBackupToggle(false);
                        }
                    }

                    // ì²¨ë¶€ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸° ë Œë”ë§
                    setTimeout(() => {
                        renderAttachmentMemberLists();
                        // Export ë²”ìœ„ ì´ˆê¸° í‘œì‹œ ìƒíƒœ ë™ê¸°í™”
                        // Export ì¢…ë¥˜ ì´ˆê¸° ìƒíƒœ: ëª¨ë‘ ë¯¸ì„ íƒ
                        ['export-type-summary','export-type-raw','export-type-members','export-type-all'].forEach(id => {
                            const el = document.getElementById(id);
                            if (el) el.checked = false;
                        });
                        handleExportTypeCheckboxChange();
                        // Export í˜•ì‹ ì˜µì…˜ ì´ˆê¸° í‘œì‹œ ìƒíƒœ ë™ê¸°í™”
                        const exportFormat = document.getElementById('export-format-select');
                        if (exportFormat) handleExportFormatChange(exportFormat.value);
                    }, 500);
                }, 3000); // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ í† ê¸€ ìƒíƒœ ì´ˆê¸°í™”
            }, 100);
        });

        // ===== í¸ì§‘ ê°€ëŠ¥í•œ í…Œì´ë¸” ê´€ë ¨ í•¨ìˆ˜ë“¤ =====
        
        // ì„ì‹œ ì €ì¥ìš© ë³€ìˆ˜ (ì‚¬ìš©ìê°€ ì €ì¥ì„ ëˆ„ë¥´ê¸° ì „ê¹Œì§€ì˜ ë³€ê²½ì‚¬í•­ ì €ì¥)
        let tempScheduleChanges = {};
        
        // í•„ë“œ í¸ì§‘ í•¨ìˆ˜
        function editField(element, scheduleId, fieldName) {
            console.log(`ğŸ“ [EDIT] í•„ë“œ í¸ì§‘ ì‹œì‘: ID=${scheduleId}, í•„ë“œ=${fieldName}`);
            
            // ì´ë¯¸ í¸ì§‘ ì¤‘ì¸ ë‹¤ë¥¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì¢…ë£Œ
            const existingInput = document.querySelector('.editing-input');
            if (existingInput) {
                existingInput.blur();
                return;
            }
            
            // ì˜¬ë°”ë¥¸ í¸ì§‘ ëŒ€ìƒ ìš”ì†Œ ì°¾ê¸°
            let editableElement;
            if (element.querySelector) {
                // í´ë¦­ëœ ìš”ì†Œ ë‚´ì—ì„œ í•´ë‹¹ í•„ë“œì˜ í¸ì§‘ ê°€ëŠ¥í•œ ìš”ì†Œ ì°¾ê¸°
                editableElement = element.querySelector(`[data-field="${fieldName}"]`);
                if (!editableElement) {
                    // fallback: ì¼ë°˜ì ì¸ editable-field ì°¾ê¸°
                    editableElement = element.querySelector('.editable-field');
                }
            } else {
                editableElement = element;
            }
            
            if (!editableElement) {
                console.warn(`âš ï¸ [EDIT] í¸ì§‘ ëŒ€ìƒ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${fieldName}`);
                return;
            }
            
            const currentValue = editableElement.textContent.trim();
            console.log(`ğŸ“ [EDIT] í˜„ì¬ ê°’: "${currentValue}"`);
            
            // í¸ì§‘ UI ìƒì„±
            let inputElement;
            
            if (fieldName === 'frequency') {
                // ì£¼ê¸°ëŠ” ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ (ê¸°ì¡´ ë°œì†¡ ì£¼ê¸°ì™€ ë™ì¼í•œ ì˜µì…˜)
                inputElement = document.createElement('select');
                inputElement.innerHTML = `
                    <option value="daily" ${currentValue === 'daily' || currentValue === 'ë§¤ì¼' ? 'selected' : ''}>ë§¤ì¼</option>
                    <option value="weekly" ${currentValue === 'weekly' || currentValue === 'ë§¤ì£¼' ? 'selected' : ''}>ë§¤ì£¼</option>
                    <option value="monthly" ${currentValue === 'monthly' || currentValue === 'ë§¤ì›”' ? 'selected' : ''}>ë§¤ì›”</option>
                `;
                inputElement.style.cssText = `
                    background: #2a2a2a;
                    color: #fff;
                    border: 1px solid #4a9eff;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 14px;
                    width: 100%;
                `;
                
                // ë“œë¡­ë‹¤ìš´ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                inputElement.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                // ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ í¸ì§‘ ì™„ë£Œ
                inputElement.addEventListener('change', function(e) {
                    e.stopPropagation();
                    finishEdit();
                });
            } else if (fieldName === 'currentSend') {
                // ì´ë²ˆ ë°œì†¡ì€ datetime-local ì…ë ¥
                inputElement = document.createElement('input');
                inputElement.type = 'datetime-local';
                
                // í˜„ì¬ ê°’ì„ datetime-local í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const dateValue = parseNextSendTime(currentValue);
                if (dateValue) {
                    // UTC ì‹œê°„ì„ ë¡œì»¬ ì‹œê°„ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ datetime-local í˜•ì‹ìœ¼ë¡œ ì„¤ì •
                    const year = dateValue.getFullYear();
                    const month = String(dateValue.getMonth() + 1).padStart(2, '0');
                    const day = String(dateValue.getDate()).padStart(2, '0');
                    const hours = String(dateValue.getHours()).padStart(2, '0');
                    const minutes = String(dateValue.getMinutes()).padStart(2, '0');
                    inputElement.value = `${year}-${month}-${day}T${hours}:${minutes}`;
                }
                
                inputElement.style.cssText = `
                    background: #2a2a2a;
                    color: #fff;
                    border: 1px solid #4a9eff;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 14px;
                    width: 100%;
                `;
                
                // datetime-local í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                inputElement.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                // ê°’ ë³€ê²½ ì‹œ ì¦‰ì‹œ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ/ì‹œê°„ ë³€ê²½ ëª¨ë‘ ë°˜ì˜)
                inputElement.addEventListener('change', function(e) {
                    e.stopPropagation();
                    finishEdit();
                });
            } else {
                // ê¸°ë³¸ í…ìŠ¤íŠ¸ ì…ë ¥
                inputElement = document.createElement('input');
                inputElement.type = 'text';
                inputElement.value = currentValue;
                inputElement.style.cssText = `
                    background: #2a2a2a;
                    color: #fff;
                    border: 1px solid #4a9eff;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 14px;
                    width: 100%;
                `;
                
                // í…ìŠ¤íŠ¸ ì…ë ¥ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                inputElement.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            inputElement.className = 'editing-input';
            
            // í¸ì§‘ ì™„ë£Œ ì²˜ë¦¬
            function finishEdit() {
                let newValue;
                
                if (fieldName === 'currentSend' && inputElement.value) {
                    // datetime-local ê°’ì„ ì•ˆì •ì ìœ¼ë¡œ í•œêµ­ì–´ ë‚ ì§œ + 24ì‹œê°„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (íƒ€ì„ì¡´ ì˜í–¥ ì œê±°)
                    const match = inputElement.value.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/);
                    if (match) {
                        const year = parseInt(match[1], 10);
                        const month = parseInt(match[2], 10) - 1;
                        const day = parseInt(match[3], 10);
                        const hour = match[4];
                        const minute = match[5];
                        const datePart = new Date(year, month, day).toLocaleDateString('ko-KR'); // ì˜ˆ: "2025. 8. 7."
                        newValue = `${datePart} ${hour}:${minute}`; // ì˜ˆ: "2025. 8. 7. 09:30"
                    } else {
                        // ì˜ˆì™¸ì ìœ¼ë¡œ í¬ë§·ì´ ë‹¤ë¥¼ ê²½ìš°ì˜ ì•ˆì „ ì¥ì¹˜
                        newValue = inputElement.value.replace('T', ' ').replace(/-/g, '. ');
                    }
                } else if (fieldName === 'frequency') {
                    // ì£¼ê¸° ê°’ì€ ë“œë¡­ë‹¤ìš´ì˜ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
                    const selectedOption = inputElement.options[inputElement.selectedIndex];
                    newValue = selectedOption.text; // "ë§¤ì¼", "ë§¤ì£¼", "ë§¤ì›”"
                } else {
                    newValue = inputElement.value.trim();
                }
                
                if (newValue && newValue !== currentValue) {
                    console.log(`ğŸ“ [EDIT] ê°’ ë³€ê²½: "${currentValue}" â†’ "${newValue}"`);
                    console.log(`ğŸ“ [EDIT] í•„ë“œëª…: ${fieldName}, ìŠ¤ì¼€ì¤„ID: ${scheduleId}`);
                    
                    // ì„ì‹œ ë³€ê²½ì‚¬í•­ ì €ì¥
                    if (!tempScheduleChanges[scheduleId]) {
                        tempScheduleChanges[scheduleId] = {};
                    }
                    tempScheduleChanges[scheduleId][fieldName] = newValue;
                    
                    // ì£¼ê¸°ë‚˜ ì´ë²ˆ ë°œì†¡ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ ë‹¤ìŒ ë°œì†¡ ìë™ ê³„ì‚°
                    if (fieldName === 'frequency' || fieldName === 'currentSend') {
                        calculateAndUpdateNextSend(scheduleId);
                    }
                    
                    // UI ì—…ë°ì´íŠ¸ - ì˜¬ë°”ë¥¸ í•„ë“œ ì°¾ê¸°
                    const scheduleRow = document.querySelector(`[data-id="${scheduleId}"]`);
                    console.log(`ğŸ“ [EDIT] ìŠ¤ì¼€ì¤„ í–‰ ì°¾ê¸°: ${!!scheduleRow}`);
                    if (scheduleRow) {
                        const targetElement = scheduleRow.querySelector(`[data-field="${fieldName}"]`);
                        console.log(`ğŸ“ [EDIT] ëŒ€ìƒ ìš”ì†Œ ì°¾ê¸°: ${!!targetElement}, ì„ íƒì: [data-field="${fieldName}"]`);
                        if (targetElement) {
                            targetElement.textContent = newValue;
                            targetElement.style.backgroundColor = '#3a4a3a'; // ë³€ê²½ë¨ í‘œì‹œ
                            console.log(`ğŸ“ [EDIT] UI ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${fieldName} = ${newValue}`);
                        } else {
                            console.warn(`âš ï¸ [EDIT] ëŒ€ìƒ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${fieldName}`);
                            // ë””ë²„ê¹…ì„ ìœ„í•´ ëª¨ë“  data-field ìš”ì†Œ ì¶œë ¥
                            const allDataFields = scheduleRow.querySelectorAll('[data-field]');
                            console.log(`ğŸ“ [EDIT] ì‚¬ìš© ê°€ëŠ¥í•œ data-field ìš”ì†Œë“¤:`, Array.from(allDataFields).map(el => el.getAttribute('data-field')));
                        }
                    }
                    
                    // ì›ë˜ í¸ì§‘ ìš”ì†Œë„ ì—…ë°ì´íŠ¸ (fallback)
                    if (editableElement) {
                        editableElement.textContent = newValue;
                        editableElement.style.backgroundColor = '#3a4a3a';
                        console.log(`ğŸ“ [EDIT] ì›ë˜ ìš”ì†Œ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${fieldName} = ${newValue}`);
                    }
                    
                    console.log(`ğŸ“ [EDIT] ì„ì‹œ ë³€ê²½ì‚¬í•­ ì €ì¥ ì™„ë£Œ`);
                }
                
                // ì…ë ¥ í•„ë“œë¥¼ ì›ë˜ ìš”ì†Œë¡œ ë³µì›
                const scheduleRow = document.querySelector(`[data-id="${scheduleId}"]`);
                if (scheduleRow) {
                    const targetElement = scheduleRow.querySelector(`[data-field="${fieldName}"]`);
                    if (targetElement) {
                        targetElement.style.display = 'block';
                    }
                }
                inputElement.remove();
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ë“œë¡­ë‹¤ìš´ì€ change ì´ë²¤íŠ¸ë¡œ ì²˜ë¦¬ë˜ë¯€ë¡œ blur ì´ë²¤íŠ¸ ì œì™¸)
            if (fieldName !== 'frequency') {
                inputElement.addEventListener('blur', finishEdit);
            }
            inputElement.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    finishEdit();
                } else if (e.key === 'Escape') {
                    editableElement.style.display = 'block';
                    inputElement.remove();
                }
            });
            
            // ê¸°ì¡´ ìš”ì†Œ ìˆ¨ê¸°ê³  ì…ë ¥ í•„ë“œ í‘œì‹œ
            editableElement.style.display = 'none';
            editableElement.parentNode.insertBefore(inputElement, editableElement.nextSibling);
            inputElement.focus();
            
            if (inputElement.type === 'text') {
                inputElement.select();
            }
        }
        
        // ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ìë™ ê³„ì‚° ë° ì—…ë°ì´íŠ¸
        function calculateAndUpdateNextSend(scheduleId) {
            console.log(`ğŸ”„ [CALC] ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° ì‹œì‘: ID=${scheduleId}`);
            
            const changes = tempScheduleChanges[scheduleId];
            if (!changes) return;
            
            // í˜„ì¬ ìŠ¤ì¼€ì¤„ ì°¾ê¸°
            const currentSchedule = window.emailScheduleList.find(s => s.id == scheduleId);
            if (!currentSchedule) return;
            
            // ë³€ê²½ëœ ì£¼ê¸°ì™€ ì´ë²ˆ ë°œì†¡ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
            const frequency = changes.frequency || currentSchedule.frequency;
            const currentSend = changes.currentSend || currentSchedule.currentSend || currentSchedule.nextSend;
            
            console.log(`ğŸ”„ [CALC] ê³„ì‚° ê¸°ì¤€: ì£¼ê¸°=${frequency}, ì´ë²ˆë°œì†¡=${currentSend}`);
            
            // ì£¼ê¸° ê°’ ë³€í™˜
            const frequencyValue = getFrequencyValue(frequency);
            if (!frequencyValue) {
                console.warn(`âš ï¸ [CALC] ìœ íš¨í•˜ì§€ ì•Šì€ ì£¼ê¸°: ${frequency}`);
                return;
            }
            
            // ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°
            const nextSend = calculateNextSendTimeFromCurrent(currentSend, frequencyValue);
            console.log(`ğŸ”„ [CALC] ê³„ì‚° ê²°ê³¼: ë‹¤ìŒë°œì†¡=${nextSend}`);
            
            // ì„ì‹œ ë³€ê²½ì‚¬í•­ì— ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ì €ì¥
            changes.nextSend = nextSend;
            
            // UIì—ì„œ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ì—…ë°ì´íŠ¸ (ì •í™•í•œ ì„ íƒì ì‚¬ìš©)
            const scheduleRow = document.querySelector(`[data-id="${scheduleId}"]`);
            if (scheduleRow) {
                const nextSendDiv = scheduleRow.querySelector('.next-send-time');
                if (nextSendDiv) {
                    nextSendDiv.textContent = nextSend;
                    nextSendDiv.style.backgroundColor = '#3a4a3a'; // ë³€ê²½ë¨ í‘œì‹œ
                    console.log(`ğŸ”„ [CALC] ë‹¤ìŒ ë°œì†¡ ì‹œê°„ UI ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${nextSend}`);
                } else {
                    console.warn(`âš ï¸ [CALC] ë‹¤ìŒ ë°œì†¡ ì‹œê°„ divë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
                }
            }
            
            console.log(`âœ… [CALC] ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° ë° UI ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
        }
        
        // ëª¨ë“  ë³€ê²½ì‚¬í•­ ì €ì¥
        function saveScheduleChanges() {
            console.log(`ğŸ’¾ [SAVE] ë³€ê²½ì‚¬í•­ ì €ì¥ ì‹œì‘`);
            console.log(`ğŸ’¾ [SAVE] ì„ì‹œ ë³€ê²½ì‚¬í•­:`, tempScheduleChanges);
            
            let savedCount = 0;
            
            // ê° ë³€ê²½ëœ ìŠ¤ì¼€ì¤„ì— ëŒ€í•´ ì²˜ë¦¬
            for (const scheduleId in tempScheduleChanges) {
                const changes = tempScheduleChanges[scheduleId];
                const scheduleIndex = window.emailScheduleList.findIndex(s => s.id == scheduleId);
                
                if (scheduleIndex !== -1) {
                    // ë³€ê²½ì‚¬í•­ì„ ì‹¤ì œ ë°ì´í„°ì— ì ìš©
                    Object.assign(window.emailScheduleList[scheduleIndex], changes);
                    savedCount++;
                    
                    console.log(`ğŸ’¾ [SAVE] ìŠ¤ì¼€ì¤„ ${scheduleId} ì €ì¥ ì™„ë£Œ:`, changes);
                } else {
                    console.warn(`âš ï¸ [SAVE] ìŠ¤ì¼€ì¤„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ID=${scheduleId}`);
                }
            }
            
            if (savedCount > 0) {
                // ë³€ê²½ì‚¬í•­ ì´ˆê¸°í™”
                tempScheduleChanges = {};
                
                // UIì—ì„œ ë³€ê²½ë¨ í‘œì‹œ ì œê±°
                document.querySelectorAll('.schedule-item div[style*="background-color: rgb(58, 74, 58)"]').forEach(element => {
                    element.style.backgroundColor = '';
                });
                
                // í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                refreshEmailScheduleList();
                
                // ì„±ê³µ ë©”ì‹œì§€
                showSimpleAlert(`âœ… ${savedCount}ê°œì˜ ì˜ˆì•½ ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                
                console.log(`âœ… [SAVE] ì´ ${savedCount}ê°œ ìŠ¤ì¼€ì¤„ ì €ì¥ ì™„ë£Œ`);
            } else {
                showSimpleAlert('â„¹ï¸ ì €ì¥í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
                console.log(`â„¹ï¸ [SAVE] ì €ì¥í•  ë³€ê²½ì‚¬í•­ ì—†ìŒ`);
            }
        }

    </script>
</body>
</html>